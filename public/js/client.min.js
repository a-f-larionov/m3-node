function _(window){"use strict";let CONST_IS_SERVER_SIDE=!1,CONST_IS_CLIENT_SIDE=!0,thisIsASomeLongNameVariable=54343470,THIS_IS_SOME_LONG_NAME_CONSTNATN=2343243,log=console.log,error=function(t){throw console.log("Ошибка: "+t),new Error(t)},getQueryVariable=function(t){let e=window.location.search.substring(1).split("&");for(let i=0;i<e.length;i++){let n=e[i].split("=");if(n[0]===t)return n[1]}Logs.log("Query Variable "+t+" not found",Logs.LEVEL_WARNING)};function declination(t,e){return e[t%100>4&&t%100<20?2:[2,0,1,1,1,2][t%10<5?t%10:5]]}window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){return window.setTimeout(t,1e3/60)}),window.cancelAnimationFrame||(window.cancelAnimationFrame=window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame);let AnimLocker={locks:0,lock:function(){AnimLocker.locks++},release:function(){AnimLocker.locks--},free:function(){return 0===AnimLocker.locks},busy:function(){return!AnimLocker.free()}},Animate={anim:function(t,e){let i,n,o,s;o=0,n=new t;for(let t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);(i=Array.from(arguments)).shift(),i.shift(),n.init.apply(n,i),n.skipAnimLock||AnimLocker.lock();let a=function(){o+=Config.OnIdle.animStep,n.iterate(o)?s=requestAnimationFrame(a):r()},r=function(){cancelAnimationFrame(s),n.finish&&n.finish(),n.skipAnimLock||AnimLocker.release(),e.onFinish&&e.onFinish()};return a(),r},getFrameUrl:function(t,e,i){return t+(Math.floor(e%i)+1)+".png"},settings:{fallVelocity:5}},animClouds=function(){let t,e;this.init=function(i){this.skipAnimLock=!0,t=[],(e=i).forEach(function(e,i){e.vx=0,e.vy=0,t[i]={x:e.x,y:e.y}})},this.cycleIt=function(i){let n;n={x:Math.random()-.5,y:Math.random()-.5},e.forEach(function(o,s){let a,r,l;a=r=l=0,e.forEach(function(t){a=t.x-o.x,r=t.y-o.y,Math.abs(a)<10||Math.abs(r)<10||(l=Math.sqrt(Math.pow(a,2)+Math.pow(r,2)))}),i%1e3==1&&(o.vx+=n.x,o.vy+=n.y),o.vx+=.01*(Math.random()-.5),o.vy+=.01*(Math.random()-.5);a=o.x-t[s].x,r=o.y-t[s].y,a>30&&(o.vx-=1),r>30&&(o.vy-=1),a<-30&&(o.vx+=1),r<-30&&(o.vy+=1),o.vx*=.9999,o.vy*=.95,o.x+=o.vx/10,o.y+=o.vy/10})},this.iterate=function(t){for(let e=0;e<1;e++)this.cycleIt(t);return e.forEach(function(t){t.redraw()}),!0},this.onFinish=function(){}},animShowDialog=function(){let t=70;this.init=function(e){t=e,this.skipAnimLock=!0},this.iterate=function(e){return this.dom.y=20*e-500,this.dom.redraw(),this.dom.y<t},this.finish=function(){this.dom.y=t,this.dom.redraw()}},animHideDialog=function(){let t=70;this.init=function(e){t=e,this.skipAnimLock=!0,t=this.dom.y},this.iterate=function(e){return this.dom.y=t+-20*e,this.dom.redraw(),this.dom.y>-500},this.finish=function(){this.dom.y=-500,this.dom.redraw()}},animChangeAndBack=function(){let t,e,i,n,o,s;i=5,o=Math.floor(20),n=Math.floor(o/2),this.init=function(i,n){e={x:5*(n.x-i.x),y:5*(n.y-i.y)},t=this.gemDoms[i.x][i.y],s={x:t.x,y:t.y}},this.iterate=function(i){return i>n?(t.x=s.x+n*e.x-e.x*(i-n),t.y=s.y+n*e.y-e.y*(i-n)):(t.x=s.x+e.x*i,t.y=s.y+e.y*i),t.redraw(),t.bindedDoms.length&&t.bindedDoms.forEach(function(e){e.x=t.x,e.y=t.y,e.redraw()}),i+1<o}},animLightning=function(){let t;this.init=function(e,i){t=this.animDoms.pop();let n=Field.getVisibleLength(e,i);t.width=n.length*DataPoints.BLOCK_WIDTH,t.height=Images.getHeight("anim-light-1.png"),i===DataObjects.WITH_LIGHTNING_VERTICAL&&(t.rotate=90,t.x=e.x*DataPoints.BLOCK_WIDTH,t.y=n.lower*DataPoints.BLOCK_HEIGHT-(Images.getHeight("anim-light-1.png")-DataPoints.BLOCK_HEIGHT)/2,t.x-=(t.width-DataPoints.BLOCK_WIDTH)/2,t.y+=(t.width-DataPoints.BLOCK_WIDTH)/2),i===DataObjects.WITH_LIGHTNING_HORIZONTAL&&(t.rotate=0,t.x=n.lower*DataPoints.BLOCK_WIDTH,t.y=e.y*DataPoints.BLOCK_HEIGHT-(Images.getHeight("anim-light-1.png")-DataPoints.BLOCK_HEIGHT)/2),t.show(),t.redraw()},this.iterate=function(e){if(t.backgroundImage=Animate.getFrameUrl("anim-light-",.4*e,5),t.redraw(),.4*e<10)return!0},this.finish=function(){t.hide(),this.animDoms.push(t)}},animGemLightning=function(){this.skipAnimLock=!0,this.init=function(){switch(console.log("init-gem-anim"),this.objectId){case DataObjects.WITH_LIGHTNING_VERTICAL:this.dom.rotate=0;break;case DataObjects.WITH_LIGHTNING_HORIZONTAL:this.dom.rotate=90}console.log("anim gem lig"),console.log(this,arguments)},this.iterate=function(t){return this.dom.backgroundImage=Animate.getFrameUrl("a-gem-light-",.5*t,5),this.dom.redraw(),!0},this.finish=function(){this.dom.rotate=0}},animHummerDestroy=function(){let t;this.init=function(e){(t=this.animDoms.pop()).x=e.x*DataPoints.BLOCK_WIDTH-(Images.getWidth("anim-hd-1.png")-DataPoints.BLOCK_WIDTH)/2,t.y=e.y*DataPoints.BLOCK_HEIGHT-(Images.getHeight("anim-hd-1.png")-DataPoints.BLOCK_HEIGHT)/2,t.width=null,t.height=null,t.backgroundImage="anim-hd-1.png",t.show(),t.redraw()},this.iterate=function(e){return t.backgroundImage=Animate.getFrameUrl("anim-hd-",.6*e,12),t.redraw(),.6*e<12},this.finish=function(){this.animDoms.push(t),t.hide()}},animChangeAndDestroy=function(){let t,e,i,n,o;i=5,n=Math.floor(10)-1,this.init=function(i,n){e={x:5*(n.x-i.x),y:5*(n.y-i.y)},t=this.gemDoms[i.x][i.y],o={x:t.x,y:t.y}},this.iterate=function(i){return t.x=o.x+e.x*i,t.y=o.y+e.y*i,t.redraw(),t.bindedDoms.length&&t.bindedDoms.forEach(function(e){e.x=t.x,e.y=t.y,e.redraw()}),i<n}},animGemEmitFader=function(){let t,e=Animate.settings.fallVelocity;this.init=function(e){(t=this.gemDoms[e.x][e.y]).x=e.x*DataPoints.BLOCK_WIDTH,t.y=e.y*DataPoints.BLOCK_HEIGHT,t.backgroundPositionY=DataPoints.BLOCK_HEIGHT,t.height=0,t.width=DataPoints.BLOCK_WIDTH,t.backgroundImage=DataObjects.images[Field.getGemId(e)],t.redraw(),t.show()},this.iterate=function(i){return t.height=e*i,t.backgroundPositionY=DataPoints.BLOCK_HEIGHT-e*i,t.redraw(),t.height<DataPoints.BLOCK_HEIGHT}},animFallGems=function(){let t,e,i=this,n=Animate.settings.fallVelocity;this.init=function(n){t=[],n.forEach(function(n){i.gemDoms[n.from.x][n.from.y].hide(),e=i.gemDoms[n.to.x][n.to.y],t.push(e),e.fallMode="just",e.startY=(n.to.y-1)*DataPoints.BLOCK_HEIGHT,e.backgroundImage=DataObjects.images[Field.getGemId({x:n.to.x,y:n.to.y})],e.x=n.to.x*DataPoints.BLOCK_WIDTH,e.y=n.to.y*DataPoints.BLOCK_HEIGHT,e.show(),!Field.isVisible({x:n.to.x,y:n.to.y-1})&&Field.isVisible(n.to)&&(e.fallMode="to-show"),Field.isVisible({x:n.to.x,y:n.to.y-1})&&!Field.isVisible(n.to)&&(e.fallMode="to-hide"),"to-show"===e.fallMode&&(e.y=n.to.y*DataPoints.BLOCK_HEIGHT,e.height=25,e.width=DataPoints.BLOCK_WIDTH,e.backgroundPositionY=DataPoints.BLOCK_HEIGHT),e.redraw()})},this.iterate=function(e){let i;return i=!1,t.forEach(function(t){switch(t.fallMode){case"to-hide":t.y=t.startY+n*e,t.height=DataPoints.BLOCK_HEIGHT-n*e,i|=t.y<t.startY+DataPoints.BLOCK_HEIGHT;break;case"to-show":t.height=n*e,t.backgroundPositionY=DataPoints.BLOCK_HEIGHT-n*e,i|=t.height<DataPoints.BLOCK_HEIGHT;break;case"just":t.y=t.startY+n*e,i|=t.y<t.startY+DataPoints.BLOCK_HEIGHT}t.bindedDoms.length&&t.bindedDoms.forEach(function(e){e.x=t.x,e.y=t.y,e.redraw()}),t.redraw()}),i},this.finish=function(){t.forEach(function(t){t.backgroundPositionY=0,t.height=DataPoints.BLOCK_HEIGHT,t.redraw()})}},animShuffle=function(){let t;this.init=function(e,i){(t=this.animDoms.pop()).x=e-Images.getWidth("anim-shuffle-1.png")/2,t.y=i-Images.getHeight("anim-shuffle-1.png")/2,t.width=Images.getWidth("anim-shuffle-1.png"),t.height=Images.getHeight("anim-shuffle-1.png"),t.backgroundImage="anim-shuffle-1.png",t.opacity=.7,t.rotate=0,t.show()},this.iterate=function(e){return t.rotate=20*e,t.redraw(),e<18},this.finish=function(){t.hide(),this.animDoms.push(t)}},animHint=function(){let t,e;this.init=function(i,n){Animate.hintActive=!0,this.skipAnimLock=!0,e=n,t=[],i.forEach(function(e){t.push({startY:this.gemDoms[e.x][e.y].y,dom:this.gemDoms[e.x][e.y]}),this.gemDoms[e.x][e.y].bindedDoms.length&&this.gemDoms[e.x][e.y].bindedDoms.forEach(function(e){t.push({startY:e.y,dom:e})})},this)},this.iterate=function(i){return t.forEach(function(t){t.dom.y=t.startY+3*Math.cos(Math.PI*i/15),t.dom.redraw(),t.dom.bindedDoms&&t.dom.bindedDoms.forEach(function(e){e.x=t.x,e.y=t.y,e.redraw()})}),e||!AnimLocker.busy()},this.finish=function(){Animate.hintActive=!1}},animHintArrow=function(){let t,e;this.init=function(e){this.skipAnimLock=!0,t=[e]},this.iterate=function(i){return e=4*Math.cos(Math.PI/15*i),t.forEach(function(t){t.x=t.p.x+e/2,t.y=t.p.y+e/2,t.dom.width=50-e,t.dom.height=50-e,t.redraw()}),!0},this.finish=function(){Animate.hintActive=!1}},animDestroyGem=function(){this.init=function(){},this.iterate=function(t){return t<10}},animDestroyLines=function(){this.init=function(){},this.iterate=function(t){return t<10}},CAPILog=function(){this.log=function(t,e,i){console.log(e,i)}};CAPILog=new CAPILog;let CAPIMap=function(){let t,e=this;this.onMapInfoCallback=null,this.gotMapsInfo=function(s,a,r,l,c){t||(t={"□":DataObjects.CELL_VISIBLE," ":DataObjects.CELL_INVISIBLE,"?":DataObjects.OBJECT_RANDOM,H:DataObjects.OBJECT_HOLE,R:DataObjects.OBJECT_RED,G:DataObjects.OBJECT_GREEN,B:DataObjects.OBJECT_BLUE,Y:DataObjects.OBJECT_YELLOW,P:DataObjects.OBJECT_PURPLE,S:DataObjects.OBJECT_SAND,"△":DataObjects.OBJECT_RED,"◆":DataObjects.OBJECT_GREEN,"▭":DataObjects.OBJECT_BLUE,"◇":DataObjects.OBJECT_YELLOW,"⨀":DataObjects.OBJECT_PURPLE,"ᨔ":DataObjects.OBJECT_POLY_COLOR,"ᥩ":DataObjects.OBJECT_BARREL,$:DataObjects.OBJECT_GOLD,t:DataObjects.OBJECT_TILE,"Ξ":DataObjects.OBJECT_TILE,"α":DataObjects.OBJECT_ALPHA,"‖":DataObjects.OBJECT_BLOCK,"β":DataObjects.OBJECT_BETA,"γ":DataObjects.OBJECT_GAMMA,b:DataObjects.OBJECT_BOX,"■":DataObjects.OBJECT_BOX,"╲":DataObjects.OBJECT_CHAIN_A,"╱":DataObjects.OBJECT_CHAIN_B,X:[DataObjects.OBJECT_CHAIN_A,DataObjects.OBJECT_CHAIN_B],"⭤":DataObjects.WITH_LIGHTNING_HORIZONTAL,"⭥":DataObjects.WITH_LIGHTNING_VERTICAL,"+":DataObjects.WITH_LIGHTNING_CROSS,"*":DataObjects.IS_EMITTER}),DataMap.setMapById(a,r),l.forEach(function(t){t.layers.gems||(t.layers.gems=n()),void 0===t.layers.special&&(t.layers.special=[]),void 0===t.layers.special[0]&&(t.layers.special[0]=[]),"string"==typeof t.layers.special[0]&&(t.layers.special=[t.layers.special]),t.layers.special.forEach(function(t){t.unshift("")}),t.layers.mask.unshift(""),t.layers.gems.unshift(""),t.layers.special.unshift(i()),t.layers.mask=o(t.layers.mask,!1),t.layers.gems=o(t.layers.gems,!1),t.layers.special=o(t.layers.special,!0),DataPoints.setPointData(t)}),c.forEach(function(t){DataPoints.setPointUserScore(t.userId,t.pointId,t.score)}),e.onMapInfoCallback&&(e.onMapInfoCallback.call(),e.onMapInfoCallback=null)},this.setCallbackOnMapsInfo=function(t){e.onMapInfoCallback=t},this.gotUserScores=function(t,e){e.forEach(function(t){DataPoints.setPointUserScore(t.userId,t.pointId,t.score)}),PageController.redraw()};let i=function(){let t="";for(let e=0;e<DataPoints.FIELD_MAX_WIDTH;e++)t+="*";return[t]},n=function(){let t=[];for(let e=0;e<DataPoints.FIELD_MAX_HEIGHT;e++){t[e]="";for(let i=0;i<DataPoints.FIELD_MAX_HEIGHT;i++)t[e]+="?"}return t},o=function(e,i){let n;return n=[],"string"==typeof e[0]&&(e=[e]),e.forEach(function(e){e.forEach(function(o,s){o.split("").forEach(function(o,a){t[o]||(Logs.log("error",Logs.LEVEL_DETAIL,[e]),Logs.alert(Logs.LEVEL_ERROR,"ERROR: Нет такого символа в мепинге."+o)),n[a]||(n[a]=[]),i?(n[a][s]||(n[a][s]=[]),n[a][s]=n[a][s].concat(t[o].length?t[o]:[t[o]])):n[a][s]=t[o]})})}),n}};CAPIMap=new CAPIMap;let CAPIStuff=function(){this.gotStuff=function(t,e){LogicStuff.updateStuff(e)},this.incrementGold=function(t,e){LogicStuff.giveAGold(e),PageController.redraw()},this.decrementGold=function(t,e){LogicStuff.usedGold(e),PageController.redraw()}};CAPIStuff=new CAPIStuff;let CAPITimeServer=function(){this.gotServerTime=function(t,e){LogicTimeClient.setServerTime(e)}};CAPITimeServer=new CAPITimeServer;let CAPIUser=function(){this.authorizeSuccess=function(t,e){CAPIUser.updateUserInfo(t,e),LogicUser.authorizeSuccess(e.id)},this.updateUserInfo=function(t,e){4===e.id&&(console.log(e.id,e.fullRecoveryTime),console.log(JSON.stringify(LogicUser.getById(4).fullRecoveryTime))),e.createTimestamp=LogicTimeClient.convertToClient(e.createTimestamp),e.lastLoginTimestamp=LogicTimeClient.convertToClient(e.lastLoginTimestamp),e.fullRecoveryTime=LogicTimeClient.convertToClient(e.fullRecoveryTime),LogicUser.updateUserInfo(e),4===e.id&&console.log("afterupdate",JSON.stringify(LogicUser.getById(4).fullRecoveryTime))},this.updateUserListInfo=function(t,e){PageController.pendingData(!0),e.forEach(function(e){CAPIUser.updateUserInfo(t,e)}),PageController.pendingData(!1)},this.gotFriendsIds=function(t,e){LogicUser.setFriendIds(e)},this.setOneHealthHide=function(t,e){PageBlockPanel.oneHealthHide=e}};CAPIUser=new CAPIUser;let DataChests=function(){let t={};this.init=function(e){t[1]={id:1,prizes:[{id:DataObjects.STUFF_HUMMER,count:1},{id:DataObjects.STUFF_LIGHTNING,count:1},{id:DataObjects.STUFF_SHUFFLE,count:1}]},t[2]={id:1,prizes:[{id:DataObjects.STUFF_GOLD,count:100},{id:DataObjects.STUFF_HUMMER,count:3}]},t[3]={id:1,prizes:[{id:DataObjects.STUFF_GOLD,count:300},{id:DataObjects.STUFF_LIGHTNING,count:2}]},t[4]={id:1,prizes:[{id:DataObjects.STUFF_HUMMER,count:4},{id:DataObjects.STUFF_LIGHTNING,count:2},{id:DataObjects.STUFF_SHUFFLE,count:1}]},t[5]={id:1,prizes:[{id:DataObjects.STUFF_GOLD,count:200},{id:DataObjects.STUFF_HUMMER,count:5}]},t[6]={id:1,prizes:[{id:DataObjects.STUFF_GOLD,count:500},{id:DataObjects.STUFF_LIGHTNING,count:3},{id:DataObjects.STUFF_SHUFFLE,count:1}]},t[7]={id:1,prizes:[{id:DataObjects.STUFF_HUMMER,count:10},{id:DataObjects.STUFF_LIGHTNING,count:2},{id:DataObjects.STUFF_SHUFFLE,count:1}]},t[8]={id:1,prizes:[{id:DataObjects.STUFF_GOLD,count:500},{id:DataObjects.STUFF_SHUFFLE,count:1}]},t[9]={id:1,prizes:[{id:DataObjects.STUFF_GOLD,count:300},{id:DataObjects.STUFF_HUMMER,count:5}]},e&&e()},this.getById=function(e){return t[e]}};DataChests=new DataChests,DataChests.depends=["Logs"],CONST_IS_SERVER_SIDE&&(global.DataChests=DataChests);let DataCross={user:{maxHealth:5,healthRecoveryTime:10},app:{width:777,height:500}};CONST_IS_SERVER_SIDE&&(global.DataCross=DataCross);let DataMap=function(){let t=1,e={},i=[];this.setMapById=function(t,i){e[t]=i,PageController.redraw()},this.getCurrent=function(){var n;return e[t]||(n||(n=t),i[n]||(i[n]=!0,SAPIMap.sendMeMapInfo(n))),e[t]},this.setCurrentMapId=function(e){e>=DataMap.MAP_ID_MAX||e<=DataMap.MAP_ID_MIN||(t=e)},this.setNextMap=function(){t>=LogicUser.getUserLastMapId()+1?PBZDialogs.dialogMessage.showDialog("НЕ ДОСТУПНО"," ДОСТУП ПОЯВИТСЯ ПОСЛЕ \r\n \r\n ПРОХОЖДЕНИЯ УРОВНЕЙ \r\n\r\n ПРЕДЫДУЩЕЙ КАРТЫ. ",5):t!==DataMap.MAP_ID_MAX?t++:PBZDialogs.dialogMessage.showDialog("СТРОИМ"," УРОВНИ СОЗДАЮТСЯ \r\n\r\n СЛЕДИ ЗА НОВОСТЯМИ В ГРУППЕ! \r\n\r\n И ВОЗВРАЩАЙСЯ В ИГРУ! ",5)},this.setPrevMap=function(){t!==DataMap.MAP_ID_MIN&&t--},this.getMapIdFromPointId=function(){return Math.ceil(LogicUser.getCurrent().nextPointId/DataMap.POINTS_PER_MAP)},this.getFirstPointId=function(){return DataMap.POINTS_PER_MAP*(t-1)+1},this.getLastPointId=function(){return this.getFirstPointId()+DataMap.POINTS_PER_MAP-1},this.getPointIdFromPointNumber=function(t){return this.getFirstPointId()+(t-1)},this.getNumberFromPointId=function(t){return t-this.getFirstPointId()+1},this.countStarsByMapId=function(e){let i,n,o,s,a,r;if(e||(e=t),i=0,!(n=LogicUser.getCurrent()))return 0;if(!(o=DataPoints.getPointUserScore(e,[n.id])))return 0;for(let t=1;t<=DataMap.POINTS_PER_MAP;t++){if(s=DataMap.getPointIdFromPointNumber(t),!(a=DataPoints.getById(s)))return 0;r=0,o[s]&&(o[s][n.id]&&(o[s][n.id].score>=a.score1&&(r=1),o[s][n.id].score>=a.score2&&(r=2),o[s][n.id].score>=a.score3&&(r=3),i+=r))}return i}};DataMap=new DataMap,DataMap.MAP_ID_MIN=1,DataMap.MAP_ID_MAX=3,DataMap.POINTS_PER_MAP=18;let DataObjects=function(){this.CELL_INVISIBLE=1,this.CELL_VISIBLE=2,this.OBJECT_RANDOM=101,this.OBJECT_RED=102,this.OBJECT_GREEN=103,this.OBJECT_BLUE=104,this.OBJECT_YELLOW=105,this.OBJECT_PURPLE=106,this.OBJECT_SAND=107,this.OBJECT_HOLE=120,this.OBJECT_BARREL=130,this.OBJECT_BLOCK=135,this.OBJECT_POLY_COLOR=140,this.OBJECT_ALPHA=150,this.OBJECT_BETA=160,this.OBJECT_GAMMA=161,this.OBJECT_TILE=170,this.OBJECT_GOLD=180,this.OBJECT_BOX=190,this.OBJECT_CHAIN_A=200,this.OBJECT_CHAIN_B=210,this.IS_EMITTER=1001,this.WITH_LIGHTNING_HORIZONTAL=1010,this.WITH_LIGHTNING_VERTICAL=1011,this.WITH_LIGHTNING_CROSS=1012,this.STUFF_HUMMER=2010,this.STUFF_LIGHTNING=2011,this.STUFF_SHUFFLE=2012,this.STUFF_GOLD=2013,this.images={},this.images[this.CELL_INVISIBLE]="field-none.png",this.images[this.CELL_VISIBLE]="field-cell.png",this.images[this.OBJECT_HOLE]="field-none.png",this.images[this.OBJECT_RANDOM]="field-none.png",this.images[this.OBJECT_RED]="field-red.png",this.images[this.OBJECT_GREEN]="field-green.png",this.images[this.OBJECT_BLUE]="field-blue.png",this.images[this.OBJECT_YELLOW]="field-yellow.png",this.images[this.OBJECT_PURPLE]="field-purple.png",this.images[this.OBJECT_SAND]="field-sand.png",this.images[this.OBJECT_BARREL]="field-barrel.png",this.images[this.OBJECT_BLOCK]="field-block.png",this.images[this.OBJECT_POLY_COLOR]="field-poly-color.png",this.images[this.OBJECT_GOLD]="field-gold.png",this.images[this.OBJECT_TILE]="field-tile.png",this.images[this.OBJECT_ALPHA]="field-alpha.png",this.images[this.OBJECT_BETA]="field-beta.png",this.images[this.OBJECT_GAMMA]="field-gamma.png",this.images[this.OBJECT_BOX]="field-box.png",this.images[this.OBJECT_CHAIN_A]="field-chain-a.png",this.images[this.OBJECT_CHAIN_B]="field-chain-b.png",this.images[this.WITH_LIGHTNING_VERTICAL]="a-gem-light-1.png",this.images[this.WITH_LIGHTNING_HORIZONTAL]="a-gem-light-1.png",this.images[this.WITH_LIGHTNING_CROSS]="a-gem-light-1.png",this.images[this.STUFF_HUMMER]="button-hummer-rest.png",this.images[this.STUFF_LIGHTNING]="button-lightning-rest.png",this.images[this.STUFF_SHUFFLE]="button-shuffle-rest.png",this.images[this.STUFF_GOLD]="button-money-rest.png"};DataObjects=new DataObjects,CONST_IS_SERVER_SIDE&&(global.DataObjects=DataObjects);let DataPoints=function(){this.FIELD_MAX_WIDTH=10,this.FIELD_MAX_HEIGHT=11,this.BLOCK_WIDTH=50,this.BLOCK_HEIGHT=50,this.healthImages={},this.healthImages[0]="creature-health-0.png",this.healthImages[1]="creature-health-1.png",this.healthImages[2]="creature-health-2.png",this.healthImages[3]="creature-health-3.png",this.objectAnims={};let t=[{number:1,x:61,y:209},{number:2,x:61,y:290},{number:3,x:105,y:371},{number:4,x:197,y:390},{number:5,x:283,y:360},{number:6,x:279,y:274},{number:7,x:214,y:205},{number:8,x:205,y:111},{number:9,x:276,y:55},{number:10,x:371,y:51},{number:11,x:452,y:93},{number:12,x:448,y:185},{number:13,x:404,y:269},{number:14,x:425,y:356},{number:15,x:516,y:386},{number:16,x:608,y:367},{number:17,x:614,y:280},{number:18,x:661,y:211}],e={},i=[];this.getPointsCoords=function(){return t},this.getById=function(t){return i[t]},this.setPointData=function(t){i[t.id]=t,PageController.redraw()};let n=null;this.setPlayedId=function(t){n=t},this.getPlayedId=function(){return n},this.getPointUserScore=function(t,i){let n,o,s;n=DataMap.getFirstPointId(t),o=DataMap.getLastPointId(t),s={};for(let t=n;t<=o;t++)for(let n in e[t])-1!==i.indexOf(parseInt(n))&&(s[t]||(s[t]={}),s[t][n]=e[t][n]);return s},this.setPointUserScore=function(t,i,n){e[i]||(e[i]={}),e[i][t]={userId:t,pointId:i,score:n}},this.getScore=function(t,i){return window.p=e,i||(i=LogicUser.getCurrent().id),i?(e[t]||(e[t]={}),e[t][i]||(e[t][i]={userId:i,pointId:t,score:0}),e[t][i].score):null},this.countStars=function(t,e,i){let n;return t||(t=DataPoints.getPlayedId()),e||(e=LogicUser.getCurrent().id),e&&t?(isNaN(i)&&(i=DataPoints.getScore(t)),(n=DataPoints.getById(t))&&null!==i?i>=n.score3?3:i>=n.score2?2:i>=n.score1?1:0:null):null},this.copyGoals=function(t){let e;e=[];for(let i in t)e.push({id:t[i].id,count:t[i].count});return e},this.init=function(){this.objectAnims[DataObjects.WITH_LIGHTNING_VERTICAL]=animGemLightning,this.objectAnims[DataObjects.WITH_LIGHTNING_HORIZONTAL]=animGemLightning,this.objectAnims[DataObjects.WITH_LIGHTNING_CROSS]=animGemLightning}};DataPoints=new DataPoints;let DataShop=function(){this.getGoldProductByPrice=function(t){let e;return e=!1,DataShop.gold.forEach(function(i){i.votes===t&&(e=i)}),e}};DataShop=new DataShop,DataShop.gold=[{votes:1,quantity:10},{votes:5,quantity:70},{votes:10,quantity:1e3}],DataShop.hummers=[{gold:10,quantity:3,imageSrc:"shop-hummer-1.png"},{gold:15,quantity:6,imageSrc:"shop-hummer-2.png"},{gold:30,quantity:9,imageSrc:"shop-hummer-3.png"}],DataShop.shuffle=[{gold:10,quantity:3,imageSrc:"shop-shuffle-1.png"},{gold:15,quantity:6,imageSrc:"shop-shuffle-2.png"},{gold:30,quantity:9,imageSrc:"shop-shuffle-3.png"}],DataShop.lightning=[{gold:10,quantity:3,imageSrc:"shop-lightning-1.png"},{gold:15,quantity:6,imageSrc:"shop-lightning-2.png"},{gold:30,quantity:9,imageSrc:"shop-lightning-3.png"}],DataShop.healthGoldPrice=100,CONST_IS_SERVER_SIDE&&(global.DataShop=DataShop);let Dialog=function(t){let e=this,i=!1;this.dialogShowed=!1,this.onShowComplete=null,this.startPosition=-500,this.width=500,this.height=322,this.src=t||"window-2.png",this.bottomPosition=90,this.dom=null,this.pointer=void 0,this.elements=[],this.elHeader=null,this.elButtonClose=null,this.init=function(){let t;(t=GUI.createDom(void 0,{width:e.width,height:e.height,backgroundImage:e.src,zIndex:1e3})).x=document.getElementById("appArea").clientWidth/2-e.width/2,t.y=e.startPosition,e.elHeader=GUI.createElement(ElementText,{x:135,y:16,width:230,height:40},t),e.elButtonClose=GUI.createElement(ElementButton,{x:452,y:3,srcRest:"button-close-rest.png",onClick:function(){e.closeDialog()}},t),e.elButtonClose.show(),e.dom=t},this.show=function(){i||(i=!0,e.dom.show(),e.elHeader.show(),e.elements.forEach(function(t){t.show()}),e.redraw())},this.hide=function(){i&&(i=!1,e.dom.hide(),e.elHeader.hide(),e.elements.forEach(function(t){t.hide()}))},this.redraw=function(){i&&(e.dialogShowed||(e.dom.pointer=e.pointer,e.dom.redraw()),e.elements.forEach(function(t){t.redraw()}),e.elHeader.redraw())},this.showDialog=function(t){return Dialog.addDialog(this,t)},this.showConcreteDialog=function(){e.dialogShowed||(e.show(),e.dialogShowed=!0,Animate.anim(animShowDialog,{dom:e.dom,onFinish:function(){e.onShowComplete&&e.onShowComplete(),LogicWizard.onShowDialog()}},e.bottomPosition),e.redraw())},this.closeDialog=function(){LogicWizard.onHideDialog(!0),Animate.anim(animHideDialog,{dom:e.dom,onFinish:n},e.bottomPosition)};let n=function(){e.dialogShowed=!1,Dialog.removeDialog(),LogicWizard.onHideDialog(!1)};this.createElement=function(t,i){e.elements.push(GUI.createElement(t,i,e.dom))},this.reset=function(t){e.dom.y=e.startPosition,e.dialogShowed=!1,t&&(e.redraw(),e.hide()),Dialog.removeDialog()},this.setTitle=function(t){e.elHeader.setText(t),e.elHeader.redraw()}};Dialog.queue=[],Dialog.addDialog=function(t,e){if(e){let i,n,o;Dialog.queue.forEach(function(t,n){t===e&&(i=n)}),(n=Dialog.queue.slice(0,i+1)).push(t),o=Dialog.queue.slice(i),Dialog.queue=n.concat(o)}else Dialog.queue.push(t);Dialog.showDialog()},Dialog.removeDialog=function(){GUI.unlockEvents(),Dialog.queue.shift(),Dialog.showDialog()},Dialog.showDialog=function(){Dialog.queue.length&&(Dialog.queue[0].showConcreteDialog(),GUI.lockEvents(Dialog.queue[0].dom))};let DialogChestYouWin=function(){let t,e=this;this.__proto__=new Dialog;let i={},n={},o=null;this.init=function(){this.__proto__.init.call(this),GUI.pushParent(e.dom),this.elHeader.setText("Ты нашел!"),(t=GUI.createElement(ElementText,{x:10,y:80,width:480,height:50})).setText("Собраны все звезды! \r\nТы открыл сундук и нашел там:"),t.show();for(let t=0;t<8;t++)i[t]=GUI.createElement(ElementImage,{y:155,width:50,height:50}),n[t]=GUI.createElement(ElementText,{y:220,width:50});GUI.popParent()},this.redraw=function(){let e,s;this.__proto__.redraw.call(this),this.dialogShowed&&(e=DataChests.getById(o),s=Images.getWidth("window-2.png")/2-50*e.prizes.length/2-5*(e.prizes.length-1)/2,e.prizes.forEach(function(t,e){let o=i[e],a=n[e];o.src=DataObjects.images[t.id],a.setText("x"+t.count),o.x=s+50*e+5*e,a.x=o.x,o.show(),a.show(),a.redraw(),o.redraw()}),t.redraw())},this.showDialog=function(t){o=t,this.__proto__.showDialog.call(this),e.redraw()}},DialogGoals=function(){let t=this;this.__proto__=new Dialog;let e={},i={};this.init=function(){this.__proto__.width=250,this.__proto__.height=150,this.__proto__.src="window-3.png",this.__proto__.bottomPosition=186,this.__proto__.init.call(this),this.__proto__.onShowComplete=this.onShowComplete,GUI.pushParent(t.dom);for(let t in DataObjects.images)e[t]=GUI.createElement(ElementImage,{x:200+t*(DataPoints.BLOCK_WIDTH+5),y:30,src:DataObjects.images[t]}),i[t]=GUI.createElement(ElementText,{x:100+t*(DataPoints.BLOCK_WIDTH+5),y:30+DataPoints.BLOCK_HEIGHT+5,width:DataPoints.BLOCK_WIDTH});GUI.createElement(ElementButton,{x:195,y:0,srcRest:"button-close-rest.png",onClick:function(){t.closeDialog()}},this.dom).show(),GUI.popParent()},this.onShowComplete=function(){setTimeout(function(){t.closeDialog()},1.2*Config.OnIdle.second)},this.setGoals=function(t){let n,o;for(let t in this.elements)this.elements[t].hide();this.elements=[],o=Images.getWidth(this.src)/2-t.length*(DataPoints.BLOCK_WIDTH+5)/2,n=0;for(let s in t)e[t[s].id].x=o+n,i[t[s].id].x=o+n,i[t[s].id].setText(t[s].count),this.elements.push(e[t[s].id]),this.elements.push(i[t[s].id]),n+=DataPoints.BLOCK_WIDTH+5;for(let t in this.elements)this.elements[t].show(),this.elements[t].redraw()}},DialogGoalsReached=function(){let t=this;this.__proto__=new Dialog;let e,i=null,n=null,o=null,s=null,a=[],r=null,l=null,c=null,h=!0,u=null,d=null;this.init=function(){this.__proto__.init.call(this),GUI.pushParent(t.dom),(i=GUI.createElement(ElementText,{x:135,y:16,width:230,height:40,text:""})).show(),(n=GUI.createElement(ElementImage,{x:100,y:40,src:"star-off-big.png"})).show(),(o=GUI.createElement(ElementImage,{x:200,y:40,src:"star-off-big.png"})).show(),(s=GUI.createElement(ElementImage,{x:300,y:40,src:"star-off-big.png"})).show();for(let t=0;t<3;t++)a[t]={elPhotoScore:GUI.createElement(ElementUserScorePhoto,{x:75+75*t+15,y:155})};(r=GUI.createElement(ElementUserScorePhoto,{x:355,y:155})).show(),(l=GUI.createElement(ElementButton,{x:178,y:240,srcRest:"button-red-rest.png",srcHover:"button-red-hover.png",srcActive:"button-red-active.png",onClick:function(){t.closeDialog(),PageController.showPage(PageMain)},title:"НА КАРТУ"})).show(),GUI.createElement(ElementButton,{x:452,y:3,srcRest:"button-close-rest.png",onClick:function(){t.closeDialog(),PageController.showPage(PageMain)}}).show(),GUI.createElement(ElementText,{x:335,y:254,text:"ПОДЕЛИТЬСЯ",fontSize:11}).show(),(c=GUI.createElement(ElementButton,{x:418,y:242,srcRest:"check-set.png",srcHover:"check-clear.png",srcActive:"check-clear.png"})).onClick=function(){h=!h,PageController.redraw()},c.show(),GUI.popParent()},this.redraw=function(){let t,u,g,f;if(this.__proto__.redraw.call(this),this.dialogShowed){t=LogicUser.getCurrent(),u=DataPoints.getById(d),i.text="ПРОЙДЕН";for(let t=0;t<3;t++)(g=e[t])&&g.id?(f=DataPoints.getScore(u.id,g.id),a[t].elPhotoScore.user=g,a[t].elPhotoScore.score=f,f?(a[t].elPhotoScore.show(),a[t].elPhotoScore.redraw()):a[t].elPhotoScore.hide()):a[t].elPhotoScore.hide();switch(r.user=LogicUser.getCurrent(),r.score=DataPoints.getScore(u.id),i.redraw(),n.src="star-off-big.png",o.src="star-off-big.png",s.src="star-off-big.png",DataPoints.countStars(u.id)){case 3:s.src="star-on-big.png";case 2:o.src="star-on-big.png";case 1:n.src="star-on-big.png"}n.redraw(),o.redraw(),s.redraw(),r.redraw(),0===LogicHealth.getHealths(t)?l.hide():l.show(),c.srcRest=h?"check-set.png":"check-clear.png",c.srcHover=h?"check-clear.png":"check-set.png",c.srcActive=c.srcHover,c.redraw()}},this.showDialog=function(i,n){let o;h=!0,d=i,o=DataMap.getCurrent().id,e=LogicUser.getFriendIdsByMapIdAndPointIdWithScore(o,i),this.__proto__.showDialog.call(this),u=n,t.redraw()};this.closeDialog=function(){h&&SocNet.post({userId:LogicUser.getCurrent().socNetUserId,message:"Я набрал "+u+" "+declination(u,["очко","очка","очков"])+"! Ты сможешь обогнать меня? https://vk.com/app7389878"}),this.__proto__.closeDialog()}},DialogHealthShop=function(){let t=this;this.__proto__=new Dialog;let e=null;this.init=function(){let i,n,o,s;this.__proto__.init.call(this),n=30,s=80,o=145,GUI.pushParent(t.dom),this.setTitle("МАГАЗИН"),e=GUI.createElement(ElementButton,{x:175,y:80,srcRest:"shop-health-1.png",onClick:function(){t.buyHealth5()}}),t.elements.push(e),i=GUI.createElement(ElementButton,{x:320,y:80,srcRest:"shop-health-2.png",onClick:function(){SAPIUser.zeroLife()}}),t.elements.push(i),GUI.popParent()},this.redraw=function(){let t;t=LogicUser.getCurrent(),e.enabled=0===LogicHealth.getHealths(t),this.__proto__.redraw.call(this)},this.buyHealth5=function(){let e,i;e=LogicStuff.getStuff("goldQty"),i=LogicUser.getCurrent(),LogicHealth.getHealths(i)>0||(e<DataShop.healthGoldPrice?(PBZDialogs.dialogMoneyShop.showDialog(this),t.closeDialog()):(SAPIStuff.buyHealth(),LogicStuff.giveAHealth(LogicHealth.getMaxHealth()),LogicStuff.usedGold(DataShop.healthGoldPrice),t.closeDialog()),PageController.redraw())}},DialogJustQuit=function(){let t=this;this.__proto__=new Dialog,this.init=function(){let e;this.__proto__.init.call(this),this.setTitle("ВЫЙТИ?"),(e=GUI.createElement(ElementText,{x:127,y:114,width:250,bold:!0,alignCenter:!0},this.dom)).setText("Потеряешь одну жизнь."),t.elements.push(e),e=GUI.createElement(ElementButton,{x:75,y:220,srcRest:"button-red-rest.png",srcHover:"button-red-hover.png",srcActive:"button-red-active.png",onClick:function(){t.closeDialog(),PageBlockPanel.oneHealthHide=!1,PageController.showPage(PageMain),PageBlockField.setStuffMode(null)},title:"СДАТЬСЯ"},this.dom),t.elements.push(e),e=GUI.createElement(ElementButton,{x:275,y:220,srcRest:"button-green-rest.png",srcHover:"button-green-hover.png",srcActive:"button-green-active.png",onClick:function(){t.closeDialog()},title:"ИГРАТЬ"},this.dom),t.elements.push(e)}},DialogMessage=function(){let t=this;this.__proto__=new Dialog;let e=null;this.init=function(){this.__proto__.init.call(this),GUI.pushParent(t.dom),e=GUI.createElement(ElementText,{x:45,y:50,width:410,height:200}),t.elements.push(e),GUI.popParent()};let i={undefined:150,1:150,2:140,3:130,4:120,5:110};this.showDialog=function(n,o,s){this.__proto__.showDialog.call(this),this.elHeader.setText(n),e.y=i[s],e.setText(o),t.redraw()}},DialogMoneyShop=function(){let t=this;this.__proto__=new Dialog,this.init=function(){let e,i,n,o;this.__proto__.init.call(this),i=25,o=60,n=150,GUI.pushParent(t.dom),this.setTitle("ГОЛОСА");for(let i=0;i<3;i++)e=GUI.createElement(ElementButton,{x:25+150*i,y:60,srcRest:"money_"+(i+1)+".png",srcHover:"money_"+(i+1)+".png",srcActive:"money_"+(i+1)+".png",onClick:function(){GUI.isFullScreen()&&GUI.fsSwitch(),SocNet.openOrderDialog(DataShop.gold[i].votes),t.closeDialog()}}),t.elements.push(e),e=GUI.createElement(ElementButton,{x:25+150*i+45,y:165,srcRest:"button-add-rest.png",onClick:function(){SocNet.openOrderDialog(DataShop.gold[i].votes),t.closeDialog()}});GUI.popParent()}},DialogPointInfo=function(){let t=this;this.__proto__=new Dialog;let e,i=null,n=null,o=null,s=[],a=null,r=null,l=null;this.init=function(){this.__proto__.init.call(this),GUI.pushParent(t.dom),(i=GUI.createElement(ElementImage,{x:100,y:40,src:"star-off-big.png"})).show(),(n=GUI.createElement(ElementImage,{x:200,y:40,src:"star-off-big.png"})).show(),(o=GUI.createElement(ElementImage,{x:300,y:40,src:"star-off-big.png"})).show(),[0,1,2].forEach(function(t){s[t]={elPhotoScore:GUI.createElement(ElementUserScorePhoto,{x:75+75*t+15,y:155})}}),(a=GUI.createElement(ElementUserScorePhoto,{x:355,y:155})).show(),(r=GUI.createElement(ElementButton,{x:178,y:240,srcRest:"button-red-rest.png",srcHover:"button-red-hover.png",srcActive:"button-red-active.png",onClick:function(){t.closeDialog(),0===LogicHealth.getHealths(LogicUser.getCurrent())?(PBZDialogs.dialogHealthShop.showDialog(),t.showDialog(l)):(SAPIUser.onPlayStart(),PageBlockPanel.oneHealthHide=!0,DataPoints.setPlayedId(l),PageController.showPage(PageField))},title:"ИГРАТЬ"})).show(),GUI.createElement(ElementButton,{x:452,y:3,srcRest:"button-close-rest.png",onClick:function(){t.closeDialog()}}).show(),GUI.popParent()},this.show=function(){this.__proto__.show.call(this)},this.hide=function(){this.__proto__.hide.call(this)},this.redraw=function(){let t,r,c;if(this.__proto__.redraw.call(this),this.dialogShowed){t=DataPoints.getById(l),this.setTitle("УРОВЕНЬ  "+l);for(let i=0;i<3;i++)(r=e[i])&&r.id?(c=DataPoints.getScore(t.id,r.id),s[i].elPhotoScore.user=r,s[i].elPhotoScore.score=c,c?(s[i].elPhotoScore.show(),s[i].elPhotoScore.redraw()):s[i].elPhotoScore.hide()):s[i].elPhotoScore.hide();switch(a.user=LogicUser.getCurrent(),a.score=DataPoints.getScore(t.id),i.src="star-off-big.png",n.src="star-off-big.png",o.src="star-off-big.png",DataPoints.countStars(t.id)){case 3:o.src="star-on-big.png";case 2:n.src="star-on-big.png";case 1:i.src="star-on-big.png"}i.redraw(),n.redraw(),o.redraw(),a.redraw()}},this.showDialog=function(i){let n;l=i,n=DataMap.getCurrent().id,e=LogicUser.getFriendIdsByMapIdAndPointIdWithScore(n,i,!1),this.__proto__.showDialog.call(this),t.redraw()}},DialogStuffShop=function(){let t=this;this.__proto__=new Dialog;let e=null,i=[];this.init=function(){let e,n,o,s;this.__proto__.init.call(this),n=30,s=80,o=145,GUI.pushParent(t.dom),this.setTitle("МАГАЗИН");for(let n=0;n<3;n++)e=GUI.createElement(ElementButton,{x:30+145*n,y:80,srcRest:"shop-hummer-2.png",srcHover:"shop-hummer-2.png",srcActive:"shop-hummer-2.png",onClick:function(){t.buyStuff(n)}}),i.push(e),t.elements.push(e),e=GUI.createElement(ElementButton,{x:30+145*n+45,y:205,srcRest:"button-add-rest.png",srcHover:"button-add-hover.png",srcActive:"button-add-active.png",itemNumber:n,onClick:function(){t.buyStuff(n)}});GUI.popParent()},this.showDialog=function(i){this.__proto__.showDialog.call(this),e=i,t.redraw()},this.redraw=function(){let t;if(e){switch(e){case LogicStuff.STUFF_HUMMER:t=DataShop.hummers;break;case LogicStuff.STUFF_LIGHTNING:t=DataShop.lightning;break;case LogicStuff.STUFF_SHUFFLE:t=DataShop.shuffle}for(let e=0;e<3;e++)i[e].srcRest=t[e].imageSrc,i[e].srcHover=t[e].imageSrc,i[e].srcActive=t[e].imageSrc,i[e].redraw()}this.__proto__.redraw.call(this)},this.buyStuff=function(i){let n,o,s,a;switch(n=LogicStuff.getStuff("goldQty"),e){case LogicStuff.STUFF_HUMMER:o=SAPIStuff.buyHummer,s=LogicStuff.giveAHummer,a=DataShop.hummers[i];break;case LogicStuff.STUFF_SHUFFLE:o=SAPIStuff.buyShuffle,s=LogicStuff.giveAShuffle,a=DataShop.shuffle[i];break;case LogicStuff.STUFF_LIGHTNING:o=SAPIStuff.buyLightning,s=LogicStuff.giveALighnting,a=DataShop.lightning[i]}n<a.gold?(PBZDialogs.dialogMoneyShop.showDialog(),t.reset(),t.showDialog(e)):(o(i),s(a.quantity),LogicStuff.usedGold(a.gold),t.closeDialog()),PageController.redraw()}},DialogTurnLoose=function(){let t=this;this.__proto__=new Dialog,this.init=function(){let e;this.__proto__.init.call(this),GUI.pushParent(t.dom),e=GUI.createElement(ElementButton,{x:452,y:3,srcRest:"button-close-rest.png",onClick:function(){t.closeDialog(),PageBlockPanel.oneHealthHide=!1,PageController.showPage(PageMain)}}),this.elButtonClose.hide(),t.elements.push(e),(e=GUI.createElement(ElementText,{x:50,y:150,fontSize:24,bold:!0,alignCenter:!0,width:400})).setText("Больше ходов нет! Ты потерял жизнь :("),t.elements.push(e),(e=GUI.createElement(ElementButton,{x:178,y:240,srcRest:"button-red-rest.png",srcHover:"button-red-hover.png",srcActive:"button-red-active.png",onClick:function(){t.closeDialog(),0===LogicHealth.getHealths(LogicUser.getCurrent())?(PBZDialogs.dialogHealthShop.showDialog(),t.showDialog(pointId)):(SAPIUser.onPlayStart(),PageBlockPanel.oneHealthHide=!0,DataPoints.setPlayedId(DataPoints.getPlayedId()),PageController.showPage(PageMain),PageController.showPage(PageField))},title:"ИГРАТЬ"})).show(),GUI.popParent()}},ElementButton=function(){let t=this,e=!1;this.x=0,this.y=0,this.width=0,this.height=0,this.srcHover="",this.srcActive="",this.srcRest="",this.onClick=null,this.title="",this.enabled=!0;let i,n=null,o=!1,s=!1;this.init=function(){(n=GUI.createDom()).width=t.width,n.height=t.height,n.backgroundImage=t.srcRest,n.pointer=GUI.POINTER_HAND,GUI.bind(n,GUI.EVENT_MOUSE_MOUSE_DOWN,r,t),GUI.bind(n,GUI.EVENT_MOUSE_CLICK,c,t),GUI.bind(n,GUI.EVENT_MOUSE_OVER,a,t),GUI.bind(n,GUI.EVENT_MOUSE_OUT,l,t),t.title&&(GUI.pushParent(n),(i=GUI.createElement(ElementText,{x:0,y:10,height:25,alignCenter:!0,text:t.title,pointer:GUI.POINTER_HAND})).show(),GUI.popParent())},this.show=function(){!0!==e&&(e=!0,n.show(),t.redraw())},this.hide=function(){!1!==e&&(e=!1,n.hide())},this.redraw=function(){let a,r,l,c;if(e){switch(a=t.srcRest,s&&(r="hover"),s&&o&&(r="active"),!s&&o&&(r="rest"),n.x=t.x,n.y=t.y,l=t.width?t.width:Images.getWidth(t.srcRest),c=t.height?t.height:Images.getHeight(t.srcRest),n.width=l,n.height=c,a=t.srcRest,r){case"rest":break;case"hover":t.srcHover?a=t.srcHover:(n.width=1.05*l,n.height=1.05*c,n.x=t.x-.025*l,n.y=t.y-.025*c);break;case"active":t.srcHover?a=t.srcActive:(n.width=1.1*Images.getWidth(t.srcRest),n.height=1.1*Images.getHeight(t.srcRest),n.x=t.x-.05*l,n.y=t.y-.05*c)}n.backgroundImage=a,t.title&&(n.title=t.title,i.width=Images.getWidth(a),i.redraw()),t.enabled?(n.pointer=GUI.POINTER_HAND,n.opacity=1):(n.pointer=GUI.POINTER_ARROW,n.opacity=.5),n.redraw()}};let a=function(){t.enabled&&(s=!0,t.redraw())},r=function(){t.enabled&&(o=!0,t.redraw())},l=function(){t.enabled&&(s=!1,t.redraw())},c=function(e,i){if(e.stopPropagation(),t.enabled)return o=!1,s=!1,t.redraw(),t.onClick.call(null,e,i)}},ElementChest=function(){let t=this,e=!1;this.x=0,this.y=0,this.width=0,this.number=-1,this.height=0;let i=null,n=null,o=null;this.chestId=null,this.init=function(){i=GUI.createDom(void 0,{width:t.width,height:t.height}),n=GUI.createElement(ElementImage,{src:"star-on.png"}),o=GUI.createElement(ElementText,{width:100,height:14,fontSize:14,bold:!1})},this.show=function(){e||(e=!0,i.show(),n.show(),o.show(),t.redraw())},this.hide=function(){e&&(e=!1,i.hide(),n.hide(),o.hide())},this.redraw=function(){let s,a;e&&(i.x=t.x,i.y=t.y,o.x=t.x+10,o.y=t.y+10,s=DataMap.countStarsByMapId(),a=LogicChests.getStarsByNumber(t.number),s=Math.min(s,a),o.text=s.toString()+"/"+a,i.backgroundImage=a===s?"pit-open.png":"pit-close.png",n.x=o.x+10,n.y=o.y-5,i.redraw(),n.redraw(),o.redraw())}},ElementField=function(){let t=this,e=!0,i=!1,n=!1,o=null,s=null,a=null;this.centerX=0,this.centerY=0,this.x=0,this.y=0;let r=null,l=[],c=[],h=[],u=[],d=[],g=0,f=0,m=0,I=0;this.onDestroyLine=null,this.onDestroyThing=null,this.beforeStuffUse=null,this.onFieldSilent=null;let p=null,E=!1;this.init=function(){let t;r=GUI.createDom(void 0,{width:DataPoints.FIELD_MAX_WIDTH*DataPoints.BLOCK_WIDTH,height:DataPoints.FIELD_MAX_HEIGHT*DataPoints.BLOCK_HEIGHT,overflow:"visible",isFieldContainer:!0}),GUI.pushParent(r),r.bind(GUI.EVENT_MOUSE_CLICK,_,r),r.bind(GUI.EVENT_MOUSE_MOUSE_DOWN,O,r),r.bind(GUI.EVENT_MOUSE_MOUSE_UP,A,r),r.bind(GUI.EVENT_MOUSE_MOVE,B,r),Field.eachCell(function(t,e){l[t]||(l[t]=[]),l[t][e]=GUI.createDom(void 0,{opacity:.4})});for(let e=0;e<100;e++)t=GUI.createDom(void 0,{width:DataPoints.BLOCK_WIDTH,height:DataPoints.BLOCK_HEIGHT}),c.push(t);Field.eachCell(function(e,i){h[e]||(h[e]=[]),t=GUI.createDom(void 0,{p:{x:e,y:i},noScale:!0,height:DataPoints.BLOCK_HEIGHT,width:DataPoints.BLOCK_WIDTH,backgroundImage:"field-none.png"}),h[e][i]=t});for(let e=0;e<100;e++)t=GUI.createDom(void 0,{width:DataPoints.BLOCK_WIDTH,height:DataPoints.BLOCK_HEIGHT}),u.push(t);for(let t=0;t<100;t++)d.push(GUI.createDom(void 0,{}));s=GUI.createDom(void 0,{backgroundImage:"field-frame.png"}),GUI.popParent(),this.redraw()};let L,y=function(e){return{x:Math.floor((e.clientX-t.x)/DataPoints.BLOCK_WIDTH),y:Math.floor((e.clientY-t.y)/DataPoints.BLOCK_HEIGHT)}},_=function(t){D(y(t))},D=function(t){let i;if(!e&&!AnimLocker.busy()&&(F&&F(),(i=Field.getCell(t)).isVisible&&i.object.isCanMoved))switch(a){case LogicStuff.STUFF_HUMMER:b(t);break;case LogicStuff.STUFF_SHUFFLE:S(t);break;case LogicStuff.STUFF_LIGHTNING:T(t);break;default:x(t)}},b=function(i){e||AnimLocker.busy()||Field.isNotGem(i)||(t.beforeStuffUse(),t.cellAttack(i),v(animHummerDestroy,i))},S=function(){e||AnimLocker.busy()||(t.beforeStuffUse(),w())},w=function(){Field.shuffle(),v(animShuffle,(m+g/2)*DataPoints.BLOCK_WIDTH,(I+f/2)*DataPoints.BLOCK_HEIGHT)},T=function(i,n){e||AnimLocker.busy()||!Field.isVisible(i)||(n||(n=DataObjects.WITH_LIGHTNING_HORIZONTAL),t.beforeStuffUse(),C(i,n))},C=function(e,i){i===DataObjects.WITH_LIGHTNING_CROSS?(Field.eachVisibleLine(e,DataObjects.WITH_LIGHTNING_VERTICAL,t.cellAttack),Field.eachVisibleLine(e,DataObjects.WITH_LIGHTNING_HORIZONTAL,t.cellAttack),t.redraw(),v(animLightning,e,DataObjects.WITH_LIGHTNING_VERTICAL),v(animLightning,e,DataObjects.WITH_LIGHTNING_HORIZONTAL)):(Field.eachVisibleLine(e,i,t.cellAttack),t.redraw(),v(animLightning,e,i))},x=function(i){let n,s,a=o;if(!e&&!AnimLocker.busy()&&Field.isFallObject(i)&&((!a||a&&!Field.isNear(a,i))&&(o=i,n=Field.getCell(o),E=n&&n.isVisible&&n.object.isPolyColor&&n,t.redraw()),a&&Field.isNear(a,i))){if(o=null,t.redraw(),E)return s=[],Field.eachCell(function(t,e,n,o){n.isVisible&&o.isGem&&o.objectId===Field.getCell(i).object.objectId&&n.object.isCanMoved&&s.push({x:t,y:e,cell:n})}),s.push({x:E.x,y:E.y,cell:E}),s.forEach(function(e){t.cellAttack(e,e.cell)}),H(),H=!1,E=!1,void(a=i=o=null);Field.isLinePossiblyDestroy(a,i)||(v(animChangeAndBack,a,i),v(animChangeAndBack,i,a)),Field.isLinePossiblyDestroy(a,i)&&(p={a:a,b:i},t.beforeTurnUse(),Field.exchangeObjects(a,i),v(animChangeAndDestroy,a,i),v(animChangeAndDestroy,i,a))}},P=null,O=function(t){Sounds.play(Sounds.PATH_CHALK),P=y(t)},A=function(){P=null},H=!1,B=function(t){let e;e=y(t),!L||L.x===e.x&&L.y===e.y||(G(t),U(t)),L=e},U=function(t){let e,i,n;E&&(e=y(t),i=Field.getCell(e),Field.isNear(e,o)&&i.isVisible&&i.object.isGem&&i.object.isCanMoved&&(F&&F(),!1===H&&(n=[],Field.eachCell(function(t,e,o,s){o.isVisible&&s.isGem&&s.objectId===i.object.objectId&&o.object.isCanMoved&&n.push({x:t,y:e})}),H=v(animHint,n)))),P&&(D(P),D(y(t)),P=null)},G=function(t){E&&H&&(H(),H=!1)};this.show=function(){!0!==n&&(n=!0,r.show(),Field.eachCell(function(t,e){l[t][e].show(),h[t][e].show()}),t.redraw())},this.hide=function(){!1!==n&&(n=!1,r.hide(),Field.eachCell(function(t,e){l[t][e].hide(),h[t][e].hide()}),s.hide(),F&&F())};let R=function(t,e){t.stopAnim&&t.stopAnim(),t.animId=e,t.hide()},N=function(t,e,i,n){e.x=t.x*DataPoints.BLOCK_WIDTH,e.y=t.y*DataPoints.BLOCK_HEIGHT;let o="",s=function(t){return!Field.isVisible(t)};o+=s({x:t.x-1,y:t.y})&&s({x:t.x,y:t.y-1})?"8px ":"0px ",o+=s({x:t.x,y:t.y-1})&&s({x:t.x+1,y:t.y})?"8px ":"0px ",o+=s({x:t.x+1,y:t.y})&&s({x:t.x,y:t.y+1})?"8px ":"0px ",o+=s({x:t.x,y:t.y+1})&&s({x:t.x-1,y:t.y})?"8px ":"0px ",e.borderRadius=o,DataObjects.images[i]&&(e.backgroundImage=DataObjects.images[i]),DataPoints.objectAnims[i]?e.animId!==i&&(R(e,i),e.stopAnim=Animate.anim(DataPoints.objectAnims[i],{dom:e,objectId:i})):R(e),void 0!==n&&(e.opacity=n),e.show(),e.redraw()};this.redraw=function(){if(!n)return;if(AnimLocker.busy())return;r.redraw();let t=0,e=0;Field.eachCell(function(i,n,o,s){let a,r,d;a=l[i][n],(r=h[i][n]).bindedDoms=[],o.isVisible?N({x:i,y:n},a,DataObjects.CELL_VISIBLE):a.hide(),o.isVisible&&(s.isGem||s.isAlpha||s.isBarrel||s.isPolyColor||s.isBlock)?N({x:i,y:n},r,s.objectId,""):r.hide(),o.isVisible&&s.isGem&&s.lightningId&&(s.lightningId===DataObjects.WITH_LIGHTNING_CROSS?(d=u[e++],N({x:i,y:n},d,DataObjects.WITH_LIGHTNING_VERTICAL,1),r.bindedDoms.push(d),d=u[e++],N({x:i,y:n},d,DataObjects.WITH_LIGHTNING_HORIZONTAL,1),r.bindedDoms.push(d)):(d=u[e++],N({x:i,y:n},d,s.lightningId,1),r.bindedDoms.push(d))),o.isVisible&&s.isAlpha&&((d=u[e++]).backgroundImage=DataPoints.healthImages[s.health],N({x:i,y:n},d,"",.9),r.bindedDoms.push(d)),o.isVisible&&o.withGold&&(d=c[t++],N({x:i,y:n},d,DataObjects.OBJECT_GOLD,"")),o.isVisible&&o.withTile&&(d=c[t++],N({x:i,y:n},d,DataObjects.OBJECT_TILE,"")),o.isVisible&&s.withBeta&&(d=u[e++],N({x:i,y:n},d,DataObjects.OBJECT_BETA,""),r.bindedDoms.push(d)),o.isVisible&&s.withGamma&&(d=u[e++],N({x:i,y:n},d,DataObjects.OBJECT_GAMMA,""),r.bindedDoms.push(d)),o.isVisible&&s.withBox&&(d=u[e++],N({x:i,y:n},d,DataObjects.OBJECT_BOX,""),r.hide()),o.isVisible&&s.withChain&&(s.withChainA&&(d=u[e++],N({x:i,y:n},d,DataObjects.OBJECT_CHAIN_A,"")),s.withChainB&&(d=u[e++],N({x:i,y:n},d,DataObjects.OBJECT_CHAIN_B,"")))});for(let e=t;e<100;e++)R(c[e]);for(let t=e;t<100;t++)R(u[t]);o?N({x:o.x,y:o.y},s):s.hide()},this.setLayers=function(e){let i,n,o=function(t,e){let i;return i=[],t.forEach(function(t,n){i[n]=[],t.forEach(function(t,o){i[n][o]=e?e(t):t})}),i},s=[];e.special.forEach(function(t){s.push(o(t))}),Field.setLayers(o(e.mask),o(e.gems,function(t){return t===DataObjects.OBJECT_RANDOM?Field.getRandomGemId():t}),s),i={x:1/0,y:1/0},n={x:-1/0,y:-1/0},Field.eachCell(function(t,e,o){o.isVisible&&(i.x=Math.min(i.x,t),i.y=Math.min(i.y,e),n.x=Math.max(n.x,t),n.y=Math.max(n.y,e))}),g=n.x-i.x+1,f=n.y-i.y+1,m=i.x,I=i.y,t.x=t.centerX-DataPoints.BLOCK_WIDTH/2-(g-1)/2*DataPoints.BLOCK_WIDTH-m*DataPoints.BLOCK_WIDTH,t.y=t.centerY-DataPoints.BLOCK_HEIGHT/2-(f-1)/2*DataPoints.BLOCK_HEIGHT-I*DataPoints.BLOCK_HEIGHT+DataPoints.BLOCK_HEIGHT/2,r.x=t.x,r.y=t.y,this.redraw()},this.run=function(){if(!AnimLocker.busy())return t.hasProcesSpecialLayer()?t.processSpecialLayer():t.hasFall()?t.fall():t.hasDestroyLines()?t.destroyLines():t.hasNoTurns()?w():t.isFieldSilent()?k():void 0};let F,k=function(){t.onFieldSilent(),M()},M=function(){setTimeout(function(){if(console.log("tryShowHint",t.isFieldSilent(),!e,n,!F,!H,!i),t.isFieldSilent()&&!e&&n&&!F&&!H&&!i){let t=Field.countTurns();if(t.length){let e=v(animHint,[t[0].a,t[0].b]);F=function(){F=null,e(),M()}}}},3*Config.OnIdle.second)};this.isFieldSilent=function(){return!(AnimLocker.busy()||t.hasDestroyLines()||t.hasFall()||t.hasProcesSpecialLayer()||t.hasNoTurns())},this.hasProcesSpecialLayer=function(t){return Field.eachCell(function(e,i,n){t|=n.isEmitter&&n.object.isHole,t|=n.isVisible&&n.object.isBarrel&&!Field.isVisible({x:e,y:i+1})}),t},this.processSpecialLayer=function(){Field.eachCell(function(e,i,n){n.isEmitter&&Field.isHole({x:e,y:i})&&(Field.setObject({x:e,y:i},Field.getRandomGemId()),Field.isVisible({x:e,y:i})&&v(animGemEmitFader,{x:e,y:i})),n.isVisible&&n.object.isBarrel&&!Field.isVisible({x:e,y:i+1})&&(t.onDestroyThing(DataObjects.OBJECT_BARREL,n),Field.setObject({x:e,y:i},DataObjects.OBJECT_HOLE,!1),n.object.isBarrel=!1,v(animHummerDestroy,{x:e,y:i}))}),t.run()},this.hasFall=function(t=!1){return Field.eachCell(function(e,i){Field.mayFall(e,i)&&(t=!0)}),t},this.fall=function(){let e;if(AnimLocker.busy())return;let i=[];Field.eachCell(function(t,n){n=DataPoints.FIELD_MAX_HEIGHT-n-1,(e=Field.mayFall(t,n))&&(Field.exchangeObjects({x:t,y:n},e),h[t][n].bindedDoms.length&&(h[e.x][e.y]&&(h[e.x][e.y].bindedDoms=h[t][n].bindedDoms),h[t][n].bindedDoms=[]),i.push({from:{x:t,y:n},to:e}))}),i.length?v(animFallGems,i):(t.run(),t.redraw()),t.processSpecialLayer()},this.hasDestroyLines=function(){let t;return(t=Field.findLines()).length>0},this.destroyLines=function(){let e,i,n;e=Field.findLines(),console.log(e),e.forEach(function(e){i=null,p&&Field.lineCrossing([e],p.a.x,p.a.y)&&(i=p.a),p&&Field.lineCrossing([e],p.b.x,p.b.y)&&(i=p.b),i?n=Field.getCell(i).object.objectId:(i=e.coords[0],n=Field.getCell(i).object.objectId),e.coords.forEach(function(e){t.cellAttack(e)}),e.coords.length>3&&(i&&4===e.coords.length&&Field.setObject(i,n,e.orientation),i&&5===e.coords.length&&Field.setObject(i,DataObjects.OBJECT_POLY_COLOR,!1)),console.log("call on detroy"),t.onDestroyLine(e)}),v(animDestroyLines)},this.hasNoTurns=function(){return 0===Field.countTurns().length},this.lock=function(){e=!0},this.unlock=function(){e=!1},this.setStuffMode=function(e){o=null,E=!1,a=e,t.redraw()};this.cellAttack=function(e,i){let n,o;if(n=(o=(i=i||Field.getCell(e)).object).lightningId,i.isVisible&&(o.isGem||o.isPolyColor)&&o.isLineForming&&o.withChain)return o.withChainA&&o.withChainB?o.withChainB=!1:(o.withChainA=!1,o.withChainB=!1,Field.updateSomeFlags(o)),void v(animHummerDestroy,e);i.object.isPolyColor&&(t.onDestroyThing(DataObjects.OBJECT_POLY_COLOR,i),Field.setObject(e,DataObjects.OBJECT_HOLE,!1),v(animHummerDestroy,e)),i.isVisible&&o.isGem&&o.isLineForming&&!o.withChain&&(t.onDestroyThing(i.object.objectId,i),Field.setObject(e,DataObjects.OBJECT_HOLE,!1),v(animHummerDestroy,e),i.withGold&&(t.onDestroyThing(DataObjects.OBJECT_GOLD,i),i.withGold=!1,v(animHummerDestroy,e)),i.withTile&&(t.onDestroyThing(DataObjects.OBJECT_TILE,i),i.withTile=!1,v(animHummerDestroy,e)),i.object.withBeta&&(t.onDestroyThing(DataObjects.OBJECT_BETA,i),i.object.withBeta=!1,v(animHummerDestroy,e)),i.object.withGamma&&(t.onDestroyThing(DataObjects.OBJECT_GAMMA,i),i.object.withGamma=!1,v(animHummerDestroy,e)),Field.eachNears(e,function(e,i){var n,o;n=e,(o=i).object.isAlpha&&(o.object.health--,o.object.health?v(animHummerDestroy,n):(t.onDestroyThing(DataObjects.OBJECT_ALPHA,o),Field.setObject(n,DataObjects.OBJECT_HOLE),v(animHummerDestroy,n))),o.object.withBox&&!o.object.withChain&&(o.object.withBox=!1,t.onDestroyThing(DataObjects.OBJECT_BOX,o),Field.updateSomeFlags(o.object),v(animHummerDestroy,n)),o.object.withBox&&o.object.withChain&&(o.object.withChainA&&o.object.withChainB?o.object.withChainB=!1:(o.object.withChainA=!1,o.object.withChainB=!1),Field.updateSomeFlags(o.object),v(animHummerDestroy,n))}),n&&C(e,n))},this.getCoords=function(){return{x:t.x+m*DataPoints.BLOCK_WIDTH,y:t.y+(I-1)*DataPoints.BLOCK_HEIGHT,cellX:m,cellY:I}},this.lockHint=function(){i=!0,F&&(F(),M())},this.unlockHint=function(){i=!1,F&&(F(),M())},this.showHint=function(t){F&&F();let e=v(animHint,t);return F=function(){F=null,e()}};let v=function(e){let i;return(i=Array.from(arguments)).shift(),i.unshift({gemDoms:h,specDoms2:u,animDoms:d,onFinish:function(){e.name===animHint.name&&F&&F(),t.redraw(),t.run()}}),i.unshift(e),Animate.anim.apply(null,i)}},ElementFriendsPanel=function(){let t=this,e=!1;this.x=0,this.y=0,this.cardWidth=50,this.cardHeight=50,this.cardSpace=10,this.cardsCount=6;let i=[],n=[],o=[];this.init=function(){for(let e=0;e<t.cardsCount;e++){let s;s=GUI.createDom(void 0,{x:t.x+e*(t.cardWidth+t.cardSpace),y:t.y,width:t.cardWidth,height:t.cardHeight,border:"2px solid #715f4b",borderRadius:"8px",background:"#aaa"}),GUI.bind(s,GUI.EVENT_MOUSE_CLICK,function(){i[e]||SocNet.openInviteFriendDialog()}),n.push(s),o.push(GUI.createElement(ElementText,{x:t.x+e*(t.cardWidth+t.cardSpace)+3,y:t.y+50-15,width:t.cardWidth,height:30/(100/t.cardWidth),alignCenter:!0,background:"#eee",opacity:.7,fontSize:12}))}},this.show=function(){e||(e=!0,n.forEach(function(t){t.show()}),o.forEach(function(t){t.show()}),t.redraw())},this.hide=function(){e&&(e=!1,n.forEach(function(t){t.hide()}),o.forEach(function(t){t.hide()}))},this.setFriends=function(t){i=t},this.redraw=function(){e&&(n.forEach(function(t,e){i[e]&&i[e].photo50?(t.backgroundImage=i[e].photo50,t.pointer=GUI.POINTER_ARROW):(t.backgroundImage="friend-vacancy.png",t.pointer=GUI.POINTER_HAND),t.redraw()}),o.forEach(function(t,e){i[e]?(t.text="ур. "+i[e].nextPointId,t.show()):t.hide(),t.redraw()}))}},ElementHealthTimer=function(){let t,e=this,i=!1;this.x=void 0,this.y=void 0,this.healthIndicator=null,this.init=function(){t=GUI.createElement(ElementText,{x:this.x,y:this.y,width:100,height:30,alignCenter:!0,bold:!0}),OnIdle.register(e.updateTimer)},this.show=function(){i||(i=!0,t.show(),e.redraw())},this.hide=function(){i&&(t.hide(),i=!1)},this.redraw=function(){i&&(t.setText("00:00:00"),e.updateTimer(),t.redraw())},this.updateTimer=function(){let o;i&&(o=LogicUser.getCurrent(),PageBlockPanel.oneHealthHide&&(o.fullRecoveryTime-=LogicHealth.getHealthRecoveryTime()),LogicHealth.isMaxHealths(o)?(PageBlockPanel.oneHealthHide&&(o.fullRecoveryTime+=LogicHealth.getHealthRecoveryTime()),e.healthIndicator.redraw(),t.hide()):(PageBlockPanel.oneHealthHide&&(o.fullRecoveryTime+=LogicHealth.getHealthRecoveryTime()),t.setText(n(LogicHealth.getTimeLeft(o))),t.show(),t.redraw(),e.healthIndicator.redraw()))};let n=function(t){let e=parseInt(t,10),i=Math.floor(e/3600),n=Math.floor((e-3600*i)/60),o=e-3600*i-60*n;return i<10&&(i="0"+i),n<10&&(n="0"+n),o<10&&(o="0"+o),n+":"+o}},ElementHealthIndicator=function(){let t,e=this,i=!1;this.x=0,this.y=0,this.init=function(){let e;t=[];for(let i=0;i<5;i++)e=GUI.createDom(null,{x:this.x+35*i,y:this.y-2,width:50,height:50,backgroundImage:"health-heart.png"}),t.push(e)},this.show=function(){i||(i=!0,t.forEach(function(t){}),e.redraw())},this.hide=function(){i&&(i=!1,t.forEach(function(t){t.hide()}))},this.redraw=function(){let n,o,s,a;i&&(a=LogicUser.getCurrent(),PageBlockPanel.oneHealthHide&&(a.fullRecoveryTime-=LogicHealth.getHealthRecoveryTime()),s=1,n=LogicHealth.getHealths(a),o=35,n===LogicHealth.getMaxHealth()-1&&(o-=10),t.forEach(function(t){t.x=e.x+(s-1)*o,s<=n?t.show():t.hide(),t.redraw(),s++}),PageBlockPanel.oneHealthHide&&(a.fullRecoveryTime+=LogicHealth.getHealthRecoveryTime()))}},ElementImage=function(){let t=this,e=!1;this.x=0,this.y=0,this.width=0,this.height=0,this.src="not-found.png",this.opacity=null,this.dom=null,this.pointer=void 0;let i=null;this.title=void 0,this.photoBorder=!1,this.init=function(){(i=GUI.createDom()).width=t.width,i.height=t.height,i.backgroundImage=t.src,this.photoBorder&&(i.border="2px solid rgba(68, 62, 0, 0.7)",i.borderRadius="8px"),t.dom=i},this.show=function(){!0!==e&&(e=!0,i.show(),t.redraw())},this.hide=function(){!1!==e&&(e=!1,i.hide())},this.redraw=function(){e&&(i.backgroundImage=t.src,null!=t.opacity&&(i.opacity=t.opacity),i.x=t.x,i.y=t.y,i.title=t.title,i.pointer=t.pointer,i.redraw())}},ElementPanelItems=function(){let t,e,i,n=this,o=!1;this.x=0,this.y=0,this.items=[];let s,a={},r={};this.title="",this.init=function(){let o;t=GUI.createElement(ElementImage,{x:n.x,y:n.y,src:"panel-goals-1.png"}),e=GUI.createElement(ElementImage,{x:n.x,y:n.y,src:"panel-goals-2.png"}),i=GUI.createElement(ElementImage,{x:n.x,y:n.y,src:"panel-goals-3.png"}),s=GUI.createElement(ElementText,{x:n.x+15,y:n.y+9,width:80,text:n.title,fontSize:n.fontSize});for(let t in DataObjects.images)o=GUI.createElement(ElementImage,{width:50,height:50,src:DataObjects.images[t]}),a[t]=o,o=GUI.createElement(ElementText,{width:DataPoints.BLOCK_WIDTH,alignRight:!0}),r[t]=o},this.show=function(){if(!o){o=!0;for(let t in a)a[t].show();for(let t in r)r[t].show();s.show()}},this.hide=function(){if(o){o=!1;for(let t in a)a[t].hide();for(let t in r)r[t].hide();s.hide(),t.hide(),e.hide(),i.hide()}},this.redraw=function(){if(!o)return;for(let t in a)a[t].hide();for(let t in r)r[t].hide();switch(t.hide(),e.hide(),i.hide(),n.items.length){case 3:i.show();break;case 2:e.show();break;case 1:t.show()}let s;t.redraw(),e.redraw(),i.redraw(),s=0,n.items.forEach(function(t){a[t.id].x=n.x+15,a[t.id].y=n.y+46+s,a[t.id].show(),r[t.id].x=n.x-7+DataPoints.BLOCK_WIDTH,r[t.id].y=n.y+46+DataPoints.BLOCK_HEIGHT/2-10+s,r[t.id].setText(t.count),r[t.id].show(),s+=DataPoints.BLOCK_HEIGHT+5})}},ElementPoint=function(){let t=this,e=!1;this.x=0,this.y=0,this.srcGrey="map-way-point-grey.png",this.srcRed="map-way-point-red.png",this.srcYellow="map-way-point-yellow.png",this.srcStarOff="star-off.png",this.srcStarOn="star-on.png",this.onClick=null;let i=null,n=[],o=null,s=null,a=null,r=null,l=null,c=null,h=null,u=!1,d=!1;this.stateId=ElementPoint.STATE_CLOSE,this.pointId=null,this.pointWidth=50,this.init=function(){(i=GUI.createDom()).backgroundImage=t.srcGrey,i.pointer=GUI.POINTER_HAND,GUI.bind(i,GUI.EVENT_MOUSE_MOUSE_DOWN,I,t),GUI.bind(i,GUI.EVENT_MOUSE_CLICK,E,t),GUI.bind(i,GUI.EVENT_MOUSE_OVER,m,t),GUI.bind(i,GUI.EVENT_MOUSE_OUT,p,t),h=GUI.createElement(ElementText,{width:33,height:20,fontSize:15,pointer:GUI.POINTER_HAND},i),(o=GUI.createDom()).backgroundImage=t.srcStarOff,(s=GUI.createDom()).backgroundImage=t.srcStarOff,(a=GUI.createDom()).backgroundImage=t.srcStarOff,r=GUI.createDom(null,{height:24,width:24,border:"1px solid #715f4b",borderRadius:"2px",zIndex:100}),l=GUI.createDom(null,{height:24,width:24,border:"1px solid #715f4b",borderRadius:"2px",zIndex:100}),c=GUI.createDom(null,{height:24,width:24,border:"1px solid #715f4b",borderRadius:"2px",zIndex:100})},this.show=function(){e||(e=!0,t.redraw(),i.show(),o.show(),s.show(),a.show(),h.show())},this.hide=function(){e&&(e=!1,i.hide(),o.hide(),s.hide(),a.hide(),h.hide(),r.hide(),l.hide(),c.hide())},this.redraw=function(){if(e){switch(this.stateId){case ElementPoint.STATE_CLOSE:i.pointer=GUI.POINTER_ARROW,i.backgroundImage=this.srcGrey;break;case ElementPoint.STATE_CURRENT:i.pointer=GUI.POINTER_HAND,i.backgroundImage=this.srcRed;break;case ElementPoint.STATE_FINISHED:i.pointer=GUI.POINTER_HAND,i.backgroundImage=this.srcYellow}t.stateId===ElementPoint.STATE_CLOSE?i.pointer=GUI.POINTER_ARROW:i.pointer=GUI.POINTER_HAND,i.x=t.x,i.y=t.y,h.x=9,h.y=16.5,h.text=t.pointId?t.pointId.toString():"",g(),f(),i.redraw(),o.redraw(),s.redraw(),a.redraw(),h.redraw()}};let g=function(){let e,i,n;e=DataPoints.countStars(t.pointId),i=t.pointWidth/2-12.5,n=7,o.x=t.x-17+i,o.y=t.y-7,o.backgroundImage=e>=1?t.srcStarOn:t.srcStarOff,s.x=t.x+i,s.y=t.y-7-11,s.backgroundImage=e>=2?t.srcStarOn:t.srcStarOff,a.x=t.x+17+i,a.y=t.y-7,a.backgroundImage=e>=3?t.srcStarOn:t.srcStarOff},f=function(){let e,i,o=t.pointWidth/2-12-2,s=0,a=[r,l,c];t.y>250||1===DataMap.getNumberFromPointId(t.pointId)||18===DataMap.getNumberFromPointId(t.pointId)?(e=-38,i=5):(e=38,i=-5),r.x=t.x-18+o,r.y=t.y+e,l.x=t.x+o,l.y=t.y+e-i,c.x=t.x+19+o,c.y=t.y+e,n.forEach(function(t){t&&t&&t.photo50?(a[s].backgroundImage=t.photo50,a[s].show(),a[s].redraw()):a[s].hide(),s++})},m=function(){t.enabled&&(d=!0,t.redraw())},I=function(){t.enabled&&(u=!0,t.redraw())},p=function(){t.enabled&&(d=!1,t.redraw())},E=function(e,i){if(e.stopPropagation(),t.stateId!==ElementPoint.STATE_CLOSE)return u=!1,d=!1,t.redraw(),t.onClick.call(null,e,i,this)};this.setGamers=function(e){for(e=e.filter(function(e){return e.nextPointId===t.pointId}),1===(n=e.slice(0,3)).length&&n.unshift(null);n.length<3;)n.push(null)}};ElementPoint.STATE_CLOSE=1,ElementPoint.STATE_CURRENT=2,ElementPoint.STATE_FINISHED=3;let ElementSprite=function(){let t,e=this,i=!1;this.x=0,this.y=0,this.width=0,this.height=0,this.src="not-found.png",this.opacity=null,this.dom=null,this.pointer=void 0,this.title=void 0,this.init=function(){(t=GUI.createDom(void 0,e.domInitParams)).width=e.width,t.height=e.height,t.x=e.x,t.y=e.y,t.backgroundImage=e.src,e.dom=t},this.show=function(){!0!==i&&(i=!0,t.show(),e.redraw())},this.hide=function(){!1!==i&&(i=!1,t.hide())},this.redraw=function(){i&&(null!=e.opacity&&(t.opacity=e.opacity),t.title=e.title,t.pointer=e.pointer,t.redraw())}},ElementStuffButton=function(){let t=this,e=!1;this.x=0,this.y=0,this.width=0,this.height=0,this.srcHover=null,this.srcActive=null,this.srcRest=null,this.onClick=null,this.title=null,this.enabled=!0;let i=null,n=null,o=!1,s=!1;this.init=function(){(i=GUI.createDom()).width=t.width,i.height=t.height,i.backgroundImage=t.srcRest,i.pointer=GUI.POINTER_HAND,GUI.bind(i,GUI.EVENT_MOUSE_MOUSE_DOWN,r,t),GUI.bind(i,GUI.EVENT_MOUSE_CLICK,c,t),GUI.bind(i,GUI.EVENT_MOUSE_OVER,a,t),GUI.bind(i,GUI.EVENT_MOUSE_OUT,l,t),n=GUI.createElement(ElementText,{})},this.show=function(){!0!==e&&(e=!0,i.show(),n.show(),t.redraw())},this.hide=function(){!1!==e&&(e=!1,i.hide(),n.hide())},this.redraw=function(){let a,r,l;e&&(i.x=t.x,i.y=t.y,a=t.srcRest,r=t.width?t.width:Images.getWidth(t.srcRest),l=t.height?t.height:Images.getHeight(t.srcRest),i.width=r,i.height=l,s&&(t.srcHover?a=t.srcHover:(i.width=1.1*r,i.height=1.1*l,i.x=t.x-.05*r,i.y=t.y-.05*l)),s&&o&&(t.srcHover?a=t.srcActive:(i.width=1.2*Images.getWidth(t.srcRest),i.height=1.2*Images.getHeight(t.srcRest),i.x=t.x-.1*r,i.y=t.y-.1*l)),!s&&o&&(a=t.srcRest),i.backgroundImage=a,t.title&&(i.title=t.title),t.enabled?(i.pointer=GUI.POINTER_HAND,i.opacity=1):(i.pointer=GUI.POINTER_ARROW,i.opacity=.5),n.x=t.x+70,n.y=t.y+40,n.setText(LogicStuff.getStuff(t.fieldName)),i.redraw(),n.redraw())};let a=function(){t.enabled&&(s=!0,t.redraw())},r=function(){t.enabled&&(o=!0,t.redraw())},l=function(){t.enabled&&(s=!1,t.redraw())},c=function(e,i){if(e.stopPropagation(),t.enabled)return o=!1,s=!1,t.redraw(),t.onClick.call(null,e,i)}},ElementText=function(){let t=this,e=!1;this.x=void 0,this.y=void 0,this.width=void 0,this.height=void 0,this.text="";let i=null;this.pointer=GUI.POINTER_ARROW,this.fontSize=18,this.bold=!0,this.alignCenter=!0,this.alignRight=!1,this.opacity=void 0,this.textDecoration=void 0,this.init=function(){(i=GUI.createDom(void 0,{height:this.height,color:this.color?this.color:"rgba(103, 77, 56, 1.0)",background:this.background,fontFamily:'arial,sans-serif,"Marvin",Tahoma,"Geneva CY",sans-serif'})).__dom.style.zIndex=this.zIndex,GUI.bind(i,GUI.EVENT_MOUSE_CLICK,o,t)},this.show=function(){e||(e=!0,i.show(),t.redraw())},this.hide=function(){e&&(e=!1,i.hide())},this.setText=function(e){"string"!=typeof e&&(e=e.toString()),t.text=e},this.redraw=function(){e&&(n(),i.x=t.x,i.y=t.y,i.fontSize=t.fontSize,i.opacity=t.opacity,i.width=t.width,i.textDecoration=t.textDecoration,t.bold?i.fontWeight="bold":i.fontWeight="normal",t.alignCenter&&(i.alignText="center"),t.alignRight&&(i.alignText="right"),i.redraw())};let n=function(){let e,n;e="";for(let i in t.text){let o=t.text[i];10!=(n=t.text.charCodeAt(i))?e+=o:e+="<br>"}i.innerHTML=e,i.pointer=t.pointer},o=function(e,i){if(t.onClick)return e.stopPropagation(),t.onClick.call(this,e,i)}},ElementUserScorePhoto=function(){let t,e,i,n=this,o=!1;this.x=0,this.y=0,this.user=null,this.score=null,this.init=function(){i=GUI.createElement(ElementText,{x:n.x-25,y:n.y-22,width:100,height:50,fontSize:12,alignCenter:!0}),t=GUI.createElement(ElementImage,{x:n.x,y:n.y,width:50,height:50,photoBorder:!0}),e=GUI.createElement(ElementText,{x:n.x-25,y:n.y+61,width:100,height:50,fontSize:12,alignCenter:!0})},this.show=function(){!0!==o&&(o=!0,i.show(),t.show(),e.show(),n.redraw())},this.hide=function(){!1!==o&&(o=!1,i.hide(),t.hide(),e.hide())},this.redraw=function(){o&&this.user&&this.user.id&&(i.text=this.user.firstName,t.src=this.user.photo50,e.text=this.score.toString(),i.redraw(),t.redraw(),e.redraw())}},LogicChests=function(){let t={1:18,2:36,3:54};this.getStarsByNumber=function(e){return t[e]},this.getNumberFromPointId=function(t){return 3%t},this.onFinish=function(t,e,i,n){let o,s,a,r,l,c,h,u,d;return o=DataPoints.countStars(null,null,e),s=DataPoints.countStars(null,null,i),r=(a=DataMap.countStarsByMapId())+(s-o),l=LogicChests.getStarsByNumber(1),c=LogicChests.getStarsByNumber(2),h=LogicChests.getStarsByNumber(3),u=0,(a<l&&l===r||1===n)&&(u=1),(a<c&&c===r||2===n)&&(u=2),(a<h&&h===r||3===n)&&(u=3),u?(d=LogicChests.getChestId(u),LogicChests.open(d),d):0},this.open=function(t){PBZDialogs.dialogChestYouWin.showDialog(t)},this.getChestId=function(t){return 3*(DataMap.getCurrent().id-1)+t}};LogicChests=new LogicChests;let LogicField=function(){let t=this,e=null,i=[DataObjects.OBJECT_RED,DataObjects.OBJECT_GREEN,DataObjects.OBJECT_BLUE,DataObjects.OBJECT_YELLOW,DataObjects.OBJECT_PURPLE,DataObjects.OBJECT_SAND],n=[DataObjects.OBJECT_RED,DataObjects.OBJECT_GREEN,DataObjects.OBJECT_BLUE,DataObjects.OBJECT_YELLOW,DataObjects.OBJECT_PURPLE],o=[DataObjects.OBJECT_RED,DataObjects.OBJECT_GREEN,DataObjects.OBJECT_BLUE,DataObjects.OBJECT_YELLOW,DataObjects.OBJECT_PURPLE,DataObjects.OBJECT_SAND,DataObjects.OBJECT_POLY_COLOR,DataObjects.OBJECT_BARREL,DataObjects.OBJECT_ALPHA];this.getCell=function(i){return!t.isOut(i)&&e[i.x][i.y]},this.getObject=function(t){return this.getCell(t).object},this.isGem=function(t){return!(!e[t.x]||!e[t.x][t.y])&&e[t.x][t.y].object.isGem},this.isNotGem=function(e){return!t.isGem(e)},this.isHole=function(t){return!(!e[t.x]||!e[t.x][t.y])&&e[t.x][t.y].object.isHole},this.isFallObject=function(i){return!t.isOut(i)&&-1!==o.indexOf(e[i.x][i.y].object.objectId)},this.mayFall=function(e,i){return!t.isOut({x:e,y:i})&&(!!LogicField.getCell({x:e,y:i}).object.isCanMoved&&(LogicField.isFallObject({x:e,y:i})&&s({x:e,y:i})))};let s=function(e){for(let i,n,o=0;o<DataPoints.FIELD_MAX_HEIGHT&&(e.y++,n=(i=t.getCell(e))&&i.object,!i||!i.isVisible||n.isHole||n.withBox||n.withChain);o++)if(i&&i.isVisible&&n.isHole)return e;return!1};this.getRandomGemId=function(){return n[Math.floor(Math.random()*n.length)]},this.isVisible=function(t){return!(!e[t.x]||!e[t.x][t.y])&&e[t.x][t.y].isVisible},this.countTurns=function(){let e,i,n,o,s,a=[],r=function(r,l){o=t.getCell(r),s=t.getCell(l),o&&s&&(i=o.object,n=s.object,o.isVisible&&i.isCanMoved&&s.isVisible&&n.isCanMoved&&(t.exchangeObjects(r,l),(e=t.findLines()).length&&a.push({a:r,b:l,lines:e}),t.exchangeObjects(r,l)))};return this.eachCell(function(t,e){r({x:t,y:e},{x:t+1,y:e}),r({x:t,y:e},{x:t,y:e+1})}),a},this.exchangeObjects=function(i,n,o){let s;return!t.isOut(i)&&!t.isOut(n)&&(o?(s=e[n.x][n.y].object.objectId,e[n.x][n.y].object.objectId=e[i.x][i.y].object.objectId,e[i.x][i.y].object.objectId=s):(s=e[n.x][n.y].object,e[n.x][n.y].object=e[i.x][i.y].object,e[i.x][i.y].object=s),!0)},this.isOut=function(t){return t.x<0||t.x>=DataPoints.FIELD_MAX_WIDTH||t.y<0||t.y>DataPoints.FIELD_MAX_HEIGHT},this.isNear=function(t,e){return 1===Math.abs(t.x-e.x)&&t.y-e.y==0||t.x-e.x==0&&1===Math.abs(t.y-e.y)},this.findLines=function(){let e,i,n,o;return i=[],n=[],o=[],this.eachCell(function(s,a){t.lineCrossing(n,s,a)||(e=t.findLine(s,a,DataObjects.WITH_LIGHTNING_VERTICAL))&&(i.push(e),n.push(e)),t.lineCrossing(o,s,a)||(e=t.findLine(s,a,DataObjects.WITH_LIGHTNING_HORIZONTAL))&&(i.push(e),o.push(e))}),i},this.findLine=function(e,i,n){let o,s,a;if(a=t.getCell({x:e,y:i}),o=a.object.objectId,!a.isVisible||!a.object.isLineForming)return!1;s={orientation:n,coords:[],gemId:o};let r=function(e){return!!((a=t.getCell(e))&&a.isVisible&&a.object.isLineForming&&a.object.objectId===o)&&s.coords.push(e)};if(n===DataObjects.WITH_LIGHTNING_HORIZONTAL)for(let t=0;t<5&&r({x:e+t,y:i});t++);else for(let t=0;t<5&&r({x:e,y:i+t});t++);return s.coords.length>=3&&s},this.lineCrossing=function(t,e,i){let n=!1;return t.forEach(function(t){t.coords.forEach(function(t){e===t.x&&i===t.y&&(n=!0)})}),n},this.eachCell=function(t){for(let i=0;i<DataPoints.FIELD_MAX_HEIGHT;i++)for(let n=0;n<DataPoints.FIELD_MAX_WIDTH;n++)t(n,i,e&&e[n][i],e&&e[n][i].object)},this.setObject=function(n,o,s){let a;(a=e[n.x][n.y].object).objectId=o,a.isHole=o===DataObjects.OBJECT_HOLE,a.isGem=-1!==i.indexOf(o),a.lightningId=s,a.isPolyColor=o===DataObjects.OBJECT_POLY_COLOR,a.isBarrel=o===DataObjects.OBJECT_BARREL,a.isBlock=o===DataObjects.OBJECT_BLOCK,a.isAlpha=o===DataObjects.OBJECT_ALPHA,t.updateSomeFlags(a)},this.updateSomeFlags=function(t){t.withChain=t.withChainA||t.withChainB,t.isCanMoved=(t.isGem||t.isBarrel||t.isPolyColor||t.isAlpha)&&!t.withBox&&!t.withChain,t.isLineForming=t.isGem&&!t.withBox},this.getGemId=function(t){return e[t.x]&&e[t.x][t.y].object.objectId},this.setLayers=function(n,o,s){let r,l,c;e=[];for(let h=0;h<DataPoints.FIELD_MAX_WIDTH;h++){e[h]=[];for(let u=0;u<DataPoints.FIELD_MAX_HEIGHT;u++){let d,g;l=!1,-1!==(r=a({x:h,y:u},s)).indexOf(DataObjects.WITH_LIGHTNING_HORIZONTAL)&&(l=DataObjects.WITH_LIGHTNING_HORIZONTAL),-1!==r.indexOf(DataObjects.WITH_LIGHTNING_VERTICAL)&&(l=DataObjects.WITH_LIGHTNING_VERTICAL),-1!==r.indexOf(DataObjects.WITH_LIGHTNING_CROSS)&&(l=DataObjects.WITH_LIGHTNING_CROSS),c=o[h]&&o[h][u],-1!==r.indexOf(DataObjects.OBJECT_BARREL)&&(c=DataObjects.OBJECT_BARREL),-1!==r.indexOf(DataObjects.OBJECT_ALPHA)&&(c=DataObjects.OBJECT_ALPHA),-1!==r.indexOf(DataObjects.OBJECT_SAND)&&(c=DataObjects.OBJECT_SAND),-1!==r.indexOf(DataObjects.OBJECT_BLOCK)&&(c=DataObjects.OBJECT_BLOCK),i.forEach(function(t){-1!==r.indexOf(t)&&(c=t)}),c||(c=Field.getRandomGemId()),d={object:g={},x:h,y:u},e[h][u]=d,d.isVisible=n[h]&&n[h][u]&&n[h][u]===DataObjects.CELL_VISIBLE,d.isEmitter=-1!==r.indexOf(DataObjects.IS_EMITTER),c===DataObjects.OBJECT_ALPHA&&(g.health=3),d.withGold=-1!==r.indexOf(DataObjects.OBJECT_GOLD),d.withTile=-1!==r.indexOf(DataObjects.OBJECT_TILE),g.withBox=-1!==r.indexOf(DataObjects.OBJECT_BOX),g.withChainA=-1!==r.indexOf(DataObjects.OBJECT_CHAIN_A),g.withChainB=-1!==r.indexOf(DataObjects.OBJECT_CHAIN_B),g.withBeta=-1!==r.indexOf(DataObjects.OBJECT_BETA),g.withGamma=-1!==r.indexOf(DataObjects.OBJECT_GAMMA),t.setObject({x:h,y:u},c,l)}}Field.findLines().length&&Field.shuffle(!0)},this.eachNears=function(e,i){[{x:e.x+1,y:e.y},{x:e.x-1,y:e.y},{x:e.x,y:e.y+1},{x:e.x,y:e.y-1}].forEach(function(e){!t.isOut(e)&&t.isVisible(e)&&i(e,t.getCell(e))})};let a=function(t,e){return e[t.x]&&e[t.x][t.y]?e[t.x][t.y]:[]};this.isLinePossiblyDestroy=function(t,e){let i,n;return LogicField.exchangeObjects(t,e),i=LogicField.findLines(),n=LogicField.lineCrossing(i,t.x,t.y)|LogicField.lineCrossing(i,e.x,e.y),LogicField.exchangeObjects(t,e),n},this.eachVisibleLine=function(e,i,n){let o=[],s=function(e,i){(i=t.getCell(e)).isVisible&&o.push({p:e,cell:i})};switch(i){case DataObjects.WITH_LIGHTNING_HORIZONTAL:for(let t=0;t<DataPoints.FIELD_MAX_WIDTH;t++)s({x:t,y:e.y});break;case DataObjects.WITH_LIGHTNING_VERTICAL:for(let t=0;t<DataPoints.FIELD_MAX_HEIGHT;t++)s({x:e.x,y:t});break;default:Logs.log("Error :"+arguments.callee.name,Logs.LEVEL_ERROR)}o.sort(function(t,e){return t.cell.object.isCanMoved&&!e.cell.object.isCanMoved?1:!t.cell.object.isCanMoved&&e.cell.object.isCanMoved?-1:0}),o.forEach(function(t){n(t.p,t.cell)})},this.getVisibleLength=function(t,e){let i=1/0,n=-1/0;switch(e){case DataObjects.WITH_LIGHTNING_HORIZONTAL:for(let e=0;e<DataPoints.FIELD_MAX_WIDTH;e++)Field.isVisible({x:e,y:t.y})&&(i=Math.min(i,e),n=Math.max(n,e));return{lower:i,higher:n,length:n-i+1};case DataObjects.WITH_LIGHTNING_VERTICAL:for(let e=0;e<DataPoints.FIELD_MAX_HEIGHT;e++)Field.isVisible({x:t.x,y:e})&&(i=Math.min(i,e),n=Math.max(n,e));return{lower:i,higher:n,length:n-i+1}}};let r=0;this.shuffle=function(e){r++;let i,n=function(){let t,i,n;Field.eachCell(function(o,s,a){let r,l;t={x:o,y:s},i={x:Math.floor(Math.random()*DataPoints.FIELD_MAX_WIDTH),y:Math.floor(Math.random()*DataPoints.FIELD_MAX_HEIGHT)},n=Field.getCell(i),r=a.object,l=n.object,a.isVisible&&r.isCanMoved&&!r.isBarrel&&r.objectId!==DataObjects.OBJECT_SAND&&n.isVisible&&l.isCanMoved&&!l.isBarrel&&l.objectId!==DataObjects.OBJECT_SAND&&Field.exchangeObjects(t,i,e)})};for(n(),i=0;i++<50&&0!==Field.findLines().length;)n();if(i=0,Field.findLines().length>0&&e&&r++<1e3){for(;i++<50&&(Field.eachCell(function(e,i,n){n.isVisible&&n.object.isGem&&n.object.objectId!==DataObjects.OBJECT_SAND&&(n.object.objectId=t.getRandomGemId())}),0!==Field.findLines().length););t.shuffle(!0)}else r=0}};LogicField=new LogicField;let Field=LogicField,LogicHealth=function(){let t=function(){return void 0!==LogicTimeClient?LogicTimeClient.getTime():LogicTimeServer.getTime()};this.getMaxHealth=function(){return DataCross.user.maxHealth},this.getHealthRecoveryTime=function(){return DataCross.user.healthRecoveryTime},this.getHealths=function(e){let i,n,o,s;return i=e.fullRecoveryTime,n=t(),o=LogicHealth.getHealthRecoveryTime(),(s=i-n)<=0?this.getMaxHealth():Math.max(0,this.getMaxHealth()-Math.ceil(s/o))},this.isMaxHealths=function(t){return this.getHealths(t)===this.getMaxHealth()},this.setMaxHealth=function(e){e.fullRecoveryTime=t()},this.decrementHealth=function(t,e){e||(e=1),LogicHealth.isMaxHealths(t)&&LogicHealth.setMaxHealth(t),0===LogicHealth.getHealths(t)&&LogicHealth.zeroLife(t),t.fullRecoveryTime+=this.getHealthRecoveryTime()*e},this.getTimeLeft=function(e){let i;return this.isMaxHealths(e)?0:(i=e.fullRecoveryTime-t())-Math.floor(i/this.getHealthRecoveryTime())*this.getHealthRecoveryTime()},this.zeroLife=function(e){e.fullRecoveryTime=t()+this.getHealthRecoveryTime()*this.getMaxHealth()}};LogicHealth=new LogicHealth,CONST_IS_SERVER_SIDE&&(global.LogicHealth=LogicHealth);let LogicMain=function(){LogicMain.prototype.onConnect=function(t){ApiRouter.onConnect(t),SAPITimeServer.sendMeTime(),LogicUser.authorize()},LogicMain.prototype.onAuthorizeSuccess=function(){DataMap.setCurrentMapId(LogicUser.getUserLastMapId()),LogicStuff.loadStuff(),PageController.showPage(PageMain),LogicWizard.onAuthorizeSuccess()},LogicMain.prototype.main=function(){let t;Logs.init(function(){}),DataPoints.init(),DataChests.init(),SocNet.init(),(t=new WebSocketClient).init(function(){}),ApiRouter.setMap({CAPIUser:CAPIUser,CAPITimeServer:CAPITimeServer,CAPIMap:CAPIMap,CAPIStuff:CAPIStuff,CAPILog:CAPILog}),ApiRouter.sendData=t.sendData,t.onData=ApiRouter.onData,t.onConnect=this.onConnect,t.onDisconnect=ApiRouter.onDisconnect,t.run(),OnIdle.init(function(){})}};LogicMain=new LogicMain;let LogicMap=function(){this.onArrowPrevClick=function(){DataMap.setPrevMap(),PageController.redraw()},this.onArrowNextClick=function(){DataMap.setNextMap(),PageController.redraw()}};LogicMap=new LogicMap;let LogicStuff=function(){let t={};this.STUFF_HUMMER=1,this.STUFF_LIGHTNING=2,this.STUFF_SHUFFLE=3,this.loadStuff=function(){SAPIStuff.sendMeStuff()},this.updateStuff=function(e){t=e,PageController.redraw()},this.getStuff=function(e){return e?(void 0===t[e]&&Logs.log("No Stuff:",Logs.LEVEL_FATAL_ERROR,[e,t]),t[e]):t},this.usedHummer=function(){t.hummerQty--},this.usedShuffle=function(){t.shuffleQty--},this.usedLightning=function(){t.lightningQty--},this.usedGold=function(e){t.goldQty-=e},this.giveAHummer=function(e){t.hummerQty+=e},this.giveAShuffle=function(e){t.shuffleQty+=e},this.giveALighnting=function(e){t.lightningQty+=e},this.giveAGold=function(e){t.goldQty+=e},this.giveAHealth=function(t){let e;e=LogicUser.getCurrent(),LogicHealth.decrementHealth(e,-t)}};LogicStuff=new LogicStuff;let LogicTimeClient=function(){let t=0,e=0,i=0;this.setServerTime=function(n){t=n,e=(new Date).getTime(),i=t-e,Logs.log("Time sync:"+n+" gotTime:"+e+" timeDiff:"+i,Logs.LEVEL_DETAIL)},this.getTime=function(){return Math.floor(this.getMicroTime()/1e3)},this.getMicroTime=function(){return(new Date).getTime()},this.convertToClient=function(t){let e;return(e=1e3*t-i)/1e3}};LogicTimeClient=new LogicTimeClient;let LogicUser=function(){let t=this,e=null,i=[],n=null;this.authorize=function(){let t,e;switch(t=SocNet.getSocNetUserId(),e=SocNet.getAuthParams(),SocNet.getType()){case SocNet.TYPE_VK:SAPIUser.authorizeByVK(t,e);break;case SocNet.TYPE_STANDALONE:SAPIUser.authorizeByStandalone(t,e);break;default:Logs.log("Wrong soc net type",Logs.LEVEL_FATAL_ERROR)}},this.authorizeSuccess=function(t){e=t,s={},LogicMain.onAuthorizeSuccess()},this.isAuthorized=function(){return!!e},this.getCurrent=function(){return this.getById(e)},this.getById=function(e){return i[e]?i[e]:(t.loadUserInfoById(e),o())},this.getList=function(e){let n,o;return n=[],e&&e.length?(o=[],e.forEach(function(t){i[t]||s[t]||(s[t]=!0,i[t]=!1,o.push(t))}),o.length&&SAPIUser.sendMeUserListInfo(o),e.forEach(function(e){t.getById(e).photo50&&n.push(t.getById(e))}),n):n};let o=function(){return{id:null,online:!1}},s={};this.loadUserInfoById=function(t){null!==e&&(s[t]||(s[t]=!0,SAPIUser.sendMeUserInfo(t)))},this.updateUserInfo=function(t){s[t.id]=!1,i[t.id]||(i[t.id]=o());for(let e in t)i[t.id][e]=t[e];i[t.id].photo50||SocNet.getUserInfo(t.socNetUserId,function(e){i[t.id].photo50=e[0].photo_50,i[t.id].photo100=e[0].photo_100,i[t.id].firstName=e[0].first_name,i[t.id].lastName=e[0].last_name,PageController.redraw()}),PageController.redraw()},this.setFriendIds=function(t){n=t,PageController.redraw()};let a=!1;this.getFriendIds=function(t){return n||a?n?t?n.slice(0,t):n:null:(a=!0,SocNet.getFriendIds(function(t){SAPIUser.sendMeUserIdsBySocNet(t)}),null)},this.getMapFriendIds=function(t){let e;return this.getFriendIds()&&(e=DataPoints.getPointsByMapId(t),n.forEach(function(t){})),null};let r=[];this.getFriendIdsByMapId=function(t){let e,i,o;return this.getFriendIds()?(i=DataMap.getFirstPointId(),e=DataMap.getLastPointId(),o=this.getList(n).filter(function(t){return t.nextPointId>=i&&t.nextPointId<=e}).map(function(t){return t.id}),function(t){t||(t=currentMapId),LogicUser.getFriendIds()&&(r[t]||(r[t]=!0,SAPIMap.sendMeUsersScore(t,LogicUser.getFriendIds())))}(t),o):[]},this.getFriendIdsByMapIdAndPointIdWithScore=function(t,e,i){let n,o,s,a;return s=[],n=LogicUser.getFriendIdsByMapId(t),a=LogicUser.getCurrent().id,i&&n.push(a),n&&(o=LogicUser.getList(n)),o&&(s=o.filter(function(t,n){return!(!i&&a===t.id)&&(o.indexOf(t)===n&&t.nextPointId>=e)}).sort(function(t,e){return e.lastLoginTimestamp-t.lastLoginTimestamp}).map(function(t){return t})),s},this.getUserLastMapId=function(){return DataMap.getMapIdFromPointId(LogicUser.getCurrent().nextPointId)}};LogicUser=new LogicUser;let LU=LogicUser,LogicWizard=function(){let t=this,e=function(){};this.TAG_FIRST_NUMBER_POINT=1,this.onClick=e,this.onDestroyThing=e,this.onDestroyLine=e,this.onShowDialog=e,this.onHideDialog=e,this.onFieldSilent=e,this.onAuthorizeSuccess=function(){1===LogicUser.getCurrent().nextPointId&&t.start(WizardFirstStart_1)},this.onFieldFirstShow=function(){let e=LogicUser.getCurrent().nextPointId,i=DataPoints.getPlayedId();2===e&&2===i&&t.start(WizardLevel2_1),3===e&&3===i&&t.start(WizardLevel3_1),4===e&&4===i&&t.start(WizardLevel_4_1),9===e&&9===i&&t.start(WizardLevel9_1),12===e&&12===i&&t.start(WizardLevel12_1),15===e&&15===i&&t.start(WizardLevel14_1),23===e&&23===i&&t.start(WizardLevel23_1),41===e&&41===i&&t.start(WizardLevel_41_1),46===e&&46===i&&t.start(WizardLevel46_1),51===e&&51===i&&t.start(WizardLevel51_1)},this.start=function(i){PBWizard.reset(),i.dialogCounter=0,t.onClick=i.onClick?i.onClick:e,t.onDestroyThing=i.onDestroyThing?i.onDestroyThing:e,t.onDestroyLine=i.onDestroyLine?i.onDestroyLine:e,t.onShowDialog=i.onShowDialog?i.onShowDialog:e,t.onHideDialog=i.onHideDialog?i.onHideDialog:e,t.onFieldSilent=i.onFieldSilent?i.onFieldSilent:e,i.init()},this.finish=function(){PBWizard.finish(),t.onClick=e,t.onDestroyThing=e,t.onDestroyLine=e,t.onShowDialog=e,t.onHideDialog=e,t.onFieldSilent=e}};LogicWizard=new LogicWizard;let PageBlockBackground=function(){let t=this,e=!1;this.elements=[],this.init=function(){let e;e=GUI.createElement(ElementImage,{x:-15,y:-15,src:"fs-frame.png"}),t.elements.push(e),e=GUI.createElement(ElementImage,{x:0,y:0,src:"old-paper.png"}),t.elements.push(e),i()},this.show=function(){if(!0!==e){e=!0,t.preset();for(let e in t.elements)t.elements[e].show();t.redraw()}},this.hide=function(){if(!1!==e){e=!1;for(let e in t.elements)t.elements[e].hide()}},this.preset=function(){},this.redraw=function(){if(e){t.preset();for(let e in t.elements)t.elements[e].redraw()}};let i=function(){let t,e;t=document.getElementsByTagName("body")[0],e="url('"+Images.getPath("old-paper.png")+"')",t.style.backgroundImage=e}};PageBlockBackground=new PageBlockBackground;let PageBlockField=function(){let t,e,i,n,o=this,s=!1,a=null,r=null,l=null,c=null,h=null,u=null,d=null,g=null,f=null,m=null,I=null,p=null,E=null;this.elements=[],this.init=function(){let e,n,s,L;L=37,a=GUI.createElement(ElementField,{centerX:388.5,centerY:250,onDestroyLine:o.onDestroyLine,onDestroyThing:o.onDestroyThing,beforeTurnUse:o.beforeTurnUse,beforeStuffUse:o.beforeStuffUse,onFieldSilent:o.onFieldSilent}),o.elements.push(a),e=GUI.createElement(ElementButton,{x:730,y:10,srcRest:"button-quit-rest.png",onClick:function(){0===i?PBZDialogs.dialogTurnsLoose.reset():PBZDialogs.dialogJustQuit.showDialog()}}),o.elements.push(e),n=635,s=95,e=GUI.createElement(ElementImage,{x:n,y:s,src:"panel-turns.png"}),o.elements.push(e),e=GUI.createElement(ElementText,{x:n,y:s+8,width:112,text:"УРОВЕНЬ",alignCenter:!0,fontSize:14}),o.elements.push(e),d=GUI.createElement(ElementText,{x:n,y:s+37,width:112,alignCenter:!0}),o.elements.push(d),n=15,s=160,e=GUI.createElement(ElementImage,{x:n,y:s,src:"panel-score.png"}),o.elements.push(e),e=GUI.createElement(ElementText,{x:n,y:s+8,width:112,text:"ОЧКИ",alignCenter:!0,fontSize:14}),o.elements.push(e),r=GUI.createElement(ElementText,{x:n,y:s+37,width:112,alignCenter:!0}),o.elements.push(r),l=GUI.createDom(void 0,{x:n+15,y:s+62}),o.elements.push(l),c=GUI.createDom(void 0,{x:n+15+27,y:s+62}),o.elements.push(c),h=GUI.createDom(void 0,{x:n+15+54,y:s+62}),o.elements.push(h),n=15,s=75,e=GUI.createElement(ElementImage,{x:n,y:s,src:"panel-turns.png"}),o.elements.push(e),e=GUI.createElement(ElementText,{x:n,y:s+8,width:112,text:"ХОДЫ",alignCenter:!0,fontSize:14}),o.elements.push(e),u=GUI.createElement(ElementText,{x:n,y:s+37,width:112,alignCenter:!0}),o.elements.push(u),n=15,s=260,t=GUI.createElement(ElementPanelItems,{x:n,y:s,title:"ЦЕЛИ",fontSize:14}),o.elements.push(t),s=200,e=GUI.createElement(ElementStuffButton,{x:650,y:s,fieldName:"hummerQty",srcRest:"button-hummer-rest.png",onClick:function(){o.setStuffMode(LogicStuff.STUFF_HUMMER)}}),o.elements.push(e),e=GUI.createElement(ElementStuffButton,{x:650,y:s+80,fieldName:"lightningQty",srcRest:"button-lightning-rest.png",onClick:function(){o.setStuffMode(LogicStuff.STUFF_LIGHTNING)}}),o.elements.push(e),e=GUI.createElement(ElementStuffButton,{x:650,y:s+160,fieldName:"shuffleQty",srcRest:"button-shuffle-rest.png",onClick:function(){o.setStuffMode(LogicStuff.STUFF_SHUFFLE)}}),o.elements.push(e),p=GUI.createElement(ElementButton,{x:312,y:5,width:25,height:25,srcRest:"button-reload-field-rest.png",onClick:function(){AnimLocker.lock(),CAPIMap.setCallbackOnMapsInfo(function(){PageController.showPage(PageMain),PageController.showPage(PageField),AnimLocker.release(),PageController.redraw()}),SAPIMap.reloadLevels(),SAPIMap.sendMeMapInfo(DataMap.getCurrent().id)}}),E=GUI.createElement(ElementButton,{x:342,y:5,width:25,height:25,srcRest:"field-red.png",onClick:function(){switch(Config.OnIdle.animStep){case 5:E.srcRest="field-yellow.png",Config.OnIdle.animStep=1;break;case 1:E.srcRest="field-red.png",Config.OnIdle.animStep=.2;break;case.2:E.srcRest="field-green.png",Config.OnIdle.animStep=5;break;default:Config.OnIdle.animStep=1}E.redraw()}}),(I=GUI.createDom(null,{x:190,y:10})).__dom.style.zIndex=1e4,f=GUI.createDom(void 0,{x:0,y:0,width:DataCross.app.width,height:DataCross.app.height,background:"black",opacity:.3,zIndex:999}),g=GUI.createElement(ElementText,{x:DataCross.app.width/2-DataCross.app.width/1.5/2,y:DataCross.app.height/2-40,width:DataCross.app.width/1.5,height:40,fontSize:36,color:"#fdfff5",alignCenter:!0,zIndex:1e3}),GUI.bind(I,GUI.EVENT_MOUSE_CLICK,function(t,e){let i;I.hide(),(i=document.elementFromPoint(t.clientX,t.clientY)).parentElement.__dom&&i.parentElement.__dom.isFieldContainer&&i.dispatchEvent(new MouseEvent(t.type,t)),m&&I.show()}),GUI.onMouseMove(function(t,e){I.x=t-25,I.y=e-25,I.redraw()})},this.show=function(){if(!0!==s){s=!0,y();for(let t in o.elements)o.elements[t].show();o.firstShow(),SocNet.getType()!==SocNet.TYPE_STANDALONE&&1!==LogicUser.getCurrent().id&&1!==LogicUser.getCurrent().socNetUserId||(p.show(),E.show())}},this.isShowed=function(){return s},this.hide=function(){if(!1!==s){s=!1;for(let t in o.elements)o.elements[t].hide();I.hide(),t.hide(),p.hide(),E.hide()}};let L,y=function(){let t;t=DataPoints.getById(DataPoints.getPlayedId()),e=0,i=t.turns,n=DataPoints.copyGoals(t.goals),a.setLayers(t.layers),o.redraw()};this.firstShow=function(){let t;a.unlock(),a.run(),t=DataPoints.getById(DataPoints.getPlayedId()),PBZDialogs.dialogGoals.setGoals(t.goals),PBZDialogs.dialogGoals.showDialog(),L=!1,LogicWizard.onFieldFirstShow()},this.redraw=function(){if(!s)return;let a=DataPoints.countStars(null,null,e);l.backgroundImage="star-off-middle.png",c.backgroundImage="star-off-middle.png",h.backgroundImage="star-off-middle.png",a>=1&&(l.backgroundImage="star-on-middle.png"),a>=2&&(c.backgroundImage="star-on-middle.png"),a>=3&&(h.backgroundImage="star-on-middle.png"),r.setText(e.toString()),u.setText(i.toString()),d.setText(DataPoints.getPlayedId().toString());for(let t in o.elements)o.elements[t].redraw();t.items=n,t.redraw(),m?(I.show(),I.redraw()):I.hide(),p.redraw(),E.redraw()};let _={};_[DataObjects.OBJECT_RED]=10,_[DataObjects.OBJECT_GREEN]=10,_[DataObjects.OBJECT_BLUE]=10,_[DataObjects.OBJECT_YELLOW]=10,_[DataObjects.OBJECT_PURPLE]=10,_[DataObjects.OBJECT_SAND]=30,_[DataObjects.OBJECT_ALPHA]=100,_[DataObjects.OBJECT_BETA]=100,_[DataObjects.OBJECT_GAMMA]=100,_[DataObjects.OBJECT_POLY_COLOR]=300,_[DataObjects.OBJECT_GOLD]=300,_[DataObjects.OBJECT_TILE]=300,_[DataObjects.OBJECT_BOX]=5,_[DataObjects.OBJECT_BARREL]=100,_[DataObjects.OBJECT_BOX]=100,this.onDestroyThing=function(t,i){D(t,1),_[t]&&(e+=_[t]),o.redraw(),LogicWizard.onDestroyThing(i)},this.onDestroyLine=function(t){LogicWizard.onDestroyLine(t)};let D=function(t,e){L=!0,n.forEach(function(i){i.id===t&&(i.count-=e),i.count>0&&(L=!1),i.count<0&&(i.count=0)}),o.redraw()};this.onFieldSilent=function(){LogicWizard.onFieldSilent(),L?(a.lock(),L=!1,setTimeout(o.finishLevel,15*Config.OnIdle.animateInterval)):0===i&&PBZDialogs.dialogTurnsLoose.showDialog()},this.finishLevel=function(){let t,i,n,o;m=null,Logs.log("finishLevel()",Logs.LEVEL_DETAIL),i=LogicUser.getCurrent(),t=DataPoints.getPlayedId(),n=DataPoints.getScore(t),console.log(t,n,i,e),i.nextPointId<t+1&&(i.nextPointId=t+1,LogicUser.updateUserInfo(i)),e>n&&(o=LogicChests.onFinish(t,n,e),SAPIMap.onFinish(t,e,o),DataPoints.setPointUserScore(i.id,t,e)),SAPIUser.onFinish(),PBZDialogs.dialogGoalsReached.showDialog(t,e),PageController.redraw()},this.beforeTurnUse=function(){0!==--i||L||a.lock(),5===i&&b("Осталось 5 ходов!"),o.redraw()},this.beforeStuffUse=function(){switch(m){case LogicStuff.STUFF_HUMMER:SAPIStuff.usedHummer(),LogicStuff.usedHummer();break;case LogicStuff.STUFF_LIGHTNING:SAPIStuff.usedLightning(),LogicStuff.usedLightning();break;case LogicStuff.STUFF_SHUFFLE:SAPIStuff.usedShuffle(),LogicStuff.usedShuffle()}m=null,a.setStuffMode(m),o.redraw()},this.setStuffMode=function(t){switch(t){case LogicStuff.STUFF_HUMMER:if(LogicStuff.getStuff("hummerQty")<1)return void PBZDialogs.dialogStuffShop.showDialog(t);I.backgroundImage="button-hummer-rest.png";break;case LogicStuff.STUFF_LIGHTNING:if(LogicStuff.getStuff("lightningQty")<1)return void PBZDialogs.dialogStuffShop.showDialog(t);I.backgroundImage="button-lightning-rest.png";break;case LogicStuff.STUFF_SHUFFLE:if(LogicStuff.getStuff("shuffleQty")<1)return void PBZDialogs.dialogStuffShop.showDialog(t);I.backgroundImage="button-shuffle-rest.png"}m=t,a.setStuffMode(t),o.redraw()},this.getElementField=function(){return a},this.onWizardFinish=function(){b("Теперь сами!")};let b=function(t){f.show(),g.setText(t),g.show(),g.redraw(),setTimeout(function(){f.hide(),g.hide()},1.1*Config.OnIdle.second)}};PageBlockField=new PageBlockField;let PageBlockMaps=function(){let t,e=this,i=!1,n=!1,o={x:714,y:225},s=!1,a=!1,r=!1,l=!1,c=!1,h={},u=1,d=null,g=[],f=null;this.elements=[],this.init=function(){let i;n=GUI.createElement(ElementImage,{x:0,y:0,width:777,height:500,src:"not-found.png"}),c=GUI.createElement(ElementImage,{x:0,y:0,width:777,height:500,src:"old-paper.png"}),e.elements.push(c),l=GUI.createElement(ElementImage,{x:0,y:0,width:777,height:500,src:"way-line.png"}),e.elements.push(l),r=GUI.createElement(ElementImage,{x:0,y:0,width:777,height:500,src:"map-001.png"}),e.elements.push(r),f=GUI.createElement(ElementImage,{x:0,y:0,width:50,height:50,p:{},src:"hint-arrow.png"}),e.elements.push(f),Animate.anim(animHintArrow,{},f),s=GUI.createElement(ElementButton,{x:0,y:o.y,srcRest:"map-arrow-left-rest.png",onClick:LogicMap.onArrowPrevClick}),e.elements.push(s),a=GUI.createElement(ElementButton,{x:o.x,y:o.y,srcRest:"map-arrow-right-rest.png",onClick:LogicMap.onArrowNextClick}),e.elements.push(a),DataPoints.getPointsCoords().forEach(function(t){1===t.number&&GUI.setTagId(LogicWizard.TAG_FIRST_NUMBER_POINT),i=GUI.createElement(ElementPoint,{x:t.x,y:t.y,friends:[],stateId:ElementPoint.STATE_CLOSE,number:null,pointId:null,onClick:function(t,e,i){PBZDialogs.dialogPointInfo.showDialog(i.pointId)}}),e.elements.push(i),g[t.number]=i,1===t.number&&GUI.setTagId(null)}),i=GUI.createElement(ElementChest,{x:162,y:304,number:1}),e.elements.push(i),i=GUI.createElement(ElementChest,{x:309,y:78,number:2}),e.elements.push(i),i=GUI.createElement(ElementChest,{x:495,y:304,number:3}),e.elements.push(i),t=GUI.createElement(ElementFriendsPanel,{x:213,y:435}),e.elements.push(t),i=GUI.createElement(ElementButton,{x:165,y:438,srcRest:"button-add-rest.png",onClick:function(){SocNet.openInviteFriendDialog()}}),e.elements.push(i),i=GUI.createElement(ElementImage,{x:650,y:370,opacity:.7,src:"wind-rose.png"}),e.elements.push(i),d=GUI.createDom(void 0,{x:0,y:0,backgroundImage:"not-found.png"})},this.show=function(){!0!==i&&(i=!0,e.elements.forEach(function(t){t.show()}),this.mapElsCreateIfNotExits(),this.mapElsShow(),e.preset(),e.redraw())},this.hide=function(){if(!1!==i){i=!1;for(let t in e.elements)e.elements[t].hide();this.mapElsHide(),s.hide()}},this.preset=function(){let t,e,i;if(this.presetPoints(),t=LogicUser.getCurrent().nextPointId,e=DataMap.getFirstPointId(),i=DataMap.getLastPointId(),t>=e&&t<=i){let e=DataPoints.getPointsCoords()[DataMap.getNumberFromPointId(t)-1];f.src="hint-arrow.png",f.p=e,f.show()}else t>i?(f.show(),f.p=o,f.src="map-arrow-right-rest.png"):f.hide()},this.redraw=function(){i&&(m()||(e.preset(),t.setFriends(LogicUser.getList(LogicUser.getFriendIds(6))),t.redraw(),this.mapElsRedraw(),e.elements.forEach(function(t){t.redraw()}),s.redraw()))},this.mapElsCreateIfNotExits=function(){let t,e;if((t=DataMap.getCurrent())&&!h[t.id]){h[t.id]=[];for(let i in t.elements)e=GUI.createElement(window[t.elements[i].name],t.elements[i].params),h[t.id].push(e)}},this.mapElsShow=function(){let t;if(t=DataMap.getCurrent()){for(let e in h[t.id])h[t.id][e].show();if(u!==t.id){for(let t in h[u])h[u][t].hide();u=t.id}}},this.mapElsHide=function(){for(let t in h)for(let e in h[t])h[t][e].hide();d.hide()},this.mapElsRedraw=function(){let t;(t=DataMap.getCurrent())&&(r.src=t.src,u!==t.id&&this.mapElsShow())},this.presetPoints=function(){let t,e,i,n,o,s;if(t=LogicUser.getCurrent(),s=DataMap.getCurrent()){o=DataPoints.getPointUserScore(s.id,[t.id]);for(let s=1;s<=DataMap.POINTS_PER_MAP;s++)e=DataMap.getPointIdFromPointNumber(s),(n=g[s]).pointId=e,(i=DataPoints.getById(e))&&(n=g[s],i.id===t.nextPointId&&(n.stateId=ElementPoint.STATE_CURRENT),i.id<t.nextPointId&&(n.stateId=ElementPoint.STATE_FINISHED),i.id>t.nextPointId&&(n.stateId=ElementPoint.STATE_CLOSE),o[e]?n.userScore=o[e][t.id]?o[e][t.id].score:0:n.userScore=0,n.setGamers(LogicUser.getFriendIdsByMapIdAndPointIdWithScore(DataMap.getCurrent().id,e,!0)))}};let m=function(){let t,e,i,n,o,s;return t=!1,e=DataMap.getCurrent(),i=LogicUser.getFriendIds(6),e&&(n=LogicUser.getFriendIdsByMapId(e.id)),i&&(o=LogicUser.getList(i)),n&&(s=LogicUser.getList(n)),e||(t=!0),i&&i.length!==o.length&&(t=!0),n&&n.length!==s.length&&(t=!0),t?d.show():d.hide(),t}};PageBlockMaps=new PageBlockMaps;let PageBlockPanel=function(){let t=this,e=!1;this.elements=[];let i,n=null,o=null;this.init=function(){let e,a,r;a=110,e=GUI.createElement(ElementImage,{x:110,y:0,src:"panel-money.png"}),t.elements.push(e),e=GUI.createElement(ElementButton,{x:115,y:-3,srcRest:"button-money-rest.png",onClick:function(){PBZDialogs.dialogMoneyShop.showDialog()}}),t.elements.push(e),i=GUI.createElement(ElementText,{x:168,y:11,width:70,alignCenter:!0}),t.elements.push(i),e=GUI.createElement(ElementButton,{x:232,y:-3,srcRest:"button-add-rest.png",onClick:function(){PBZDialogs.dialogMoneyShop.showDialog()}}),t.elements.push(e),r=398,e=GUI.createElement(ElementImage,{x:398,y:0,src:"panel-hearth.png"}),t.elements.push(e),e=GUI.createElement(ElementHealthIndicator,{x:407,y:-1}),t.elements.push(e),e=GUI.createElement(ElementHealthTimer,{x:509,y:10,healthIndicator:e}),t.elements.push(e),e=GUI.createElement(ElementButton,{x:588,y:-4,srcRest:"button-add-rest.png",onClick:function(){PBZDialogs.dialogHealthShop.showDialog()}}),t.elements.push(e),n=GUI.createElement(ElementButton,{x:650,y:10,srcRest:"button-sound-off.png",srcHover:"button-sound-active.png",srcActive:"button-sound-active.png",onClick:function(){Sounds.toggle(),Sounds.play(Sounds.PATH_CHALK),PageController.redraw()}}),t.elements.push(n),o=GUI.createElement(ElementButton,{x:690,y:10,srcRest:"button-fs-on-rest.png",onClick:s}),t.elements.push(o)},this.show=function(){if(!e){e=!0,t.preset();for(let e in t.elements)t.elements[e].show();t.redraw()}},this.hide=function(){if(e){e=!1;for(let e in t.elements)t.elements[e].hide()}},this.preset=function(){Sounds.isEnabled()?n.srcRest="button-sound-on.png":n.srcRest="button-sound-off.png",void 0!==LogicStuff.getStuff().goldQty&&i.setText(LogicStuff.getStuff("goldQty"))},this.redraw=function(){e&&(t.preset(),t.elements.forEach(function(t){t.redraw()}))};let s=function(){GUI.fsSwitch(),GUI.isFullScreen()?(o.srcRest="button-fs-on-rest.png",o.srcHover="button-fs-on-rest.png",o.srcActive="button-fs-on-rest.png"):(o.srcRest="button-fs-off-rest.png",o.srcHover="button-fs-off-rest.png",o.srcActive="button-fs-off-rest.png")};this.oneHealthHide=!1};PageBlockPanel=new PageBlockPanel;let PageBlockWizard=function(){let t=this,e=!1,i={};this.elements=[];let n=null,o=null,s=null,a=null;this.init=function(){(n=document.getElementById("wizardArea")).width=DataCross.app.width,n.height=DataCross.app.height,n.style.display="none",(o=n.getContext("2d")).showByImg=h,o.unlockByImg=c,o.highlightCells=u;let t=function(t,e){let i,s,a,r;a=t.offsetX,r=t.offsetY,0===(i=o.getImageData(a,r,1,1).data)[3]?(n.style.display="none",(s=document.elementFromPoint(t.offsetX,t.offsetY))&&s.dispatchEvent(new MouseEvent(t.type,t)),n.isActive&&(n.style.display=""),e&&e(s)):e&&e(!1)};n.onclick=function(e){t(e,LogicWizard.onClick)},n.onmousemove=function(e){t(e,function(t){n.style.cursor=t?t.style.cursor:""})},(s=GUI.createElement(ElementImage,{x:400,y:360,src:"w-dialog.png"})).dom.__dom.style.zIndex=2e4,s.hide(),(a=GUI.createElement(ElementText,{x:416,y:376,width:Images.getWidth("w-dialog.png")-32,height:Images.getHeight("w-dialog.png"),alignCenter:!0,zIndex:20001,text:"text"})).hide()};this.show=function(){if(!e){e=!0,t.preset();for(let e in t.elements)t.elements[e].show();t.redraw()}},this.hide=function(){if(e){e=!1;for(let e in t.elements)t.elements[e].hide()}},this.preset=function(){},this.redraw=function(){e&&(t.preset(),t.elements.forEach(function(t){t.redraw()}),s.redraw(),a.redraw())},this.begin=function(){PageBlockField.getElementField().lockHint(),n.style.display="",n.isActive=!0,o.clearRect(0,0,DataCross.app.width*window.devicePixelRatio,DataCross.app.height*window.devicePixelRatio),o.globalCompositeOperation="source-out",o.globalAlpha=.55,o.fillStyle="black",o.fillRect(0,0,DataCross.app.width*window.devicePixelRatio,DataCross.app.height*window.devicePixelRatio)},this.finish=function(){t.reset(),PageBlockField.onWizardFinish()},this.reset=function(){n.isActive=!1,n.style.display="none",s.hide(),a.hide(),PageBlockField.getElementField().unlockHint(),clearInterval(r)};let r=null;this.showHint=function(t){let e=PageBlockField.getElementField().getCoords();t.forEach(function(t){t.x+=e.cellX,t.y+=e.cellY}),r&&clearInterval(r),r=setInterval(function(){Animate.hintActive||PageBlockField.getElementField().showHint(t)},1.5*Config.OnIdle.second)},this.updateText=function(e){a.text=e,t.redraw()},this.showDialog=function(e,i,n,o){let r;switch(e||(e=400),i||(i=360),n){default:case 1:r=30;break;case 2:r=15;break;case 3:r=2}n||(r=15*n),o||(o=""),s.x=e,s.y=i,a.x=e+16,a.y=i+16+r,s.show(),a.show(),t.redraw()},this.hideDialog=function(){s.hide(),a.hide()},this.draw=function(t){t(o)};let l=function(t,e,n,s,a){if(!a||!i[t])return i[t]=new Image,i[t].onload=function(){l(t,e,n,s,!0)},void(i[t].src=Images.getPath(t));o.globalAlpha=s?1:.99,o.globalCompositeOperation="destination-out",o.drawImage(i[t],e,n,Images.getWidth(t),Images.getHeight(t))},c=function(t,e,i){l(t,e,i,!0)},h=function(t,e,i){l(t,e,i,!1)},u=function(t){let e=PageBlockField.getElementField().getCoords();t.forEach(function(t){t.unlock?c("w-cell.png",e.x+DataPoints.BLOCK_WIDTH*t.x,e.y+DataPoints.BLOCK_HEIGHT*(t.y+1)):h("w-cell.png",e.x+DataPoints.BLOCK_WIDTH*t.x,e.y+DataPoints.BLOCK_HEIGHT*(t.y+1))})};this.showByImg=h,this.unlockByImg=c,this.highlightCells=u};PageBlockWizard=new PageBlockWizard;let PBWizard=PageBlockWizard,PageBlockZClouds=function(){let t=this,e=!1;this.elements=[],this.init=function(){let e,i;(i=[{x:30,y:50},{x:30,y:150},{x:30,y:300},{x:30,y:350},{x:100,y:50},{x:110,y:100},{x:100,y:200},{x:100,y:350},{x:250,y:20},{x:250,y:100},{x:250,y:200},{x:250,y:300},{x:250,y:400},{x:400,y:80},{x:400,y:110},{x:400,y:200},{x:400,y:250},{x:400,y:350},{x:510,y:50},{x:510,y:300},{x:510,y:200},{x:510,y:400}]).forEach(function(i){e=GUI.createElement(ElementImage,{x:i.x,y:i.y,src:"clouds-1.png",opacity:.9}),t.elements.push(e)}),Animate.anim(animClouds,{},t.elements)},this.show=function(){if(!e){e=!0;for(let e in t.elements)t.elements[e].show();t.redraw()}},this.hide=function(){if(e){e=!1;for(let e in t.elements)t.elements[e].hide()}},this.redraw=function(){e&&(DataMap.getCurrent()&&DataMap.getCurrent().id>LogicUser.getUserLastMapId()?t.elements.forEach(function(t){t.show()}):t.elements.forEach(function(t){t.hide()}),t.elements.forEach(function(t){t.redraw()}))}};PageBlockZClouds=new PageBlockZClouds;let PageBlockZDialogs=function(){let t=this,e=!1;this.elements=[],this.dialogMoneyShop=null,this.dialogHealthShop=null,this.dialogGoals=null,this.dialogStuffShop=null,this.dialogGoalsReached=null,this.dialogTurnsLoose=null,this.dialogJustQuit=null,this.dialogPointInfo=null,this.dialogChestYouWin=null,this.dialogMessage=null,this.init=function(){this.dialogMoneyShop=GUI.createElement(DialogMoneyShop,{}),t.elements.push(this.dialogMoneyShop),this.dialogHealthShop=GUI.createElement(DialogHealthShop,{}),t.elements.push(this.dialogHealthShop),this.dialogGoals=GUI.createElement(DialogGoals),t.elements.push(this.dialogGoals),this.dialogGoalsReached=GUI.createElement(DialogGoalsReached),t.elements.push(this.dialogGoalsReached),this.dialogTurnsLoose=GUI.createElement(DialogTurnLoose),t.elements.push(this.dialogTurnsLoose),this.dialogJustQuit=GUI.createElement(DialogJustQuit),t.elements.push(this.dialogJustQuit),this.dialogStuffShop=GUI.createElement(DialogStuffShop),t.elements.push(this.dialogStuffShop),this.dialogPointInfo=GUI.createElement(DialogPointInfo),t.elements.push(this.dialogPointInfo),this.dialogChestYouWin=GUI.createElement(DialogChestYouWin),t.elements.push(this.dialogChestYouWin),this.dialogMessage=GUI.createElement(DialogMessage),t.elements.push(this.dialogMessage)},this.show=function(){if(!e){e=!0;for(let e in t.elements)t.elements[e].show();t.redraw()}},this.hide=function(){if(e){e=!1;for(let e in t.elements)t.elements[e].hide()}},this.redraw=function(){e&&t.elements.forEach(function(t){t.redraw()})}};PageBlockZDialogs=new PageBlockZDialogs;let PBZDialogs=PageBlockZDialogs,PageField=function(){let t=this;this.blocks=[],this.init=function(){t.blocks.push(PageBlockBackground),t.blocks.push(PageBlockField),t.blocks.push(PageBlockPanel),t.blocks.push(PBZDialogs),t.blocks.push(PageBlockWizard)}};PageField=new PageField;let PageMain=function(){let t=this;this.blocks=[],this.init=function(){t.blocks.push(PageBlockBackground),t.blocks.push(PageBlockPanel),t.blocks.push(PageBlockMaps),t.blocks.push(PBZDialogs),t.blocks.push(PageBlockWizard),t.blocks.push(PageBlockZClouds)}};PageMain=new PageMain;let WizardFirstStart_1={init:function(){PBWizard.begin(),PBWizard.updateText("Нажми на красный кружок, что бы начать играть."),PBWizard.showDialog(400,360,2);let t=DataPoints.getPointsCoords()[0];PBWizard.unlockByImg("w-circle.png",t.x-Images.getWidth("w-circle.png")/2+Images.getWidth("map-way-point-red.png")/2,t.y-Images.getHeight("w-circle.png")/2+Images.getHeight("map-way-point-red.png")/2)},onClick:function(t){t.tagId===LogicWizard.TAG_FIRST_NUMBER_POINT&&"1"===t.innerText&&LogicWizard.start(WizardFirstStart_2)}},WizardFirstStart_2={init:function(){PBWizard.begin()},onShowDialog:function(){WizardFirstStart_2.dialogCounter++,WizardFirstStart_2.dialogCounter>1||(PBWizard.updateText("Нажми кнопку играть."),PBWizard.showDialog(400,380,1),PBWizard.unlockByImg("w-button.png",390-Images.getWidth("w-button.png")/2,328))},onHideDialog:function(){WizardFirstStart_2.dialogCounter++,2===WizardFirstStart_2.dialogCounter&&PBWizard.hideDialog(),2===WizardFirstStart_2.dialogCounter&&PBWizard.begin(),5===WizardFirstStart_2.dialogCounter&&LogicWizard.start(WizardFirstStart_3)}},WizardFirstStart_3={init:function(){PBWizard.begin()},onHideDialog:function(t){this.dialogCounter++<3||(PBWizard.updateText("Поменяй соседние камни местами, чтобы собрать камни красного цвета."),PBWizard.showDialog(210,380,3),PBWizard.showHint([{x:1,y:0},{x:2,y:0}]),PBWizard.highlightCells([{x:1,y:0,unlock:!0},{x:2,y:0,unlock:!0},{x:3,y:0,unlock:!1},{x:4,y:0,unlock:!1}]))},onDestroyLine:function(t){LogicWizard.start(WizardFirstStart_4)}},WizardFirstStart_4={init:function(){PBWizard.begin(),setTimeout(function(){PBWizard.updateText("У тебя получилось. Давай ещё!"),PBWizard.showDialog(210,380,2,21),PBWizard.showHint([{x:3,y:2},{x:3,y:3}]),PBWizard.highlightCells([{x:2,y:2,unlock:!1},{x:3,y:2,unlock:!0},{x:3,y:3,unlock:!0},{x:4,y:2,unlock:!1}])},1.5*Config.OnIdle.second)},onDestroyLine:function(t){console.log(t),LogicWizard.finish()}},WizardLevel12_1={init:function(){PBWizard.begin(),PBWizard.updateText("Собирай пауков, взрывая камни на которых они сидят")},onHideDialog:function(){WizardLevel12_1.dialogCounter++<2||(PBWizard.showHint([{x:2,y:1},{x:3,y:1}]),PBWizard.showDialog(210,400,2,20),PBWizard.highlightCells([{x:0,y:1,unlock:!1},{x:1,y:1,unlock:!1},{x:2,y:1,unlock:!0},{x:3,y:1,unlock:!0}]))},onDestroyLine:function(){LogicWizard.finish()}},WizardLevel14_1={init:function(){PBWizard.begin(),PBWizard.updateText("Взорви камни, что бы снять цепь.")},onHideDialog:function(){WizardLevel14_1.dialogCounter++<2||(PBWizard.showHint([{x:2,y:1},{x:2,y:0}]),PBWizard.showDialog(210,400,2,20),PBWizard.highlightCells([{x:2,y:0,unlock:!0},{x:1,y:1,unlock:!1},{x:2,y:1,unlock:!0},{x:3,y:1,unlock:!1}]))},onDestroyLine:function(){LogicWizard.finish()}},WizardLevel2_1={init:function(){PBWizard.begin(),PBWizard.updateText("Собрав ряд из 4-ех камней, получишь камень с молнией.")},onHideDialog:function(t){WizardLevel2_1.dialogCounter++<2||(PBWizard.showDialog(210,400,3,20),PBWizard.showHint([{x:1,y:3},{x:2,y:3}]),PBWizard.draw(function(t){t.highlightCells([{x:2,y:1,unlock:!1},{x:2,y:2,unlock:!1},{x:1,y:3,unlock:!0},{x:2,y:3,unlock:!0},{x:2,y:4,unlock:!1}])}))},onDestroyLine:function(){LogicWizard.start(WizardLevel2_2)}},WizardLevel2_2={init:function(){PBWizard.begin(),PBWizard.updateText("Взорви камень с молнией, что бы использовать её."),setTimeout(function(){PBWizard.showHint([{x:2,y:4},{x:3,y:4}]),PBWizard.showDialog(230,150,2,20),PBWizard.draw(function(t){t.highlightCells([{x:2,y:4,unlock:!0},{x:3,y:4,unlock:!0},{x:4,y:4,unlock:!1},{x:5,y:4,unlock:!1}])})},1.1*Config.OnIdle.second)},onDestroyLine:function(){LogicWizard.finish()}},WizardLevel23_1={init:function(){PBWizard.begin(),PBWizard.updateText("Взрывай камни рядом с красным пауком, что бы он убежал с поля.")},onHideDialog:function(){WizardLevel23_1.dialogCounter++<2||(PBWizard.showHint([{x:2,y:1},{x:2,y:0}]),PBWizard.showDialog(210,400,3,20),PBWizard.highlightCells([{x:2,y:2,unlock:!1},{x:1,y:1,unlock:!1},{x:2,y:1,unlock:!1},{x:3,y:1,unlock:!0},{x:4,y:1,unlock:!0}]))},onDestroyLine:function(){LogicWizard.finish()}},WizardLevel3_1={init:function(){PBWizard.begin(),PBWizard.updateText("Собрав ряд из 5-ти камней, получаешь звезду.")},onHideDialog:function(){WizardLevel3_1.dialogCounter++<2||(PBWizard.showHint([{x:4,y:2},{x:4,y:3}]),PBWizard.showDialog(210,380,2,20),PBWizard.highlightCells([{x:2,y:2,unlock:!1},{x:3,y:2,unlock:!1},{x:4,y:2,unlock:!0},{x:5,y:2,unlock:!1},{x:6,y:2,unlock:!1},{x:4,y:3,unlock:!0}]))},onDestroyLine:function(){LogicWizard.start(WizardLevel3_2)}},WizardLevel3_2={init:function(){PBWizard.begin()},onFieldSilent:function(){PBWizard.updateText("Выбери цвет, что бы убрать все камни этого цвета."),PBWizard.showDialog(230,50,2,20),PBWizard.showHint([{x:4,y:2},{x:5,y:2}]),PBWizard.highlightCells([{x:4,y:2,unlock:!0},{x:5,y:2,unlock:!0}])},onDestroyThing:function(t){t.object.objectId===DataObjects.OBJECT_POLY_COLOR&&LogicWizard.finish()}},WizardLevel_4_1={init:function(){PBWizard.begin(),PBWizard.updateText("Взорви камень, под которым есть золото.")},onHideDialog:function(){WizardLevel_4_1.dialogCounter++<2||(PBWizard.showHint([{x:2,y:1},{x:3,y:1}]),PBWizard.showDialog(210,400,2,20),PBWizard.highlightCells([{x:0,y:1,unlock:!1},{x:1,y:1,unlock:!1},{x:2,y:1,unlock:!0},{x:3,y:1,unlock:!0}]))},onDestroyLine:function(){LogicWizard.start(WizardLevel4_2)}},WizardLevel4_2={init:function(){PBWizard.begin()},onFieldSilent:function(){PBWizard.updateText("Собери еще золота!"),PBWizard.showDialog(450,250,1,20),PBWizard.showHint([{x:0,y:2},{x:1,y:2}]),PBWizard.highlightCells([{x:1,y:0,unlock:!1},{x:1,y:1,unlock:!1},{x:1,y:2,unlock:!0},{x:1,y:3,unlock:!1},{x:0,y:2,unlock:!0}])},onDestroyLine:function(t){LogicWizard.finish()}},WizardLevel_41_1={init:function(){PBWizard.begin(),PBWizard.updateText("Взорви камни и бочка упадет на блок.")},onHideDialog:function(){WizardLevel_41_1.dialogCounter++<2||(PBWizard.showHint([{x:1,y:4},{x:2,y:4}]),PBWizard.showDialog(340,390,2),PBWizard.highlightCells([{x:2,y:2,unlock:!1},{x:2,y:3,unlock:!1},{x:2,y:4,unlock:!0},{x:2,y:5,unlock:!1},{x:2,y:6,unlock:!1},{x:1,y:4,unlock:!0}]))},onDestroyLine:function(){LogicWizard.start(WizardLevel41_2)}},WizardLevel41_2={init:function(){PBWizard.begin(),PBWizard.updateText("Бочка ещё не улетела, взорви ряд камней что бы переместить бочку."),PBWizard.showDialog(360,390,3),PBWizard.showHint([{x:2,y:5},{x:3,y:5}]),PBWizard.highlightCells([{x:3,y:3,unlock:!1},{x:3,y:4,unlock:!1},{x:3,y:5,unlock:!0},{x:3,y:6,unlock:!1},{x:2,y:5,unlock:!0}])},onDestroyLine:function(){LogicWizard.finish()}},WizardLevel46_1={init:function(){PBWizard.begin(),PBWizard.updateText("Соедини песочные камни в ряд.")},onHideDialog:function(){WizardLevel46_1.dialogCounter++<2||(PBWizard.showHint([{x:2,y:1},{x:3,y:1}]),PBWizard.showDialog(340,390,2),PBWizard.highlightCells([{x:3,y:0,unlock:!1},{x:3,y:1,unlock:!0},{x:3,y:2,unlock:!1},{x:2,y:1,unlock:!0}]))},onDestroyLine:function(){LogicWizard.finish()}},WizardLevel51_1={init:function(){PBWizard.begin(),PBWizard.updateText("Соедини ряд чтобы взорвать желтого паука.")},onHideDialog:function(){WizardLevel51_1.dialogCounter++<2||(PBWizard.showHint([{x:5,y:2},{x:5,y:2}]),PBWizard.showDialog(340,390,2),PBWizard.highlightCells([{x:2,y:2,unlock:!1},{x:3,y:2,unlock:!1},{x:4,y:2,unlock:!0},{x:5,y:2,unlock:!0}]))},onDestroyLine:function(){LogicWizard.finish()}},WizardLevel9_1={init:function(){PBWizard.begin(),PBWizard.updateText("Взорви камни рядом с ящиком.")},onHideDialog:function(){WizardLevel9_1.dialogCounter++<2||(PBWizard.showHint([{x:2,y:1},{x:3,y:1}]),PBWizard.showDialog(210,400,2,20),PBWizard.highlightCells([{x:0,y:1,unlock:!1},{x:1,y:1,unlock:!1},{x:2,y:1,unlock:!0},{x:3,y:1,unlock:!0}]))},onDestroyLine:function(){LogicWizard.finish()}};var FS,PATH;CONST_IS_SERVER_SIDE&&(FS=require("fs"),PATH=require("path"));let ApiRouter=new function ApiRouter(){let self=this,map,connections={},onDisconnectCallbacks=[],onFailedSendCallbacks=[];this.setMap=function(t){map=t},this.onData=function(t,e){let i,n,o;try{t=JSON.parse(t)}catch(e){return void log("Wrong data:parse error",Logs.LEVEL_WARNING,t)}"object"==typeof t?void 0!==t.group?"string"==typeof t.group?void 0!==t.method?"string"==typeof t.method?void 0!==t.args?"object"==typeof t.args?(i=t.group,n=t.method,o=t.args,void 0!==map[i]?void 0!==map[i][n]?(CONST_IS_SERVER_SIDE?Logs.log(e+" >> "+i+"."+n,Logs.LEVEL_DETAIL,o):Logs.log(i+"."+n,Logs.LEVEL_DETAIL,o),o.unshift(connections[e]),map[i][n].apply(self,o)):Logs.log("Wrong data: method not found "+n,Logs.LEVEL_WARNING,t):Logs.log("Wrong data: group not found "+i,Logs.LEVEL_WARNING,t)):Logs.log("Wrong data: packet.args must have type 'object'",Logs.LEVEL_WARNING,t):Logs.log("Wrong data: packet must have .args",Logs.LEVEL_WARNING,t):Logs.log("Wrong data: packet.method must have type 'string'",Logs.LEVEL_WARNING,t):Logs.log("Wrong data: packet must have .method",Logs.LEVEL_WARNING,t):Logs.log("Wrong data: packet.group must have type 'string'",Logs.LEVEL_WARNING,t):Logs.log("Wrong data: packet must have .group",Logs.LEVEL_WARNING,t):Logs.log("Wrong data: packet must be 'object'",Logs.LEVEL_WARNING,t)},this.onConnect=function(t){Logs.log("ApiRouter.onConnect: id="+t,Logs.LEVEL_DETAIL),connections[t]={connectionId:t}},this.onDisconnect=function(t){Logs.log("connection close: id="+t,Logs.LEVEL_WARNING);for(let e in onDisconnectCallbacks)onDisconnectCallbacks[e].call(self,connections[t]);delete connections[t]},this.executeRequest=function(t,e,i,n){let o,s;for(s in i=Array.prototype.slice.call(i),n||(n=[{connectionId:null}]),o="",n)o+=n[s].connectionId;CONST_IS_SERVER_SIDE?Logs.log(o+" << "+t+"."+e+":"+i.join(","),Logs.LEVEL_DETAIL):Logs.log(t+"."+e,Logs.LEVEL_DETAIL,i);let a={group:t,method:e,args:i};a=JSON.stringify(a);let r=0;for(s in n){if(!this.sendData(a,n[s].connectionId)){Logs.log("ApiRouter.failedToSend",Logs.LEVEL_WARNING,{packet:a,cntx:n[s]});for(let t in onFailedSendCallbacks)onFailedSendCallbacks[t].call(self,n[t])}r++}0===r&&Logs.log("ApiRouter. Try send to empty contextlist.",Logs.LEVEL_WARNING,{packet:a,cntxList:n})},this.addOnDisconnectCallback=function(t){onDisconnectCallbacks.push(t)},this.addOnFailedSendCallback=function(t){onFailedSendCallbacks.push(t)},this.getSAPIJSCode=function(){let t,e,i,n;for(e in t="",n={},map||(map=getSAPIMap()),map)for(i in global[e])"function"==typeof global[e][i]&&(n[e]||(n[e]={}),n[e][i]=!0);for(e in n){for(i in t+="let "+e+" = function(){\r\n",n[e])t+="\tthis."+i+" = function(){\r\n",t+="\t\tApiRouter.executeRequest('"+e+"' ,'"+i+"', arguments);\r\n",t+="\t};\r\n";t+="};\r\n",t+=e+" = new "+e+"();\r\n"}for(e in t+="ApiRouter.map2 = {\r\n",n)t+="\t"+e+" : "+e+",\r\n";return t=t.substr(0,t.length-1),t+="};\r\n"},this.generate=function(){return generateCAPIComponents(getCAPIMap()),generateSAPIMapCode(getSAPIMap())};let getCAPIMap=function(){let path,list,capiName,methodName,map,capiObject,file_content;return path=CONST_DIR_CLIENT+"components/application/capi/",list=FS.readdirSync(path),map={},list.forEach(function(fileName){if(".gitkeep"!==fileName&&".gitignore"!==fileName){capiName=getComponentNameFromPath(path+fileName),file_content=FS.readFileSync(path+fileName).toString(),capiObject=eval(file_content.toString()),map[capiName]=[];for(let t in capiObject){if(!capiObject.hasOwnProperty(t))return;"function"==typeof capiObject[t]&&(map[capiName][t]=!0)}}}),map},getSAPIMap=function(){let t,e,i,n,o;t=CONST_DIR_COMPONENTS+"/application/sapi/",e=FS.readdirSync(t),o={};for(let s in e)if(".gitkeep"!==e[s]&&".gitignore"!==e[s])for(n in i=getComponentNameFromPath(t+e[s]),require(t+e[s]),o[i]=[],global[i])"function"==typeof global[i][n]&&(o[i][n]=!0);return o},getComponentNameFromPath=function(t){return PATH.basename(t).replace(".js","")},generateSAPIMapCode=function(t){let e,i;for(e in i="",i+=" ApiRouter.setMap({\r\n",t)i+="\t"+e+":"+e+",\r\n";return i+="});\r\n"},generateCAPIComponents=function(t){let e,i,n="";for(e in t)if(".gitkeep"!==e&&".gitignore"!==e){for(i in n="",n+=e+" = function(){\r\n\r\n",t[e])n+="\tthis."+i+" = function(){\r\n\r\n",n+="\t\tlet args, toUserId;\r\n",n+="\t\targs = Array.prototype.slice.call(arguments);\r\n",n+="\t\ttoUserId = args.shift();\r\n",n+='\t\tLogicUser.sendToUser(toUserId, "'+e+'", "'+i+'", args);\r\n',n+="\t};\r\n\r\n";n+="};\r\n",n+=e+" = new "+e+"();\r\n",FS.writeFileSync(CONST_DIR_COMPONENTS+"generated/"+e+".js",n)}}};CONST_IS_SERVER_SIDE&&(global.ApiRouter=ApiRouter);let GUI=function(){let t=this,e=!1,i=!1;this.EVENT_MOUSE_MOUSE_DOWN=1,this.EVENT_MOUSE_MOUSE_TOUCH_START=100,this.EVENT_MOUSE_MOUSE_TOUCH_END=101,this.EVENT_MOUSE_MOUSE_UP=2,this.EVENT_MOUSE_CLICK=3,this.EVENT_MOUSE_MOVE=4,this.EVENT_MOUSE_OVER=5,this.EVENT_MOUSE_OUT=6,this.EVENT_KEY_DOWN=100,this.EVENT_KEY_UP=101,this.POINTER_HAND="pointer",this.POINTER_ARROW="default",this.eventNames=[],this.eventNames[this.EVENT_MOUSE_MOUSE_DOWN]="mousedown",this.eventNames[this.EVENT_MOUSE_MOUSE_UP]="mouseup",this.eventNames[this.EVENT_MOUSE_CLICK]="click",this.eventNames[this.EVENT_MOUSE_OVER]="mouseover",this.eventNames[this.EVENT_MOUSE_MOVE]="mousemove",this.eventNames[this.EVENT_MOUSE_OUT]="mouseout",this.eventNames[this.EVENT_KEY_DOWN]="keydown",this.eventNames[this.EVENT_KEY_UP]="keyup",this.eventNames[this.EVENT_MOUSE_MOUSE_TOUCH_START]="touchstart",this.eventNames[this.EVENT_MOUSE_MOUSE_TOUCH_END]="touchend";let n=[],o=[];this.lockEventsExcept=null;let s=null;this.init=function(){i=document.getElementById("appArea"),o.push(i);let t=document.createElement("style");t.type="text/css",t.innerHTML=".sepia { filter: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg'><filter id='old-timey'><feColorMatrix type='matrix' values='0.14 0.45 0.05 0 0 0.12 0.39 0.04 0 0 0.08 0.28 0.03 0 0 0 0 0 1 0'/></filter></svg>#old-timey\");-webkit-filter: sepia(0.5);-webkit-filter: sepia(85%) grayscale(50%);-moz-filter: sepia(70%);-ms-filter: sepia(70%);-o-filter: sepia(70%);filter: sepia(70%);}",t.innerHTML+=".gui-dom {  position: absolute; overflow: hidden}",t.innerHTML+="* {-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;}",document.getElementsByTagName("head")[0].appendChild(t),document.addEventListener("mousemove",function(t){n.forEach(function(e){e.call(null,t.clientX-i.offsetLeft,t.clientY-i.offsetTop)})}),a(function(){e=!e,s()}),this.fsSwitch=function(){s(!0),GUI.isFullScreen()?l():r()};let s=function(t){let e;e=document.getElementById("vk_comments"),t&&!GUI.isFullScreen()||!t&&GUI.isFullScreen()?(e&&(e.style.display="none"),i.style.left=screen.availWidth/2-parseInt(i.style.width)/2+"px",i.style.top=screen.availHeight/2-parseInt(i.style.height)/2+"px"):(e&&(e.style.display=""),i.style.left="",i.style.top="")},r=function(){let t=window.document.body;t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen&&t.webkitRequestFullScreen()},l=function(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen()}},this.createElement=function(t,e,i){let n;e||(e={}),t||Logs.log("GUI.createElement: не определен элемент:"+t,Logs.LEVEL_FATAL_ERROR),(n=new t).init&&"function"==typeof n.init||Logs.log("GUI.craeteElement: элемент должен иметь функцию init().",Logs.LEVEL_FATAL_ERROR,arguments),n.show&&"function"==typeof n.show||Logs.log("GUI.createElement: элемент должен иметь функцию show().",Logs.LEVEL_FATAL_ERROR,arguments),n.hide&&"function"==typeof n.hide||Logs.log("GUI.createElement: элемент должен иметь функцию hide().",Logs.LEVEL_FATAL_ERROR,arguments),n.redraw&&"function"==typeof n.redraw||Logs.log("GUI.createElement: элемент должен иметь функцию redraw().",Logs.LEVEL_FATAL_ERROR,arguments);for(let t in e)n[t]=e[t];return i?(GUI.pushParent(i),n.init(),GUI.popParent()):n.init(),n},this.pushParent=function(t){return o.push(t.__dom)},this.popParent=function(){return o.pop()},this.getCurrentParent=function(){return o[o.length-1]},this.createDom=function(t,e){let i;if((i=new GUIDom).init(void 0,t),s&&(i.__dom.tagId=s),e)for(let t in e)i[t]=e[t];return i},this.bind=function(t,e,i,n){t.bind(e,i,n)},this.lockEvents=function(e){t.lockEventsExcept=e},this.unlockEvents=function(){t.lockEventsExcept=null},this.onMouseMove=function(t){n.push(t)};let a=function(t){document.addEventListener("fullscreenchange",t),document.addEventListener("mozfullscreenchange",t),document.addEventListener("webkitfullscreenchange",t),document.addEventListener("msfullscreenchange",t)};this.isFullScreen=function(){return e},this.setTagId=function(t){s=t}};GUI=new GUI;let GUIDom=function(){let t=this;this.__id=++GUIDom.lastId;let e={},i=!1,n=null;this.init=function(t,i){for(let t in s)e[t]=void 0;t||(t="span"),(n=document.createElement(t)).className="gui-dom","input"===t&&(n.style.border="none"),n.ondragstart=function(){return!1},this.__dom=n,n.__dom=this,(i=i?i.__dom:GUI.getCurrentParent()).appendChild(n)},this.show=function(){i||(i=!0,n.style.display="",t.redraw())},this.hide=function(){i&&(i=!1,n.style.display="none")},this.redraw=function(){if(i)for(let i in s)e[i]!==t[i]&&(s[i].call(),e[i]=t[i])},this.bind=function(e,i,o){let s;(s=GUI.eventNames[e])||Logs.log("undefined gui eventId:"+e,Logs.LEVEL_FATAL_ERROR),n.addEventListener(s,function(e){if(GUI.lockEventsExcept){let e,i;for(e=t.__dom,i=!0;e;)GUI.lockEventsExcept.__dom===e&&(i=!1),e=e.parentElement;if(i)return}i.call(o,e,n)},!1)},this.setFocus=function(){n.focus()};let o=function(){let e;e=Images.getMeta(t.backgroundImage),!t.width&&!t.height&&e.path&&e.w&&e.h&&(t.width=e.w,t.height=e.h,s.height.call(),s.width.call()),n.style.backgroundImage="url("+e.path+")",t.backgroundPositionY=t.backgroundPositionY?t.backgroundPositionY:0,n.style.backgroundPositionX="-"+Images.getX(t.backgroundImage)+"px",n.style.backgroundPositionY="-"+(Images.getY(t.backgroundImage)+t.backgroundPositionY)+"px",n.style.backgroundRepeat="no-repeat",t.noScale?n.style.backgroundSize=e.w+"px "+e.h+"px":window.useSprite&&t.width&&t.height?(n.style.backgroundPositionX=parseInt(n.style.backgroundPositionX)*t.width/e.w+"px",n.style.backgroundPositionY=parseInt(n.style.backgroundPositionY)*t.height/e.h+"px",n.style.backgroundSize=window.spriteSize.width*t.width/e.w+"px "+window.spriteSize.height*t.height/e.h+"px "):n.style.backgroundSize=t.width+"px "+t.height+"px"},s={x:function(){n.style.left=t.x+"px"},y:function(){n.style.top=t.y+"px"},width:function(){n.style.width=t.width+"px",t.backgroundImage&&o()},height:function(){n.style.height=t.height+"px",t.backgroundImage&&o()},backgroundPositionY:o,backgroundImage:o,backgroundSize:function(){n.style.backgroundSize=t.backgroundSize+"px"},innerHTML:function(){n.innerHTML=t.innerHTML},pointer:function(){n.style.cursor=t.pointer},opacity:function(){n.style.opacity=t.opacity},fontWeight:function(){n.style.fontWeight=t.fontWeight},fontSize:function(){n.style.fontSize=t.fontSize+"px"},fontFamily:function(){n.style.fontFamily=t.fontFamily},color:function(){n.style.color=t.color},textShadow:function(){n.style.textShadow=t.textShadow},borderRadius:function(){n.style.borderRadius=t.borderRadius},border:function(){n.style.border=t.border},borderTop:function(){n.style.borderTop=t.borderTop},borderRight:function(){n.style.borderRight=t.borderRight},borderBottom:function(){n.style.borderBottom=t.borderBottom},borderLeft:function(){n.style.borderLeft=t.borderLeft},padding:function(){n.style.padding=t.padding},boxShadow:function(){n.style.boxShadow=t.boxShadow},lineHeight:function(){n.style.lineHeight=t.lineHeight},background:function(){n.style.background=t.background},transform:function(){n.style.transform=t.transform},title:function(){n.setAttribute("title",t.title)},isItsepia:function(){n.className+="sepia"},alignText:function(){n.style.textAlign=t.alignText},zIndex:function(){n.style.zIndex=t.zIndex},overflow:function(){n.style.overflow=t.overflow},textDecoration:function(){n.style.textDecoration=t.textDecoration},rotate:function(){n.style.transform="rotate("+t.rotate+"deg)"}}};GUIDom.lastId=0;let Images=function(){this.getPath=function(t){return this.getMeta(t).path},this.getHeight=function(t){return this.getMeta(t).h},this.getWidth=function(t){return this.getMeta(t).w},this.getX=function(t){return this.getMeta(t).x},this.getY=function(t){return this.getMeta(t).y};let t={path:"",w:void 0,h:void 0,x:0,y:0},e=[];this.getMeta=function(i){return i&&0===i.indexOf("https://")||0===i.indexOf("http://")?(t.path=i,t):i&&window.i_d[i]?window.i_d[i]:-1!==e.indexOf(i)?t:(e.push(i),Logs.log("Image url not found for: "+i,Logs.LEVEL_ERROR),t.path="",t)}};var FS;Images=new Images,CONST_IS_SERVER_SIDE&&(FS=require("fs"));let Logs=function(){let t=this,e=null,i=[];this.init=function(t){e=Config.Logs.triggerLevel;for(let t=0;t<100;t++)i.push("--dummy--");t()},this.showCache=function(){for(let t in i)i[t]},this.log=function(s,a,r,l){let c,h,u,d,g,f,m,I,p,E;if(a||(a=Logs.LEVEL_DETAIL),!(a<e)){switch(m=(c=new Date).getFullYear(),g=n(c.getDate()),f=n(c.getMonth()+1),I=n(c.getHours()),p=n(c.getMinutes()),E=n(c.getSeconds()),u=(h=CONST_IS_CLIENT_SIDE?p+":"+E:g+"-"+f+"-"+m+" "+I+":"+p+":"+E)+" ["+(d=o[a])+"] "+s,r||(r=""),CONST_IS_SERVER_SIDE&&r&&(r=JSON.stringify(r)),i.push(u),i.shift(),l){default:switch(a){case Logs.LEVEL_ERROR:console.error(" > "+u,r);break;case Logs.LEVEL_WARNING:console.warn(" > "+u,r);break;default:console.log(" > "+u,r)}break;case Logs.CHANNEL_VK_PAYMENTS:FS.writeFile(CONST_DIR_SERVER+"/logs/vk_payments.log",u+r+"\r\n",{flag:"a"},function(){});break;case Logs.CHANNEL_VK_STUFF:FS.writeFile(CONST_DIR_SERVER+"/logs/vk_stuff.log",u+r+"\r\n",{flag:"a"},function(){});break;case Logs.CHANNEL_VK_HEALTH:FS.writeFile(CONST_DIR_SERVER+"/logs/vk_health.log",u+r+"\r\n",{flag:"a"},function(){})}if(a!==Logs.LEVEL_ERROR&&Logs.LEVEL_FATAL_ERROR,a===Logs.LEVEL_FATAL_ERROR)throw t.showCache(),new Error("Vse polamalos'!")}};let n=function(t){return"00000".substr(0,2-t.toString().length)+t};this.setLevel=function(t){e=t},this.LEVEL_DETAIL=1,this.LEVEL_NOTIFY=2,this.LEVEL_WARNING=3,this.LEVEL_ERROR=4,this.LEVEL_FATAL_ERROR=5,this.alert=function(t,i){t<e||alert(i)};let o={};o[this.LEVEL_DETAIL]="d",o[this.LEVEL_NOTIFY]="N",o[this.LEVEL_WARNING]="w",o[this.LEVEL_ERROR]="E",o[this.LEVEL_FATAL_ERROR]="FE"};Logs=new Logs,Logs.CHANNEL_VK_PAYMENTS=1,Logs.CHANNEL_VK_STUFF=2,Logs.CHANNEL_VK_HEALTH=3,Logs.depends=[],CONST_IS_SERVER_SIDE&&(global.Logs=Logs);let OnIdle=function(){let t=this;this.stack=[],this.init=function(t){setTimeout(OnIdle.iterate,15*Config.OnIdle.animateInterval),t()},this.register=function(e){t.stack.push(e)},this.iterate=function(){for(let e in t.stack)t.stack[e]();setTimeout(OnIdle.iterate,Config.OnIdle.animateInterval)}};OnIdle=new OnIdle;let PageController=function(){let t,e=this,i=[];this.addBlocks=function(t){t.forEach(function(t){i.push({block:t,showed:!1}),t.init||Logs.log("PageController.addPage. block must have method init(). ",Logs.LEVEL_FATAL_ERROR,t),t.show||Logs.log("PageController.addPage. block must have method show().",Logs.LEVEL_FATAL_ERROR,t),t.hide||Logs.log("PageController.addPage. block must have method hide()",Logs.LEVEL_FATAL_ERROR,t),t.redraw||Logs.log("PageController.addPage. block must have method redraw()",Logs.LEVEL_FATAL_ERROR,t),t.init()})},this.showBlocks=function(t){let n;for(let e in i){n=!1;for(let o in t)i[e].block===t[o]&&(n=!0);n?!1===i[e].showed&&(i[e].block.show(),i[e].showed=!0):!0===i[e].showed&&(i[e].block.hide(),i[e].showed=!1)}e.redraw()};let n=!1;this.redrawCount=0,this.pendingData=function(t){n=t};let o=null;this.redraw=function(){if(n)o||(o=setTimeout(PageController.redraw,1e3));else{o=null,PageController.redrawCount++;for(let t in i)i[t].block.redraw()}},this.showPage=function(i){t=i,e.showBlocks(i.blocks)},this.isShowedNow=function(e){return e===t},this.getCurrentPage=function(){return t}};PageController=new PageController;let Profiler=function(){this.start=function(t){},this.stop=function(t){},this.getNewId=function(t){},this.printReport=function(){},this.saveToDB=function(){},this.getTextReport=function(){},this.init=function(t){}};Profiler=new Profiler;let SocNet=function(){let t=this,e=null;this.init=function(e){switch(Logs.log("SocNet.Init()",Logs.LEVEL_NOTIFY),t.getType()){case SocNet.TYPE_VK:t.__proto__=SocNetVK;break;case SocNet.TYPE_STANDALONE:t.__proto__=SocNetStandalone;break;default:Logs.log("Wrong soc net type",Logs.LEVEL_FATAL_ERROR)}t.__proto__.init(e)},this.getType=function(){return e||(SocNetVK.detectIsItThat()&&(e=SocNet.TYPE_VK),SocNetStandalone.detectIsItThat()&&(e=SocNet.TYPE_STANDALONE),e||Logs.log("Не удалось определить тип социальной сети(платформы)",Logs.LEVEL_FATAL_ERROR)),e}};SocNet=new SocNet,SocNet.TYPE_VK=1,SocNet.TYPE_STANDALONE=2,SocNet.SEX_UNKNOWN=1,SocNet.SEX_WOMAN=2,SocNet.SEX_MAN=3;let SocNetStandalone=function(){this.init=function(){},this.getAuthParams=function(){return{}},this.getUserProfileUrl=function(){return Logs.log("TODO Me, SocNetStandalone.getUserProfileUrl",Logs.LEVEL_WARNING),"/notFound/todo/me/please/:)"},this.openInviteFriendDialog=function(){Logs.log("todo me SocNetStandalone.openIvniteFirendDialog",Logs.LEVEL_WARNING),alert("Sorry, but functional is not realized!")},this.getSocNetUserId=function(){let t;return(t=parseInt(getQueryVariable("soc-net-user-id")))||(Logs.log("TODO Me. SocNetStandlaone.getSocNetUesrId and ... guset mode :)",Logs.LEVEL_WARNING),t=111),t};let t=[];for(let e=0;e<1e4;e++)t.push(e);this.getFriendIds=function(e){e(t)},this.getUserInfo=function(t,e){let i=["Кириллов Юрий Валериевич https://sun9-66.userapi.com/c850720/v850720693/aa731/OfJz30MgPwk.jpg?ava=1","Пахомов Александр Григорьевич https://sun9-14.userapi.com/c638221/v638221218/2ef4b/_aHYzcPLBCg.jpg?ava=1","Негода Устин Леонидович https://sun1-22.userapi.com/RmZXykSdi9zj13kzngIYEqOfID_hx6orUlfJlA/MMMD8qmZ_Xw.jpg?ava=1","Грабчак Роман Андреевич https://sun1-21.userapi.com/y5VqHemrzxItmMMqaFLOgs8zICBGDnLsQSgAxQ/vCEOyLcrgd0.jpg?ava=1","Наумов Людвиг Артёмович https://sun1-17.userapi.com/dqr7J__INZrCV_sz-q_FjD3QZZ2teSTYvc1tnQ/jnfGgShVuX8.jpg?ava=1","Симонов Игнатий Васильевич https://sun1-89.userapi.com/XbvESSpRKkZTVrKVoPaLsvxi8VeAt2F3bnBSjw/CXlmEGL1hLA.jpg?ava=1","Харитонов Яромир Александрович https://sun9-23.userapi.com/c852020/v852020728/2517a/KgfXYhVKZqc.jpg?ava=1","Носков Людвиг Романович https://sun9-46.userapi.com/c856128/v856128757/17a84c/jVZi7Qhn8J0.jpg?ava=1","Крюков Марк Романович https://sun9-25.userapi.com/c129/u3798851/d_c8272907.jpg?ava=1","Киранов Марат Романович https://sun9-21.userapi.com/c856128/v856128316/2231ac/YlxmsBfJmRo.jpg?ava=1","Чубайк Николай Викторович https://sun9-24.userapi.com/c855236/v855236720/1fc41b/30CK4PHZdbA.jpg?ava=1","Пушкин Александр Сергеевич https://sun9-71.userapi.com/c857324/v857324568/1766c5/-0YaEO72vRE.jpg?ava=1","Билл Гейтс Ибнабабн https://sun9-9.userapi.com/c857324/v857324365/129750/UE54E0SgDaU.jpg?ava=1","Стив Джоб Jobs https://sun9-45.userapi.com/c845420/v845420707/eff82/P3Mvr9Zp4qI.jpg?ava=1"],n={};this.getSocNetUserId(),n.first_name=i[t%i.length].split(" ")[0],n.last_name=i[t%i.length].split(" ")[1],n.photo_50=i[t%i.length].split(" ")[3],n.photo_100=i[t%i.length].split(" ")[3],n.id=t,n.sex=SocNet.SEX_UNKNOWN,e([n])},this.openOrderDialog=function(t){let e=DataShop.getGoldProductByPrice(t);confirm("Купить "+e.quantity+"монет за "+t+" стенделонов?")},this.post=function(){console.log(arguments),alert("Возможно не сейчас!")},this.detectIsItThat=function(){return"STANDALONE"===window.PLATFORM_ID}};SocNetStandalone=new SocNetStandalone;let SocNetVK=function(){let t={};this.getAuthParams=function(){return{authKey:t.auth_key,appId:t.api_id}},this.getUserProfileUrl=function(t,e){return"http://vk.com/id"+e},this.openInviteFriendDialog=function(){VK.callMethod("showInviteBox")},this.openOrderDialog=function(t){VK.callMethod("showOrderBox",{type:"votes",votes:t})},this.getFriendIds=function(t){VK.api("friends.getAppUsers",{},function(e){t(e.response)})},this.getUserInfo=function(t,e){VK.api("users.get",{user_ids:t,fields:"photo_50,photo_100"},function(t){e(t.response)})},this.post=function(t){console.log(t),VK.api("wall.post",{owner_id:t.userId,message:t.message,attachments:"photo-194995832_457239017"},function(){console.log(arguments)})},this.init=function(){let e,i;e=function(){Logs.log("VK client API inited.",Logs.LEVEL_NOTIFY)},i=function(){alert("Произошла ошибка доступа к вКонтакте, обратитесь к автору приложения."),Logs.log("SocNetVK Fail",Logs.LEVEL_FATAL_ERROR)},VK.init(e,i,"5.95"),t={viewer_id:getQueryVariable("viewer_id"),api_id:getQueryVariable("api_id"),auth_key:getQueryVariable("auth_key"),secret:getQueryVariable("secret"),access_token:getQueryVariable("access_token")}},this.getSocNetUserId=function(){return t.viewer_id},this.detectIsItThat=function(){return"VK"==window.PLATFORM_ID}};SocNetVK=new SocNetVK;let Sounds=function(){let t=this,e={};this.enabled=!0,this.PATH_CHALK="/sounds/chalk.mp3",this.toggle=function(){t.enabled?t.off():t.on()},this.isEnabled=function(){return t.enabled},this.on=function(){t.enabled=!0,document.cookie="settings_sound=on"},this.off=function(){t.enabled=!1,document.cookie="settings_sound=off"},this.play=function(i,n){t.enabled&&(e[i]||(e[i]=new Audio(i+"?t=1123")),n||(n=1),e[i].volume=n,e[i].play())},-1!==document.cookie.search("settings_sound=off")&&t.off()};Sounds=new Sounds;let WebSocketClient=function(){let t,e=this,i=null,n=null,o=null,s=null;this.init=function(e){o="https:"==window.document.location.protocol?"wss":"ws",i=Config.WebSocketClient.host,n=Config.WebSocketClient.port,t=Config.WebSocketClient.url,e()},this.onData=null,this.onConnect=null,this.onDisconnect=null,this.sendData=function(t){return l.push(t),E(),!0},this.run=function(){a(),u()};let a=function(){"function"!=typeof e.onConnect&&Logs.log("onConnect must be function",Logs.LEVEL_FATAL_ERROR,e.onConnect),"function"!=typeof e.onDisconnect&&Logs.log("onConnect must be function",Logs.LEVEL_FATAL_ERROR,e.onDisconnect),"function"!=typeof e.onData&&Logs.log("onConnect must be function",Logs.LEVEL_FATAL_ERROR,e.onData)},r=!1,l=[],c=null,h=0,u=function(){d()},d=function(){let e;h++,e=o+"://"+i+":"+n+t,Logs.log("WebSocket, connectCount:"+h,Logs.LEVEL_NOTIFY,{uri:e}),(c=new WebSocket(e)).onopen=g,c.onclose=f,c.onmessage=I,c.onerror=p},g=function(){r=!0,E(),s=++WebSocketClient.connectionId,e.onConnect(s)},f=function(t){r=!1,h--,t.wasClean?Logs.log("WebSocket: Соединение закрыто успешно."):Logs.log("WebSocket: Соединение закрыто, отсутствует соединение."),Logs.log("WebSocket: Код: "+t.code+" причина: "+t.reason),e.onDisconnect(s),setTimeout(m,3e3)},m=function(){!1===r&&(Logs.log("Try reconnect",Logs.LEVEL_NOTIFY),h<3&&d())},I=function(t){e.onData(t.data,s)},p=function(t){Logs.log("WebSocket: Ошибка ",Logs.LEVEL_NOTIFY,t.timeStamp)},E=function(){let t;l.length&&r&&(t=l.shift(),c.send(t),l.length&&setTimeout(E,1500))}};WebSocketClient.connectionId=0;let fps=33.3,Config={Logs:{triggerLevel:Logs.LEVEL_DETAIL},WebSocketClient:{host:"local.host",port:443,url:"/service"},SocNet:{appId:6221265},OnIdle:{animateInterval:1e3/fps,second:-1,animStep:1}};Config.OnIdle.second=Config.OnIdle.animateInterval*fps/Config.OnIdle.animStep,window.onload=function(){LogicMain.main()};let SAPIMap=function(){this.reloadLevels=function(){ApiRouter.executeRequest("SAPIMap","reloadLevels",arguments)},this.sendMeMapInfo=function(){ApiRouter.executeRequest("SAPIMap","sendMeMapInfo",arguments)},this.sendMeUsersScore=function(){ApiRouter.executeRequest("SAPIMap","sendMeUsersScore",arguments)},this.onFinish=function(){ApiRouter.executeRequest("SAPIMap","onFinish",arguments)}};SAPIMap=new SAPIMap;let SAPIStuff=function(){this.sendMeStuff=function(){ApiRouter.executeRequest("SAPIStuff","sendMeStuff",arguments)},this.usedHummer=function(){ApiRouter.executeRequest("SAPIStuff","usedHummer",arguments)},this.usedShuffle=function(){ApiRouter.executeRequest("SAPIStuff","usedShuffle",arguments)},this.usedLightning=function(){ApiRouter.executeRequest("SAPIStuff","usedLightning",arguments)},this.buyHummer=function(){ApiRouter.executeRequest("SAPIStuff","buyHummer",arguments)},this.buyShuffle=function(){ApiRouter.executeRequest("SAPIStuff","buyShuffle",arguments)},this.buyLightning=function(){ApiRouter.executeRequest("SAPIStuff","buyLightning",arguments)},this.buyHealth=function(){ApiRouter.executeRequest("SAPIStuff","buyHealth",arguments)}};SAPIStuff=new SAPIStuff;let SAPITimeServer=function(){this.sendMeTime=function(){ApiRouter.executeRequest("SAPITimeServer","sendMeTime",arguments)}};SAPITimeServer=new SAPITimeServer;let SAPIUser=function(){this.authorizeByVK=function(){ApiRouter.executeRequest("SAPIUser","authorizeByVK",arguments)},this.authorizeByStandalone=function(){ApiRouter.executeRequest("SAPIUser","authorizeByStandalone",arguments)},this.sendMeUserInfo=function(){ApiRouter.executeRequest("SAPIUser","sendMeUserInfo",arguments)},this.sendMeUserListInfo=function(){ApiRouter.executeRequest("SAPIUser","sendMeUserListInfo",arguments)},this.sendMeUserIdsBySocNet=function(){ApiRouter.executeRequest("SAPIUser","sendMeUserIdsBySocNet",arguments)},this.onFinish=function(){ApiRouter.executeRequest("SAPIUser","onFinish",arguments)},this.onPlayStart=function(){ApiRouter.executeRequest("SAPIUser","onPlayStart",arguments)},this.zeroLife=function(){ApiRouter.executeRequest("SAPIUser","zeroLife",arguments)}};SAPIUser=new SAPIUser,ApiRouter.map2={SAPIMap:SAPIMap,SAPIStuff:SAPIStuff,SAPITimeServer:SAPITimeServer,SAPIUser:SAPIUser},document.addEventListener("DOMContentLoaded",function(){GUI.init(),PageController.addBlocks([PageBlockBackground,PageBlockField,PageBlockMaps,PageBlockPanel,PageBlockWizard,PageBlockZClouds,PageBlockZDialogs]),PageField.init(),PageMain.init()})}_(window);
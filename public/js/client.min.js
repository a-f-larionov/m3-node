function ___(){CONST_IS_SERVER_SIDE=!1,CONST_IS_CLIENT_SIDE=!0,void 0!==window.constants&&(window.constants.__path="../client/core/constants.js");let e=console.log,t=function(e){let t=window.location.search.substring(1).split("&");for(let i=0;i<t.length;i++){let n=t[i].split("=");if(n[0]===e)return n[1]}Logs.log("Query Variable "+e+" not found",Logs.LEVEL_WARNING)};window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){return window.setTimeout(e,1e3/60)}),window.cancelAnimationFrame||(window.cancelAnimationFrame=window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),void 0!==window.functions&&(window.functions.__path="../client/core/functions.js"),AnimLocker={locks:0,lock:function(){AnimLocker.locks++},release:function(){AnimLocker.locks--},free:function(){return 0===AnimLocker.locks},busy:function(){return!AnimLocker.free()}},void 0!==window.AnimLocker&&(window.AnimLocker.__path="../client/components/application/anims/AnimLocker.js"),Animate={anim:function(e,t){let i,n,o,s;o=0,n=new e;for(let e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);(i=Array.from(arguments)).shift(),i.shift(),n.init.apply(n,i),n.skipAnimLock||AnimLocker.lock();let a=function(){o+=p.OnIdle.animStep,n.iterate(o)?s=requestAnimationFrame(a):l()},l=function(){cancelAnimationFrame(s),n.finish&&n.finish(),n.skipAnimLock||AnimLocker.release(),t.onFinish&&t.onFinish()};return a(),l},getFrameUrl:function(e,t,i){return e+(Math.floor(t%i)+1)+".png"}},Animate.settings={fallVelocity:5},void 0!==window.Animate&&(window.Animate.__path="../client/components/application/anims/Animate.js");let i=function(){let e=70;this.init=function(t){e=t,this.skipAnimLock=!0},this.iterate=function(t){return this.dom.y=20*t-500,this.dom.redraw(),this.dom.y<e},this.finish=function(){this.dom.y=e,this.dom.redraw()}},n=function(){let e=70;this.init=function(t){e=t,this.skipAnimLock=!0,e=this.dom.y},this.iterate=function(t){return this.dom.y=e+-20*t,this.dom.redraw(),this.dom.y>-500},this.finish=function(){this.dom.y=-500,this.dom.redraw()}};void 0!==window.dialogs&&(window.dialogs.__path="../client/components/application/anims/dialogs.js");let o=function(){let e,t,i,n,o,s;i=5,o=Math.floor(20),n=Math.floor(o/2),this.init=function(i,n){t={x:5*(n.x-i.x),y:5*(n.y-i.y)},e=this.gemDoms[i.x][i.y],s={x:e.x,y:e.y}},this.iterate=function(i){return i>n?(e.x=s.x+n*t.x-t.x*(i-n),e.y=s.y+n*t.y-t.y*(i-n)):(e.x=s.x+t.x*i,e.y=s.y+t.y*i),e.redraw(),e.bindedDoms&&(e.bindedDoms.x=e.x,e.bindedDoms.y=e.y,e.bindedDoms.redraw()),i+1<o}},s=function(){let e;this.init=function(t,i){e=this.animDoms.pop();let n=Field.getVisibleLength(t,i);e.width=n.length*DataPoints.BLOCK_WIDTH,e.height=Images.getHeight("/images/anim-light-1.png"),i===DataObjects.WITH_LIGHTNING_VERTICAL&&(e.rotate=90,e.x=t.x*DataPoints.BLOCK_WIDTH,e.y=n.lower*DataPoints.BLOCK_HEIGHT-(Images.getHeight("/images/anim-light-1.png")-DataPoints.BLOCK_HEIGHT)/2,e.x-=(e.width-DataPoints.BLOCK_WIDTH)/2,e.y+=(e.width-DataPoints.BLOCK_WIDTH)/2),i===DataObjects.WITH_LIGHTNING_HORIZONTAL&&(e.rotate=0,e.x=n.lower*DataPoints.BLOCK_WIDTH,e.y=t.y*DataPoints.BLOCK_HEIGHT-(Images.getHeight("/images/anim-light-1.png")-DataPoints.BLOCK_HEIGHT)/2),e.show(),e.redraw()},this.iterate=function(t){if(e.backgroundImage=Animate.getFrameUrl("/images/anim-light-",.5*t,5),e.redraw(),t<15)return!0},this.finish=function(){e.hide(),this.animDoms.push(e)}},a=function(){let e,t="/images/anim-hd-1.png";this.init=function(i){(e=this.animDoms.pop()).x=i.x*DataPoints.BLOCK_WIDTH-(Images.getWidth(t)-DataPoints.BLOCK_WIDTH)/2,e.y=i.y*DataPoints.BLOCK_HEIGHT-(Images.getHeight(t)-DataPoints.BLOCK_HEIGHT)/2,e.width=null,e.height=null,e.backgroundImage=t,e.show(),e.redraw()},this.iterate=function(t){return e.backgroundImage=Animate.getFrameUrl("/images/anim-hd-",1*t,15),e.redraw(),t<15},this.finish=function(){this.animDoms.push(e),e.hide()}},l=function(){let e,t,i,n,o;i=5,n=Math.floor(10)-1,this.init=function(i,n){t={x:5*(n.x-i.x),y:5*(n.y-i.y)},e=this.gemDoms[i.x][i.y],o={x:e.x,y:e.y}},this.iterate=function(i){return e.x=o.x+t.x*i,e.y=o.y+t.y*i,e.redraw(),e.bindedDoms&&(e.bindedDoms.x=e.x,e.bindedDoms.y=e.y,e.bindedDoms.redraw()),i<n}},r=function(){let e,t=Animate.settings.fallVelocity;this.init=function(t){(e=this.gemDoms[t.x][t.y]).x=t.x*DataPoints.BLOCK_WIDTH,e.y=t.y*DataPoints.BLOCK_HEIGHT,e.backgroundPositionY=DataPoints.BLOCK_HEIGHT,e.height=0,e.width=DataPoints.BLOCK_WIDTH,e.backgroundImage=DataPoints.objectImages[Field.getGemId(t)],e.redraw(),e.show()},this.iterate=function(i){return e.height=t*i,e.backgroundPositionY=DataPoints.BLOCK_HEIGHT-t*i,e.redraw(),e.height<DataPoints.BLOCK_HEIGHT}},c=function(){let e,t,i=this,n=Animate.settings.fallVelocity;this.init=function(n){e=[],n.forEach(function(n){i.gemDoms[n.from.x][n.from.y].hide(),t=i.gemDoms[n.to.x][n.to.y],e.push(t),t.fallMode="just",t.startY=(n.to.y-1)*DataPoints.BLOCK_HEIGHT,t.backgroundImage=DataPoints.objectImages[Field.getGemId({x:n.to.x,y:n.to.y})],t.x=n.to.x*DataPoints.BLOCK_WIDTH,t.y=n.to.y*DataPoints.BLOCK_HEIGHT,t.show(),!Field.isVisible({x:n.to.x,y:n.to.y-1})&&Field.isVisible(n.to)&&(t.fallMode="to-show"),Field.isVisible({x:n.to.x,y:n.to.y-1})&&!Field.isVisible(n.to)&&(t.fallMode="to-hide"),"to-show"===t.fallMode&&(t.y=n.to.y*DataPoints.BLOCK_HEIGHT,t.height=25,t.width=DataPoints.BLOCK_WIDTH,t.backgroundPositionY=DataPoints.BLOCK_HEIGHT),t.redraw()})},this.iterate=function(t){let i;return i=!1,e.forEach(function(e){switch(e.fallMode){case"to-hide":e.y=e.startY+n*t,e.height=DataPoints.BLOCK_HEIGHT-n*t,i|=e.y<e.startY+DataPoints.BLOCK_HEIGHT;break;case"to-show":e.height=n*t,e.backgroundPositionY=DataPoints.BLOCK_HEIGHT-n*t,i|=e.height<DataPoints.BLOCK_HEIGHT;break;case"just":e.y=e.startY+n*t,i|=e.y<e.startY+DataPoints.BLOCK_HEIGHT}e.bindedDoms&&(e.bindedDoms.x=e.x,e.bindedDoms.y=e.y,e.bindedDoms.redraw()),e.redraw()}),i},this.finish=function(){e.forEach(function(e){e.backgroundPositionY=0,e.height=DataPoints.BLOCK_HEIGHT,e.redraw()})}},h=function(){let e;this.init=function(t,i){(e=this.animDoms.pop()).x=t-Images.getWidth("/images/anim-shuffle-1.png")/2,e.y=i-Images.getHeight("/images/anim-shuffle-1.png")/2,e.width=Images.getWidth("/images/anim-shuffle-1.png"),e.height=Images.getHeight("/images/anim-shuffle-1.png"),e.backgroundImage="/images/anim-shuffle-1.png",e.opacity=.7,e.rotate=0,e.show()},this.iterate=function(t){return e.rotate=20*t,e.redraw(),t<18},this.finish=function(){e.hide(),this.animDoms.push(e)}},d=function(){let e,t;this.init=function(i,n){Animate.hintActive=!0,this.skipAnimLock=!0,t=n,e=[],i.forEach(function(t){e.push({startY:this.gemDoms[t.x][t.y].y,dom:this.gemDoms[t.x][t.y]})},this)},this.iterate=function(i){return e.forEach(function(e){e.dom.y=e.startY+3*Math.cos(Math.PI*i/15),e.dom.redraw(),e.dom.bindedDoms&&(e.dom.bindedDoms.x=e.x,e.dom.bindedDoms.y=e.y,e.dom.bindedDoms.redraw())}),t||!AnimLocker.busy()},this.finish=function(){Animate.hintActive=!1}},g=function(){let e,t;this.init=function(t){this.skipAnimLock=!0,e=[t]},this.iterate=function(i){return t=4*Math.cos(Math.PI/15*i),e.forEach(function(e){e.x=e.p.x+t/2,e.y=e.p.y+t/2,e.dom.width=50-t,e.dom.height=50-t,e.redraw()}),!0},this.finish=function(){Animate.hintActive=!1}},u=function(){this.init=function(){},this.iterate=function(e){return e<10}};var f,m;void 0!==window["element-field"]&&(window["element-field"].__path="../client/components/application/anims/element-field.js"),CAPILog=function(){this.log=function(e,t,i){console.log(t,i)}},CAPILog=new CAPILog,void 0!==window.CAPILog&&(window.CAPILog.__path="../client/components/application/capi/CAPILog.js"),CAPIMap=function(){let e,t=this;this.onMapInfoCallback=null,this.gotMapsInfo=function(s,a,l,r,c,h,d){e||(e={"□":DataObjects.CELL_VISIBLE," ":DataObjects.CELL_INVISIBLE,"?":DataObjects.OBJECT_RANDOM,H:DataObjects.OBJECT_HOLE,R:DataObjects.OBJECT_RED,G:DataObjects.OBJECT_GREEN,B:DataObjects.OBJECT_BLUE,Y:DataObjects.OBJECT_YELLOW,P:DataObjects.OBJECT_PURPLE,S:DataObjects.OBJECT_SAND,"△":DataObjects.OBJECT_RED,"◆":DataObjects.OBJECT_GREEN,"▭":DataObjects.OBJECT_BLUE,"◇":DataObjects.OBJECT_YELLOW,"⨀":DataObjects.OBJECT_PURPLE,"ᨔ":DataObjects.OBJECT_POLY_COLOR,"ᥩ":DataObjects.OBJECT_BARREL,$:DataObjects.OBJECT_GOLD,t:DataObjects.OBJECT_TILE,"Ξ":DataObjects.OBJECT_TILE,"α":DataObjects.OBJECT_SPIDER_ALPHA,"‖":DataObjects.OBJECT_BLOCK,"β":DataObjects.OBJECT_SPIDER_BETA,"γ":DataObjects.OBJECT_SPIDER_GAMMA,b:DataObjects.OBJECT_BOX,"■":DataObjects.OBJECT_BOX,"╲":DataObjects.OBJECT_CHAIN_A,"╱":DataObjects.OBJECT_CHAIN_B,X:[DataObjects.OBJECT_CHAIN_A,DataObjects.OBJECT_CHAIN_B],"⭤":DataObjects.WITH_LIGHTNING_HORIZONTAL,"⭥":DataObjects.WITH_LIGHTNING_VERTICAL,"+":DataObjects.WITH_LIGHTNING_CROSS,"*":DataObjects.IS_EMITTER}),DataMap.setMapById(a,l),r.forEach(function(e){e.layers.gems||(e.layers.gems=n()),void 0===e.layers.special&&(e.layers.special=[]),void 0===e.layers.special[0]&&(e.layers.special[0]=[]),"string"==typeof e.layers.special[0]&&(e.layers.special=[e.layers.special]),e.layers.special.forEach(function(e){e.unshift("")}),e.layers.mask.unshift(""),e.layers.gems.unshift(""),e.layers.special.unshift(i()),e.layers.mask=o(e.layers.mask,!1),e.layers.gems=o(e.layers.gems,!1),e.layers.special=o(e.layers.special,!0),DataPoints.setPointData(e)}),h.forEach(function(e){DataChests.setData(e)}),c.forEach(function(e){DataPoints.setPointUserScore(e.userId,e.pointId,e.score)}),d.forEach(function(e){DataChests.setOpened(e.chestId)}),t.onMapInfoCallback&&(t.onMapInfoCallback.call(),t.onMapInfoCallback=null)},this.setCallbackOnMapsInfo=function(e){t.onMapInfoCallback=e},this.gotUserScores=function(e,t){t.forEach(function(e){DataPoints.setPointUserScore(e.userId,e.pointId,e.score)}),PageController.redraw()};let i=function(){let e="";for(let t=0;t<DataPoints.FIELD_MAX_WIDTH;t++)e+="*";return[e]},n=function(){let e=[];for(let t=0;t<DataPoints.FIELD_MAX_HEIGHT;t++){e[t]="";for(let i=0;i<DataPoints.FIELD_MAX_HEIGHT;i++)e[t]+="?"}return e},o=function(t,i){let n;return n=[],"string"==typeof t[0]&&(t=[t]),t.forEach(function(t){t.forEach(function(o,s){o.split("").forEach(function(o,a){e[o]||(Logs.log("error",Logs.LEVEL_DETAIL,[t]),Logs.alert(Logs.LEVEL_ERROR,"ERROR: Нет такого символа в мепинге."+o)),n[a]||(n[a]=[]),i?(n[a][s]||(n[a][s]=[]),n[a][s]=n[a][s].concat(e[o].length?e[o]:[e[o]])):n[a][s]=e[o]})})}),n}},CAPIMap=new CAPIMap,void 0!==window.CAPIMap&&(window.CAPIMap.__path="../client/components/application/capi/CAPIMap.js"),CAPIStuff=function(){this.gotStuff=function(e,t){LogicStuff.updateStuff(t)},this.incrementGold=function(e,t){LogicStuff.giveAGold(t),PageController.redraw()},this.decrementGold=function(e,t){LogicStuff.usedGold(t),PageController.redraw()}},CAPIStuff=new CAPIStuff,void 0!==window.CAPIStuff&&(window.CAPIStuff.__path="../client/components/application/capi/CAPIStuff.js"),CAPITimeServer=function(){this.gotServerTime=function(e,t){LogicTimeClient.setServerTime(t)}},CAPITimeServer=new CAPITimeServer,void 0!==window.CAPITimeServer&&(window.CAPITimeServer.__path="../client/components/application/capi/CAPITimeServer.js"),CAPIUser=function(){this.authorizeSuccess=function(e,t){CAPIUser.updateUserInfo(e,t),LogicUser.authorizeSuccess(t.id)},this.updateUserInfo=function(e,t){t.createTimestamp=LogicTimeClient.convertToClient(t.createTimestamp),t.lastLoginTimestamp=LogicTimeClient.convertToClient(t.lastLoginTimestamp),t.fullRecoveryTime=LogicTimeClient.convertToClient(t.fullRecoveryTime),LogicUser.updateUserInfo(t)},this.updateUserListInfo=function(e,t){PageController.pendingData(!0),t.forEach(function(t){CAPIUser.updateUserInfo(e,t)}),PageController.pendingData(!1)},this.gotFriendsIds=function(e,t){LogicUser.setFriendIds(t)},this.setOneHealthHide=function(e,t){PageBlockPanel.oneHealthHide=t}},CAPIUser=new CAPIUser,void 0!==window.CAPIUser&&(window.CAPIUser.__path="../client/components/application/capi/CAPIUser.js"),DataChests=function(){let e=[{number:1,x:175,y:125},{number:2,x:475,y:225}],t=[],i=[];this.getCoords=function(){return e},this.getById=function(e){return t[e]},this.setData=function(e){t[e.id]=e,PageController.redraw()},this.setOpened=function(e){i[e]=!0},this.isItOpened=function(e){return!0===i[e]}},DataChests=new DataChests,void 0!==window.DataChests&&(window.DataChests.__path="../client/components/application/data/DataChests.js"),DataCross={},DataCross.user={maxHealth:5,healthRecoveryTime:45},DataCross.app={width:777,height:500},void 0!==window.DataCross&&(window.DataCross.__path="components/application/data/DataCross.js"),DataMap=function(){let e=1,t={},i=[];this.setMapById=function(e,i){t[e]=i,PageController.redraw()},this.getCurent=function(){var n;return t[e]||(n||(n=e),i[n]||(i[n]=!0,SAPIMap.sendMeMapInfo(n))),t[e]},this.setCurrentMapId=function(t){t>=DataMap.MAP_ID_MAX||t<=DataMap.MAP_ID_MIN||(e=t)},this.setNextMap=function(){e!==DataMap.MAP_ID_MAX&&e++},this.setPrevMap=function(){e!==DataMap.MAP_ID_MIN&&e--},this.getMapIdFromPointId=function(e){return Math.ceil(LogicUser.getCurrentUser().nextPointId/DataMap.POINTS_PER_MAP)},this.getFirstPointId=function(){return DataMap.POINTS_PER_MAP*(e-1)+1},this.getLastPointId=function(){return this.getFirstPointId()+DataMap.POINTS_PER_MAP-1},this.getPointIdFromPointNumber=function(e){return this.getFirstPointId()+(e-1)},this.getNumberFromPointId=function(e){return e-this.getFirstPointId()+1},this.getFirstChestId=function(){return DataMap.CHESTS_PER_MAP*(e-1)+1},this.getLastChestId=function(){return this.getFirstChestId()+DataMap.CHESTS_PER_MAP-1},this.getChestIdFromChestNumber=function(e){return this.getFirstChestId()+(e-1)},this.countStarsByMapId=function(t){let i,n,o,s,a,l;if(t||(t=e),i=0,!(n=LogicUser.getCurrentUser()))return 0;if(!(o=DataPoints.getPointUserScore(t,[n.id])))return 0;for(let e=1;e<=DataMap.POINTS_PER_MAP;e++){if(s=DataMap.getPointIdFromPointNumber(e),!(a=DataPoints.getById(s)))return 0;l=0,o[s]&&(o[s][n.id]&&(o[s][n.id].score>=a.score1&&(l=1),o[s][n.id].score>=a.score2&&(l=2),o[s][n.id].score>=a.score3&&(l=3),i+=l))}return i}},GUI={},GUI.ANIM_TYPE_ROTATE=10,GUI.ANIM_TYPE_MOVE=20,GUI.ANIM_TYPE_GOTO=30,GUI.ANIM_TYPE_MOVIE=40,GUI.ANIM_TYPE_PAUSE=50,GUI.ANIM_TYPE_STOP=60,DataMap=new DataMap,DataMap.MAP_ID_MIN=1,DataMap.MAP_ID_MAX=10,DataMap.POINTS_PER_MAP=18,DataMap.CHESTS_PER_MAP=2,void 0!==window.DataMap&&(window.DataMap.__path="../client/components/application/data/DataMap.js"),DataObjects=function(){this.CELL_INVISIBLE=1,this.CELL_VISIBLE=2,this.OBJECT_RANDOM=101,this.OBJECT_RED=102,this.OBJECT_GREEN=103,this.OBJECT_BLUE=104,this.OBJECT_YELLOW=105,this.OBJECT_PURPLE=106,this.OBJECT_SAND=107,this.OBJECT_HOLE=120,this.OBJECT_BARREL=130,this.OBJECT_BLOCK=135,this.OBJECT_POLY_COLOR=140,this.OBJECT_SPIDER_ALPHA=150,this.OBJECT_SPIDER_BETA=160,this.OBJECT_SPIDER_GAMMA=161,this.OBJECT_TILE=170,this.OBJECT_GOLD=180,this.OBJECT_BOX=190,this.OBJECT_CHAIN_A=200,this.OBJECT_CHAIN_B=210,this.IS_EMITTER=1001,this.WITH_LIGHTNING_HORIZONTAL=1010,this.WITH_LIGHTNING_VERTICAL=1011,this.WITH_LIGHTNING_CROSS=1012},DataObjects=new DataObjects,void 0!==window.DataObjects&&(window.DataObjects.__path="components/application/data/DataObjects.js"),DataPoints=function(){this.FIELD_MAX_WIDTH=10,this.FIELD_MAX_HEIGHT=11,this.BLOCK_WIDTH=50,this.BLOCK_HEIGHT=50,this.objectImages={},this.objectImages[DataObjects.CELL_INVISIBLE]="/images/field-none-2.png",this.objectImages[DataObjects.CELL_VISIBLE]="/images/field-cell.png",this.objectImages[DataObjects.OBJECT_HOLE]="/images/field-none-2.png",this.objectImages[DataObjects.OBJECT_RANDOM]="/images/field-none.png",this.objectImages[DataObjects.OBJECT_RED]="/images/field-red.png",this.objectImages[DataObjects.OBJECT_GREEN]="/images/field-green.png",this.objectImages[DataObjects.OBJECT_BLUE]="/images/field-blue.png",this.objectImages[DataObjects.OBJECT_YELLOW]="/images/field-yellow.png",this.objectImages[DataObjects.OBJECT_PURPLE]="/images/field-purple.png",this.objectImages[DataObjects.OBJECT_SAND]="/images/field-sand.png",this.objectImages[DataObjects.OBJECT_BARREL]="/images/field-barrel.png",this.objectImages[DataObjects.OBJECT_BLOCK]="/images/field-block.png",this.objectImages[DataObjects.OBJECT_POLY_COLOR]="/images/field-poly-color.png",this.objectImages[DataObjects.OBJECT_GOLD]="/images/field-gold.png",this.objectImages[DataObjects.OBJECT_TILE]="/images/field-tile.png",this.objectImages[DataObjects.OBJECT_SPIDER_ALPHA]="/images/field-alpha.png",this.objectImages[DataObjects.OBJECT_SPIDER_BETA]="/images/field-beta.png",this.objectImages[DataObjects.OBJECT_SPIDER_GAMMA]="/images/field-gamma.png",this.objectImages[DataObjects.OBJECT_BOX]="/images/field-box.png",this.objectImages[DataObjects.OBJECT_CHAIN_A]="/images/field-chain-a.png",this.objectImages[DataObjects.OBJECT_CHAIN_B]="/images/field-chain-b.png",this.objectImages[DataObjects.WITH_LIGHTNING_VERTICAL]="/images/spec-light-ver-1.png",this.objectImages[DataObjects.WITH_LIGHTNING_HORIZONTAL]="/images/spec-light-hor-1.png",this.objectImages[DataObjects.WITH_LIGHTNING_CROSS]="/images/spec-light-cross-1.png",this.healthImages={},this.healthImages[0]="/images/creature-health-0.png",this.healthImages[1]="/images/creature-health-1.png",this.healthImages[2]="/images/creature-health-2.png",this.healthImages[3]="/images/creature-health-3.png",this.objectAnims={},this.objectAnims[DataObjects.WITH_LIGHTNING_HORIZONTAL]=[[{type:GUI.ANIM_TYPE_MOVIE,images:["/images/spec-light-hor-1.png","/images/spec-light-hor-2.png","/images/spec-light-hor-3.png","/images/spec-light-hor-4.png","/images/spec-light-hor-5.png"],duration:5},{type:GUI.ANIM_TYPE_GOTO,pos:0}]],this.objectAnims[DataObjects.WITH_LIGHTNING_VERTICAL]=[[{type:GUI.ANIM_TYPE_MOVIE,images:["/images/spec-light-ver-1.png","/images/spec-light-ver-2.png","/images/spec-light-ver-3.png","/images/spec-light-ver-4.png","/images/spec-light-ver-5.png"],duration:5},{type:GUI.ANIM_TYPE_GOTO,pos:0}]],this.objectAnims[DataObjects.WITH_LIGHTNING_CROSS]=[[{type:GUI.ANIM_TYPE_MOVIE,images:["/images/spec-light-cross-1.png","/images/spec-light-cross-2.png","/images/spec-light-cross-3.png","/images/spec-light-cross-4.png","/images/spec-light-cross-5.png"],duration:5},{type:GUI.ANIM_TYPE_GOTO,pos:0}]];let e=[{number:1,x:61,y:209},{number:2,x:61,y:290},{number:3,x:105,y:371},{number:4,x:197,y:390},{number:5,x:283,y:360},{number:6,x:279,y:274},{number:7,x:214,y:205},{number:8,x:205,y:111},{number:9,x:276,y:55},{number:10,x:371,y:51},{number:11,x:452,y:93},{number:12,x:448,y:185},{number:13,x:404,y:269},{number:14,x:425,y:356},{number:15,x:516,y:386},{number:16,x:608,y:367},{number:17,x:614,y:280},{number:18,x:661,y:211}],t={},i=[];this.getPointsCoords=function(){return e},this.getById=function(e){return i[e]},this.setPointData=function(e){i[e.id]=e,PageController.redraw()};let n=null;this.setPlayedId=function(e){n=e},this.getPlayedId=function(){return n},this.getPointUserScore=function(e,i){let n,o,s;n=DataMap.getFirstPointId(e),o=DataMap.getLastPointId(e),s={};for(let e=n;e<=o;e++)for(let n in t[e])-1!==i.indexOf(parseInt(n))&&(s[e]||(s[e]={}),s[e][n]=t[e][n]);return s},this.setPointUserScore=function(e,i,n){t[i]||(t[i]={}),t[i][e]={userId:e,pointId:i,score:n}},this.getScore=function(e,i){return i||(i=LogicUser.getCurrentUser().id),i?(t[e]||(t[e]={}),t[e][i]||(t[e][i]={userId:i,pointId:e,score:0}),t[e][i].score):null},this.countStars=function(e,t,i){let n;return e||(e=DataPoints.getPlayedId()),t||(t=LogicUser.getCurrentUser().id),t&&e?(isNaN(i)&&(i=DataPoints.getScore(e)),(n=DataPoints.getById(e))&&null!==i?i>=n.score3?3:i>=n.score2?2:i>=n.score1?1:0:null):null},this.copyGoals=function(e){let t;t=[];for(let i in e)t.push({id:e[i].id,count:e[i].count});return t}},DataPoints=new DataPoints,void 0!==window.DataPoints&&(window.DataPoints.__path="../client/components/application/data/DataPoints.js"),DataPrizes=function(){let e=this;this.giveOutPrizes=function(t){t.forEach(function(t){e.giveOutPrize(t)})},this.giveOutPrize=function(e){switch(e.id){case DataPrizes.PRIZE_STUFF_HUMMER:LogicStuff.giveAHummer(e.count);break;case DataPrizes.PRIZE_STUFF_SHUFFLE:LogicStuff.giveAShuffle(e.count);break;case DataPrizes.PRIZE_STUFF_LIGHTNING:LogicStuff.giveALighnting(e.count);break;case DataPrizes.PRIZE_STUFF_GOLD:LogicStuff.giveAGold(e.count)}},this.getImageFor=function(e){let t;switch(e.id){case DataPrizes.PRIZE_STUFF_GOLD:t="/images/map-way-point-red.png";break;case DataPrizes.PRIZE_STUFF_HUMMER:t="/images/button-hummer-rest.png";break;case DataPrizes.PRIZE_STUFF_SHUFFLE:t="/images/button-shuffle-rest.png";break;case DataPrizes.PRIZE_STUFF_LIGHTNING:t="/images/button-lightning-rest.png"}return t}},DataPrizes=new DataPrizes,DataPrizes.PRIZE_STUFF_HUMMER=1,DataPrizes.PRIZE_STUFF_SHUFFLE=2,DataPrizes.PRIZE_STUFF_LIGHTNING=3,DataPrizes.PRIZE_STUFF_GOLD=100,void 0!==window.DataPrizes&&(window.DataPrizes.__path="../client/components/application/data/DataPrizes.js"),DataShop=function(){this.getGoldProductByPrice=function(e){let t;return t=!1,DataShop.gold.forEach(function(i){i.votes===e&&(t=i)}),t}},DataShop=new DataShop,DataShop.gold=[{votes:1,quantity:10},{votes:5,quantity:70},{votes:10,quantity:1e3}],DataShop.hummers=[{gold:10,quantity:3,imageSrc:"/images/shop-hummer-1.png"},{gold:15,quantity:6,imageSrc:"/images/shop-hummer-2.png"},{gold:30,quantity:9,imageSrc:"/images/shop-hummer-3.png"}],DataShop.shuffle=[{gold:10,quantity:3,imageSrc:"/images/shop-shuffle-1.png"},{gold:15,quantity:6,imageSrc:"/images/shop-shuffle-2.png"},{gold:30,quantity:9,imageSrc:"/images/shop-shuffle-3.png"}],DataShop.lightning=[{gold:10,quantity:3,imageSrc:"/images/shop-lightning-1.png"},{gold:15,quantity:6,imageSrc:"/images/shop-lightning-2.png"},{gold:30,quantity:9,imageSrc:"/images/shop-lightning-3.png"}],DataShop.healthPrice=100,void 0!==window.DataShop&&(window.DataShop.__path="components/application/data/DataShop.js"),Dialog=function(e){let t=this,o=!1;this.dialogShowed=!1,this.onShowComplete=null,this.startPosition=-500,this.width=500,this.height=322,this.src=e||"/images/window-2.png",this.bottomPosition=90,this.dom=null,this.pointer=void 0,this.elements=[],this.title=void 0,this.init=function(){let e;(e=GUI.createDom(void 0,{width:t.width,height:t.height,backgroundImage:t.src})).x=document.getElementById("appArea").clientWidth/2-t.width/2,e.y=t.startPosition,t.dom=e},this.show=function(){o||(o=!0,t.dom.show(),t.elements.forEach(function(e){e.show()}),t.redraw())},this.hide=function(){o&&(o=!1,t.dom.hide(),t.elements.forEach(function(e){e.hide()}))},this.redraw=function(){o&&(t.dialogShowed||(t.dom.title=t.title,t.dom.pointer=t.pointer,t.dom.redraw()),t.elements=function(e){e.redraw()})},this.showDialog=function(e){return Dialog.addDialog(this,e)},this.showConcreteDialog=function(){t.dialogShowed||(t.show(),t.dialogShowed=!0,Animate.anim(i,{dom:t.dom,onFinish:function(){t.onShowComplete&&t.onShowComplete(),LogicWizard.onShowDialog()}},t.bottomPosition),t.redraw())},this.closeDialog=function(){LogicWizard.onHideDialog(!0),Animate.anim(n,{dom:t.dom,onFinish:s},t.bottomPosition)};let s=function(){t.dialogShowed=!1,Dialog.removeDialog(),LogicWizard.onHideDialog(!1)};this.createElement=function(e,i){t.elements.push(GUI.createElement(e,i,t.dom))},this.reset=function(e){t.dom.y=t.startPosition,t.dialogShowed=!1,e&&(t.redraw(),t.hide()),Dialog.removeDialog()}},Dialog.queue=[],Dialog.addDialog=function(e,t){if(t){let i,n,o;Dialog.queue.forEach(function(e,n){e===t&&(i=n)}),(n=Dialog.queue.slice(0,i+1)).push(e),o=Dialog.queue.slice(i),Dialog.queue=n.concat(o)}else Dialog.queue.push(e);Dialog.showDialog()},Dialog.removeDialog=function(){GUI.unlockEvents(),Dialog.queue.shift(),Dialog.showDialog()},Dialog.showDialog=function(){Dialog.queue.length&&(Dialog.queue[0].showConcreteDialog(),GUI.lockEvents(Dialog.queue[0].dom))},void 0!==window.Dialog&&(window.Dialog.__path="../client/components/application/gui_elements/Dialog.js"),DialogChestNeedStars=function(){let e,t=this;this.__proto__=new Dialog,this.init=function(){this.__proto__.init.call(this),GUI.pushParent(t.dom),GUI.createElement(ElementButton,{x:452,y:3,width:100,height:40,srcRest:"/images/button-close-rest.png",srcHover:"/images/button-close-hover.png",srcActive:"/images/button-close-active.png",onClick:function(){t.closeDialog()}}).show(),(e=GUI.createElement(ElementText,{x:50,y:70,width:260,height:80,text:""})).show(),GUI.popParent()},this.show=function(){this.__proto__.show.call(this)},this.hide=function(){this.__proto__.hide.call(this)},this.redraw=function(){this.__proto__.redraw.call(this),this.dialogShowed&&(e.setText("Нужно собрать еще :"+(this.goalStars-this.mapStars)+" звезд(ы)"),e.redraw())},this.showDialog=function(){this.__proto__.showDialog.call(this),t.redraw()}},void 0!==window.DialogChestNeedStars&&(window.DialogChestNeedStars.__path="../client/components/application/gui_elements/DialogChestNeedStars.js"),DialogChestYouWin=function(){let e,t=this;this.__proto__=new Dialog;let i={},n={};this.init=function(){this.__proto__.init.call(this),GUI.pushParent(t.dom),GUI.createElement(ElementButton,{x:452,y:3,width:100,height:40,srcRest:"/images/button-close-rest.png",srcHover:"/images/button-close-hover.png",srcActive:"/images/button-close-active.png",onClick:function(){t.closeDialog()}}).show(),(e=GUI.createElement(ElementText,{x:40,y:20,width:240,height:80,text:""})).show();for(let e=0;e<4;e++)i[e]=GUI.createElement(ElementImage,{x:40+50*e,y:90,src:""}),n[e]=GUI.createElement(ElementText,{x:60+50*e,y:140,width:50});GUI.popParent()},this.show=function(){this.__proto__.show.call(this)},this.hide=function(){this.__proto__.hide.call(this)},this.redraw=function(){if(this.__proto__.redraw.call(this),!this.dialogShowed)return;let o,s;o=DataChests.getById(t.chestId),e.setText("Собраны все звезды! Ты открыл сундук и нашел там:");for(let e=0;e<4;e++)(s=o.prizes[e])?(i[e].src=DataPrizes.getImageFor(s),n[e].setText(s.count),i[e].show(),n[e].show(),n[e].redraw(),i[e].redraw()):(i[e].hide(),n[e].hide());e.redraw()},this.showDialog=function(){this.__proto__.showDialog.call(this),t.redraw()}},void 0!==window.DialogChestYouWin&&(window.DialogChestYouWin.__path="../client/components/application/gui_elements/DialogChestYouWin.js"),DialogGoals=function(){let e=this;this.__proto__=new Dialog;let t={},i={};this.init=function(){this.__proto__.width=250,this.__proto__.height=150,this.__proto__.src="/images/window-3.png",this.__proto__.bottomPosition=186,this.__proto__.init.call(this),this.__proto__.onShowComplete=this.onShowComplete,GUI.pushParent(e.dom);for(let e in DataPoints.objectImages)t[e]=GUI.createElement(ElementImage,{x:200+e*(DataPoints.BLOCK_WIDTH+5),y:30,src:DataPoints.objectImages[e]}),i[e]=GUI.createElement(ElementText,{x:100+e*(DataPoints.BLOCK_WIDTH+5),y:30+DataPoints.BLOCK_HEIGHT+5,width:DataPoints.BLOCK_WIDTH});GUI.createElement(ElementButton,{x:195,y:0,srcRest:"/images/button-close-rest.png",srcHover:"/images/button-close-hover.png",srcActive:"/images/button-close-active.png",onClick:function(){e.closeDialog()}},this.dom).show(),GUI.popParent()},this.onShowComplete=function(){setTimeout(function(){e.closeDialog()},1.2*p.OnIdle.second)},this.setGoals=function(e){let n,o;for(let e in this.elements)this.elements[e].hide();this.elements=[],o=Images.getWidth(this.src)/2-e.length*(DataPoints.BLOCK_WIDTH+5)/2,n=0;for(let s in e)t[e[s].id].x=o+n,i[e[s].id].x=o+n,i[e[s].id].setText(e[s].count),this.elements.push(t[e[s].id]),this.elements.push(i[e[s].id]),n+=DataPoints.BLOCK_WIDTH+5;for(let e in this.elements)this.elements[e].show(),this.elements[e].redraw()}},void 0!==window.DialogGoals&&(window.DialogGoals.__path="../client/components/application/gui_elements/DialogGoals.js"),DialogGoalsReached=function(){let e=this;e.__name="DialogGoalsReached",this.__proto__=new Dialog;let t,i=null,n=null,o=null,s=null,a=[],l=null,r=null,c=null;this.init=function(){this.__proto__.init.call(this),GUI.pushParent(e.dom),(i=GUI.createElement(ElementText,{x:135,y:12,width:230,height:40,text:""})).show(),(n=GUI.createElement(ElementImage,{x:100,y:40,src:"/images/star-off-big.png"})).show(),(o=GUI.createElement(ElementImage,{x:200,y:40,src:"/images/star-off-big.png"})).show(),(s=GUI.createElement(ElementImage,{x:300,y:40,src:"/images/star-off-big.png"})).show();for(let e=0;e<3;e++)a[e]={elPhotoScore:GUI.createElement(ElementUserScorePhoto,{x:75+75*e+15,y:155})};(l=GUI.createElement(ElementUserScorePhoto,{x:355,y:155})).show(),(r=GUI.createElement(ElementButton,{x:178,y:240,srcRest:"/images/button-red-rest.png",srcHover:"/images/button-red-hover.png",srcActive:"/images/button-red-active.png",onClick:function(){e.closeDialog(),PageController.showPage(PageMain)},title:"НА КАРТУ"})).show(),GUI.createElement(ElementButton,{x:452,y:3,srcRest:"/images/button-close-rest.png",srcHover:"/images/button-close-hover.png",srcActive:"/images/button-close-active.png",onClick:function(){e.closeDialog(),PageController.showPage(PageMain)}}).show(),GUI.popParent()},this.redraw=function(){let e,h,d,g;if(this.__proto__.redraw.call(this),this.dialogShowed){e=LogicUser.getCurrentUser(),h=DataPoints.getById(c),i.text="ПРОЙДЕН "+c;for(let e=0;e<3;e++)(d=t[e])&&d.id?(g=DataPoints.getScore(h.id,d.id),a[e].elPhotoScore.user=d,a[e].elPhotoScore.score=g,g?(a[e].elPhotoScore.show(),a[e].elPhotoScore.redraw()):a[e].elPhotoScore.hide()):a[e].elPhotoScore.hide();switch(l.user=LogicUser.getCurrentUser(),l.score=DataPoints.getScore(h.id),i.redraw(),n.src="/images/star-off-big.png",o.src="/images/star-off-big.png",s.src="/images/star-off-big.png",DataPoints.countStars(h.id)){case 3:s.src="/images/star-on-big.png";case 2:o.src="/images/star-on-big.png";case 1:n.src="/images/star-on-big.png"}n.redraw(),o.redraw(),s.redraw(),l.redraw(),0===LogicHealth.getHealths(e)?r.hide():r.show()}},this.showDialog=function(i){let n;c=i,n=DataMap.getCurent().id,t=LogicUser.getFriendIdsByMapIdAndPointIdWithScore(n,i),this.__proto__.showDialog.call(this),e.redraw()}},void 0!==window.DialogGoalsReached&&(window.DialogGoalsReached.__path="../client/components/application/gui_elements/DialogGoalsReached.js"),DialogHealthShop=function(){let e=this;e.__name="DialogHealthShop",this.__proto__=new Dialog;let t=null;this.init=function(){let i,n,o,s;this.__proto__.init.call(this),n=30,s=80,o=145,GUI.pushParent(e.dom),i=GUI.createElement(ElementText,{x:135,y:11,width:230,height:40,text:"МАГАЗИН"}),e.elements.push(i),t=GUI.createElement(ElementButton,{x:175,y:80,srcRest:"/images/shop-health-1.png",srcHover:"/images/shop-health-1.png",srcActive:"/images/shop-health-1.png",onClick:function(){e.buyHealth5()}}),e.elements.push(t),i=GUI.createElement(ElementButton,{x:320,y:80,srcRest:"/images/shop-health-2.png",srcHover:"/images/shop-health-2.png",srcActive:"/images/shop-health-2.png",onClick:function(){SAPIUser.zeroLife()}}),e.elements.push(i),GUI.createElement(ElementButton,{x:452,y:3,srcRest:"/images/button-close-rest.png",srcHover:"/images/button-close-hover.png",srcActive:"/images/button-close-active.png",onClick:function(){e.closeDialog()}}).show(),GUI.popParent()},this.redraw=function(){let e;e=LogicUser.getCurrentUser(),t.enabled=0===LogicHealth.getHealths(e),this.__proto__.redraw.call(this)},this.buyHealth5=function(){let t,i;t=LogicStuff.getStuff("goldQty"),i=LogicUser.getCurrentUser(),LogicHealth.getHealths(i)>0||(t<DataShop.healthPrice?(PBZDialogs.dialogMoneyShop.showDialog(this),e.closeDialog()):(SAPIStuff.buyHealth(),LogicStuff.giveAHealth(LogicHealth.getMaxHealth()),LogicStuff.usedGold(DataShop.healthPrice),e.closeDialog()),PageController.redraw())}},void 0!==window.DialogHealthShop&&(window.DialogHealthShop.__path="../client/components/application/gui_elements/DialogHealthShop.js"),DialogJustQuit=function(){let e=this;e.__name="DialogJustQuit",this.__proto__=new Dialog,this.init=function(){let t;this.__proto__.init.call(this),(t=GUI.createElement(ElementText,{x:150,y:12,width:200,bold:!0,alignCenter:!0},this.dom)).setText("ВЫЙТИ?"),e.elements.push(t),(t=GUI.createElement(ElementText,{x:127,y:114,width:250,bold:!0,alignCenter:!0},this.dom)).setText("Потеряешь одну жизнь."),e.elements.push(t),t=GUI.createElement(ElementButton,{x:75,y:220,srcRest:"/images/button-red-rest.png",srcHover:"/images/button-red-hover.png",srcActive:"/images/button-red-active.png",onClick:function(){e.closeDialog(),PageBlockPanel.oneHealthHide=!1,PageController.showPage(PageMain),PageBlockField.setStuffMode(null)},title:"СДАТЬСЯ"},this.dom),e.elements.push(t),t=GUI.createElement(ElementButton,{x:275,y:220,srcRest:"/images/button-green-rest.png",srcHover:"/images/button-green-hover.png",srcActive:"/images/button-green-active.png",onClick:function(){e.closeDialog()},title:"ИГРАТЬ"},this.dom),e.elements.push(t),t=GUI.createElement(ElementButton,{x:452,y:3,srcRest:"/images/button-close-rest.png",srcHover:"/images/button-close-hover.png",srcActive:"/images/button-close-active.png",onClick:function(){e.closeDialog()}},this.dom),e.elements.push(t)}},void 0!==window.DialogJustQuit&&(window.DialogJustQuit.__path="../client/components/application/gui_elements/DialogJustQuit.js"),DialogMoneyShop=function(){let e=this;e.__name="DialogMoneyShop",this.__proto__=new Dialog,this.init=function(){let t,i,n,o;this.__proto__.init.call(this),i=25,o=60,n=150,GUI.pushParent(e.dom),t=GUI.createElement(ElementText,{x:135,y:11,width:230,height:40,text:"ГОЛОСА"}),e.elements.push(t);for(let i=0;i<3;i++)t=GUI.createElement(ElementButton,{x:25+150*i,y:60,srcRest:"/images/money_"+(i+1)+".png",srcHover:"/images/money_"+(i+1)+".png",srcActive:"/images/money_"+(i+1)+".png",onClick:function(){GUI.isFullScreen()&&GUI.fsSwitch(),SocNet.openOrderDialog(DataShop.gold[i].votes),e.closeDialog()}}),e.elements.push(t),t=GUI.createElement(ElementButton,{x:25+150*i+45,y:165,srcRest:"/images/button-add-rest.png",srcHover:"/images/button-add-hover.png",srcActive:"/images/button-add-active.png",onClick:function(){SocNet.openOrderDialog(DataShop.gold[i].votes),e.closeDialog()}});GUI.createElement(ElementButton,{x:452,y:3,srcRest:"/images/button-close-rest.png",srcHover:"/images/button-close-hover.png",srcActive:"/images/button-close-active.png",onClick:function(){e.closeDialog()}}).show(),GUI.popParent()}},void 0!==window.DialogMoneyShop&&(window.DialogMoneyShop.__path="../client/components/application/gui_elements/DialogMoneyShop.js"),DialogPointInfo=function(){let e=this;e.__name="DialogPointInfo",this.__proto__=new Dialog;let t,i=null,n=null,o=null,s=null,a=[],l=null,r=null,c=null;this.init=function(){this.__proto__.init.call(this),GUI.pushParent(e.dom),(i=GUI.createElement(ElementText,{x:135,y:12,width:230,height:40,text:""})).show(),(n=GUI.createElement(ElementImage,{x:100,y:40,src:"/images/star-off-big.png"})).show(),(o=GUI.createElement(ElementImage,{x:200,y:40,src:"/images/star-off-big.png"})).show(),(s=GUI.createElement(ElementImage,{x:300,y:40,src:"/images/star-off-big.png"})).show(),[0,1,2].forEach(function(e){a[e]={elPhotoScore:GUI.createElement(ElementUserScorePhoto,{x:75+75*e+15,y:155})}}),(l=GUI.createElement(ElementUserScorePhoto,{x:355,y:155})).show(),(r=GUI.createElement(ElementButton,{x:178,y:240,srcRest:"/images/button-red-rest.png",srcHover:"/images/button-red-hover.png",srcActive:"/images/button-red-active.png",onClick:function(){e.closeDialog(),0===LogicHealth.getHealths(LogicUser.getCurrentUser())?(PBZDialogs.dialogHealthShop.showDialog(),e.showDialog(c)):(SAPIUser.onPlayStart(),PageBlockPanel.oneHealthHide=!0,DataPoints.setPlayedId(c),PageController.showPage(PageField))},title:"ИГРАТЬ"})).show(),GUI.createElement(ElementButton,{x:452,y:3,srcRest:"/images/button-close-rest.png",srcHover:"/images/button-close-hover.png",srcActive:"/images/button-close-active.png",onClick:function(){e.closeDialog()}}).show(),GUI.popParent()},this.show=function(){this.__proto__.show.call(this)},this.hide=function(){this.__proto__.hide.call(this)},this.redraw=function(){let e,r,h;if(this.__proto__.redraw.call(this),this.dialogShowed){e=DataPoints.getById(c),i.text="УРОВЕНЬ  "+c;for(let i=0;i<3;i++)(r=t[i])&&r.id?(h=DataPoints.getScore(e.id,r.id),a[i].elPhotoScore.user=r,a[i].elPhotoScore.score=h,h?(a[i].elPhotoScore.show(),a[i].elPhotoScore.redraw()):a[i].elPhotoScore.hide()):a[i].elPhotoScore.hide();switch(l.user=LogicUser.getCurrentUser(),l.score=DataPoints.getScore(e.id),i.redraw(),n.src="/images/star-off-big.png",o.src="/images/star-off-big.png",s.src="/images/star-off-big.png",DataPoints.countStars(e.id)){case 3:s.src="/images/star-on-big.png";case 2:o.src="/images/star-on-big.png";case 1:n.src="/images/star-on-big.png"}n.redraw(),o.redraw(),s.redraw(),l.redraw()}},this.showDialog=function(i){let n;c=i,n=DataMap.getCurent().id,t=LogicUser.getFriendIdsByMapIdAndPointIdWithScore(n,i,!1),this.__proto__.showDialog.call(this),e.redraw()}},void 0!==window.DialogPointInfo&&(window.DialogPointInfo.__path="../client/components/application/gui_elements/DialogPointInfo.js"),DialogStuffShop=function(){let e=this;this.__proto__=new Dialog;let t=null,i=[];this.init=function(){let t,n,o,s;this.__proto__.init.call(this),n=30,s=80,o=145,GUI.pushParent(e.dom),t=GUI.createElement(ElementText,{x:135,y:11,width:230,height:40,text:"МАГАЗИН"}),e.elements.push(t);for(let n=0;n<3;n++)t=GUI.createElement(ElementButton,{x:30+145*n,y:80,srcRest:"/images/shop-hummer-2.png",srcHover:"/images/shop-hummer-2.png",srcActive:"/images/shop-hummer-2.png",onClick:function(){e.buyStuff(n)}}),i.push(t),e.elements.push(t),t=GUI.createElement(ElementButton,{x:30+145*n+45,y:205,srcRest:"/images/button-add-rest.png",srcHover:"/images/button-add-hover.png",srcActive:"/images/button-add-active.png",itemNumber:n,onClick:function(){e.buyStuff(n)}});GUI.createElement(ElementButton,{x:452,y:3,srcRest:"/images/button-close-rest.png",srcHover:"/images/button-close-hover.png",srcActive:"/images/button-close-active.png",onClick:function(){e.closeDialog()}}).show(),GUI.popParent()},this.showDialog=function(i){this.__proto__.showDialog.call(this),t=i,e.redraw()},this.redraw=function(){let e;if(t){switch(t){case LogicStuff.STUFF_HUMMER:e=DataShop.hummers;break;case LogicStuff.STUFF_LIGHTNING:e=DataShop.lightning;break;case LogicStuff.STUFF_SHUFFLE:e=DataShop.shuffle}for(let t=0;t<3;t++)i[t].srcRest=e[t].imageSrc,i[t].srcHover=e[t].imageSrc,i[t].srcActive=e[t].imageSrc,i[t].redraw()}this.__proto__.redraw.call(this)},this.buyStuff=function(i){let n,o,s,a;switch(n=LogicStuff.getStuff("goldQty"),t){case LogicStuff.STUFF_HUMMER:o=SAPIStuff.buyHummer,s=LogicStuff.giveAHummer,a=DataShop.hummers[i];break;case LogicStuff.STUFF_SHUFFLE:o=SAPIStuff.buyShuffle,s=LogicStuff.giveAShuffle,a=DataShop.shuffle[i];break;case LogicStuff.STUFF_LIGHTNING:o=SAPIStuff.buylightning,s=LogicStuff.giveALighnting,a=DataShop.lightning[i]}n<a.gold?(PBZDialogs.dialogMoneyShop.showDialog(),e.reset(),e.showDialog(t)):(o(i),s(a.quantity),LogicStuff.usedGold(a.gold),e.closeDialog()),PageController.redraw()}},void 0!==window.DialogStuffShop&&(window.DialogStuffShop.__path="../client/components/application/gui_elements/DialogStuffShop.js"),DialogTurnLoose=function(){let e,t=this;this.__proto__=new Dialog,this.init=function(){let i;this.__proto__.init.call(this),GUI.pushParent(t.dom),i=GUI.createElement(ElementButton,{x:452,y:3,srcRest:"/images/button-close-rest.png",srcHover:"/images/button-close-hover.png",srcActive:"/images/button-close-active.png",onClick:function(){t.closeDialog(),PageBlockPanel.oneHealthHide=!1,PageController.showPage(PageMain)}}),t.elements.push(i),(i=GUI.createElement(ElementText,{x:50,y:150,fontSize:24,bold:!0,alignCenter:!0,width:400})).setText("Больше ходов нет! Ты потерял жизнь :("),t.elements.push(i),(e=GUI.createElement(ElementText,{x:135,y:12,width:230,height:40,text:"ПРОИГРЫШ"})).show(),(i=GUI.createElement(ElementButton,{x:178,y:240,srcRest:"/images/button-red-rest.png",srcHover:"/images/button-red-hover.png",srcActive:"/images/button-red-active.png",onClick:function(){t.closeDialog(),0===LogicHealth.getHealths(LogicUser.getCurrentUser())?(PBZDialogs.dialogHealthShop.showDialog(),t.showDialog(pointId)):(SAPIUser.onPlayStart(),PageBlockPanel.oneHealthHide=!0,DataPoints.setPlayedId(DataPoints.getPlayedId()),PageController.showPage(PageMain),PageController.showPage(PageField))},title:"ИГРАТЬ"})).show(),GUI.popParent()}},void 0!==window.DialogTurnLoose&&(window.DialogTurnLoose.__path="../client/components/application/gui_elements/DialogTurnLoose.js"),ElementButton=function(){let e=this,t=!1;this.x=0,this.y=0,this.width=0,this.height=0,this.srcHover="/path/to/image/hover.png",this.srcActive="/path/to/image/active.png",this.srcRest="path/to/image/rest2.png",this.onClick=null,this.title,this.enabled=!0;let i,n=null,o=!1,s=!1;this.init=function(){(n=GUI.createDom()).width=e.width,n.height=e.height,n.backgroundImage=e.srcRest,n.pointer=GUI.POINTER_HAND,GUI.bind(n,GUI.EVENT_MOUSE_MOUSE_DOWN,l,e),GUI.bind(n,GUI.EVENT_MOUSE_CLICK,c,e),GUI.bind(n,GUI.EVENT_MOUSE_OVER,a,e),GUI.bind(n,GUI.EVENT_MOUSE_OUT,r,e),e.title&&(GUI.pushParent(n),(i=GUI.createElement(ElementText,{x:0,y:10,height:25,alignCenter:!0,text:e.title,pointer:GUI.POINTER_HAND})).show(),GUI.popParent())},this.show=function(){!0!==t&&(t=!0,n.show(),e.redraw())},this.hide=function(){!1!==t&&(t=!1,n.hide())},this.redraw=function(){let a;t&&(a=e.srcRest,s&&(a=e.srcHover),s&&o&&(a=e.srcActive),!s&&o&&(a=e.srcRest),n.backgroundImage=a,e.title&&(n.title=e.title,i.width=Images.getWidth(a),i.redraw()),e.enabled?(n.pointer=GUI.POINTER_HAND,n.opacity=1):(n.pointer=GUI.POINTER_ARROW,n.opacity=.5),n.x=e.x,n.y=e.y,n.redraw())};let a=function(){e.enabled&&(s=!0,e.redraw())},l=function(){e.enabled&&(o=!0,e.redraw())},r=function(){e.enabled&&(s=!1,e.redraw())},c=function(t,i){if(t.stopPropagation(),e.enabled)return o=!1,s=!1,e.redraw(),e.onClick.call(null,t,i)}},void 0!==window.ElementButton&&(window.ElementButton.__path="../client/components/application/gui_elements/ElementButton.js"),ElementChest=function(){let e=this,t=!1;this.x=0,this.y=0,this.width=0,this.goalStars=null,this.height=0,this.srcChestClose="/images/chest-close.png",this.srcChestOpen="/images/chest-open.png",this.onClick=null;let i=null,n=null,o=!1,s=!1;this.stateId=1,this.chestId=null,this.init=function(){n=GUI.createElement(ElementText,{width:100,height:40,text:""}),(i=GUI.createDom()).width=e.width,i.height=e.height,i.backgroundImage=e.srcChestClose,i.pointer=GUI.POINTER_HAND,GUI.bind(i,GUI.EVENT_MOUSE_MOUSE_DOWN,l,e),GUI.bind(i,GUI.EVENT_MOUSE_CLICK,c,e),GUI.bind(i,GUI.EVENT_MOUSE_OVER,a,e),GUI.bind(i,GUI.EVENT_MOUSE_OUT,r,e)},this.show=function(){t||(t=!0,i.show(),n.show(),e.redraw())},this.hide=function(){t&&(t=!1,n.hide(),i.hide())},this.redraw=function(){if(!t)return;switch(this.stateId){case 1:i.backgroundImage=s?this.srcChestOpen:this.srcChestClose;break;case 2:i.backgroundImage=this.srcChestOpen}e.stateId===ElementChest.STATE_OPEN?i.pointer=GUI.POINTER_ARROW:i.pointer=GUI.POINTER_HAND,i.x=e.x,i.y=e.y,n.x=e.x+10,n.y=e.y+60;let o=DataChests.isItOpened(e.chestId);e.goalStars?e.stars>e.goalStars?n.text=e.goalStars+"/"+e.goalStars:n.text=e.stars+"/"+e.goalStars:n.text="",n.text+=o?"opened":"closed",n.redraw(),i.redraw()};let a=function(){e.enabled&&(s=!0,e.redraw())},l=function(){e.enabled&&(o=!0,e.redraw())},r=function(){e.enabled&&(s=!1,e.redraw())},c=function(t,i){return t.stopPropagation(),o=!1,s=!1,e.redraw(),e.onClick.call(null,t,i,this)}},ElementChest.STATE_CLOSE=1,ElementChest.STATE_OPEN=2,void 0!==window.ElementChest&&(window.ElementChest.__path="../client/components/application/gui_elements/ElementChest.js"),ElementField=function(){let e=this,t=!0,i=!1,n=!1,g=null,f=null,m=null;this.centerX=0,this.centerY=0,this.x=0,this.y=0;let I=null,_=[],E=[],w=[],L=[],D=[],b=0,y=0,P=0,S=0;this.onDestroyLine=null,this.onDestroyThing=null,this.beforeStuffUse=null,this.onFieldSilent=null;let T=null,C=!1;this.init=function(){let e;I=GUI.createDom(void 0,{width:DataPoints.FIELD_MAX_WIDTH*DataPoints.BLOCK_WIDTH,height:DataPoints.FIELD_MAX_HEIGHT*DataPoints.BLOCK_HEIGHT,overflow:"visible"}),GUI.pushParent(I),I.bind(GUI.EVENT_MOUSE_CLICK,A,I),I.bind(GUI.EVENT_MOUSE_MOUSE_DOWN,M,I),I.bind(GUI.EVENT_MOUSE_MOUSE_UP,F,I),I.bind(GUI.EVENT_MOUSE_MOVE,j,I),Field.eachCell(function(e,t){_[e]||(_[e]=[]),_[e][t]=GUI.createDom(void 0,{opacity:.4})});for(let t=0;t<100;t++)e=GUI.createDom(void 0,{width:DataPoints.BLOCK_WIDTH,height:DataPoints.BLOCK_HEIGHT}),OnIdle.register(e.animate),E.push(e);Field.eachCell(function(t,i){w[t]||(w[t]=[]),e=GUI.createDom(void 0,{p:{x:t,y:i},noScale:!0,height:DataPoints.BLOCK_HEIGHT,width:DataPoints.BLOCK_WIDTH,backgroundImage:"/images/field-none.png"}),w[t][i]=e});for(let t=0;t<100;t++)e=GUI.createDom(void 0,{width:DataPoints.BLOCK_WIDTH,height:DataPoints.BLOCK_HEIGHT}),OnIdle.register(e.animate),L.push(e);for(let e=0;e<100;e++)D.push(GUI.createDom(void 0,{}));f=GUI.createDom(void 0,{backgroundImage:"/images/field-frame.png"}),GUI.popParent(),this.redraw()};let O,x=function(t){return{x:Math.floor((t.clientX-e.x)/DataPoints.BLOCK_WIDTH),y:Math.floor((t.clientY-e.y)/DataPoints.BLOCK_HEIGHT)}},A=function(e){U(x(e))},U=function(e){let i;if(!t&&!AnimLocker.busy()&&(K&&K(),(i=Field.getCell(e)).isVisible&&i.object.isCanMoved))switch(m){case LogicStuff.STUFF_HUMMER:B(e);break;case LogicStuff.STUFF_SHUFFLE:v(e);break;case LogicStuff.STUFF_LIGHTNING:G(e);break;default:R(e)}},B=function(i){t||AnimLocker.busy()||Field.isNotGem(i)||(e.beforeStuffUse(),e.cellAttack(i),Z(a,i))},v=function(){t||AnimLocker.busy()||(e.beforeStuffUse(),H())},H=function(){console.log("s"),Field.shuffle(),Z(h,(P+b/2)*DataPoints.BLOCK_WIDTH,(S+y/2)*DataPoints.BLOCK_HEIGHT)},G=function(i,n){t||AnimLocker.busy()||!Field.isVisible(i)||(n||(n=DataObjects.WITH_LIGHTNING_HORIZONTAL),e.beforeStuffUse(),k(i,n))},k=function(t,i){i===DataObjects.WITH_LIGHTNING_CROSS?(Field.eachVisibleLine(t,DataObjects.WITH_LIGHTNING_VERTICAL,e.cellAttack),Field.eachVisibleLine(t,DataObjects.WITH_LIGHTNING_HORIZONTAL,e.cellAttack),e.redraw(),Z(s,t,DataObjects.WITH_LIGHTNING_VERTICAL),Z(s,t,DataObjects.WITH_LIGHTNING_HORIZONTAL)):(Field.eachVisibleLine(t,i,e.cellAttack),e.redraw(),Z(s,t,i))},R=function(i){let n,s,a=g;if(!t&&!AnimLocker.busy()&&Field.isFallObject(i)&&((!a||a&&!Field.isNear(a,i))&&(g=i,n=Field.getCell(g),C=n&&n.isVisible&&n.object.isPolyColor&&n,e.redraw()),a&&Field.isNear(a,i))){if(g=null,e.redraw(),C)return s=[],Field.eachCell(function(e,t,n,o){n.isVisible&&o.isGem&&o.objectId===Field.getCell(i).object.objectId&&n.object.isCanMoved&&s.push({x:e,y:t,cell:n})}),s.push({x:C.x,y:C.y,cell:C}),s.forEach(function(t){e.cellAttack(t,t.cell)}),W(),W=!1,C=!1,void(a=i=g=null);Field.isLinePossiblyDestroy(a,i)||(Z(o,a,i),Z(o,i,a)),Field.isLinePossiblyDestroy(a,i)&&(T={a:a,b:i},e.beforeTurnUse(),Field.exchangeObjects(a,i),Z(l,a,i),Z(l,i,a))}},N=null,M=function(e){Sounds.play(Sounds.PATH_CHALK),N=x(e)},F=function(){N=null},W=!1,j=function(e){let t;t=x(e),!O||O.x===t.x&&O.y===t.y||(V(e),z(e)),O=t},z=function(e){let t,i,n;C&&(t=x(e),i=Field.getCell(t),Field.isNear(t,g)&&i.isVisible&&i.object.isGem&&i.object.isCanMoved&&(K&&K(),!1===W&&(n=[],Field.eachCell(function(e,t,o,s){o.isVisible&&s.isGem&&s.objectId===i.object.objectId&&o.object.isCanMoved&&n.push({x:e,y:t})}),W=Z(d,n)))),N&&(U(N),U(x(e)),N=null)},V=function(e){C&&W&&(W(),W=!1)};this.show=function(){!0!==n&&(n=!0,I.show(),Field.eachCell(function(e,t){_[e][t].show(),w[e][t].show()}),e.redraw())},this.hide=function(){!1!==n&&(n=!1,I.hide(),Field.eachCell(function(e,t){_[e][t].hide(),w[e][t].hide()}),f.hide(),K&&K())};let J=function(e,t,i,n){t.x=e.x*DataPoints.BLOCK_WIDTH,t.y=e.y*DataPoints.BLOCK_HEIGHT;let o="",s=function(e){return!Field.isVisible(e)};o+=s({x:e.x-1,y:e.y})&&s({x:e.x,y:e.y-1})?"8px ":"0px ",o+=s({x:e.x,y:e.y-1})&&s({x:e.x+1,y:e.y})?"8px ":"0px ",o+=s({x:e.x+1,y:e.y})&&s({x:e.x,y:e.y+1})?"8px ":"0px ",o+=s({x:e.x,y:e.y+1})&&s({x:e.x-1,y:e.y})?"8px ":"0px ",t.borderRadius=o,DataPoints.objectImages[i]&&(t.backgroundImage=DataPoints.objectImages[i]),DataPoints.objectAnims[i]?(t.animPlayed=!0,t.animTracks=GUI.copyAnimTracks(DataPoints.objectAnims[i]),GUI.updateAnimTracks(t)):t.animPlayed=!1,void 0!==n&&(t.opacity=n),t.show(),t.redraw()};this.redraw=function(){if(!n)return;if(AnimLocker.busy())return;I.redraw();let e=0,t=0;Field.eachCell(function(i,n,o,s){let a,l,r;a=_[i][n],(l=w[i][n]).bindedDoms=null,o.isVisible?J({x:i,y:n},a,DataObjects.CELL_VISIBLE):a.hide(),o.isVisible&&(s.isGem||s.isSpiderAlpha||s.isBarrel||s.isPolyColor||s.isBlock)?J({x:i,y:n},l,s.objectId,""):l.hide(),o.isVisible&&s.isGem&&s.lightningId&&(r=L[t++],J({x:i,y:n},r,s.lightningId,.5),l.bindedDoms=r),o.isVisible&&s.isSpiderAlpha&&((r=L[t++]).backgroundImage=DataPoints.healthImages[s.health],J({x:i,y:n},r,"",""),l.bindedDoms=r),o.isVisible&&o.withGold&&(r=E[e++],J({x:i,y:n},r,DataObjects.OBJECT_GOLD,"")),o.isVisible&&o.withTile&&(r=E[e++],J({x:i,y:n},r,DataObjects.OBJECT_TILE,"")),o.isVisible&&s.withSpiderBeta&&(r=L[t++],J({x:i,y:n},r,DataObjects.OBJECT_SPIDER_BETA,""),l.bindedDoms=r),o.isVisible&&s.withSpiderGamma&&(r=L[t++],J({x:i,y:n},r,DataObjects.OBJECT_SPIDER_GAMMA,""),l.bindedDoms=r),o.isVisible&&s.withBox&&(r=L[t++],J({x:i,y:n},r,DataObjects.OBJECT_BOX,""),l.hide()),o.isVisible&&s.withChain&&(s.withChainA&&(r=L[t++],J({x:i,y:n},r,DataObjects.OBJECT_CHAIN_A,"")),s.withChainB&&(r=L[t++],J({x:i,y:n},r,DataObjects.OBJECT_CHAIN_B,"")))});for(let t=e;t<100;t++)E[t].hide();for(let e=t;e<100;e++)L[e].hide();g?J({x:g.x,y:g.y},f):f.hide()},this.setLayers=function(t){let i,n,o=function(e,t){let i;return i=[],e.forEach(function(e,n){i[n]=[],e.forEach(function(e,o){i[n][o]=t?t(e):e})}),i},s=[];t.special.forEach(function(e){s.push(o(e))}),Field.setLayers(o(t.mask),o(t.gems,function(e){return e===DataObjects.OBJECT_RANDOM?Field.getRandomGemId():e}),s),i={x:1/0,y:1/0},n={x:-1/0,y:-1/0},Field.eachCell(function(e,t,o){o.isVisible&&(i.x=Math.min(i.x,e),i.y=Math.min(i.y,t),n.x=Math.max(n.x,e),n.y=Math.max(n.y,t))}),b=n.x-i.x+1,y=n.y-i.y+1,P=i.x,S=i.y,e.x=e.centerX-DataPoints.BLOCK_WIDTH/2-(b-1)/2*DataPoints.BLOCK_WIDTH-P*DataPoints.BLOCK_WIDTH,e.y=e.centerY-DataPoints.BLOCK_HEIGHT/2-(y-1)/2*DataPoints.BLOCK_HEIGHT-S*DataPoints.BLOCK_HEIGHT+DataPoints.BLOCK_HEIGHT/2,I.x=e.x,I.y=e.y,this.redraw()},this.run=function(){if(!AnimLocker.busy())return e.hasProcesSpecialLayer()?e.processSpecialLayer():e.hasFall()?e.fall():e.hasDestroyLines()?e.destroyLines():e.hasNoTurns()?H():e.isFieldSilent()?Y():void 0};let K,Y=function(){e.onFieldSilent(),q()},q=function(){setTimeout(function(){if(console.log("tryShowHint",e.isFieldSilent(),!t,n,!K,!W,!i),e.isFieldSilent()&&!t&&n&&!K&&!W&&!i){let e=Field.countTurns();if(e.length){let t=Z(d,[e[0].a,e[0].b]);K=function(){K=null,t(),q()}}}},3*p.OnIdle.second)};this.isFieldSilent=function(){return!(AnimLocker.busy()||e.hasDestroyLines()||e.hasFall()||e.hasProcesSpecialLayer()||e.hasNoTurns())},this.hasProcesSpecialLayer=function(e){return Field.eachCell(function(t,i,n){e|=n.isEmitter&&n.object.isHole,e|=n.isVisible&&n.object.isBarrel&&!Field.isVisible({x:t,y:i+1})}),e},this.processSpecialLayer=function(){Field.eachCell(function(t,i,n){n.isEmitter&&Field.isHole({x:t,y:i})&&(Field.setObject({x:t,y:i},Field.getRandomGemId()),Field.isVisible({x:t,y:i})&&Z(r,{x:t,y:i})),n.isVisible&&n.object.isBarrel&&!Field.isVisible({x:t,y:i+1})&&(e.onDestroyThing(DataObjects.OBJECT_BARREL,n),Field.setObject({x:t,y:i},DataObjects.OBJECT_HOLE,!1),n.object.isBarrel=!1,Z(a,{x:t,y:i}))}),e.run()},this.hasFall=function(e=!1){return Field.eachCell(function(t,i){Field.mayFall(t,i)&&(e=!0)}),e},this.fall=function(){let t;if(AnimLocker.busy())return;let i=[];Field.eachCell(function(e,n){n=DataPoints.FIELD_MAX_HEIGHT-n-1,(t=Field.mayFall(e,n))&&(Field.exchangeObjects({x:e,y:n},t),w[e][n].bindedDoms&&(w[t.x][t.y]&&(w[t.x][t.y].bindedDoms=w[e][n].bindedDoms),w[e][n].bindedDoms=null),i.push({from:{x:e,y:n},to:t}))}),i.length?Z(c,i):(e.run(),e.redraw()),e.processSpecialLayer()},this.hasDestroyLines=function(){let e;return(e=Field.findLines()).length>0},this.destroyLines=function(){let t,i,n;(t=Field.findLines()).forEach(function(t){i=null,T&&Field.lineCrossing([t],T.a.x,T.a.y)&&(i=T.a),T&&Field.lineCrossing([t],T.b.x,T.b.y)&&(i=T.b),i&&(n=Field.getCell(i).object.objectId),t.coords.forEach(function(t){e.cellAttack(t)}),t.coords.length>3&&(i&&4===t.coords.length&&Field.setObject(i,n,t.orientation),i&&5===t.coords.length&&Field.setObject(i,DataObjects.OBJECT_POLY_COLOR,!1)),e.onDestroyLine(t)}),Z(u)},this.hasNoTurns=function(){return 0===Field.countTurns().length},this.lock=function(){t=!0},this.unlock=function(){t=!1},this.setStuffMode=function(t){g=null,C=!1,m=t,e.redraw()};this.cellAttack=function(t,i){let n,o;if(n=(o=(i=i||Field.getCell(t)).object).lightningId,i.isVisible&&(o.isGem||o.isPolyColor)&&o.isLineForming&&o.withChain)return o.withChainA&&o.withChainB?o.withChainB=!1:(o.withChainA=!1,o.withChainB=!1,Field.updateSomeFlags(o)),void Z(a,t);i.object.isPolyColor&&(e.onDestroyThing(DataObjects.OBJECT_POLY_COLOR,i),Field.setObject(t,DataObjects.OBJECT_HOLE,!1),Z(a,t)),i.isVisible&&o.isGem&&o.isLineForming&&!o.withChain&&(e.onDestroyThing(i.object.objectId,i),Field.setObject(t,DataObjects.OBJECT_HOLE,!1),Z(a,t),i.withGold&&(e.onDestroyThing(DataObjects.OBJECT_GOLD,i),i.withGold=!1,Z(a,t)),i.withTile&&(e.onDestroyThing(DataObjects.OBJECT_TILE,i),i.withTile=!1,Z(a,t)),i.object.withSpiderBeta&&(e.onDestroyThing(DataObjects.OBJECT_SPIDER_BETA,i),i.object.withSpiderBeta=!1,Z(a,t)),i.object.withSpiderGamma&&(e.onDestroyThing(DataObjects.OBJECT_SPIDER_GAMMA,i),i.object.withSpiderGamma=!1,Z(a,t)),Field.eachNears(t,function(t,i){var n,o;n=t,(o=i).object.isSpiderAlpha&&(o.object.health--,o.object.health?Z(a,n):(e.onDestroyThing(DataObjects.OBJECT_SPIDER_ALPHA,o),Field.setObject(n,DataObjects.OBJECT_HOLE),Z(a,n))),o.object.withBox&&!o.object.withChain&&(o.object.withBox=!1,e.onDestroyThing(DataObjects.OBJECT_BOX,o),Field.updateSomeFlags(o.object),Z(a,n)),o.object.withBox&&o.object.withChain&&(o.object.withChainA&&o.object.withChainB?o.object.withChainB=!1:(o.object.withChainA=!1,o.object.withChainB=!1),Field.updateSomeFlags(o.object),Z(a,n))}),n&&k(t,n))},this.getCoords=function(){return{x:e.x+P*DataPoints.BLOCK_WIDTH,y:e.y+(S-1)*DataPoints.BLOCK_HEIGHT,cellX:P,cellY:S}},this.lockHint=function(){i=!0,K&&(K(),q())},this.unlockHint=function(){i=!1,K&&(K(),q())},this.showHint=function(e){K&&K();let t=Z(d,e);return K=function(){K=null,t()}};let Z=function(t){let i;return(i=Array.from(arguments)).shift(),i.unshift({gemDoms:w,specDoms2:L,animDoms:D,onFinish:function(){t.name===d.name&&K&&K(),e.redraw(),e.run()}}),i.unshift(t),Animate.anim.apply(null,i)}},void 0!==window.ElementField&&(window.ElementField.__path="../client/components/application/gui_elements/ElementField.js"),ElementFriendsPanel=function(){let e=this,t=!1;this.x=0,this.y=0,this.cardWidth=50,this.cardHeight=50,this.cardSpace=10,this.cardsCount=6;let i=[],n=[],o=[];this.init=function(){for(let t=0;t<e.cardsCount;t++){let s;s=GUI.createDom(void 0,{x:e.x+t*(e.cardWidth+e.cardSpace),y:e.y,width:e.cardWidth,height:e.cardHeight,border:"2px solid #715f4b",borderRadius:"8px",background:"#aaa"}),GUI.bind(s,GUI.EVENT_MOUSE_CLICK,function(){i[t]||SocNet.openInviteFriendDialog()}),n.push(s),o.push(GUI.createElement(ElementText,{x:e.x+t*(e.cardWidth+e.cardSpace)+3,y:e.y+50-15,width:e.cardWidth,height:30/(100/e.cardWidth),alignCenter:!0,background:"#eee",opacity:.7,fontSize:12}))}},this.show=function(){t||(t=!0,n.forEach(function(e){e.show()}),o.forEach(function(e){e.show()}),e.redraw())},this.hide=function(){t&&(t=!1,n.forEach(function(e){e.hide()}),o.forEach(function(e){e.hide()}))},this.setFriends=function(e){i=e},this.redraw=function(){t&&(n.forEach(function(e,t){i[t]&&i[t].photo50?(e.backgroundImage=i[t].photo50,e.pointer=GUI.POINTER_ARROW):(e.backgroundImage="/images/friend-vacancy.png",e.pointer=GUI.POINTER_HAND),e.redraw()}),o.forEach(function(e,t){i[t]?(e.text="ур. "+i[t].nextPointId,e.show()):e.hide(),e.redraw()}))}},void 0!==window.ElementFriendsPanel&&(window.ElementFriendsPanel.__path="../client/components/application/gui_elements/ElementFriendsPanel.js"),ElementHealthTimer=function(){let e,t=this,i=!1;this.x=void 0,this.y=void 0,this.healthIndicator=null,this.init=function(){e=GUI.createElement(ElementText,{x:this.x,y:this.y,width:100,height:30,alignCenter:!0,bold:!0}),OnIdle.register(t.updateTimer)},this.show=function(){i||(i=!0,e.show(),t.redraw())},this.hide=function(){i&&(e.hide(),i=!1)},this.redraw=function(){i&&(e.setText("00:00:00"),t.updateTimer(),e.redraw())},this.updateTimer=function(){let o;i&&(o=LogicUser.getCurrentUser(),PageBlockPanel.oneHealthHide&&(o.fullRecoveryTime-=LogicHealth.getHealthRecoveryTime()),LogicHealth.isMaxHealths(o)?(PageBlockPanel.oneHealthHide&&(o.fullRecoveryTime+=LogicHealth.getHealthRecoveryTime()),t.healthIndicator.redraw(),e.hide()):(PageBlockPanel.oneHealthHide&&(o.fullRecoveryTime+=LogicHealth.getHealthRecoveryTime()),e.setText(n(LogicHealth.getTimeLeft(o))),e.show(),e.redraw(),t.healthIndicator.redraw()))};let n=function(e){let t=parseInt(e,10),i=Math.floor(t/3600),n=Math.floor((t-3600*i)/60),o=t-3600*i-60*n;return i<10&&(i="0"+i),n<10&&(n="0"+n),o<10&&(o="0"+o),n+":"+o}},void 0!==window.ElementHealthTimer&&(window.ElementHealthTimer.__path="../client/components/application/gui_elements/ElementHealthTimer.js"),ElementHealthIndicator=function(){let e,t=this,i=!1;this.x=0,this.y=0,this.init=function(){let t;e=[];for(let i=0;i<5;i++)t=GUI.createDom(null,{x:this.x+35*i,y:this.y-2,width:50,height:50,backgroundImage:"/images/health-heart.png"}),e.push(t)},this.show=function(){i||(i=!0,e.forEach(function(e){}),t.redraw())},this.hide=function(){i&&(i=!1,e.forEach(function(e){e.hide()}))},this.redraw=function(){let n,o,s,a;i&&(a=LogicUser.getCurrentUser(),PageBlockPanel.oneHealthHide&&(a.fullRecoveryTime-=LogicHealth.getHealthRecoveryTime()),s=1,n=LogicHealth.getHealths(a),o=35,n===LogicHealth.getMaxHealth()-1&&(o-=10),e.forEach(function(e){e.x=t.x+(s-1)*o,s<=n?e.show():e.hide(),e.redraw(),s++}),PageBlockPanel.oneHealthHide&&(a.fullRecoveryTime+=LogicHealth.getHealthRecoveryTime()))}},void 0!==window.ElementHealthsIndicator&&(window.ElementHealthsIndicator.__path="../client/components/application/gui_elements/ElementHealthsIndicator.js"),ElementImage=function(){let e=this,t=!1;this.x=0,this.y=0,this.width=0,this.height=0,this.src="/images/not-found.png",this.opacity=null,this.dom=null,this.pointer=void 0;let i=null;this.title=void 0,this.photoBorder=!1,this.init=function(){(i=GUI.createDom()).width=e.width,i.height=e.height,i.backgroundImage=e.src,this.photoBorder&&(i.border="2px solid rgba(68, 62, 0, 0.7)",i.borderRadius="8px"),e.dom=i},this.show=function(){!0!==t&&(t=!0,i.show(),e.redraw())},this.hide=function(){!1!==t&&(t=!1,i.hide())},this.redraw=function(){t&&(i.backgroundImage=e.src,null!=e.opacity&&(i.opacity=e.opacity),i.x=e.x,i.y=e.y,i.title=e.title,i.pointer=e.pointer,i.redraw())}},void 0!==window.ElementImage&&(window.ElementImage.__path="../client/components/application/gui_elements/ElementImage.js"),ElementPanelItems=function(){let e,t,i,n=this,o=!1;this.x=0,this.y=0,this.items=[];let s,a={},l={};this.title="",this.init=function(){let o;e=GUI.createElement(ElementImage,{x:n.x,y:n.y,src:"/images/panel-goals-1.png"}),t=GUI.createElement(ElementImage,{x:n.x,y:n.y,src:"/images/panel-goals-2.png"}),i=GUI.createElement(ElementImage,{x:n.x,y:n.y,src:"/images/panel-goals-3.png"}),s=GUI.createElement(ElementText,{x:n.x+15,y:n.y+7,width:80,text:n.title,fontSize:n.fontSize});for(let e in DataPoints.objectImages)o=GUI.createElement(ElementImage,{width:50,height:50,src:DataPoints.objectImages[e]}),a[e]=o,o=GUI.createElement(ElementText,{width:DataPoints.BLOCK_WIDTH,alignRight:!0}),l[e]=o},this.show=function(){if(!o){o=!0;for(let e in a)a[e].show();for(let e in l)l[e].show();s.show()}},this.hide=function(){if(o){o=!1;for(let e in a)a[e].hide();for(let e in l)l[e].hide();s.hide(),e.hide(),t.hide(),i.hide()}},this.redraw=function(){if(!o)return;for(let e in a)a[e].hide();for(let e in l)l[e].hide();switch(e.hide(),t.hide(),i.hide(),n.items.length){case 3:i.show();break;case 2:t.show();break;case 1:e.show()}let s;e.redraw(),t.redraw(),i.redraw(),s=0,n.items.forEach(function(e){a[e.id].x=n.x+15,a[e.id].y=n.y+46+s,a[e.id].show(),l[e.id].x=n.x-7+DataPoints.BLOCK_WIDTH,l[e.id].y=n.y+46+DataPoints.BLOCK_HEIGHT/2-10+s,l[e.id].setText(e.count),l[e.id].show(),s+=DataPoints.BLOCK_HEIGHT+5})}},void 0!==window.ElementPanelItems&&(window.ElementPanelItems.__path="../client/components/application/gui_elements/ElementPanelItems.js"),ElementPoint=function(){let e=this,t=!1;this.x=0,this.y=0,this.srcGrey="/images/map-way-point-grey.png",this.srcRed="/images/map-way-point-red.png",this.srcYellow="/images/map-way-point-yellow.png",this.srcStarOff="/images/star-off.png",this.srcStarOn="/images/star-on.png",this.onClick=null;let i=null,n=[],o=null,s=null,a=null,l=null,r=null,c=null,h=null,d=!1,g=!1;this.stateId=ElementPoint.STATE_CLOSE,this.pointId=null,this.pointWidth=50,this.init=function(){(i=GUI.createDom()).backgroundImage=e.srcGrey,i.pointer=GUI.POINTER_HAND,GUI.bind(i,GUI.EVENT_MOUSE_MOUSE_DOWN,p,e),GUI.bind(i,GUI.EVENT_MOUSE_CLICK,_,e),GUI.bind(i,GUI.EVENT_MOUSE_OVER,m,e),GUI.bind(i,GUI.EVENT_MOUSE_OUT,I,e),h=GUI.createElement(ElementText,{width:33,height:20,fontSize:15,pointer:GUI.POINTER_HAND},i),(o=GUI.createDom()).backgroundImage=e.srcStarOff,(s=GUI.createDom()).backgroundImage=e.srcStarOff,(a=GUI.createDom()).backgroundImage=e.srcStarOff,l=GUI.createDom(null,{height:24,width:24,border:"1px solid #715f4b",borderRadius:"2px"}),r=GUI.createDom(null,{height:24,width:24,border:"1px solid #715f4b",borderRadius:"2px"}),c=GUI.createDom(null,{height:24,width:24,border:"1px solid #715f4b",borderRadius:"2px"})},this.show=function(){t||(t=!0,e.redraw(),i.show(),o.show(),s.show(),a.show(),h.show())},this.hide=function(){t&&(t=!1,i.hide(),o.hide(),s.hide(),a.hide(),h.hide(),l.hide(),r.hide(),c.hide())},this.redraw=function(){if(t){switch(this.stateId){case ElementPoint.STATE_CLOSE:i.pointer=GUI.POINTER_ARROW,i.backgroundImage=this.srcGrey;break;case ElementPoint.STATE_CURRENT:i.pointer=GUI.POINTER_HAND,i.backgroundImage=this.srcRed;break;case ElementPoint.STATE_FINISHED:i.pointer=GUI.POINTER_HAND,i.backgroundImage=this.srcYellow}e.stateId===ElementPoint.STATE_CLOSE?i.pointer=GUI.POINTER_ARROW:i.pointer=GUI.POINTER_HAND,i.x=e.x,i.y=e.y,h.x=9,h.y=16.5,h.text=e.pointId?e.pointId.toString():"",u(),f(),i.redraw(),o.redraw(),s.redraw(),a.redraw(),h.redraw()}};let u=function(){let t,i,n;t=DataPoints.countStars(e.pointId),i=e.pointWidth/2-12.5,n=7,o.x=e.x-17+i,o.y=e.y-7,o.backgroundImage=t>=1?e.srcStarOn:e.srcStarOff,s.x=e.x+i,s.y=e.y-7-11,s.backgroundImage=t>=2?e.srcStarOn:e.srcStarOff,a.x=e.x+17+i,a.y=e.y-7,a.backgroundImage=t>=3?e.srcStarOn:e.srcStarOff},f=function(){let t,i,o=e.pointWidth/2-12-2,s=0,a=[l,r,c];e.y>250||1===DataMap.getNumberFromPointId(e.pointId)||18===DataMap.getNumberFromPointId(e.pointId)?(t=-38,i=5):(t=38,i=-5),l.x=e.x-18+o,l.y=e.y+t,r.x=e.x+o,r.y=e.y+t-i,c.x=e.x+19+o,c.y=e.y+t,n.forEach(function(e){e&&e&&e.photo50?(a[s].backgroundImage=e.photo50,a[s].show(),a[s].redraw()):a[s].hide(),s++})},m=function(){e.enabled&&(g=!0,e.redraw())},p=function(){e.enabled&&(d=!0,e.redraw())},I=function(){e.enabled&&(g=!1,e.redraw())},_=function(t,i){if(t.stopPropagation(),e.stateId!==ElementPoint.STATE_CLOSE)return d=!1,g=!1,e.redraw(),e.onClick.call(null,t,i,this)};this.setGamers=function(t){for(t=t.filter(function(t){return t.nextPointId===e.pointId}),1===(n=t.slice(0,3)).length&&n.unshift(null);n.length<3;)n.push(null)}},ElementPoint.STATE_CLOSE=1,ElementPoint.STATE_CURRENT=2,ElementPoint.STATE_FINISHED=3,void 0!==window.ElementPoint&&(window.ElementPoint.__path="../client/components/application/gui_elements/ElementPoint.js"),ElementSprite=function(){let e,t=this,i=!1;this.x=0,this.y=0,this.width=0,this.height=0,this.src="/images/not-found.png",this.opacity=null,this.dom=null,this.pointer=void 0,this.title=void 0,this.animPlay=function(){e.animPlayed=!0},this.init=function(){(e=GUI.createDom(void 0,t.domInitParams)).width=t.width,e.height=t.height,e.x=t.x,e.y=t.y,e.backgroundImage=t.src,t.dom=e},this.show=function(){!0!==i&&(i=!0,e.show(),t.redraw())},this.hide=function(){!1!==i&&(i=!1,e.hide())},this.redraw=function(){i&&(null!=t.opacity&&(e.opacity=t.opacity),e.title=t.title,e.pointer=t.pointer,e.redraw())}},void 0!==window.ElementSprite&&(window.ElementSprite.__path="../client/components/application/gui_elements/ElementSprite.js"),ElementStuffButton=function(){let e=this,t=!1;this.x=0,this.y=0,this.width=0,this.height=0,this.srcHover="/path/to/image/hover.png",this.srcActive="/path/to/image/active.png",this.srcRest="path/to/image/rest1.png",this.onClick=null,this.title=null,this.enabled=!0;let i=null,n=null,o=!1,s=!1;this.init=function(){(i=GUI.createDom()).width=e.width,i.height=e.height,i.backgroundImage=e.srcRest,i.pointer=GUI.POINTER_HAND,GUI.bind(i,GUI.EVENT_MOUSE_MOUSE_DOWN,l,e),GUI.bind(i,GUI.EVENT_MOUSE_CLICK,c,e),GUI.bind(i,GUI.EVENT_MOUSE_OVER,a,e),GUI.bind(i,GUI.EVENT_MOUSE_OUT,r,e),n=GUI.createElement(ElementText,{})},this.show=function(){1!=t&&(t=!0,i.show(),n.show(),e.redraw())},this.hide=function(){0!=t&&(t=!1,i.hide(),n.hide())},this.redraw=function(){let a;t&&(a=e.srcRest,s&&(a=e.srcHover),s&&o&&(a=e.srcActive),!s&&o&&(a=e.srcRest),i.backgroundImage=a,e.title&&(i.title=e.title),e.enabled?(i.pointer=GUI.POINTER_HAND,i.opacity=1):(i.pointer=GUI.POINTER_ARROW,i.opacity=.5),i.x=e.x,i.y=e.y,n.x=e.x+70,n.y=e.y+40,n.setText(LogicStuff.getStuff(e.fieldName)),i.redraw(),n.redraw())};let a=function(){e.enabled&&(s=!0,e.redraw())},l=function(){e.enabled&&(o=!0,e.redraw())},r=function(){e.enabled&&(s=!1,e.redraw())},c=function(t,i){if(t.stopPropagation(),e.enabled)return o=!1,s=!1,e.redraw(),e.onClick.call(null,t,i)}},void 0!==window.ElementStuffButton&&(window.ElementStuffButton.__path="../client/components/application/gui_elements/ElementStuffButton.js"),ElementText=function(){let e=this,t=!1;this.x=void 0,this.y=void 0,this.width=void 0,this.height=void 0,this.text="";let i=null;this.pointer=GUI.POINTER_ARROW,this.fontSize=18,this.bold=!0,this.alignCenter=!0,this.alignRight=!1,this.opacity=void 0,this.textDecoration=void 0,this.init=function(){(i=GUI.createDom(void 0,{height:this.height,color:this.color?this.color:"rgba(103, 77, 56, 1.0)",background:this.background,fontFamily:'arial,sans-serif,"Marvin",Tahoma,"Geneva CY",sans-serif'})).__dom.style.zIndex=this.zIndex,GUI.bind(i,GUI.EVENT_MOUSE_CLICK,o,e)},this.show=function(){t||(t=!0,i.show(),e.redraw())},this.hide=function(){t&&(t=!1,i.hide())},this.setText=function(t){"string"!=typeof t&&(t=t.toString()),e.text=t},this.redraw=function(){t&&(n(),i.x=e.x,i.y=e.y,i.fontSize=e.fontSize,i.opacity=e.opacity,i.width=e.width,i.textDecoration=e.textDecoration,e.bold?i.fontWeight="bold":i.fontWeight="normal",e.alignCenter&&(i.alignText="center"),e.alignRight&&(i.alignText="right"),i.redraw())};let n=function(){let t,n;t="";for(let i in e.text){let o=e.text[i];10!=(n=e.text.charCodeAt(i))?t+=o:t+="<br>"}i.innerHTML=t,i.pointer=e.pointer},o=function(t,i){if(e.onClick)return t.stopPropagation(),e.onClick.call(this,t,i)}},void 0!==window.ElementText&&(window.ElementText.__path="../client/components/application/gui_elements/ElementText.js"),ElementUserScorePhoto=function(){let e,t,i,n=this,o=!1;this.x=0,this.y=0,this.user=null,this.score=null,this.init=function(){i=GUI.createElement(ElementText,{x:n.x-25,y:n.y-22,width:100,height:50,fontSize:12,alignCenter:!0}),e=GUI.createElement(ElementImage,{x:n.x,y:n.y,width:50,height:50,photoBorder:!0}),t=GUI.createElement(ElementText,{x:n.x-25,y:n.y+61,width:100,height:50,fontSize:12,alignCenter:!0})},this.show=function(){!0!==o&&(o=!0,i.show(),e.show(),t.show(),n.redraw())},this.hide=function(){!1!==o&&(o=!1,i.hide(),e.hide(),t.hide())},this.redraw=function(){o&&this.user&&this.user.id&&(i.text=this.user.firstName,e.src=this.user.photo50,t.text=this.score.toString(),i.redraw(),e.redraw(),t.redraw())}},void 0!==window.ElementUserScorePhoto&&(window.ElementUserScorePhoto.__path="../client/components/application/gui_elements/ElementUserScorePhoto.js"),LogicField=function(){let e=this,t=null,i=[DataObjects.OBJECT_RED,DataObjects.OBJECT_GREEN,DataObjects.OBJECT_BLUE,DataObjects.OBJECT_YELLOW,DataObjects.OBJECT_PURPLE,DataObjects.OBJECT_SAND],n=[DataObjects.OBJECT_RED,DataObjects.OBJECT_GREEN,DataObjects.OBJECT_BLUE,DataObjects.OBJECT_YELLOW,DataObjects.OBJECT_PURPLE],o=[DataObjects.OBJECT_RED,DataObjects.OBJECT_GREEN,DataObjects.OBJECT_BLUE,DataObjects.OBJECT_YELLOW,DataObjects.OBJECT_PURPLE,DataObjects.OBJECT_SAND,DataObjects.OBJECT_POLY_COLOR,DataObjects.OBJECT_BARREL,DataObjects.OBJECT_SPIDER_ALPHA];this.getCell=function(i){return!e.isOut(i)&&t[i.x][i.y]},this.getObject=function(e){return this.getCell(e).object},this.isGem=function(e){return!(!t[e.x]||!t[e.x][e.y])&&t[e.x][e.y].object.isGem},this.isNotGem=function(t){return!e.isGem(t)},this.isHole=function(e){return!(!t[e.x]||!t[e.x][e.y])&&t[e.x][e.y].object.isHole},this.isFallObject=function(i){return!e.isOut(i)&&-1!==o.indexOf(t[i.x][i.y].object.objectId)},this.mayFall=function(t,i){return!e.isOut({x:t,y:i})&&(!!LogicField.getCell({x:t,y:i}).object.isCanMoved&&(LogicField.isFallObject({x:t,y:i})&&s({x:t,y:i})))};let s=function(t){for(let i,n,o=0;o<DataPoints.FIELD_MAX_HEIGHT&&(t.y++,n=(i=e.getCell(t))&&i.object,!i||!i.isVisible||n.isHole||n.withBox);o++)if(i&&i.isVisible&&n.isHole)return t;return!1};this.getRandomGemId=function(){return n[Math.floor(Math.random()*n.length)]},this.isVisible=function(e){return!(!t[e.x]||!t[e.x][e.y])&&t[e.x][e.y].isVisible},this.countTurns=function(){let t,i,n,o,s,a=[],l=function(l,r){o=e.getCell(l),s=e.getCell(r),o&&s&&(i=o.object,n=s.object,o.isVisible&&i.isCanMoved&&s.isVisible&&n.isCanMoved&&(e.exchangeObjects(l,r),(t=e.findLines()).length&&a.push({a:l,b:r,lines:t}),e.exchangeObjects(l,r)))};return this.eachCell(function(e,t){l({x:e,y:t},{x:e+1,y:t}),l({x:e,y:t},{x:e,y:t+1})}),a},this.exchangeObjects=function(i,n,o){let s;return!e.isOut(i)&&!e.isOut(n)&&(o?(s=t[n.x][n.y].object.objectId,t[n.x][n.y].object.objectId=t[i.x][i.y].object.objectId,t[i.x][i.y].object.objectId=s):(s=t[n.x][n.y].object,t[n.x][n.y].object=t[i.x][i.y].object,t[i.x][i.y].object=s),!0)},this.isOut=function(e){return e.x<0||e.x>=DataPoints.FIELD_MAX_WIDTH||e.y<0||e.y>DataPoints.FIELD_MAX_HEIGHT},this.isNear=function(e,t){return 1===Math.abs(e.x-t.x)&&e.y-t.y==0||e.x-t.x==0&&1===Math.abs(e.y-t.y)},this.findLines=function(){let e,t;t=[];for(let i=0;i<DataPoints.FIELD_MAX_HEIGHT;i++)for(let n=0;n<DataPoints.FIELD_MAX_WIDTH;n++)this.lineCrossing(t,n,i)||((e=this.findLine(n,i,DataObjects.WITH_LIGHTNING_VERTICAL))&&t.push(e),(e=this.findLine(n,i,DataObjects.WITH_LIGHTNING_HORIZONTAL))&&t.push(e));return t},this.findLine=function(t,i,n){let o,s,a;if(a=e.getCell({x:t,y:i}),o=a.object.objectId,!a.isVisible||!a.object.isLineForming)return!1;s={orientation:n,coords:[],gemId:o};let l=function(t){return!!((a=e.getCell(t))&&a.isVisible&&a.object.isLineForming&&a.object.objectId===o)&&s.coords.push(t)};if(n===DataObjects.WITH_LIGHTNING_HORIZONTAL)for(let e=0;e<5&&l({x:t+e,y:i});e++);else for(let e=0;e<5&&l({x:t,y:i+e});e++);return s.coords.length>=3&&s},this.lineCrossing=function(e,t,i){for(let n in e)for(let o in e[n].coords)if(t===e[n].coords[o].x&&i===e[n].coords[o].y)return!0;return!1},this.eachCell=function(e){for(let i=0;i<DataPoints.FIELD_MAX_HEIGHT;i++)for(let n=0;n<DataPoints.FIELD_MAX_WIDTH;n++)e(n,i,t&&t[n][i],t&&t[n][i].object)},this.setObject=function(n,o,s){let a;(a=t[n.x][n.y].object).objectId=o,a.isHole=o===DataObjects.OBJECT_HOLE,a.isGem=-1!==i.indexOf(o),a.lightningId=s,a.isPolyColor=o===DataObjects.OBJECT_POLY_COLOR,a.isBarrel=o===DataObjects.OBJECT_BARREL,a.isBlock=o===DataObjects.OBJECT_BLOCK,a.isSpiderAlpha=o===DataObjects.OBJECT_SPIDER_ALPHA,e.updateSomeFlags(a)},this.updateSomeFlags=function(e){e.withChain=e.withChainA||e.withChainB,e.isCanMoved=(e.isGem||e.isBarrel||e.isPolyColor)&&!e.withBox&&!e.withChain,e.isLineForming=e.isGem&&!e.withBox},this.getGemId=function(e){return t[e.x]&&t[e.x][e.y].object.objectId},this.setLayers=function(n,o,s){let l,r,c;t=[],console.log(o);for(let h=0;h<DataPoints.FIELD_MAX_WIDTH;h++){t[h]=[];for(let d=0;d<DataPoints.FIELD_MAX_HEIGHT;d++){let g,u;r=!1,-1!==(l=a({x:h,y:d},s)).indexOf(DataObjects.WITH_LIGHTNING_HORIZONTAL)&&(r=DataObjects.WITH_LIGHTNING_HORIZONTAL),-1!==l.indexOf(DataObjects.WITH_LIGHTNING_VERTICAL)&&(r=DataObjects.WITH_LIGHTNING_VERTICAL),-1!==l.indexOf(DataObjects.WITH_LIGHTNING_CROSS)&&(r=DataObjects.WITH_LIGHTNING_CROSS),c=o[h]&&o[h][d],-1!==l.indexOf(DataObjects.OBJECT_BARREL)&&(c=DataObjects.OBJECT_BARREL),-1!==l.indexOf(DataObjects.OBJECT_SPIDER_ALPHA)&&(c=DataObjects.OBJECT_SPIDER_ALPHA),-1!==l.indexOf(DataObjects.OBJECT_SAND)&&(c=DataObjects.OBJECT_SAND),-1!==l.indexOf(DataObjects.OBJECT_BLOCK)&&(c=DataObjects.OBJECT_BLOCK),i.forEach(function(e){-1!==l.indexOf(e)&&(c=e,console.log(e))}),c||(c=Field.getRandomGemId()),g={object:u={},x:h,y:d},t[h][d]=g,g.isVisible=n[h]&&n[h][d]&&n[h][d]===DataObjects.CELL_VISIBLE,g.isEmitter=-1!==l.indexOf(DataObjects.IS_EMITTER),c===DataObjects.OBJECT_SPIDER_ALPHA&&(u.health=3),g.withGold=-1!==l.indexOf(DataObjects.OBJECT_GOLD),g.withTile=-1!==l.indexOf(DataObjects.OBJECT_TILE),u.withBox=-1!==l.indexOf(DataObjects.OBJECT_BOX),u.withChainA=-1!==l.indexOf(DataObjects.OBJECT_CHAIN_A),u.withChainB=-1!==l.indexOf(DataObjects.OBJECT_CHAIN_B),u.withSpiderBeta=-1!==l.indexOf(DataObjects.OBJECT_SPIDER_BETA),u.withSpiderGamma=-1!==l.indexOf(DataObjects.OBJECT_SPIDER_GAMMA),e.setObject({x:h,y:d},c,r)}}console.log("find lines",Field.findLines().length),Field.findLines().length&&Field.shuffle(!0)},this.eachNears=function(t,i){[{x:t.x+1,y:t.y},{x:t.x-1,y:t.y},{x:t.x,y:t.y+1},{x:t.x,y:t.y-1}].forEach(function(t){!e.isOut(t)&&e.isVisible(t)&&i(t,e.getCell(t))})};let a=function(e,t){return t[e.x]&&t[e.x][e.y]?t[e.x][e.y]:[]};this.isLinePossiblyDestroy=function(e,t){let i,n;return LogicField.exchangeObjects(e,t),i=LogicField.findLines(),n=LogicField.lineCrossing(i,e.x,e.y)|LogicField.lineCrossing(i,t.x,t.y),LogicField.exchangeObjects(e,t),n},this.eachVisibleLine=function(t,i,n){let o=[],s=function(t,i){(i=e.getCell(t)).isVisible&&o.push({p:t,cell:i})};switch(i){case DataObjects.WITH_LIGHTNING_HORIZONTAL:for(let e=0;e<DataPoints.FIELD_MAX_WIDTH;e++)s({x:e,y:t.y});break;case DataObjects.WITH_LIGHTNING_VERTICAL:for(let e=0;e<DataPoints.FIELD_MAX_HEIGHT;e++)s({x:t.x,y:e});break;default:Logs.log("Error :"+arguments.callee.name,Logs.LEVEL_ERROR)}o.sort(function(e,t){return e.cell.object.isCanMoved&&!t.cell.object.isCanMoved?1:!e.cell.object.isCanMoved&&t.cell.object.isCanMoved?-1:0}),o.forEach(function(e){n(e.p,e.cell)})},this.getVisibleLength=function(e,t){let i=1/0,n=-1/0;switch(t){case DataObjects.WITH_LIGHTNING_HORIZONTAL:for(let t=0;t<DataPoints.FIELD_MAX_WIDTH;t++)Field.isVisible({x:t,y:e.y})&&(i=Math.min(i,t),n=Math.max(n,t));return{lower:i,higher:n,length:n-i+1};case DataObjects.WITH_LIGHTNING_VERTICAL:for(let t=0;t<DataPoints.FIELD_MAX_HEIGHT;t++)Field.isVisible({x:e.x,y:t})&&(i=Math.min(i,t),n=Math.max(n,t));return{lower:i,higher:n,length:n-i+1}}};let l=0;this.shuffle=function(t){l++;let i,n=function(){let e,i,n;Field.eachCell(function(o,s,a){let l,r;e={x:o,y:s},i={x:Math.floor(Math.random()*DataPoints.FIELD_MAX_WIDTH),y:Math.floor(Math.random()*DataPoints.FIELD_MAX_HEIGHT)},n=Field.getCell(i),l=a.object,r=n.object,a.isVisible&&l.isCanMoved&&!l.isBarrel&&l.objectId!==DataObjects.OBJECT_SAND&&n.isVisible&&r.isCanMoved&&!r.isBarrel&&r.objectId!==DataObjects.OBJECT_SAND&&Field.exchangeObjects(e,i,t)})};for(n(),i=0;i++<50&&0!==Field.findLines().length;)n();if(i=0,Field.findLines().length>0&&t&&l++<1e3){for(;i++<50&&(Field.eachCell(function(t,i,n){n.isVisible&&n.object.isGem&&n.object.objectId!==DataObjects.OBJECT_SAND&&(n.object.objectId=e.getRandomGemId())}),0!==Field.findLines().length););e.shuffle(!0)}else l=0}},LogicField=new LogicField,Field=LogicField,void 0!==window.LogicField&&(window.LogicField.__path="../client/components/application/logic/LogicField.js"),LogicHealth=function(){let e=function(){return"undefined"!=typeof LogicTimeClient?LogicTimeClient.getTime():LogicTimeServer.getTime()};this.getMaxHealth=function(){return DataCross.user.maxHealth},this.getHealthRecoveryTime=function(){return DataCross.user.healthRecoveryTime},this.getHealths=function(t){let i,n,o,s;return i=t.fullRecoveryTime,n=e(),o=LogicHealth.getHealthRecoveryTime(),(s=i-n)<=0?this.getMaxHealth():Math.max(0,this.getMaxHealth()-Math.ceil(s/o))},this.isMaxHealths=function(e){return this.getHealths(e)===this.getMaxHealth()},this.setMaxHealth=function(t){t.fullRecoveryTime=e()},this.decrementHealth=function(e,t){t||(t=1),LogicHealth.isMaxHealths(e)&&LogicHealth.setMaxHealth(e),0===LogicHealth.getHealths(e)&&LogicHealth.zeroLife(e),e.fullRecoveryTime+=this.getHealthRecoveryTime()*t},this.getTimeLeft=function(t){let i;return this.isMaxHealths(t)?0:(i=t.fullRecoveryTime-e())-Math.floor(i/this.getHealthRecoveryTime())*this.getHealthRecoveryTime()},this.zeroLife=function(t){t.fullRecoveryTime=e()+this.getHealthRecoveryTime()*this.getMaxHealth()}},LogicHealth=new LogicHealth,void 0!==window.LogicHealth&&(window.LogicHealth.__path="components/application/logic/LogicHealth.js"),LogicMain=function(){this.main=function(){Logs.init(function(){}),SocNet.init(),webSocketClient=new WebSocketClient,webSocketClient.init(function(){}),ApiRouter.setMap({CAPIUser:CAPIUser,CAPITimeServer:CAPITimeServer,CAPIMap:CAPIMap,CAPIStuff:CAPIStuff}),ApiRouter.sendData=webSocketClient.sendData,webSocketClient.onData=ApiRouter.onData,webSocketClient.onConnect=this.onConnect,webSocketClient.onDisconnect=ApiRouter.onDisconnect,webSocketClient.run(),OnIdle.init(function(){})},this.onConnect=function(e){ApiRouter.onConnect(e),LogicUser.authorize()},this.onAuthorizeSuccess=function(){DataMap.setCurrentMapId(DataMap.getMapIdFromPointId(LogicUser.getCurrentUser().nextPointId)),SAPITimeServer.sendMeTime(),LogicStuff.loadStuff(),PageController.showPage(PageMain),LogicWizard.onAuthorizeSuccess()}},void 0!==window.LogicMain&&(window.LogicMain.__path="../client/components/application/logic/LogicMain.js"),LogicMap=function(){this.onArrowPrevClick=function(){DataMap.setPrevMap(),PageController.redraw()},this.onArrowNextClick=function(){DataMap.setNextMap(),PageController.redraw()}},LogicMap=new LogicMap,void 0!==window.LogicMap&&(window.LogicMap.__path="../client/components/application/logic/LogicMap.js"),LogicStuff=function(){let e={};this.STUFF_HUMMER=1,this.STUFF_LIGHTNING=2,this.STUFF_SHUFFLE=3,this.loadStuff=function(){SAPIStuff.sendMeStuff()},this.updateStuff=function(t){e=t},this.getStuff=function(t){return t?(void 0===e[t]&&Logs.log("No Stuff:",Logs.LEVEL_FATAL_ERROR,[t,e]),e[t]):e},this.usedHummer=function(){e.hummerQty--},this.usedShuffle=function(){e.shuffleQty--},this.usedlightning=function(){e.lightningQty--},this.usedGold=function(t){e.goldQty-=t},this.giveAHummer=function(t){e.hummerQty+=t},this.giveAShuffle=function(t){e.shuffleQty+=t},this.giveALighnting=function(t){e.lightningQty+=t},this.giveAGold=function(t){e.goldQty+=t},this.giveAHealth=function(e){let t;t=LogicUser.getCurrentUser(),LogicHealth.decrementHealth(t,-e)}},LogicStuff=new LogicStuff,void 0!==window.LogicStuff&&(window.LogicStuff.__path="../client/components/application/logic/LogicStuff.js"),LogicTimeClient=function(){let e=0,t=0,i=0;this.setServerTime=function(n){e=n,t=(new Date).getTime(),i=e-t,Logs.log("Time sync:"+n+" gotTime:"+t+" timeDiff:"+i,Logs.LEVEL_DETAIL)},this.getTime=function(){return Math.floor(this.getMicroTime()/1e3)},this.getMicroTime=function(){return(new Date).getTime()+i},this.convertToClient=function(e){let t;return(t=1e3*e-i)/1e3}},LogicTimeClient=new LogicTimeClient,void 0!==window.LogicTimeClient&&(window.LogicTimeClient.__path="../client/components/application/logic/LogicTimeClient.js"),LogicUser=function(){let e=this,t=null,i=[],n=null;this.authorize=function(){let e,t;switch(e=SocNet.getSocNetUserId(),t=SocNet.getAuthParams(),SocNet.getType()){case SocNet.TYPE_VK:SAPIUser.authorizeByVK(e,t);break;case SocNet.TYPE_STANDALONE:SAPIUser.authorizeByStandalone(e,t);break;default:Logs.log("Wrong soc net type",Logs.LEVEL_FATAL_ERROR)}},this.authorizeSuccess=function(e){t=e,s={},LogicMain.onAuthorizeSuccess()},this.isAuthorized=function(){return!!t},this.getCurrentUser=function(){return this.getById(t)},this.getById=function(t){return i[t]?i[t]:(e.loadUserInfoById(t),o())},this.getList=function(t){let n,o;return n=[],t&&t.length?(o=[],t.forEach(function(e){i[e]||s[e]||(s[e]=!0,i[e]=!1,o.push(e))}),o.length&&SAPIUser.sendMeUserListInfo(o),t.forEach(function(t){e.getById(t).photo50&&n.push(e.getById(t))}),n):n};let o=function(){return{id:null,online:!1}},s={};this.loadUserInfoById=function(e){null!==t&&(s[e]||(s[e]=!0,SAPIUser.sendMeUserInfo(e)))},this.updateUserInfo=function(e){s[e.id]=!1,i[e.id]||(i[e.id]=o());for(let t in e)i[e.id][t]=e[t];i[e.id].photo50||SocNet.getUserInfo(e.socNetUserId,function(t){i[e.id].photo50=t[0].photo_50,i[e.id].photo100=t[0].photo_100,i[e.id].firstName=t[0].first_name,i[e.id].lastName=t[0].last_name,PageController.redraw()}),PageController.redraw()},this.setFriendIds=function(e){n=e,PageController.redraw()};let a=!1;this.getFriendIds=function(e){return n||a?n?e?n.slice(0,e):n:null:(a=!0,SocNet.getFriendIds(function(e){SAPIUser.sendMeUserIdsBySocNet(e)}),null)},this.getMapFriendIds=function(e){let t;return this.getFriendIds()&&(t=DataPoints.getPointsByMapId(e),n.forEach(function(e){})),null};let l=[];this.getFriendIdsByMapId=function(e){let t,i,o;return this.getFriendIds()?(i=DataMap.getFirstPointId(),t=DataMap.getLastPointId(),o=this.getList(n).filter(function(e){return e.nextPointId>=i&&e.nextPointId<=t}).map(function(e){return e.id}),function(e){e||(e=currentMapId),LogicUser.getFriendIds()&&(l[e]||(l[e]=!0,SAPIMap.sendMeUsersScore(e,LogicUser.getFriendIds())))}(e),o):[]},this.getFriendIdsByMapIdAndPointIdWithScore=function(e,t,i){let n,o,s,a;return s=[],n=LogicUser.getFriendIdsByMapId(e),a=LogicUser.getCurrentUser().id,i&&n.push(a),n&&(o=LogicUser.getList(n)),o&&(s=o.filter(function(e,n){return!(!i&&a===e.id)&&(o.indexOf(e)===n&&e.nextPointId>=t)}).sort(function(e,t){return t.lastLoginTimestamp-e.lastLoginTimestamp}).map(function(e){return e})),s}},LogicUser=new LogicUser,LU=LogicUser,void 0!==window.LogicUser&&(window.LogicUser.__path="../client/components/application/logic/LogicUser.js"),LogicWizard=function(){let e=this,t=function(){};this.TAG_FIRST_NUMBER_POINT=1,this.onClick=t,this.onDestroyThing=t,this.onDestroyLine=t,this.onShowDialog=t,this.onHideDialog=t,this.onFieldSilent=t,this.onAuthorizeSuccess=function(){1===LogicUser.getCurrentUser().nextPointId&&e.start(WizardFirstStart_1)},this.onFieldFirstShow=function(){let t=LogicUser.getCurrentUser().nextPointId,i=DataPoints.getPlayedId();2===t&&2===i&&e.start(WizardLevel2_1),3===t&&3===i&&e.start(WizardLevel3_1),4===t&&4===i&&e.start(WizardLevel_4_1),9===t&&9===i&&e.start(WizardLevel9_1),12===t&&12===i&&e.start(WizardLevel12_1),15===t&&15===i&&e.start(WizardLevel14_1),23===t&&23===i&&e.start(WizardLevel23_1),41===t&&41===i&&e.start(WizardLevel_41_1),46===t&&46===i&&e.start(WizardLevel46_1),51===t&&51===i&&e.start(WizardLevel51_1)},this.start=function(i){PBWizard.reset(),i.dialogCounter=0,e.onClick=i.onClick?i.onClick:t,e.onDestroyThing=i.onDestroyThing?i.onDestroyThing:t,e.onDestroyLine=i.onDestroyLine?i.onDestroyLine:t,e.onShowDialog=i.onShowDialog?i.onShowDialog:t,e.onHideDialog=i.onHideDialog?i.onHideDialog:t,e.onFieldSilent=i.onFieldSilent?i.onFieldSilent:t,i.init()},this.finish=function(){PBWizard.finish(),e.onClick=t,e.onDestroyThing=t,e.onDestroyLine=t,e.onShowDialog=t,e.onHideDialog=t,e.onFieldSilent=t}},LogicWizard=new LogicWizard,void 0!==window.LogicWizard&&(window.LogicWizard.__path="../client/components/application/logic/LogicWizard.js"),PageBlockBackground=function(){let e=this,t=!1;this.elements=[],this.init=function(){let t;t=GUI.createElement(ElementImage,{x:-15,y:-15,src:"/images/fs-frame.png"}),e.elements.push(t),t=GUI.createElement(ElementImage,{x:0,y:0,src:"/images/old-paper.png"}),e.elements.push(t),i()},this.show=function(){if(!0!==t){t=!0,e.preset();for(let t in e.elements)e.elements[t].show();e.redraw()}},this.hide=function(){if(!1!==t){t=!1;for(let t in e.elements)e.elements[t].hide()}},this.preset=function(){},this.redraw=function(){if(t){e.preset();for(let t in e.elements)e.elements[t].redraw()}};let i=function(){let e,t;e=document.getElementsByTagName("body")[0],t="url('"+Images.getPath("/images/old-paper.png")+"')",e.style.backgroundImage=t}},PageBlockBackground=new PageBlockBackground,void 0!==window.PageBlockBackground&&(window.PageBlockBackground.__path="../client/components/application/page_blocks/PageBlockBackground.js"),PageBlockField=function(){let e,t,i,n,o=this,s=!1,a=null,l=null,r=null,c=null,h=null,d=null,g=null,u=null,f=null,m=null,I=null,_=null,E=null;this.elements=[],this.init=function(){let t,n,s,w;w=37,a=GUI.createElement(ElementField,{centerX:388.5,centerY:250,onDestroyLine:o.onDestroyLine,onDestroyThing:o.onDestroyThing,beforeTurnUse:o.beforeTurnUse,beforeStuffUse:o.beforeStuffUse,onFieldSilent:o.onFieldSilent}),o.elements.push(a),t=GUI.createElement(ElementButton,{x:730,y:10,srcRest:"/images/button-quit-rest.png",srcHover:"/images/button-quit-hover.png",srcActive:"/images/button-quit-active.png",onClick:function(){0===i?PBZDialogs.dialogTurnsLoose.reset():PBZDialogs.dialogJustQuit.showDialog()}}),o.elements.push(t),n=635,s=95,t=GUI.createElement(ElementImage,{x:n,y:s,src:"/images/panel-turns.png"}),o.elements.push(t),t=GUI.createElement(ElementText,{x:n,y:s+6,width:112,text:"УРОВЕНЬ",alignCenter:!0}),o.elements.push(t),g=GUI.createElement(ElementText,{x:n,y:s+37,width:112,alignCenter:!0}),o.elements.push(g),n=15,s=160,t=GUI.createElement(ElementImage,{x:n,y:s,src:"/images/panel-score.png"}),o.elements.push(t),t=GUI.createElement(ElementText,{x:n,y:s+6,width:112,text:"ОЧКИ",alignCenter:!0}),o.elements.push(t),l=GUI.createElement(ElementText,{x:n,y:s+37,width:112,alignCenter:!0}),o.elements.push(l),r=GUI.createDom(void 0,{x:n+15,y:s+62}),o.elements.push(r),c=GUI.createDom(void 0,{x:n+15+27,y:s+62}),o.elements.push(c),h=GUI.createDom(void 0,{x:n+15+54,y:s+62}),o.elements.push(h),n=15,s=75,t=GUI.createElement(ElementImage,{x:n,y:s,src:"/images/panel-turns.png"}),o.elements.push(t),t=GUI.createElement(ElementText,{x:n,y:s+6,width:112,text:"ХОДЫ",alignCenter:!0,fontSize5:18}),o.elements.push(t),d=GUI.createElement(ElementText,{x:n,y:s+37,width:112,alignCenter:!0}),o.elements.push(d),n=15,s=260,e=GUI.createElement(ElementPanelItems,{x:n,y:s,title:"ЦЕЛИ",fontSize:18}),o.elements.push(e),s=200,t=GUI.createElement(ElementStuffButton,{x:650,y:s,fieldName:"hummerQty",srcRest:"/images/button-hummer-rest.png",srcHover:"/images/button-hummer-hover.png",srcActive:"/images/button-hummer-active.png",onClick:function(){o.setStuffMode(LogicStuff.STUFF_HUMMER)}}),o.elements.push(t),t=GUI.createElement(ElementStuffButton,{x:650,y:s+80,fieldName:"lightningQty",srcRest:"/images/button-lightning-rest.png",srcHover:"/images/button-lightning-hover.png",srcActive:"/images/button-lightning-active.png",onClick:function(){o.setStuffMode(LogicStuff.STUFF_LIGHTNING)}}),o.elements.push(t),t=GUI.createElement(ElementStuffButton,{x:650,y:s+160,fieldName:"shuffleQty",srcRest:"/images/button-shuffle-rest.png",srcHover:"/images/button-shuffle-hover.png",srcActive:"/images/button-shuffle-active.png",onClick:function(){o.setStuffMode(LogicStuff.STUFF_SHUFFLE)}}),o.elements.push(t),_=GUI.createElement(ElementButton,{x:312,y:5,width:25,height:25,srcRest:"/images/button-reload-field-rest.png",srcHover:"/images/button-reload-field-hover.png",srcActive:"/images/button-reload-field-active.png",onClick:function(){AnimLocker.lock(),CAPIMap.setCallbackOnMapsInfo(function(){PageController.showPage(PageMain),PageController.showPage(PageField),AnimLocker.release(),PageController.redraw()}),SAPIMap.reloadLevels(),SAPIMap.sendMeMapInfo(DataMap.getCurent().id)}}),E=GUI.createElement(ElementButton,{x:342,y:5,width:25,height:25,srcRest:"/images/field-red.png",srcHover:"/images/field-red.png",srcActive:"/images/field-red.png",onClick:function(){switch(p.OnIdle.animStep){case 5:E.srcRest="/images/field-yellow.png",p.OnIdle.animStep=1;break;case 1:E.srcRest="/images/field-red.png",p.OnIdle.animStep=.2;break;case.2:E.srcRest="/images/field-green.png",p.OnIdle.animStep=5;break;default:p.OnIdle.animStep=1}E.redraw()}}),(I=GUI.createDom(null,{x:190,y:10})).__dom.style.zIndex=1e4,f=GUI.createDom(void 0,{x:0,y:0,width:DataCross.app.width,height:DataCross.app.height,background:"black",opacity:.3,zIndex:999}),u=GUI.createElement(ElementText,{x:DataCross.app.width/2-DataCross.app.width/1.5/2,y:DataCross.app.height/2-40,width:DataCross.app.width/1.5,height:40,fontSize:36,color:"#fdfff5",alignCenter:!0,zIndex:1e3}),GUI.bind(I,GUI.EVENT_MOUSE_CLICK,function(e,t){let i;I.hide(),(i=document.elementFromPoint(e.clientX,e.clientY)).dispatchEvent(new MouseEvent(e.type,e)),m&&I.show()}),GUI.onMouseMove(function(e,t){I.x=e-25,I.y=t-25,I.redraw()})},this.show=function(){if(!0!==s){s=!0,L();for(let e in o.elements)o.elements[e].show();o.firstShow(),SocNet.getType()!==SocNet.TYPE_STANDALONE&&1!==LogicUser.getCurrentUser().id&&1!==LogicUser.getCurrentUser().socNetUserId||(_.show(),E.show())}},this.isShowed=function(){return s},this.hide=function(){if(!1!==s){s=!1;for(let e in o.elements)o.elements[e].hide();I.hide(),e.hide(),_.hide(),E.hide()}};let w,L=function(){let e;e=DataPoints.getById(DataPoints.getPlayedId()),t=0,i=e.turns,n=DataPoints.copyGoals(e.goals),a.setLayers(e.layers),o.redraw()};this.firstShow=function(){let e;a.unlock(),a.run(),e=DataPoints.getById(DataPoints.getPlayedId()),PBZDialogs.dialogGoals.setGoals(e.goals),PBZDialogs.dialogGoals.showDialog(),w=!1,LogicWizard.onFieldFirstShow()},this.redraw=function(){if(!s)return;let a=DataPoints.countStars(null,null,t);r.backgroundImage="/images/star-off-middle.png",c.backgroundImage="/images/star-off-middle.png",h.backgroundImage="/images/star-off-middle.png",a>=1&&(r.backgroundImage="/images/star-on-middle.png"),a>=2&&(c.backgroundImage="/images/star-on-middle.png"),a>=3&&(h.backgroundImage="/images/star-on-middle.png"),l.setText(t.toString()),d.setText(i.toString()),g.setText(DataPoints.getPlayedId().toString());for(let e in o.elements)o.elements[e].redraw();e.items=n,e.redraw(),m?(I.show(),I.redraw()):I.hide(),_.redraw(),E.redraw()};let D={};D[DataObjects.OBJECT_RED]=10,D[DataObjects.OBJECT_GREEN]=10,D[DataObjects.OBJECT_BLUE]=10,D[DataObjects.OBJECT_YELLOW]=10,D[DataObjects.OBJECT_PURPLE]=10,D[DataObjects.OBJECT_SAND]=30,D[DataObjects.OBJECT_SPIDER_ALPHA]=100,D[DataObjects.OBJECT_SPIDER_BETA]=100,D[DataObjects.OBJECT_SPIDER_GAMMA]=100,D[DataObjects.OBJECT_POLY_COLOR]=300,D[DataObjects.OBJECT_GOLD]=300,D[DataObjects.OBJECT_TILE]=300,D[DataObjects.OBJECT_BOX]=5,D[DataObjects.OBJECT_BARREL]=100,D[DataObjects.OBJECT_BOX]=100,this.onDestroyThing=function(e,i){b(e,1),D[e]&&(t+=D[e]),o.redraw(),LogicWizard.onDestroyThing(i)},this.onDestroyLine=function(e){LogicWizard.onDestroyLine(e)};let b=function(e,t){w=!0,n.forEach(function(i){i.id===e&&(i.count-=t),i.count>0&&(w=!1),i.count<0&&(i.count=0)}),o.redraw()};this.onFieldSilent=function(){LogicWizard.onFieldSilent(),w?(a.lock(),w=!1,setTimeout(o.finishLevel,15*p.OnIdle.animateInterval)):0===i&&PBZDialogs.dialogTurnsLoose.showDialog()},this.finishLevel=function(){let e,i,n;m=null,Logs.log("finishLevel()",Logs.LEVEL_DETAIL),i=LogicUser.getCurrentUser(),e=DataPoints.getPlayedId(),n=DataPoints.getScore(e),i.nextPointId<e+1&&(i.nextPointId=e+1,LogicUser.updateUserInfo(i)),t>n&&(SAPIMap.finishLevel(e,t),DataPoints.setPointUserScore(i.id,e,t)),SAPIUser.onPlayFinish(),PBZDialogs.dialogGoalsReached.showDialog(e),PageController.redraw()},this.beforeTurnUse=function(){0!==--i||w||a.lock(),5===i&&y("Осталось 5 ходов!"),o.redraw()},this.beforeStuffUse=function(){switch(m){case LogicStuff.STUFF_HUMMER:SAPIStuff.usedHummer(),LogicStuff.usedHummer();break;case LogicStuff.STUFF_LIGHTNING:SAPIStuff.usedlightning(),LogicStuff.usedlightning();break;case LogicStuff.STUFF_SHUFFLE:SAPIStuff.usedShuffle(),LogicStuff.usedShuffle()}m=null,a.setStuffMode(m),o.redraw()},this.setStuffMode=function(e){switch(e){case LogicStuff.STUFF_HUMMER:if(LogicStuff.getStuff("hummerQty")<1)return void PBZDialogs.dialogStuffShop.showDialog(e);I.backgroundImage="/images/button-hummer-active.png";break;case LogicStuff.STUFF_LIGHTNING:if(LogicStuff.getStuff("lightningQty")<1)return void PBZDialogs.dialogStuffShop.showDialog(e);I.backgroundImage="/images/button-lightning-active.png";break;case LogicStuff.STUFF_SHUFFLE:if(LogicStuff.getStuff("shuffleQty")<1)return void PBZDialogs.dialogStuffShop.showDialog(e);I.backgroundImage="/images/button-shuffle-active.png"}m=e,a.setStuffMode(e),o.redraw()},this.getElementField=function(){return a},this.onWizardFinish=function(){y("Теперь сами!")};let y=function(e){f.show(),u.setText(e),u.show(),u.redraw(),setTimeout(function(){f.hide(),u.hide()},1.1*p.OnIdle.second)}},PageBlockField=new PageBlockField,void 0!==window.PageBlockField&&(window.PageBlockField.__path="../client/components/application/page_blocks/PageBlockField.js"),PageBlockMaps=function(){let e,t=this,i=!1,n=!1,o={x:714,y:225},s=!1,a=!1,l=!1,r=!1,c=!1,h={},d=1,u=null,f=[],m=[],p=null;this.elements=[],this.init=function(){let i;n=GUI.createElement(ElementImage,{x:0,y:0,width:777,height:500,src:"/images/not-found.png"}),c=GUI.createElement(ElementImage,{x:0,y:0,width:777,height:500,src:"/images/old-paper.png"}),t.elements.push(c),r=GUI.createElement(ElementImage,{x:0,y:0,width:777,height:500,src:"/images/way-line.png"}),t.elements.push(r),l=GUI.createElement(ElementImage,{x:0,y:0,width:777,height:500,src:"/images/map-001.png"}),t.elements.push(l),p=GUI.createElement(ElementImage,{x:0,y:0,width:50,height:50,p:{},src:"/images/hint-arrow.png"}),t.elements.push(p),Animate.anim(g,{},p),s=GUI.createElement(ElementButton,{x:0,y:o.y,srcRest:"/images/map-arrow-left-rest.png",srcHover:"/images/map-arrow-left-hover.png",srcActive:"/images/map-arrow-left-active.png",onClick:LogicMap.onArrowPrevClick}),t.elements.push(s),a=GUI.createElement(ElementButton,{x:o.x,y:o.y,srcRest:"/images/map-arrow-right-rest.png",srcHover:"/images/map-arrow-right-hover.png",srcActive:"/images/map-arrow-right-active.png",onClick:LogicMap.onArrowNextClick}),t.elements.push(a),DataPoints.getPointsCoords().forEach(function(e){1===e.number&&GUI.setTagId(LogicWizard.TAG_FIRST_NUMBER_POINT),i=GUI.createElement(ElementPoint,{x:e.x,y:e.y,friends:[],stateId:ElementPoint.STATE_CLOSE,number:null,pointId:null,onClick:function(e,t,i){PBZDialogs.dialogPointInfo.showDialog(i.pointId)}}),t.elements.push(i),f[e.number]=i,1===e.number&&GUI.setTagId(null)}),DataChests.getCoords().forEach(function(e){i=GUI.createElement(ElementChest,{x:e.x,y:e.y,width:71,height:62,number:e.number,enabled:!0,onClick:function(e,t,i){let n,o,s,a,l;n=i.chestId,o=DataChests.isItOpened(n),a=(s=DataChests.getById(n)).goalStars,l=DataMap.countStarsByMapId(),o||(l<a?(PBZDialogs.dialogChestNeedStars.mapStars=l,PBZDialogs.dialogChestNeedStars.goalStars=a,PBZDialogs.dialogChestNeedStars.showDialog()):(SAPIChest.openChest(n),DataChests.setOpened(n),DataPrizes.giveOutPrizes(s.prizes),PBZDialogs.dialogChestYouWin.chestId=n,PBZDialogs.dialogChestYouWin.showDialog(),PageController.redraw()))}}),m[e.number]=i}),e=GUI.createElement(ElementFriendsPanel,{x:213,y:435}),t.elements.push(e),i=GUI.createElement(ElementButton,{x:165,y:438,srcRest:"/images/button-add-rest.png",srcHover:"/images/button-add-hover.png",srcActive:"/images/button-add-active.png",onClick:function(){SocNet.openInviteFriendDialog()}}),t.elements.push(i),i=GUI.createElement(ElementImage,{x:650,y:370,opacity:.7,src:"/images/wind-rose.png"}),t.elements.push(i),u=GUI.createDom(void 0,{x:0,y:0,backgroundImage:"/images/not-found.png"})},this.show=function(){!0!==i&&(i=!0,t.elements.forEach(function(e){e.show()}),this.mapElsCreateIfNotExits(),this.mapElsShow(),t.preset(),t.redraw())},this.hide=function(){if(!1!==i){i=!1;for(let e in t.elements)t.elements[e].hide();this.mapElsHide(),s.hide()}},this.preset=function(){let e,t,i;if(this.presetPoints(),this.presetChests(),e=LogicUser.getCurrentUser().nextPointId,t=DataMap.getFirstPointId(),i=DataMap.getLastPointId(),e>=t&&e<=i){let t=DataPoints.getPointsCoords()[DataMap.getNumberFromPointId(e)-1];p.src="/images/hint-arrow.png",p.p=t,p.show()}else e>i?(p.show(),p.p=o,p.src="/images/map-arrow-right-rest.png"):p.hide()},this.redraw=function(){i&&(I()||(t.preset(),e.setFriends(LogicUser.getList(LogicUser.getFriendIds(6))),e.redraw(),t.elements.forEach(function(e){e.redraw()}),this.mapElsRedraw(),s.redraw()))},this.mapElsCreateIfNotExits=function(){let e,t;if((e=DataMap.getCurent())&&!h[e.id]){h[e.id]=[];for(let i in e.elements)t=GUI.createElement(window[e.elements[i].name],e.elements[i].params),e.elements[i].animPlay&&t.animPlay(),h[e.id].push(t)}},this.mapElsShow=function(){let e;if(e=DataMap.getCurent()){for(let t in h[e.id])h[e.id][t].show();if(d!==e.id){for(let e in h[d])h[d][e].hide();d=e.id}}},this.mapElsHide=function(){for(let e in h)for(let t in h[e])h[e][t].hide();u.hide()},this.mapElsRedraw=function(){let e;if(e=DataMap.getCurent()){l.src=e.src,d!==e.id&&this.mapElsShow();for(let t in h[e.id]);}},this.presetPoints=function(){let e,t,i,n,o,s;if(e=LogicUser.getCurrentUser(),s=DataMap.getCurent()){o=DataPoints.getPointUserScore(s.id,[e.id]);for(let s=1;s<=DataMap.POINTS_PER_MAP;s++)t=DataMap.getPointIdFromPointNumber(s),(n=f[s]).pointId=t,(i=DataPoints.getById(t))&&(n=f[s],i.id===e.nextPointId&&(n.stateId=ElementPoint.STATE_CURRENT),i.id<e.nextPointId&&(n.stateId=ElementPoint.STATE_FINISHED),i.id>e.nextPointId&&(n.stateId=ElementPoint.STATE_CLOSE),o[t]?n.userScore=o[t][e.id]?o[t][e.id].score:0:n.userScore=0,n.setGamers(LogicUser.getFriendIdsByMapIdAndPointIdWithScore(DataMap.getCurent().id,t,!0)))}},this.presetChests=function(){let e,t,i,n;if(n=DataMap.getCurent())for(let n=1;n<=DataMap.CHESTS_PER_MAP;n++)e=DataMap.getChestIdFromChestNumber(n),(t=DataChests.getById(e))&&((i=m[n]).chestId=e,i.goalStars=t.goalStars,i.stars=DataMap.countStarsByMapId())};let I=function(){let e,t,i,n,o,s;return e=!1,t=DataMap.getCurent(),i=LogicUser.getFriendIds(6),t&&(n=LogicUser.getFriendIdsByMapId(t.id)),i&&(o=LogicUser.getList(i)),n&&(s=LogicUser.getList(n)),t||(e=!0),i&&i.length!==o.length&&(e=!0),n&&n.length!==s.length&&(e=!0),e?u.show():u.hide(),e}},PageBlockMaps=new PageBlockMaps,void 0!==window.PageBlockMaps&&(window.PageBlockMaps.__path="../client/components/application/page_blocks/PageBlockMaps.js"),PageBlockPanel=function(){let e=this,t=!1;this.elements=[];let i,n=null,o=null;this.init=function(){let t,a,l;a=110,t=GUI.createElement(ElementImage,{x:110,y:0,src:"/images/panel-money.png"}),e.elements.push(t),t=GUI.createElement(ElementButton,{x:115,y:-3,srcRest:"/images/button-money-rest.png",srcHover:"/images/button-money-hover.png",srcActive:"/images/button-money-active.png",onClick:function(){PBZDialogs.dialogMoneyShop.showDialog()}}),e.elements.push(t),i=GUI.createElement(ElementText,{x:168,y:11,width:70,alignCenter:!0}),e.elements.push(i),t=GUI.createElement(ElementButton,{x:232,y:-3,srcRest:"/images/button-add-rest.png",srcHover:"/images/button-add-hover.png",srcActive:"/images/button-add-active.png",onClick:function(){PBZDialogs.dialogMoneyShop.showDialog()}}),e.elements.push(t),l=398,t=GUI.createElement(ElementImage,{x:398,y:0,src:"/images/panel-hearth.png"}),e.elements.push(t),t=GUI.createElement(ElementHealthIndicator,{x:407,y:-1}),e.elements.push(t),t=GUI.createElement(ElementHealthTimer,{x:509,y:10,healthIndicator:t}),e.elements.push(t),t=GUI.createElement(ElementButton,{x:588,y:-4,srcRest:"/images/button-add-rest.png",srcHover:"/images/button-add-hover.png",srcActive:"/images/button-add-active.png",onClick:function(){PBZDialogs.dialogHealthShop.showDialog()}}),e.elements.push(t),n=GUI.createElement(ElementButton,{x:650,y:10,srcRest:"/images/button-sound-off.png",srcHover:"/images/button-sound-active.png",srcActive:"/images/button-sound-active.png",onClick:function(){Sounds.toggle(),Sounds.play(Sounds.PATH_CHALK),PageController.redraw()}}),e.elements.push(n),o=GUI.createElement(ElementButton,{x:690,y:10,srcRest:"/images/button-fs-on-rest.png",srcHover:"/images/button-fs-on-hover.png",srcActive:"/images/button-fs-on-active.png",onClick:s}),e.elements.push(o)},this.show=function(){if(!t){t=!0,e.preset();for(let t in e.elements)e.elements[t].show();e.redraw()}},this.hide=function(){if(t){t=!1;for(let t in e.elements)e.elements[t].hide()}},this.preset=function(){Sounds.isEnabled()?n.srcRest="/images/button-sound-on.png":n.srcRest="/images/button-sound-off.png",void 0!==LogicStuff.getStuff().goldQty&&i.setText(LogicStuff.getStuff("goldQty"))},this.redraw=function(){t&&(e.preset(),e.elements.forEach(function(e){e.redraw()}))};let s=function(){GUI.fsSwitch(),GUI.isFullScreen()?(o.srcRest="/images/button-fs-on-rest.png",o.srcHover="/images/button-fs-on-rest.png",o.srcActive="/images/button-fs-on-rest.png"):(o.srcRest="/images/button-fs-off-rest.png",o.srcHover="/images/button-fs-off-rest.png",o.srcActive="/images/button-fs-off-rest.png")};this.oneHealthHide=!1},PageBlockPanel=new PageBlockPanel,void 0!==window.PageBlockPanel&&(window.PageBlockPanel.__path="../client/components/application/page_blocks/PageBlockPanel.js"),PageBlockWizard=function(){let e=this,t=!1,i={};this.elements=[];let n=null,o=null,s=null,a=null;this.init=function(){n=document.getElementById("wizardArea"),console.log(n),n.width=DataCross.app.width,n.height=DataCross.app.height,n.style.display="none",(o=n.getContext("2d")).showByImg=c,o.unlockByImg=r,o.highlightCells=h;let e=function(e,t){let i,s,a,l;a=e.offsetX,l=e.offsetY,0===(i=o.getImageData(a,l,1,1).data)[3]?(n.style.display="none",(s=document.elementFromPoint(e.offsetX,e.offsetY))&&s.dispatchEvent(new MouseEvent(e.type,e)),n.isActive&&(n.style.display=""),t&&t(s)):t&&t(!1)};n.onclick=function(t){e(t,LogicWizard.onClick)},n.onmousemove=function(t){e(t,function(e){n.style.cursor=e?e.style.cursor:""})},(s=GUI.createElement(ElementImage,{x:400,y:360,src:"/images/wizard-dialog.png"})).dom.__dom.style.zIndex=2e4,s.hide(),(a=GUI.createElement(ElementText,{x:416,y:376,width:Images.getWidth("/images/wizard-dialog.png")-32,height:Images.getHeight("/images/wizard-dialog.png"),alignCenter:!0,zIndex:20001,text:"text"})).hide()};this.show=function(){if(!t){t=!0,e.preset();for(let t in e.elements)e.elements[t].show();e.redraw()}},this.hide=function(){if(t){t=!1;for(let t in e.elements)e.elements[t].hide()}},this.preset=function(){},this.redraw=function(){t&&(e.preset(),e.elements.forEach(function(e){e.redraw()}),s.redraw(),a.redraw())},this.begin=function(){PageBlockField.getElementField().lockHint(),n.style.display="",n.isActive=!0,o.clearRect(0,0,DataCross.app.width*window.devicePixelRatio,DataCross.app.height*window.devicePixelRatio),o.globalCompositeOperation="source-out",o.globalAlpha=.55,o.fillStyle="black",o.fillRect(0,0,DataCross.app.width*window.devicePixelRatio,DataCross.app.height*window.devicePixelRatio)},this.finish=function(){e.reset(),PageBlockField.onWizardFinish()},this.reset=function(){n.isActive=!1,n.style.display="none",s.hide(),a.hide(),PageBlockField.getElementField().unlockHint(),clearInterval(l)};let l=null;this.showHint=function(e){let t=PageBlockField.getElementField().getCoords();e.forEach(function(e){e.x+=t.cellX,e.y+=t.cellY}),l&&clearInterval(l),l=setInterval(function(){Animate.hintActive||PageBlockField.getElementField().showHint(e)},1.5*p.OnIdle.second)},this.updateText=function(t){a.text=t,e.redraw()},this.showDialog=function(t,i,n,o){let l;switch(t||(t=400),i||(i=360),n){default:case 1:l=30;break;case 2:l=15;break;case 3:l=2}n||(l=15*n),o||(o=""),s.x=t,s.y=i,a.x=t+16,a.y=i+16+l,s.show(),a.show(),e.redraw()},this.hideDialog=function(){s.hide(),a.hide()},this.draw=function(e){e(o)};let r=function(e,t,n){if(o.globalAlpha=1,o.globalCompositeOperation="destination-out",!i[e])return i[e]=new Image,i[e].onload=function(){r(e,t,n)},void(i[e].src=e);o.drawImage(i[e],t,n,Images.getWidth(e),Images.getHeight(e))},c=function(e,t,n){if(o.globalAlpha=.99,o.globalCompositeOperation="destination-out",!i[e])return i[e]=new Image,i[e].onload=function(){c(e,t,n)},void(i[e].src=e);o.drawImage(i[e],t,n,Images.getWidth(e),Images.getHeight(e))},h=function(e){let t=PageBlockField.getElementField().getCoords();e.forEach(function(e){e.unlock?r("/images/wizard-diamond-cell.png",t.x+DataPoints.BLOCK_WIDTH*e.x,t.y+DataPoints.BLOCK_HEIGHT*(e.y+1)):c("/images/wizard-diamond-cell.png",t.x+DataPoints.BLOCK_WIDTH*e.x,t.y+DataPoints.BLOCK_HEIGHT*(e.y+1))})};this.showByImg=c,this.unlockByImg=r,this.highlightCells=h},PageBlockWizard=new PageBlockWizard,PBWizard=PageBlockWizard,void 0!==window.PageBlockWizard&&(window.PageBlockWizard.__path="../client/components/application/page_blocks/PageBlockWizard.js"),PageBlockZDialogs=function(){let e=this,t=!1;this.elements=[],this.dialogMoneyShop=null,this.dialogHealthShop=null,this.dialogGoals=null,this.dialogStuffShop=null,this.dialogGoalsReached=null,this.dialogTurnsLoose=null,this.dialogJustQuit=null,this.dialogPointInfo=null,this.dialogChestNeedStars=null,this.dialogChestYouWin=null,this.init=function(){this.dialogMoneyShop=GUI.createElement(DialogMoneyShop,{}),e.elements.push(this.dialogMoneyShop),this.dialogHealthShop=GUI.createElement(DialogHealthShop,{}),e.elements.push(this.dialogHealthShop),this.dialogGoals=GUI.createElement(DialogGoals),e.elements.push(this.dialogGoals),this.dialogGoalsReached=GUI.createElement(DialogGoalsReached),e.elements.push(this.dialogGoalsReached),this.dialogTurnsLoose=GUI.createElement(DialogTurnLoose),e.elements.push(this.dialogTurnsLoose),this.dialogJustQuit=GUI.createElement(DialogJustQuit),e.elements.push(this.dialogJustQuit),this.dialogStuffShop=GUI.createElement(DialogStuffShop),e.elements.push(this.dialogStuffShop),this.dialogPointInfo=GUI.createElement(DialogPointInfo),e.elements.push(this.dialogPointInfo),this.dialogChestNeedStars=GUI.createElement(DialogChestNeedStars),e.elements.push(this.dialogChestNeedStars),this.dialogChestYouWin=GUI.createElement(DialogChestYouWin),e.elements.push(this.dialogChestYouWin)},this.show=function(){if(!t){t=!0,e.preset();for(let t in e.elements)e.elements[t].show();e.redraw()}},this.hide=function(){if(t){t=!1;for(let t in e.elements)e.elements[t].hide()}},this.preset=function(){},this.redraw=function(){t&&(e.preset(),e.elements.forEach(function(e){e.redraw()}))}},PageBlockZDialogs=new PageBlockZDialogs,PBZDialogs=PageBlockZDialogs,void 0!==window.PageBlockZDialogs&&(window.PageBlockZDialogs.__path="../client/components/application/page_blocks/PageBlockZDialogs.js"),PageField=function(){let e=this;this.blocks=[],this.init=function(){e.blocks.push(PageBlockBackground),e.blocks.push(PageBlockField),e.blocks.push(PageBlockPanel),e.blocks.push(PBZDialogs),e.blocks.push(PageBlockWizard)}},PageField=new PageField,void 0!==window.PageField&&(window.PageField.__path="../client/components/application/pages/PageField.js"),PageMain=function(){let e=this;this.blocks=[],this.init=function(){e.blocks.push(PageBlockBackground),e.blocks.push(PageBlockPanel),e.blocks.push(PageBlockMaps),e.blocks.push(PBZDialogs),e.blocks.push(PageBlockWizard)}},PageMain=new PageMain,void 0!==window.PageMain&&(window.PageMain.__path="../client/components/application/pages/PageMain.js"),WizardFirstStart_1={init:function(){PBWizard.begin(),PBWizard.updateText("Нажми на красный кружок, что бы начать играть."),PBWizard.showDialog(400,360,2);let e=DataPoints.getPointsCoords()[0];PBWizard.unlockByImg("/images/wizard-point-circle.png",e.x-Images.getWidth("/images/wizard-point-circle.png")/2+Images.getWidth("/images/map-way-point-red.png")/2,e.y-Images.getHeight("/images/wizard-point-circle.png")/2+Images.getHeight("/images/map-way-point-red.png")/2)},onClick:function(e){e.tagId===LogicWizard.TAG_FIRST_NUMBER_POINT&&"1"===e.innerText&&LogicWizard.start(WizardFirstStart_2)}},WizardFirstStart_2={init:function(){PBWizard.begin()},onShowDialog:function(){WizardFirstStart_2.dialogCounter++,WizardFirstStart_2.dialogCounter>1||(PBWizard.updateText("Нажми кнопку играть."),PBWizard.showDialog(400,380,1),PBWizard.unlockByImg("/images/wizard-button.png",390-Images.getWidth("/images/wizard-button.png")/2,328))},onHideDialog:function(){WizardFirstStart_2.dialogCounter++,2===WizardFirstStart_2.dialogCounter&&PBWizard.hideDialog(),2===WizardFirstStart_2.dialogCounter&&PBWizard.begin(),5===WizardFirstStart_2.dialogCounter&&LogicWizard.start(WizardFirstStart_3)}},WizardFirstStart_3={init:function(){PBWizard.begin()},onHideDialog:function(e){this.dialogCounter++<3||(PBWizard.updateText("Поменяй соседние камни местами, чтобы собрать камни красного цвета."),PBWizard.showDialog(210,380,3),PBWizard.showHint([{x:1,y:0},{x:2,y:0}]),PBWizard.highlightCells([{x:1,y:0,unlock:!0},{x:2,y:0,unlock:!0},{x:3,y:0,unlock:!1},{x:4,y:0,unlock:!1}]))},onDestroyLine:function(e){LogicWizard.start(WizardFirstStart_4)}},WizardFirstStart_4={init:function(){PBWizard.begin(),setTimeout(function(){PBWizard.updateText("У тебя получилось. Давай ещё!"),PBWizard.showDialog(210,380,2,21),PBWizard.showHint([{x:3,y:2},{x:3,y:3}]),PBWizard.highlightCells([{x:2,y:2,unlock:!1},{x:3,y:2,unlock:!0},{x:3,y:3,unlock:!0},{x:4,y:2,unlock:!1}])},1.5*p.OnIdle.second)},onDestroyLine:function(e){LogicWizard.finish()}},void 0!==window.WizardFirst&&(window.WizardFirst.__path="../client/components/application/wizards/WizardFirst.js"),WizardLevel12_1={init:function(){PBWizard.begin(),PBWizard.updateText("Собирай пауков, взрывая камни на которых они сидят")},onHideDialog:function(){WizardLevel12_1.dialogCounter++<2||(PBWizard.showHint([{x:2,y:1},{x:3,y:1}]),PBWizard.showDialog(210,400,2,20),PBWizard.highlightCells([{x:0,y:1,unlock:!1},{x:1,y:1,unlock:!1},{x:2,y:1,unlock:!0},{x:3,y:1,unlock:!0}]))},onDestroyLine:function(){LogicWizard.finish()}},void 0!==window.WizardLevel_12&&(window.WizardLevel_12.__path="../client/components/application/wizards/WizardLevel_12.js"),WizardLevel14_1={init:function(){PBWizard.begin(),PBWizard.updateText("Взорви камни, что бы снять цепь.")},onHideDialog:function(){WizardLevel14_1.dialogCounter++<2||(PBWizard.showHint([{x:2,y:1},{x:2,y:0}]),PBWizard.showDialog(210,400,2,20),PBWizard.highlightCells([{x:2,y:0,unlock:!0},{x:1,y:1,unlock:!1},{x:2,y:1,unlock:!0},{x:3,y:1,unlock:!1}]))},onDestroyLine:function(){LogicWizard.finish()}},void 0!==window.WizardLevel_14&&(window.WizardLevel_14.__path="../client/components/application/wizards/WizardLevel_14.js"),WizardLevel2_1={init:function(){PBWizard.begin(),PBWizard.updateText("Собрав ряд из 4-ех камней, получишь камень с молнией.")},onHideDialog:function(e){WizardLevel2_1.dialogCounter++<2||(PBWizard.showDialog(210,400,3,20),PBWizard.showHint([{x:1,y:3},{x:2,y:3}]),PBWizard.draw(function(e){e.highlightCells([{x:2,y:1,unlock:!1},{x:2,y:2,unlock:!1},{x:1,y:3,unlock:!0},{x:2,y:3,unlock:!0},{x:2,y:4,unlock:!1}])}))},onDestroyLine:function(){LogicWizard.start(WizardLevel2_2)}},WizardLevel2_2={init:function(){PBWizard.begin(),PBWizard.updateText("Взорви камень с молнией, что бы использовать её."),setTimeout(function(){PBWizard.showHint([{x:2,y:4},{x:3,y:4}]),PBWizard.showDialog(230,150,2,20),PBWizard.draw(function(e){e.highlightCells([{x:2,y:4,unlock:!0},{x:3,y:4,unlock:!0},{x:4,y:4,unlock:!1},{x:5,y:4,unlock:!1}])})},1.1*p.OnIdle.second)},onDestroyLine:function(){LogicWizard.finish()}},void 0!==window.WizardLevel_2&&(window.WizardLevel_2.__path="../client/components/application/wizards/WizardLevel_2.js"),WizardLevel23_1={init:function(){PBWizard.begin(),PBWizard.updateText("Взрывай камни рядом с красным пауком, что бы он убежал с поля.")},onHideDialog:function(){WizardLevel23_1.dialogCounter++<2||(PBWizard.showHint([{x:2,y:1},{x:2,y:0}]),PBWizard.showDialog(210,400,3,20),PBWizard.highlightCells([{x:2,y:2,unlock:!1},{x:1,y:1,unlock:!1},{x:2,y:1,unlock:!1},{x:3,y:1,unlock:!0},{x:4,y:1,unlock:!0}]))},onDestroyLine:function(){LogicWizard.finish()}},void 0!==window.WizardLevel_23&&(window.WizardLevel_23.__path="../client/components/application/wizards/WizardLevel_23.js"),WizardLevel3_1={init:function(){PBWizard.begin(),PBWizard.updateText("Собрав ряд из 5-ти камней, получаешь звезду.")},onHideDialog:function(){WizardLevel3_1.dialogCounter++<2||(PBWizard.showHint([{x:4,y:2},{x:4,y:3}]),PBWizard.showDialog(210,400,2,20),PBWizard.highlightCells([{x:2,y:2,unlock:!1},{x:3,y:2,unlock:!1},{x:4,y:2,unlock:!0},{x:5,y:2,unlock:!1},{x:6,y:2,unlock:!1},{x:4,y:3,unlock:!0}]))},onDestroyLine:function(){LogicWizard.start(WizardLevel3_2)}},WizardLevel3_2={init:function(){PBWizard.begin()},onFieldSilent:function(){PBWizard.updateText("Выбери цвет, что бы убрать все камни этого цвета."),PBWizard.showDialog(230,50,2,20),PBWizard.showHint([{x:4,y:2},{x:5,y:2}]),PBWizard.highlightCells([{x:4,y:2,unlock:!0},{x:5,y:2,unlock:!0}])},onDestroyThing:function(e){e.object.objectId===DataObjects.OBJECT_POLY_COLOR&&LogicWizard.finish()}},void 0!==window.WizardLevel_3&&(window.WizardLevel_3.__path="../client/components/application/wizards/WizardLevel_3.js"),WizardLevel_4_1={init:function(){PBWizard.begin(),PBWizard.updateText("Взорви камень, под которым есть золото.")},onHideDialog:function(){WizardLevel_4_1.dialogCounter++<2||(PBWizard.showHint([{x:2,y:1},{x:3,y:1}]),PBWizard.showDialog(210,400,2,20),PBWizard.highlightCells([{x:0,y:1,unlock:!1},{x:1,y:1,unlock:!1},{x:2,y:1,unlock:!0},{x:3,y:1,unlock:!0}]))},onDestroyLine:function(){LogicWizard.start(WizardLevel4_2)}},WizardLevel4_2={init:function(){PBWizard.begin()},onFieldSilent:function(){PBWizard.updateText("Собери еще золота!"),PBWizard.showDialog(450,250,1,20),PBWizard.showHint([{x:0,y:2},{x:1,y:2}]),PBWizard.highlightCells([{x:1,y:0,unlock:!1},{x:1,y:1,unlock:!1},{x:1,y:2,unlock:!0},{x:1,y:3,unlock:!1},{x:0,y:2,unlock:!0}])},onDestroyLine:function(e){LogicWizard.finish()}},void 0!==window.WizardLevel_4&&(window.WizardLevel_4.__path="../client/components/application/wizards/WizardLevel_4.js"),WizardLevel_41_1={init:function(){PBWizard.begin(),PBWizard.updateText("Взорви камни и бочка упадет на блок.")},onHideDialog:function(){WizardLevel_41_1.dialogCounter++<2||(PBWizard.showHint([{x:1,y:4},{x:2,y:4}]),PBWizard.showDialog(340,390,2),PBWizard.highlightCells([{x:2,y:2,unlock:!1},{x:2,y:3,unlock:!1},{x:2,y:4,unlock:!0},{x:2,y:5,unlock:!1},{x:2,y:6,unlock:!1},{x:1,y:4,unlock:!0}]))},onDestroyLine:function(){console.log(1),LogicWizard.start(WizardLevel41_2)}},WizardLevel41_2={init:function(){PBWizard.begin(),console.log(2),PBWizard.updateText("Бочка ещё не улетела, взорви ряд камней что бы переместить бочку."),console.log(2),PBWizard.showDialog(360,390,3),PBWizard.showHint([{x:2,y:5},{x:3,y:5}]),PBWizard.highlightCells([{x:3,y:3,unlock:!1},{x:3,y:4,unlock:!1},{x:3,y:5,unlock:!0},{x:3,y:6,unlock:!1},{x:2,y:5,unlock:!0}])},onDestroyLine:function(){LogicWizard.finish()}},void 0!==window.WizardLevel_41&&(window.WizardLevel_41.__path="../client/components/application/wizards/WizardLevel_41.js"),WizardLevel46_1={init:function(){PBWizard.begin(),PBWizard.updateText("Соедини песочные камни в ряд.")},onHideDialog:function(){WizardLevel46_1.dialogCounter++<2||(PBWizard.showHint([{x:2,y:1},{x:3,y:1}]),PBWizard.showDialog(340,390,2),PBWizard.highlightCells([{x:3,y:0,unlock:!1},{x:3,y:1,unlock:!0},{x:3,y:2,unlock:!1},{x:2,y:1,unlock:!0}]))},onDestroyLine:function(){LogicWizard.finish()}},void 0!==window.WizardLevel_46&&(window.WizardLevel_46.__path="../client/components/application/wizards/WizardLevel_46.js"),WizardLevel51_1={init:function(){PBWizard.begin(),PBWizard.updateText("Соедини ряд чтобы взорвать желтого паука.")},onHideDialog:function(){WizardLevel51_1.dialogCounter++<2||(PBWizard.showHint([{x:5,y:2},{x:5,y:2}]),PBWizard.showDialog(340,390,2),PBWizard.highlightCells([{x:2,y:2,unlock:!1},{x:3,y:2,unlock:!1},{x:4,y:2,unlock:!0},{x:5,y:2,unlock:!0}]))},onDestroyLine:function(){LogicWizard.finish()}},void 0!==window.WizardLevel_51&&(window.WizardLevel_51.__path="../client/components/application/wizards/WizardLevel_51.js"),WizardLevel9_1={init:function(){PBWizard.begin(),PBWizard.updateText("Взорви камни рядом с ящиком.")},onHideDialog:function(){WizardLevel9_1.dialogCounter++<2||(PBWizard.showHint([{x:2,y:1},{x:3,y:1}]),PBWizard.showDialog(210,400,2,20),PBWizard.highlightCells([{x:0,y:1,unlock:!1},{x:1,y:1,unlock:!1},{x:2,y:1,unlock:!0},{x:3,y:1,unlock:!0}]))},onDestroyLine:function(){LogicWizard.finish()}},void 0!==window.WizardLevel_9&&(window.WizardLevel_9.__path="../client/components/application/wizards/WizardLevel_9.js"),CONST_IS_SERVER_SIDE&&(m=require("fs"),f=require("path")),ApiRouter=new function(){let t,i=this,n={},o=[],s=[];this.setMap=function(e){t=e},this.onData=function(o,s){let a,l,r;try{o=JSON.parse(o)}catch(t){return void e("Wrong data:parse error",Logs.LEVEL_WARNING,o)}"object"==typeof o?void 0!==o.group?"string"==typeof o.group?void 0!==o.method?"string"==typeof o.method?void 0!==o.args?"object"==typeof o.args?(a=o.group,l=o.method,r=o.args,void 0!==t[a]?void 0!==t[a][l]?(CONST_IS_SERVER_SIDE?Logs.log(s+" >> "+a+"."+l,Logs.LEVEL_DETAIL,r):Logs.log(a+"."+l,Logs.LEVEL_DETAIL,r),r.unshift(n[s]),t[a][l].apply(i,r)):Logs.log("Wrong data: method not found "+l,Logs.LEVEL_WARNING,o):Logs.log("Wrong data: group not found "+a,Logs.LEVEL_WARNING,o)):Logs.log("Wrong data: packet.args must have type 'object'",Logs.LEVEL_WARNING,o):Logs.log("Wrong data: packet must have .args",Logs.LEVEL_WARNING,o):Logs.log("Wrong data: packet.method must have type 'string'",Logs.LEVEL_WARNING,o):Logs.log("Wrong data: packet must have .method",Logs.LEVEL_WARNING,o):Logs.log("Wrong data: packet.group must have type 'string'",Logs.LEVEL_WARNING,o):Logs.log("Wrong data: packet must have .group",Logs.LEVEL_WARNING,o):Logs.log("Wrong data: packet must be 'object'",Logs.LEVEL_WARNING,o)},this.onConnect=function(e){Logs.log("ApiRouter.onConnect: id="+e,Logs.LEVEL_DETAIL),n[e]={connectionId:e}},this.onDisconnect=function(e){Logs.log("connection close: id="+e,Logs.LEVEL_WARNING);for(let t in o)o[t].call(i,n[e]);delete n[e]},this.executeRequest=function(e,t,n,o){let a,l;for(l in n=Array.prototype.slice.call(n),o||(o=[{connectionId:null}]),a="",o)a+=o[l].connectionId;CONST_IS_SERVER_SIDE?Logs.log(a+" << "+e+"."+t+":"+n.join(","),Logs.LEVEL_DETAIL):Logs.log(e+"."+t,Logs.LEVEL_DETAIL,n);let r={group:e,method:t,args:n};r=JSON.stringify(r);let c=0;for(l in o){if(!this.sendData(r,o[l].connectionId)){Logs.log("ApiRouter.failedToSend",Logs.LEVEL_WARNING,{packet:r,cntx:o[l]});for(let e in s)s[e].call(i,o[e])}c++}0===c&&Logs.log("ApiRouter. Try send to empty contextlist.",Logs.LEVEL_WARNING,{packet:r,cntxList:o})},this.addOnDisconnectCallback=function(e){o.push(e)},this.addOnFailedSendCallback=function(e){s.push(e)},this.getSAPIJSCode=function(){let e,i,n,o;for(i in e="",o={},t||(t=l()),t)for(n in global[i])"function"==typeof global[i][n]&&(o[i]||(o[i]={}),o[i][n]=!0);for(i in o){for(n in e+=i+" = function(){\r\n",o[i])e+="\tthis."+n+" = function(){\r\n",e+="\t\tApiRouter.executeRequest('"+i+"' ,'"+n+"', arguments);\r\n",e+="\t};\r\n";e+="};\r\n",e+=i+" = new "+i+"();\r\n"}for(i in e+="ApiRouter.map2 = {\r\n",o)e+="\t"+i+" : "+i+",\r\n";return e=e.substr(0,e.length-1),e+="};\r\n"},this.generate=function(){return h(a()),c(l())},this.generateClient=function(){let e,t;t=a();let i="";for(e in i+="ApiRouter.map = {\r\n",t)i+="\t"+e+" : "+e+",\r\n";i=i.substr(0,i.length-1),i='document.addEventListener("DOMContentLoaded", function() {'+(i+="};\r\n")+"})"};let a=function(){let e,t,i,n,o,s;e=CONST_DIR_CLIENT+"components/application/capi/",t=m.readdirSync(e),o={};for(let a in t)if(".gitkeep"!==t[a]&&".gitignore"!==t[a]){for(n in i=r(e+t[a]),s=null,global[i]&&(s=global[i]),require(e+t[a]),o[i]=[],global[i])"function"==typeof global[i][n]&&(o[i][n]=!0);s&&(global[i]=s)}return o},l=function(){let e,t,i,n,o;e=CONST_DIR_COMPONENTS+"/application/sapi/",t=m.readdirSync(e),o={};for(let s in t)if(".gitkeep"!==t[s]&&".gitignore"!==t[s])for(n in i=r(e+t[s]),require(e+t[s]),o[i]=[],global[i])"function"==typeof global[i][n]&&(o[i][n]=!0);return o},r=function(e){return f.basename(e).replace(".js","")},c=function(e){let t,i;for(t in i="",i+=" ApiRouter.setMap({\r\n",e)i+="\t"+t+":"+t+",\r\n";return i+="});\r\n"},h=function(e){let t,i,n="";for(t in e)if(".gitkeep"!==t&&".gitignore"!==t){for(i in n="",n+=t+" = function(){\r\n\r\n",e[t])n+="\tthis."+i+" = function(){\r\n\r\n",n+="\t\tlet args, toUserId;\r\n",n+="\t\targs = Array.prototype.slice.call(arguments);\r\n",n+="\t\ttoUserId = args.shift();\r\n",n+='\t\tLogicUser.sendToUser(toUserId, "'+t+'", "'+i+'", args);\r\n',n+="\t};\r\n\r\n";n+="};\r\n",n+=t+" = new "+t+"();\r\n",m.writeFileSync(CONST_DIR_COMPONENTS+"generated/"+t+".js",n)}}},void 0!==window.ApiRouter&&(window.ApiRouter.__path="components/base/ApiRouter.js"),GUI=function(){let e=this,t=!1,i=!1;this.EVENT_MOUSE_MOUSE_DOWN=1,this.EVENT_MOUSE_MOUSE_TOUCH_START=100,this.EVENT_MOUSE_MOUSE_TOUCH_END=101,this.EVENT_MOUSE_MOUSE_UP=2,this.EVENT_MOUSE_CLICK=3,this.EVENT_MOUSE_MOVE=4,this.EVENT_MOUSE_OVER=5,this.EVENT_MOUSE_OUT=6,this.EVENT_KEY_DOWN=100,this.EVENT_KEY_UP=101,this.POINTER_HAND="pointer",this.POINTER_ARROW="default",this.eventNames=[],this.eventNames[this.EVENT_MOUSE_MOUSE_DOWN]="mousedown",this.eventNames[this.EVENT_MOUSE_MOUSE_UP]="mouseup",this.eventNames[this.EVENT_MOUSE_CLICK]="click",this.eventNames[this.EVENT_MOUSE_OVER]="mouseover",this.eventNames[this.EVENT_MOUSE_MOVE]="mousemove",this.eventNames[this.EVENT_MOUSE_OUT]="mouseout",this.eventNames[this.EVENT_KEY_DOWN]="keydown",this.eventNames[this.EVENT_KEY_UP]="keyup",this.eventNames[this.EVENT_MOUSE_MOUSE_TOUCH_START]="touchstart",this.eventNames[this.EVENT_MOUSE_MOUSE_TOUCH_END]="touchend";let n=[],o=[];this.lockEventsExcept=null;let s=null;this.init=function(){i=document.getElementById("appArea"),o.push(i);let e=document.createElement("style");e.type="text/css",e.innerHTML=".sepia { filter: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg'><filter id='old-timey'><feColorMatrix type='matrix' values='0.14 0.45 0.05 0 0 0.12 0.39 0.04 0 0 0.08 0.28 0.03 0 0 0 0 0 1 0'/></filter></svg>#old-timey\");-webkit-filter: sepia(0.5);-webkit-filter: sepia(85%) grayscale(50%);-moz-filter: sepia(70%);-ms-filter: sepia(70%);-o-filter: sepia(70%);filter: sepia(70%);}",e.innerHTML+=".gui-dom {  position: absolute; overflow: hidden}",e.innerHTML+="* {-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;}",document.getElementsByTagName("head")[0].appendChild(e),document.addEventListener("mousemove",function(e){n.forEach(function(t){t.call(null,e.clientX-i.offsetLeft,e.clientY-i.offsetTop)})}),a(function(){t=!t,s()}),this.fsSwitch=function(){s(!0),GUI.isFullScreen()?r():l()};let s=function(e){let t;t=document.getElementById("vk_comments"),e&&!GUI.isFullScreen()||!e&&GUI.isFullScreen()?(t&&(t.style.display="none"),i.style.left=screen.availWidth/2-parseInt(i.style.width)/2+"px",i.style.top=screen.availHeight/2-parseInt(i.style.height)/2+"px"):(t&&(t.style.display=""),i.style.left="",i.style.top="")},l=function(){let e=window.document.body;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen&&e.webkitRequestFullScreen()},r=function(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen()}},this.createElement=function(e,t,i){let n;t||(t={}),e||Logs.log("GUI.createElement: не определен элемент:"+e,Logs.LEVEL_FATAL_ERROR),(n=new e).init&&"function"==typeof n.init||Logs.log("GUI.craeteElement: элемент должен иметь функцию init().",Logs.LEVEL_FATAL_ERROR,arguments),n.show&&"function"==typeof n.show||Logs.log("GUI.createElement: элемент должен иметь функцию show().",Logs.LEVEL_FATAL_ERROR,arguments),n.hide&&"function"==typeof n.hide||Logs.log("GUI.createElement: элемент должен иметь функцию hide().",Logs.LEVEL_FATAL_ERROR,arguments),n.redraw&&"function"==typeof n.redraw||Logs.log("GUI.createElement: элемент должен иметь функцию redraw().",Logs.LEVEL_FATAL_ERROR,arguments);for(let e in t)n[e]=t[e];return i?(GUI.pushParent(i),n.init(),GUI.popParent()):n.init(),n},this.pushParent=function(e){return o.push(e.__dom)},this.popParent=function(){return o.pop()},this.getCurrentParent=function(){return o[o.length-1]},this.createDom=function(t,i){let n;if((n=new GUIDom).init(void 0,t),s&&(n.__dom.tagId=s),i){for(let e in i)n[e]=i[e];i.animTracks&&(n.animTracks=i.animTracks,e.updateAnimTracks(n),OnIdle.register(n.animate))}return n},this.updateAnimTracks=function(e){if(e.animTracks)for(let t in e.animTracks){e.animData[t]={frameN:0,counter:0};for(let i in e.animTracks[t]){let n=e.animTracks[t][i];switch(n.type){case GUI.ANIM_TYPE_ROTATE:n.currentAngle||(n.currentAngle=0);break;case GUI.ANIM_TYPE_MOVIE:n.imageN||(n.imageN=0,e.src=n.images[n.imageN])}}}},this.createInput=function(e,t){let i;if((i=new GUIDom).init("input",e),t)for(let e in t)i[e]=t[e];return i},this.createCanvas=function(e,t){let i;if((i=new GUIDom).init("canvas",e),t)for(let e in t)i[e]=t[e];return i},this.bind=function(e,t,i,n){e.bind(t,i,n)},this.lockEvents=function(t){e.lockEventsExcept=t},this.unlockEvents=function(){e.lockEventsExcept=null},this.onMouseMove=function(e){n.push(e)};let a=function(e){document.addEventListener("fullscreenchange",e),document.addEventListener("mozfullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("msfullscreenchange",e)};this.isFullScreen=function(){return t},this.setTagId=function(e){s=e},this.copyAnimTracks=function(e){let t,i;return t=[],e.forEach(function(e,n){t[n]=[],e.forEach(function(e,o){i={};for(let t in e)i[t]=e[t];t[n][o]=i})}),t}},GUI=new GUI,GUI.ANIM_TYPE_ROTATE=10,GUI.ANIM_TYPE_MOVE=20,GUI.ANIM_TYPE_MOVE_2=21,GUI.ANIM_TYPE_GOTO=30,GUI.ANIM_TYPE_MOVIE=40,GUI.ANIM_TYPE_PAUSE=50,GUI.ANIM_TYPE_STOP=60,void 0!==window.GUI&&(window.GUI.__path="../client/components/base/GUI.js"),GUIDom=function(){let e=this;this.__id=++GUIDom.lastId;let t={},i=!1,n=null;this.animTracks=[],this.animData=[],this.animPlayed=!1,this.init=function(e,i){for(let e in d)t[e]=void 0;e||(e="span"),(n=document.createElement(e)).className="gui-dom","input"===e&&(n.style.border="none"),n.ondragstart=function(){return!1},this.__dom=n,n.__dom=this,(i=i?i.__dom:GUI.getCurrentParent()).appendChild(n)},this.show=function(){i||(i=!0,n.style.display="",e.redraw())},this.hide=function(){i&&(i=!1,n.style.display="none")},this.redraw=function(){if(i)for(let i in d)t[i]!==e[i]&&(d[i].call(),t[i]=e[i])};let o=null,s=[],a=null;this.animateStop=function(){o=null},this.animateOpacity=function(t,i,n){void 0!==i&&(e.opacity=i),e.opacity||(e.opacity=0),i=e.opacity,o=i<t?1:2,(s=[]).push(t),s.push(i),s.push(Math.abs((t-i)/24)),a=n,l()};let l=function(){switch(o){case 1:r.apply(this,s);break;case 2:c.apply(this,s);break;default:return}setTimeout(function(){l(),e.redraw()},a)},r=function(t,i,n){e.opacity<t?e.opacity+=n:(e.opacity=t,o=null)},c=function(t,i,n){e.opacity>t?e.opacity-=n:(e.opacity=t,o=null)};this.bind=function(t,i,o){let s;(s=GUI.eventNames[t])||Logs.log("undefined gui eventId:"+t,Logs.LEVEL_FATAL_ERROR),n.addEventListener(s,function(t){if(GUI.lockEventsExcept){let t,i;for(t=e.__dom,i=!0;t;)GUI.lockEventsExcept.__dom===t&&(i=!1),t=t.parentElement;if(i)return}i.call(o,t,n)},!1)},this.setFocus=function(){n.focus()};let h=function(){let t;t=Images.getPath(e.backgroundImage),e.width||e.height||!Images.getPath(e.backgroundImage)||(e.width=Images.getWidth(e.backgroundImage),e.height=Images.getHeight(e.backgroundImage),d.height.call(),d.width.call()),n.style.backgroundImage="url("+t+")",e.backgroundPositionY=e.backgroundPositionY?e.backgroundPositionY:0,n.style.backgroundPositionX="-"+Images.getX(e.backgroundImage)+"px",n.style.backgroundPositionY="-"+(Images.getY(e.backgroundImage)+e.backgroundPositionY)+"px",n.style.backgroundRepeat="no-repeat",e.noScale?n.style.backgroundSize=Images.getWidth(e.backgroundImage)+"px "+Images.getHeight(e.backgroundImage)+"px":n.style.backgroundSize=e.width+"px "+e.height+"px"},d={x:function(){n.style.left=e.x+"px"},y:function(){n.style.top=e.y+"px"},width:function(){n.style.width=e.width+"px",e.backgroundImage&&h()},height:function(){n.style.height=e.height+"px",e.backgroundImage&&h()},backgroundPositionY:h,backgroundImage:h,backgroundSize:function(){n.style.backgroundSize=e.backgroundSize+"px"},innerHTML:function(){n.innerHTML=e.innerHTML},pointer:function(){n.style.cursor=e.pointer},opacity:function(){n.style.opacity=e.opacity},fontWeight:function(){n.style.fontWeight=e.fontWeight},fontSize:function(){n.style.fontSize=e.fontSize+"px"},fontFamily:function(){n.style.fontFamily=e.fontFamily},color:function(){n.style.color=e.color},textShadow:function(){n.style.textShadow=e.textShadow},borderRadius:function(){n.style.borderRadius=e.borderRadius},border:function(){n.style.border=e.border},borderTop:function(){n.style.borderTop=e.borderTop},borderRight:function(){n.style.borderRight=e.borderRight},borderBottom:function(){n.style.borderBottom=e.borderBottom},borderLeft:function(){n.style.borderLeft=e.borderLeft},padding:function(){n.style.padding=e.padding},boxShadow:function(){n.style.boxShadow=e.boxShadow},lineHeight:function(){n.style.lineHeight=e.lineHeight},background:function(){n.style.background=e.background},transform:function(){n.style.transform=e.transform},title:function(){n.setAttribute("title",e.title)},isItsepia:function(){n.className+="sepia"},alignText:function(){n.style.textAlign=e.alignText},zIndex:function(){n.style.zIndex=e.zIndex},overflow:function(){n.style.overflow=e.overflow},textDecoration:function(){n.style.textDecoration=e.textDecoration},rotate:function(){n.style.transform="rotate("+e.rotate+"deg)"}};this.animate=function(){if(e.animPlayed&&i)for(let t in e.animTracks)e.proccessTrack(t)},this.proccessTrack=function(t){let i;switch((i=e.animTracks[t][e.animData[t].frameN]).type){case GUI.ANIM_TYPE_ROTATE:i.currentAngle>=360&&(i.currentAngle=0),e.transform="rotate("+(i.currentAngle+=i.angle)+"deg)",e.redraw();break;case GUI.ANIM_TYPE_GOTO:e.animData[t].frameN=i.pos;break;case GUI.ANIM_TYPE_MOVIE:i.imageN++,i.imageN===i.images.length&&(i.imageN=0),e.backgroundImage=i.images[i.imageN],e.redraw();break;case GUI.ANIM_TYPE_MOVE:e.x+=i.vX,e.y+=i.vY,e.redraw();break;case GUI.ANIM_TYPE_PAUSE:break;case GUI.ANIM_TYPE_STOP:e.animPlayed=!1,i.callback&&i.callback()}e.animData[t].counter++,i.duration&&e.animData[t].counter>i.duration&&(e.animData[t].frameN++,e.animData[t].counter=0,void 0===e.animTracks[t][e.animData[t].frameN]&&(e.animPlayed=!1,e.animData[t].frameN=0,i.callback&&i.callback()))}},GUIDom.lastId=0,void 0!==window.GUIDom&&(window.GUIDom.__path="../client/components/base/GUIDom.js"),Images=function(){this.getPath=function(e){return this.getMeta(e).path},this.getHeight=function(e){return this.getMeta(e).h},this.getWidth=function(e){return this.getMeta(e).w},this.getX=function(e){return this.getMeta(e).x},this.getY=function(e){return this.getMeta(e).y};let e={path:"",w:void 0,h:void 0,x:0,y:0},t=[];this.getMeta=function(i){return i&&0===i.indexOf("https://")||0===i.indexOf("http://")?(e.path="",e):i&&window.imagesData[i]?window.imagesData[i]:-1!==t.indexOf(i)?e:(t.push(i),Logs.log("Image url not found for: "+i,Logs.LEVEL_ERROR),e.path="",e)}},Images=new Images,void 0!==window.Images&&(window.Images.__path="../client/components/base/Images.js"),CONST_IS_SERVER_SIDE&&(m=require("fs")),Logs=function(){let e=this,t=null,i=[];this.init=function(e){t=p.Logs.triggerLevel;for(let e=0;e<100;e++)i.push("--dummy--");e()},this.showCache=function(){for(let e in i)i[e]},this.log=function(s,a,l,r){let c,h,d,g,u,f,p,I,_,E;if(a||(a=Logs.LEVEL_DETAIL),!(a<t)){switch(p=(c=new Date).getFullYear(),u=n(c.getDate()),f=n(c.getMonth()+1),I=n(c.getHours()),_=n(c.getMinutes()),E=n(c.getSeconds()),d=(h=CONST_IS_CLIENT_SIDE?_+":"+E:u+"-"+f+"-"+p+" "+I+":"+_+":"+E)+" ["+(g=o[a])+"] "+s,l||(l=""),CONST_IS_SERVER_SIDE&&l&&(l=JSON.stringify(l)),i.push(d),i.shift(),r){default:switch(a){case Logs.LEVEL_ERROR:console.error(" > "+d,l);break;case Logs.LEVEL_WARNING:console.warn(" > "+d,l);break;default:console.log(" > "+d,l)}break;case Logs.CHANNEL_VK_PAYMENTS:m.writeFile(CONST_DIR_SERVER+"/logs/vk_payments.log",d+l+"\r\n",{flag:"a"},function(){});break;case Logs.CHANNEL_VK_STUFF:m.writeFile(CONST_DIR_SERVER+"/logs/vk_stuff.log",d+l+"\r\n",{flag:"a"},function(){});break;case Logs.CHANNEL_VK_HEALTH:m.writeFile(CONST_DIR_SERVER+"/logs/vk_health.log",d+l+"\r\n",{flag:"a"},function(){})}if(a!==Logs.LEVEL_ERROR&&Logs.LEVEL_FATAL_ERROR,a===Logs.LEVEL_FATAL_ERROR)throw e.showCache(),new Error("Vse polamalos'!")}};let n=function(e){return"00000".substr(0,2-e.toString().length)+e};this.setLevel=function(e){t=e},this.LEVEL_DETAIL=1,this.LEVEL_NOTIFY=2,this.LEVEL_WARNING=3,this.LEVEL_ERROR=4,this.LEVEL_FATAL_ERROR=5,this.alert=function(e,i){e<t||alert(i)};let o={};o[this.LEVEL_DETAIL]="d",o[this.LEVEL_NOTIFY]="N",o[this.LEVEL_WARNING]="w",o[this.LEVEL_ERROR]="E",o[this.LEVEL_FATAL_ERROR]="FE"},Logs=new Logs,Logs.CHANNEL_VK_PAYMENTS=1,Logs.CHANNEL_VK_STUFF=2,Logs.CHANNEL_VK_HEALTH=3,Logs.depends=[],void 0!==window.Logs&&(window.Logs.__path="components/base/Logs.js"),OnIdle=function(){let e=this;this.stack=[],this.init=function(e){setTimeout(OnIdle.iterate,15*p.OnIdle.animateInterval),e()},this.register=function(t){e.stack.push(t)},this.iterate=function(){for(let t in e.stack)e.stack[t]();setTimeout(OnIdle.iterate,p.OnIdle.animateInterval)}},OnIdle=new OnIdle,void 0!==window.OnIdle&&(window.OnIdle.__path="../client/components/base/OnIdle.js"),PageController=function(){let e,t=this,i=[];this.addBlocks=function(e){e.forEach(function(e){i.push({block:e,showed:!1}),e.init||Logs.log("PageController.addPage. block must have method init(). ",Logs.LEVEL_FATAL_ERROR,e),e.show||Logs.log("PageController.addPage. block must have method show().",Logs.LEVEL_FATAL_ERROR,e),e.hide||Logs.log("PageController.addPage. block must have method hide()",Logs.LEVEL_FATAL_ERROR,e),e.redraw||Logs.log("PageController.addPage. block must have method redraw()",Logs.LEVEL_FATAL_ERROR,e),e.init()})},this.showBlocks=function(e){let n;for(let t in i){n=!1;for(let o in e)i[t].block===e[o]&&(n=!0);n?!1===i[t].showed&&(i[t].block.show(),i[t].showed=!0):!0===i[t].showed&&(i[t].block.hide(),i[t].showed=!1)}t.redraw()};let n=!1;this.redrawCount=0,this.pendingData=function(e){n=e};let o=null;this.redraw=function(){if(n)o||(o=setTimeout(PageController.redraw,1e3));else{o=null,PageController.redrawCount++;for(let e in i)i[e].block.redraw()}},this.showPage=function(i){e=i,t.showBlocks(i.blocks)},this.isShowedNow=function(t){return t===e},this.getCurrentPage=function(){return e}},PageController=new PageController,void 0!==window.PageController&&(window.PageController.__path="../client/components/base/PageController.js"),Profiler=function(){this.start=function(e){},this.stop=function(e){},this.getNewId=function(e){},this.printReport=function(){},this.saveToDB=function(){},this.getTextReport=function(){},this.init=function(e){}},Profiler=new Profiler,void 0!==window.Profiler&&(window.Profiler.__path="../client/components/base/Profiler.js"),SocNet=function(){let e=this,t=null;this.init=function(t){switch(Logs.log("SocNet.Init()",Logs.LEVEL_NOTIFY),e.getType()){case SocNet.TYPE_VK:e.__proto__=SocNetVK;break;case SocNet.TYPE_STANDALONE:e.__proto__=SocNetStandalone;break;default:Logs.log("Wrong soc net type",Logs.LEVEL_FATAL_ERROR)}e.__proto__.init(t)},this.getType=function(){return t||(SocNetVK.detectIsItThat()&&(t=SocNet.TYPE_VK),SocNetStandalone.detectIsItThat()&&(t=SocNet.TYPE_STANDALONE),t||Logs.log("Не удалось определить тип социальной сети(платформы)",Logs.LEVEL_FATAL_ERROR)),t}},SocNet=new SocNet,SocNet.TYPE_VK=1,SocNet.TYPE_STANDALONE=2,SocNet.SEX_UNKNOWN=1,SocNet.SEX_WOMAN=2,SocNet.SEX_MAN=3,void 0!==window.SocNet&&(window.SocNet.__path="../client/components/base/SocNet.js"),SocNetStandalone=function(){this.init=function(){},this.getAuthParams=function(){return{}},this.getUserProfileUrl=function(){return Logs.log("TODO Me, SocNetStandalone.getUserProfileUrl",Logs.LEVEL_WARNING),"/notFound/todo/me/please/:)"},this.openInviteFriendDialog=function(){Logs.log("todo me SocNetStandalone.openIvniteFirendDialog",Logs.LEVEL_WARNING),alert("Sorry, but functional is not realized!")},this.getSocNetUserId=function(){let e;return(e=parseInt(t("soc-net-user-id")))||(Logs.log("TODO Me. SocNetStandlaone.getSocNetUesrId and ... guset mode :)",Logs.LEVEL_WARNING),e=111),e};let e=[];for(let t=0;t<1e4;t++)e.push(t);this.getFriendIds=function(t){t(e)},this.getUserInfo=function(e,t){let i=["Кириллов Юрий Валериевич /images/field-barrel.png","Пахомов Александр Григорьевич /images/field-box.png","Негода Устин Леонидович /images/field-red.png","Грабчак Роман Андреевич /images/field-green.png","Наумов Людвиг Артёмович /images/field-blue.png","Симонов Игнатий Васильевич /images/field-purple.png","Харитонов Яромир Александрович /images/field-yellow.png","Носков Людвиг Романович /images/field-sand.png","Крюков Марк Романович /images/field-poly-color.png","Киранов Марат Романович /images/field-gold.png","Чубайк Николай Викторович /images/field-poly-color.png","Пушкин Александр Сергеевич /images/field-alpha.png","Билл Гейтс Ибнабабн /images/field-beta.png","Стив Джоб Jobs /images/field-gamma.png"],n={};this.getSocNetUserId(),n.first_name=i[e%i.length].split(" ")[0],n.last_name=i[e%i.length].split(" ")[1],n.photo_50=i[e%i.length].split(" ")[3],n.photo_100=i[e%i.length].split(" ")[3],n.id=e,n.sex=SocNet.SEX_UNKNOWN,t([n])},this.openOrderDialog=function(e){let t=DataShop.getGoldProductByPrice(e);confirm("Купить "+t.quantity+"монет за "+e+" стенделонов?")},this.detectIsItThat=function(){return"STANDALONE"===window.PLATFORM_ID}},SocNetStandalone=new SocNetStandalone,void 0!==window.SocNetStandalone&&(window.SocNetStandalone.__path="../client/components/base/SocNetStandalone.js"),SocNetVK=function(){let e={};this.getAuthParams=function(){return{authKey:e.auth_key,appId:e.api_id}},this.getUserProfileUrl=function(e,t){return"http://vk.com/id"+t},this.openInviteFriendDialog=function(){VK.callMethod("showInviteBox")},this.openOrderDialog=function(e){VK.callMethod("showOrderBox",{type:"votes",votes:e})},this.getFriendIds=function(e){VK.api("friends.getAppUsers",{},function(t){e(t.response)})},this.getUserInfo=function(e,t){VK.api("users.get",{user_ids:e,fields:"photo_50,photo_100"},function(e){t(e.response)})},this.init=function(){let i,n;i=function(){Logs.log("VK client API inited.",Logs.LEVEL_NOTIFY)},n=function(){alert("Произошла ошибка доступа к вКонтакте, обратитесь к автору приложения."),Logs.log("SocNetVK Fail",Logs.LEVEL_FATAL_ERROR)},VK.init(i,n,"5.95"),e={viewer_id:t("viewer_id"),api_id:t("api_id"),auth_key:t("auth_key"),secret:t("secret"),access_token:t("access_token")}},this.getSocNetUserId=function(){return e.viewer_id},this.detectIsItThat=function(){return"VK"==window.PLATFORM_ID}},SocNetVK=new SocNetVK,void 0!==window.SocNetVK&&(window.SocNetVK.__path="../client/components/base/SocNetVK.js"),Sounds=function(){let e=this,t={};this.enabled=!0,this.PATH_CHALK="/sounds/chalk.mp3",this.toggle=function(){e.enabled?e.off():e.on()},this.isEnabled=function(){return e.enabled},this.on=function(){e.enabled=!0,document.cookie="settings_sound=on"},this.off=function(){e.enabled=!1,document.cookie="settings_sound=off"},this.play=function(i,n){e.enabled&&(t[i]||(t[i]=new Audio(i+"?t=1123")),n||(n=1),t[i].volume=n,t[i].play())},-1!==document.cookie.search("settings_sound=off")&&e.off()},Sounds=new Sounds,void 0!==window.Sounds&&(window.Sounds.__path="../client/components/base/Sounds.js"),WebSocketClient=function(){let e,t=this,i=null,n=null,o=null,s=null;this.init=function(t){o="https:"==window.document.location.protocol?"wss":"ws",i=p.WebSocketClient.host,n=p.WebSocketClient.port,e=p.WebSocketClient.url,t()},this.onData=null,this.onConnect=null,this.onDisconnect=null,this.sendData=function(e){return r.push(e),E(),!0},this.run=function(){a(),d()};let a=function(){"function"!=typeof t.onConnect&&Logs.log("onConnect must be function",Logs.LEVEL_FATAL_ERROR,t.onConnect),"function"!=typeof t.onDisconnect&&Logs.log("onConnect must be function",Logs.LEVEL_FATAL_ERROR,t.onDisconnect),"function"!=typeof t.onData&&Logs.log("onConnect must be function",Logs.LEVEL_FATAL_ERROR,t.onData)},l=!1,r=[],c=null,h=0,d=function(){g()},g=function(){let t;h++,t=o+"://"+i+":"+n+e,Logs.log("WebSocket, connectCount:"+h,Logs.LEVEL_NOTIFY,{uri:t}),(c=new WebSocket(t)).onopen=u,c.onclose=f,c.onmessage=I,c.onerror=_},u=function(){l=!0,E(),s=++WebSocketClient.connectionId,t.onConnect(s)},f=function(e){l=!1,h--,e.wasClean?Logs.log("WebSocket: Соединение закрыто успешно."):Logs.log("WebSocket: Соединение закрыто, отсутствует соединение."),Logs.log("WebSocket: Код: "+e.code+" причина: "+e.reason),t.onDisconnect(s),setTimeout(m,3e3)},m=function(){!1===l&&(Logs.log("Try reconnect",Logs.LEVEL_NOTIFY),h<3&&g())},I=function(e){t.onData(e.data,s)},_=function(e){Logs.log("WebSocket: Ошибка ",Logs.LEVEL_NOTIFY,e.timeStamp)},E=function(){let e;r.length&&l&&(e=r.shift(),c.send(e),r.length&&setTimeout(E,1500))}},WebSocketClient.connectionId=0,void 0!==window.WebSocketClient&&(window.WebSocketClient.__path="../client/components/base/WebSocketClient.js");let p={Logs:{triggerLevel:Logs.LEVEL_DETAIL},WebSocketClient:{host:"local.host",port:443,url:"/service"},SocNet:{appId:6221265},OnIdle:{animateInterval:1e3/33.3,second:-1,animStep:1}};p.OnIdle.second=33.3*p.OnIdle.animateInterval/p.OnIdle.animStep,void 0!==window["config.local.host.tri-base"]&&(window["config.local.host.tri-base"].__path="../client/config.local.host.tri-base.js"),window.onload=function(){global=window,process={},process.exit=function(){throw console.log("Unexpected termination of work!"),document.body.innerHTML="server is broken!",new Error("server is broken!")},LogicMain=new LogicMain,LogicMain.main()},void 0!==window.run&&(window.run.__path="../client//run.js"),SAPIChest=function(){this.openChest=function(){ApiRouter.executeRequest("SAPIChest","openChest",arguments)}},SAPIChest=new SAPIChest,SAPIMap=function(){this.reloadLevels=function(){ApiRouter.executeRequest("SAPIMap","reloadLevels",arguments)},this.sendMeMapInfo=function(){ApiRouter.executeRequest("SAPIMap","sendMeMapInfo",arguments)},this.sendMeUsersScore=function(){ApiRouter.executeRequest("SAPIMap","sendMeUsersScore",arguments)},this.finishLevel=function(){ApiRouter.executeRequest("SAPIMap","finishLevel",arguments)}},SAPIMap=new SAPIMap,SAPIStuff=function(){this.sendMeStuff=function(){ApiRouter.executeRequest("SAPIStuff","sendMeStuff",arguments)},this.usedHummer=function(){ApiRouter.executeRequest("SAPIStuff","usedHummer",arguments)},this.usedShuffle=function(){ApiRouter.executeRequest("SAPIStuff","usedShuffle",arguments)},this.usedlightning=function(){ApiRouter.executeRequest("SAPIStuff","usedlightning",arguments)},this.buyHummer=function(){ApiRouter.executeRequest("SAPIStuff","buyHummer",arguments)},this.buyShuffle=function(){ApiRouter.executeRequest("SAPIStuff","buyShuffle",arguments)},this.buylightning=function(){ApiRouter.executeRequest("SAPIStuff","buylightning",arguments)},this.buyHealth=function(){ApiRouter.executeRequest("SAPIStuff","buyHealth",arguments)}},SAPIStuff=new SAPIStuff,SAPITimeServer=function(){this.sendMeTime=function(){ApiRouter.executeRequest("SAPITimeServer","sendMeTime",arguments)}},SAPITimeServer=new SAPITimeServer,SAPIUser=function(){this.authorizeByVK=function(){ApiRouter.executeRequest("SAPIUser","authorizeByVK",arguments)},this.authorizeByStandalone=function(){ApiRouter.executeRequest("SAPIUser","authorizeByStandalone",arguments)},this.sendMeUserInfo=function(){ApiRouter.executeRequest("SAPIUser","sendMeUserInfo",arguments)},this.sendMeUserListInfo=function(){ApiRouter.executeRequest("SAPIUser","sendMeUserListInfo",arguments)},this.sendMeUserIdsBySocNet=function(){ApiRouter.executeRequest("SAPIUser","sendMeUserIdsBySocNet",arguments)},this.onPlayFinish=function(){ApiRouter.executeRequest("SAPIUser","onPlayFinish",arguments)},this.onPlayStart=function(){ApiRouter.executeRequest("SAPIUser","onPlayStart",arguments)},this.zeroLife=function(){ApiRouter.executeRequest("SAPIUser","zeroLife",arguments)}},SAPIUser=new SAPIUser,ApiRouter.map2={SAPIChest:SAPIChest,SAPIMap:SAPIMap,SAPIStuff:SAPIStuff,SAPITimeServer:SAPITimeServer,SAPIUser:SAPIUser},document.addEventListener("DOMContentLoaded",function(){GUI.init(),PageController.addBlocks([PageBlockBackground,PageBlockField,PageBlockMaps,PageBlockPanel,PageBlockWizard,PageBlockZDialogs]),PageField.init(),PageMain.init()})}___();
function _(e){CONST_IS_SERVER_SIDE=!1,CONST_IS_CLIENT_SIDE=!0,void 0!==e.constants&&(e.constants.__path="../client/core/constants.js");let t=console.log,i=function(t){let i=e.location.search.substring(1).split("&");for(let e=0;e<i.length;e++){let n=i[e].split("=");if(n[0]===t)return n[1]}De.log("Query Variable "+t+" not found",De.LEVEL_WARNING)};e.requestAnimationFrame||(e.requestAnimationFrame=e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(t,i){return e.setTimeout(t,1e3/60)}),e.cancelAnimationFrame||(e.cancelAnimationFrame=e.mozCancelAnimationFrame||e.webkitCancelAnimationFrame||e.msCancelAnimationFrame),void 0!==e.functions&&(e.functions.__path="../client/core/functions.js");let n={locks:0,lock:function(){n.locks++},release:function(){n.locks--},free:function(){return 0===n.locks},busy:function(){return!n.free()}};void 0!==e.AnimLocker&&(e.AnimLocker.__path="../client/components/application/anims/AnimLocker.js");let o={anim:function(e,t){let i,o,s,l;s=0,o=new e;for(let e in t)t.hasOwnProperty(e)&&(o[e]=t[e]);(i=Array.from(arguments)).shift(),i.shift(),o.init.apply(o,i),o.skipAnimLock||n.lock();let r=function(){s+=We.OnIdle.animStep,o.iterate(s)?l=requestAnimationFrame(r):a()},a=function(){cancelAnimationFrame(l),o.finish&&o.finish(),o.skipAnimLock||n.release(),t.onFinish&&t.onFinish()};return r(),a},getFrameUrl:function(e,t,i){return e+(Math.floor(t%i)+1)+".png"},settings:{fallVelocity:5}};void 0!==e.Animate&&(e.Animate.__path="../client/components/application/anims/Animate.js");let s=function(){let e=70;this.init=function(t){e=t,this.skipAnimLock=!0},this.iterate=function(t){return this.dom.y=20*t-500,this.dom.redraw(),this.dom.y<e},this.finish=function(){this.dom.y=e,this.dom.redraw()}},l=function(){let e=70;this.init=function(t){e=t,this.skipAnimLock=!0,e=this.dom.y},this.iterate=function(t){return this.dom.y=e+-20*t,this.dom.redraw(),this.dom.y>-500},this.finish=function(){this.dom.y=-500,this.dom.redraw()}};void 0!==e.dialogs&&(e.dialogs.__path="../client/components/application/anims/dialogs.js");let r=function(){let e,t,i,n,o,s;i=5,o=Math.floor(20),n=Math.floor(o/2),this.init=function(i,n){t={x:5*(n.x-i.x),y:5*(n.y-i.y)},e=this.gemDoms[i.x][i.y],s={x:e.x,y:e.y}},this.iterate=function(i){return i>n?(e.x=s.x+n*t.x-t.x*(i-n),e.y=s.y+n*t.y-t.y*(i-n)):(e.x=s.x+t.x*i,e.y=s.y+t.y*i),e.redraw(),e.bindedDoms&&(e.bindedDoms.x=e.x,e.bindedDoms.y=e.y,e.bindedDoms.redraw()),i+1<o}},a=function(){let e;this.init=function(t,i){e=this.animDoms.pop();let n=Field.getVisibleLength(t,i);e.width=n.length*C.BLOCK_WIDTH,e.height=Pe.getHeight("anim-light-1.png"),i===x.WITH_LIGHTNING_VERTICAL&&(e.rotate=90,e.x=t.x*C.BLOCK_WIDTH,e.y=n.lower*C.BLOCK_HEIGHT-(Pe.getHeight("anim-light-1.png")-C.BLOCK_HEIGHT)/2,e.x-=(e.width-C.BLOCK_WIDTH)/2,e.y+=(e.width-C.BLOCK_WIDTH)/2),i===x.WITH_LIGHTNING_HORIZONTAL&&(e.rotate=0,e.x=n.lower*C.BLOCK_WIDTH,e.y=t.y*C.BLOCK_HEIGHT-(Pe.getHeight("anim-light-1.png")-C.BLOCK_HEIGHT)/2),e.show(),e.redraw()},this.iterate=function(t){if(e.backgroundImage=o.getFrameUrl("anim-light-",.5*t,5),e.redraw(),t<15)return!0},this.finish=function(){e.hide(),this.animDoms.push(e)}},c=function(){let e;this.init=function(t){(e=this.animDoms.pop()).x=t.x*C.BLOCK_WIDTH-(Pe.getWidth("anim-hd-1.png")-C.BLOCK_WIDTH)/2,e.y=t.y*C.BLOCK_HEIGHT-(Pe.getHeight("anim-hd-1.png")-C.BLOCK_HEIGHT)/2,e.width=null,e.height=null,e.backgroundImage="anim-hd-1.png",e.show(),e.redraw()},this.iterate=function(t){return e.backgroundImage=o.getFrameUrl("anim-hd-",1*t,15),e.redraw(),t<15},this.finish=function(){this.animDoms.push(e),e.hide()}},h=function(){let e,t,i,n,o;i=5,n=Math.floor(10)-1,this.init=function(i,n){t={x:5*(n.x-i.x),y:5*(n.y-i.y)},e=this.gemDoms[i.x][i.y],o={x:e.x,y:e.y}},this.iterate=function(i){return e.x=o.x+t.x*i,e.y=o.y+t.y*i,e.redraw(),e.bindedDoms&&(e.bindedDoms.x=e.x,e.bindedDoms.y=e.y,e.bindedDoms.redraw()),i<n}},u=function(){let e,t=o.settings.fallVelocity;this.init=function(t){(e=this.gemDoms[t.x][t.y]).x=t.x*C.BLOCK_WIDTH,e.y=t.y*C.BLOCK_HEIGHT,e.backgroundPositionY=C.BLOCK_HEIGHT,e.height=0,e.width=C.BLOCK_WIDTH,e.backgroundImage=C.objectImages[Field.getGemId(t)],e.redraw(),e.show()},this.iterate=function(i){return e.height=t*i,e.backgroundPositionY=C.BLOCK_HEIGHT-t*i,e.redraw(),e.height<C.BLOCK_HEIGHT}},d=function(){let e,t,i=this,n=o.settings.fallVelocity;this.init=function(n){e=[],n.forEach(function(n){i.gemDoms[n.from.x][n.from.y].hide(),t=i.gemDoms[n.to.x][n.to.y],e.push(t),t.fallMode="just",t.startY=(n.to.y-1)*C.BLOCK_HEIGHT,t.backgroundImage=C.objectImages[Field.getGemId({x:n.to.x,y:n.to.y})],t.x=n.to.x*C.BLOCK_WIDTH,t.y=n.to.y*C.BLOCK_HEIGHT,t.show(),!Field.isVisible({x:n.to.x,y:n.to.y-1})&&Field.isVisible(n.to)&&(t.fallMode="to-show"),Field.isVisible({x:n.to.x,y:n.to.y-1})&&!Field.isVisible(n.to)&&(t.fallMode="to-hide"),"to-show"===t.fallMode&&(t.y=n.to.y*C.BLOCK_HEIGHT,t.height=25,t.width=C.BLOCK_WIDTH,t.backgroundPositionY=C.BLOCK_HEIGHT),t.redraw()})},this.iterate=function(t){let i;return i=!1,e.forEach(function(e){switch(e.fallMode){case"to-hide":e.y=e.startY+n*t,e.height=C.BLOCK_HEIGHT-n*t,i|=e.y<e.startY+C.BLOCK_HEIGHT;break;case"to-show":e.height=n*t,e.backgroundPositionY=C.BLOCK_HEIGHT-n*t,i|=e.height<C.BLOCK_HEIGHT;break;case"just":e.y=e.startY+n*t,i|=e.y<e.startY+C.BLOCK_HEIGHT}e.bindedDoms&&(e.bindedDoms.x=e.x,e.bindedDoms.y=e.y,e.bindedDoms.redraw()),e.redraw()}),i},this.finish=function(){e.forEach(function(e){e.backgroundPositionY=0,e.height=C.BLOCK_HEIGHT,e.redraw()})}},g=function(){let e;this.init=function(t,i){(e=this.animDoms.pop()).x=t-Pe.getWidth("anim-shuffle-1.png")/2,e.y=i-Pe.getHeight("anim-shuffle-1.png")/2,e.width=Pe.getWidth("anim-shuffle-1.png"),e.height=Pe.getHeight("anim-shuffle-1.png"),e.backgroundImage="anim-shuffle-1.png",e.opacity=.7,e.rotate=0,e.show()},this.iterate=function(t){return e.rotate=20*t,e.redraw(),t<18},this.finish=function(){e.hide(),this.animDoms.push(e)}},f=function(){let e,t;this.init=function(i,n){o.hintActive=!0,this.skipAnimLock=!0,t=n,e=[],i.forEach(function(t){e.push({startY:this.gemDoms[t.x][t.y].y,dom:this.gemDoms[t.x][t.y]})},this)},this.iterate=function(i){return e.forEach(function(e){e.dom.y=e.startY+3*Math.cos(Math.PI*i/15),e.dom.redraw(),e.dom.bindedDoms&&(e.dom.bindedDoms.x=e.x,e.dom.bindedDoms.y=e.y,e.dom.bindedDoms.redraw())}),t||!n.busy()},this.finish=function(){o.hintActive=!1}},p=function(){let e,t;this.init=function(t){this.skipAnimLock=!0,e=[t]},this.iterate=function(i){return t=4*Math.cos(Math.PI/15*i),e.forEach(function(e){e.x=e.p.x+t/2,e.y=e.p.y+t/2,e.dom.width=50-t,e.dom.height=50-t,e.redraw()}),!0},this.finish=function(){o.hintActive=!1}},m=function(){this.init=function(){},this.iterate=function(e){return e<10}};void 0!==e["element-field"]&&(e["element-field"].__path="../client/components/application/anims/element-field.js");let _=function(){this.log=function(e,t,i){console.log(t,i)}};_=new _,void 0!==e.CAPILog&&(e.CAPILog.__path="../client/components/application/capi/CAPILog.js");let E=function(){let e,t=this;this.onMapInfoCallback=null,this.gotMapsInfo=function(s,l,r,a,c,h,u){e||(e={"□":x.CELL_VISIBLE," ":x.CELL_INVISIBLE,"?":x.OBJECT_RANDOM,H:x.OBJECT_HOLE,R:x.OBJECT_RED,G:x.OBJECT_GREEN,B:x.OBJECT_BLUE,Y:x.OBJECT_YELLOW,P:x.OBJECT_PURPLE,S:x.OBJECT_SAND,"△":x.OBJECT_RED,"◆":x.OBJECT_GREEN,"▭":x.OBJECT_BLUE,"◇":x.OBJECT_YELLOW,"⨀":x.OBJECT_PURPLE,"ᨔ":x.OBJECT_POLY_COLOR,"ᥩ":x.OBJECT_BARREL,$:x.OBJECT_GOLD,t:x.OBJECT_TILE,"Ξ":x.OBJECT_TILE,"α":x.OBJECT_SPIDER_ALPHA,"‖":x.OBJECT_BLOCK,"β":x.OBJECT_SPIDER_BETA,"γ":x.OBJECT_SPIDER_GAMMA,b:x.OBJECT_BOX,"■":x.OBJECT_BOX,"╲":x.OBJECT_CHAIN_A,"╱":x.OBJECT_CHAIN_B,X:[x.OBJECT_CHAIN_A,x.OBJECT_CHAIN_B],"⭤":x.WITH_LIGHTNING_HORIZONTAL,"⭥":x.WITH_LIGHTNING_VERTICAL,"+":x.WITH_LIGHTNING_CROSS,"*":x.IS_EMITTER}),S.setMapById(l,r),a.forEach(function(e){e.layers.gems||(e.layers.gems=n()),void 0===e.layers.special&&(e.layers.special=[]),void 0===e.layers.special[0]&&(e.layers.special[0]=[]),"string"==typeof e.layers.special[0]&&(e.layers.special=[e.layers.special]),e.layers.special.forEach(function(e){e.unshift("")}),e.layers.mask.unshift(""),e.layers.gems.unshift(""),e.layers.special.unshift(i()),e.layers.mask=o(e.layers.mask,!1),e.layers.gems=o(e.layers.gems,!1),e.layers.special=o(e.layers.special,!0),C.setPointData(e)}),h.forEach(function(e){b.setData(e)}),c.forEach(function(e){C.setPointUserScore(e.userId,e.pointId,e.score)}),u.forEach(function(e){b.setOpened(e.chestId)}),t.onMapInfoCallback&&(t.onMapInfoCallback.call(),t.onMapInfoCallback=null)},this.setCallbackOnMapsInfo=function(e){t.onMapInfoCallback=e},this.gotUserScores=function(e,t){t.forEach(function(e){C.setPointUserScore(e.userId,e.pointId,e.score)}),ve.redraw()};let i=function(){let e="";for(let t=0;t<C.FIELD_MAX_WIDTH;t++)e+="*";return[e]},n=function(){let e=[];for(let t=0;t<C.FIELD_MAX_HEIGHT;t++){e[t]="";for(let i=0;i<C.FIELD_MAX_HEIGHT;i++)e[t]+="?"}return e},o=function(t,i){let n;return n=[],"string"==typeof t[0]&&(t=[t]),t.forEach(function(t){t.forEach(function(o,s){o.split("").forEach(function(o,l){e[o]||(De.log("error",De.LEVEL_DETAIL,[t]),De.alert(De.LEVEL_ERROR,"ERROR: Нет такого символа в мепинге."+o)),n[l]||(n[l]=[]),i?(n[l][s]||(n[l][s]=[]),n[l][s]=n[l][s].concat(e[o].length?e[o]:[e[o]])):n[l][s]=e[o]})})}),n}};E=new E,void 0!==e.CAPIMap&&(e.CAPIMap.__path="../client/components/application/capi/CAPIMap.js");let I=function(){this.gotStuff=function(e,t){ie.updateStuff(t)},this.incrementGold=function(e,t){ie.giveAGold(t),ve.redraw()},this.decrementGold=function(e,t){ie.usedGold(t),ve.redraw()}};I=new I,void 0!==e.CAPIStuff&&(e.CAPIStuff.__path="../client/components/application/capi/CAPIStuff.js");let y=function(){this.gotServerTime=function(e,t){ne.setServerTime(t)}};y=new y,void 0!==e.CAPITimeServer&&(e.CAPITimeServer.__path="../client/components/application/capi/CAPITimeServer.js");let T=function(){this.authorizeSuccess=function(e,t){T.updateUserInfo(e,t),oe.authorizeSuccess(t.id)},this.updateUserInfo=function(e,t){t.createTimestamp=ne.convertToClient(t.createTimestamp),t.lastLoginTimestamp=ne.convertToClient(t.lastLoginTimestamp),t.fullRecoveryTime=ne.convertToClient(t.fullRecoveryTime),oe.updateUserInfo(t)},this.updateUserListInfo=function(e,t){ve.pendingData(!0),t.forEach(function(t){T.updateUserInfo(e,t)}),ve.pendingData(!1)},this.gotFriendsIds=function(e,t){oe.setFriendIds(t)},this.setOneHealthHide=function(e,t){ce.oneHealthHide=t}};T=new T,void 0!==e.CAPIUser&&(e.CAPIUser.__path="../client/components/application/capi/CAPIUser.js");let b=function(){let e=[{number:1,x:175,y:125},{number:2,x:475,y:225}],t=[],i=[];this.getCoords=function(){return e},this.getById=function(e){return t[e]},this.setData=function(e){t[e.id]=e,ve.redraw()},this.setOpened=function(e){i[e]=!0},this.isItOpened=function(e){return!0===i[e]}};b=new b,void 0!==e.DataChests&&(e.DataChests.__path="../client/components/application/data/DataChests.js");let w={user:{maxHealth:5,healthRecoveryTime:45},app:{width:777,height:500}};CONST_IS_SERVER_SIDE&&(global.DataCross=w),void 0!==e.DataCross&&(e.DataCross.__path="components/application/data/DataCross.js");let S=function(){let e=1,t={},i=[];this.setMapById=function(e,i){t[e]=i,ve.redraw()},this.getCurent=function(){var n;return t[e]||(n||(n=e),i[n]||(i[n]=!0,SAPIMap.sendMeMapInfo(n))),t[e]},this.setCurrentMapId=function(t){t>=S.MAP_ID_MAX||t<=S.MAP_ID_MIN||(e=t)},this.setNextMap=function(){e!==S.MAP_ID_MAX&&e++},this.setPrevMap=function(){e!==S.MAP_ID_MIN&&e--},this.getMapIdFromPointId=function(e){return Math.ceil(oe.getCurrentUser().nextPointId/S.POINTS_PER_MAP)},this.getFirstPointId=function(){return S.POINTS_PER_MAP*(e-1)+1},this.getLastPointId=function(){return this.getFirstPointId()+S.POINTS_PER_MAP-1},this.getPointIdFromPointNumber=function(e){return this.getFirstPointId()+(e-1)},this.getNumberFromPointId=function(e){return e-this.getFirstPointId()+1},this.getFirstChestId=function(){return S.CHESTS_PER_MAP*(e-1)+1},this.getLastChestId=function(){return this.getFirstChestId()+S.CHESTS_PER_MAP-1},this.getChestIdFromChestNumber=function(e){return this.getFirstChestId()+(e-1)},this.countStarsByMapId=function(t){let i,n,o,s,l,r;if(t||(t=e),i=0,!(n=oe.getCurrentUser()))return 0;if(!(o=C.getPointUserScore(t,[n.id])))return 0;for(let e=1;e<=S.POINTS_PER_MAP;e++){if(s=S.getPointIdFromPointNumber(e),!(l=C.getById(s)))return 0;r=0,o[s]&&(o[s][n.id]&&(o[s][n.id].score>=l.score1&&(r=1),o[s][n.id].score>=l.score2&&(r=2),o[s][n.id].score>=l.score3&&(r=3),i+=r))}return i}};(S=new S).MAP_ID_MIN=1,S.MAP_ID_MAX=10,S.POINTS_PER_MAP=18,S.CHESTS_PER_MAP=2,void 0!==e.DataMap&&(e.DataMap.__path="../client/components/application/data/DataMap.js");let x=function(){this.CELL_INVISIBLE=1,this.CELL_VISIBLE=2,this.OBJECT_RANDOM=101,this.OBJECT_RED=102,this.OBJECT_GREEN=103,this.OBJECT_BLUE=104,this.OBJECT_YELLOW=105,this.OBJECT_PURPLE=106,this.OBJECT_SAND=107,this.OBJECT_HOLE=120,this.OBJECT_BARREL=130,this.OBJECT_BLOCK=135,this.OBJECT_POLY_COLOR=140,this.OBJECT_SPIDER_ALPHA=150,this.OBJECT_SPIDER_BETA=160,this.OBJECT_SPIDER_GAMMA=161,this.OBJECT_TILE=170,this.OBJECT_GOLD=180,this.OBJECT_BOX=190,this.OBJECT_CHAIN_A=200,this.OBJECT_CHAIN_B=210,this.IS_EMITTER=1001,this.WITH_LIGHTNING_HORIZONTAL=1010,this.WITH_LIGHTNING_VERTICAL=1011,this.WITH_LIGHTNING_CROSS=1012};x=new x,CONST_IS_SERVER_SIDE&&(global.DataObjects=x),void 0!==e.DataObjects&&(e.DataObjects.__path="components/application/data/DataObjects.js");let C=function(){this.FIELD_MAX_WIDTH=10,this.FIELD_MAX_HEIGHT=11,this.BLOCK_WIDTH=50,this.BLOCK_HEIGHT=50,this.objectImages={},this.objectImages[x.CELL_INVISIBLE]="field-none-2.png",this.objectImages[x.CELL_VISIBLE]="field-cell.png",this.objectImages[x.OBJECT_HOLE]="field-none-2.png",this.objectImages[x.OBJECT_RANDOM]="field-none.png",this.objectImages[x.OBJECT_RED]="field-red.png",this.objectImages[x.OBJECT_GREEN]="field-green.png",this.objectImages[x.OBJECT_BLUE]="field-blue.png",this.objectImages[x.OBJECT_YELLOW]="field-yellow.png",this.objectImages[x.OBJECT_PURPLE]="field-purple.png",this.objectImages[x.OBJECT_SAND]="field-sand.png",this.objectImages[x.OBJECT_BARREL]="field-barrel.png",this.objectImages[x.OBJECT_BLOCK]="field-block.png",this.objectImages[x.OBJECT_POLY_COLOR]="field-poly-color.png",this.objectImages[x.OBJECT_GOLD]="field-gold.png",this.objectImages[x.OBJECT_TILE]="field-tile.png",this.objectImages[x.OBJECT_SPIDER_ALPHA]="field-alpha.png",this.objectImages[x.OBJECT_SPIDER_BETA]="field-beta.png",this.objectImages[x.OBJECT_SPIDER_GAMMA]="field-gamma.png",this.objectImages[x.OBJECT_BOX]="field-box.png",this.objectImages[x.OBJECT_CHAIN_A]="field-chain-a.png",this.objectImages[x.OBJECT_CHAIN_B]="field-chain-b.png",this.objectImages[x.WITH_LIGHTNING_VERTICAL]="spec-light-ver-1.png",this.objectImages[x.WITH_LIGHTNING_HORIZONTAL]="spec-light-hor-1.png",this.objectImages[x.WITH_LIGHTNING_CROSS]="spec-light-cross-1.png",this.healthImages={},this.healthImages[0]="creature-health-0.png",this.healthImages[1]="creature-health-1.png",this.healthImages[2]="creature-health-2.png",this.healthImages[3]="creature-health-3.png",this.objectAnims={};let e=[{number:1,x:61,y:209},{number:2,x:61,y:290},{number:3,x:105,y:371},{number:4,x:197,y:390},{number:5,x:283,y:360},{number:6,x:279,y:274},{number:7,x:214,y:205},{number:8,x:205,y:111},{number:9,x:276,y:55},{number:10,x:371,y:51},{number:11,x:452,y:93},{number:12,x:448,y:185},{number:13,x:404,y:269},{number:14,x:425,y:356},{number:15,x:516,y:386},{number:16,x:608,y:367},{number:17,x:614,y:280},{number:18,x:661,y:211}],t={},i=[];this.getPointsCoords=function(){return e},this.getById=function(e){return i[e]},this.setPointData=function(e){i[e.id]=e,ve.redraw()};let n=null;this.setPlayedId=function(e){n=e},this.getPlayedId=function(){return n},this.getPointUserScore=function(e,i){let n,o,s;n=S.getFirstPointId(e),o=S.getLastPointId(e),s={};for(let e=n;e<=o;e++)for(let n in t[e])-1!==i.indexOf(parseInt(n))&&(s[e]||(s[e]={}),s[e][n]=t[e][n]);return s},this.setPointUserScore=function(e,i,n){t[i]||(t[i]={}),t[i][e]={userId:e,pointId:i,score:n}},this.getScore=function(e,i){return i||(i=oe.getCurrentUser().id),i?(t[e]||(t[e]={}),t[e][i]||(t[e][i]={userId:i,pointId:e,score:0}),t[e][i].score):null},this.countStars=function(e,t,i){let n;return e||(e=C.getPlayedId()),t||(t=oe.getCurrentUser().id),t&&e?(isNaN(i)&&(i=C.getScore(e)),(n=C.getById(e))&&null!==i?i>=n.score3?3:i>=n.score2?2:i>=n.score1?1:0:null):null},this.copyGoals=function(e){let t;t=[];for(let i in e)t.push({id:e[i].id,count:e[i].count});return t},this.init=function(){this.objectAnims[x.WITH_LIGHTNING_HORIZONTAL]=[[{type:Le.ANIM_TYPE_MOVIE,images:["spec-light-hor-1.png","spec-light-hor-2.png","spec-light-hor-3.png","spec-light-hor-4.png","spec-light-hor-5.png"],duration:5},{type:Le.ANIM_TYPE_GOTO,pos:0}]],this.objectAnims[x.WITH_LIGHTNING_VERTICAL]=[[{type:Le.ANIM_TYPE_MOVIE,images:["spec-light-ver-1.png","spec-light-ver-2.png","spec-light-ver-3.png","spec-light-ver-4.png","spec-light-ver-5.png"],duration:5},{type:Le.ANIM_TYPE_GOTO,pos:0}]],this.objectAnims[x.WITH_LIGHTNING_CROSS]=[[{type:Le.ANIM_TYPE_MOVIE,images:["spec-light-cross-1.png","spec-light-cross-2.png","spec-light-cross-3.png","spec-light-cross-4.png","spec-light-cross-5.png"],duration:5},{type:Le.ANIM_TYPE_GOTO,pos:0}]]}};C=new C,void 0!==e.DataPoints&&(e.DataPoints.__path="../client/components/application/data/DataPoints.js");let L=function(){let e=this;this.giveOutPrizes=function(t){t.forEach(function(t){e.giveOutPrize(t)})},this.giveOutPrize=function(e){switch(e.id){case L.PRIZE_STUFF_HUMMER:ie.giveAHummer(e.count);break;case L.PRIZE_STUFF_SHUFFLE:ie.giveAShuffle(e.count);break;case L.PRIZE_STUFF_LIGHTNING:ie.giveALighnting(e.count);break;case L.PRIZE_STUFF_GOLD:ie.giveAGold(e.count)}},this.getImageFor=function(e){let t;switch(e.id){case L.PRIZE_STUFF_GOLD:t="map-way-point-red.png";break;case L.PRIZE_STUFF_HUMMER:t="button-hummer-rest.png";break;case L.PRIZE_STUFF_SHUFFLE:t="button-shuffle-rest.png";break;case L.PRIZE_STUFF_LIGHTNING:t="button-lightning-rest.png"}return t}};(L=new L).PRIZE_STUFF_HUMMER=1,L.PRIZE_STUFF_SHUFFLE=2,L.PRIZE_STUFF_LIGHTNING=3,L.PRIZE_STUFF_GOLD=100,void 0!==e.DataPrizes&&(e.DataPrizes.__path="../client/components/application/data/DataPrizes.js");let O=function(){this.getGoldProductByPrice=function(e){let t;return t=!1,O.gold.forEach(function(i){i.votes===e&&(t=i)}),t}};(O=new O).gold=[{votes:1,quantity:10},{votes:5,quantity:70},{votes:10,quantity:1e3}],O.hummers=[{gold:10,quantity:3,imageSrc:"shop-hummer-1.png"},{gold:15,quantity:6,imageSrc:"shop-hummer-2.png"},{gold:30,quantity:9,imageSrc:"shop-hummer-3.png"}],O.shuffle=[{gold:10,quantity:3,imageSrc:"shop-shuffle-1.png"},{gold:15,quantity:6,imageSrc:"shop-shuffle-2.png"},{gold:30,quantity:9,imageSrc:"shop-shuffle-3.png"}],O.lightning=[{gold:10,quantity:3,imageSrc:"shop-lightning-1.png"},{gold:15,quantity:6,imageSrc:"shop-lightning-2.png"},{gold:30,quantity:9,imageSrc:"shop-lightning-3.png"}],O.healthPrice=100,CONST_IS_SERVER_SIDE&&(global.DataShop=O),void 0!==e.DataShop&&(e.DataShop.__path="components/application/data/DataShop.js");let P=function(e){let t=this,i=!1;this.dialogShowed=!1,this.onShowComplete=null,this.startPosition=-500,this.width=500,this.height=322,this.src=e||"window-2.png",this.bottomPosition=90,this.dom=null,this.pointer=void 0,this.elements=[],this.title=void 0,this.init=function(){let e;(e=Le.createDom(void 0,{width:t.width,height:t.height,backgroundImage:t.src})).x=document.getElementById("appArea").clientWidth/2-t.width/2,e.y=t.startPosition,t.dom=e},this.show=function(){i||(i=!0,t.dom.show(),t.elements.forEach(function(e){e.show()}),t.redraw())},this.hide=function(){i&&(i=!1,t.dom.hide(),t.elements.forEach(function(e){e.hide()}))},this.redraw=function(){i&&(t.dialogShowed||(t.dom.title=t.title,t.dom.pointer=t.pointer,t.dom.redraw()),t.elements=function(e){e.redraw()})},this.showDialog=function(e){return P.addDialog(this,e)},this.showConcreteDialog=function(){t.dialogShowed||(t.show(),t.dialogShowed=!0,o.anim(s,{dom:t.dom,onFinish:function(){t.onShowComplete&&t.onShowComplete(),se.onShowDialog()}},t.bottomPosition),t.redraw())},this.closeDialog=function(){se.onHideDialog(!0),o.anim(l,{dom:t.dom,onFinish:n},t.bottomPosition)};let n=function(){t.dialogShowed=!1,P.removeDialog(),se.onHideDialog(!1)};this.createElement=function(e,i){t.elements.push(Le.createElement(e,i,t.dom))},this.reset=function(e){t.dom.y=t.startPosition,t.dialogShowed=!1,e&&(t.redraw(),t.hide()),P.removeDialog()}};P.queue=[],P.addDialog=function(e,t){if(t){let i,n,o;P.queue.forEach(function(e,n){e===t&&(i=n)}),(n=P.queue.slice(0,i+1)).push(e),o=P.queue.slice(i),P.queue=n.concat(o)}else P.queue.push(e);P.showDialog()},P.removeDialog=function(){Le.unlockEvents(),P.queue.shift(),P.showDialog()},P.showDialog=function(){P.queue.length&&(P.queue[0].showConcreteDialog(),Le.lockEvents(P.queue[0].dom))},void 0!==e.Dialog&&(e.Dialog.__path="../client/components/application/gui_elements/Dialog.js");let A=function(){let e,t=this;this.__proto__=new P,this.init=function(){this.__proto__.init.call(this),Le.pushParent(t.dom),Le.createElement(W,{x:452,y:3,width:100,height:40,srcRest:"button-close-rest.png",srcHover:"button-close-hover.png",srcActive:"button-close-active.png",onClick:function(){t.closeDialog()}}).show(),(e=Le.createElement(X,{x:50,y:70,width:260,height:80,text:""})).show(),Le.popParent()},this.show=function(){this.__proto__.show.call(this)},this.hide=function(){this.__proto__.hide.call(this)},this.redraw=function(){this.__proto__.redraw.call(this),this.dialogShowed&&(e.setText("Нужно собрать еще :"+(this.goalStars-this.mapStars)+" звезд(ы)"),e.redraw())},this.showDialog=function(){this.__proto__.showDialog.call(this),t.redraw()}};void 0!==e.DialogChestNeedStars&&(e.DialogChestNeedStars.__path="../client/components/application/gui_elements/DialogChestNeedStars.js");let D=function(){let e,t=this;this.__proto__=new P;let i={},n={};this.init=function(){this.__proto__.init.call(this),Le.pushParent(t.dom),Le.createElement(W,{x:452,y:3,width:100,height:40,srcRest:"button-close-rest.png",srcHover:"button-close-hover.png",srcActive:"button-close-active.png",onClick:function(){t.closeDialog()}}).show(),(e=Le.createElement(X,{x:40,y:20,width:240,height:80,text:""})).show();for(let e=0;e<4;e++)i[e]=Le.createElement(J,{x:40+50*e,y:90,src:""}),n[e]=Le.createElement(X,{x:60+50*e,y:140,width:50});Le.popParent()},this.show=function(){this.__proto__.show.call(this)},this.hide=function(){this.__proto__.hide.call(this)},this.redraw=function(){if(this.__proto__.redraw.call(this),!this.dialogShowed)return;let o,s;o=b.getById(t.chestId),e.setText("Собраны все звезды! Ты открыл сундук и нашел там:");for(let e=0;e<4;e++)(s=o.prizes[e])?(i[e].src=L.getImageFor(s),n[e].setText(s.count),i[e].show(),n[e].show(),n[e].redraw(),i[e].redraw()):(i[e].hide(),n[e].hide());e.redraw()},this.showDialog=function(){this.__proto__.showDialog.call(this),t.redraw()}};void 0!==e.DialogChestYouWin&&(e.DialogChestYouWin.__path="../client/components/application/gui_elements/DialogChestYouWin.js");let H=function(){let e=this;this.__proto__=new P;let t={},i={};this.init=function(){this.__proto__.width=250,this.__proto__.height=150,this.__proto__.src="window-3.png",this.__proto__.bottomPosition=186,this.__proto__.init.call(this),this.__proto__.onShowComplete=this.onShowComplete,Le.pushParent(e.dom);for(let e in C.objectImages)t[e]=Le.createElement(J,{x:200+e*(C.BLOCK_WIDTH+5),y:30,src:C.objectImages[e]}),i[e]=Le.createElement(X,{x:100+e*(C.BLOCK_WIDTH+5),y:30+C.BLOCK_HEIGHT+5,width:C.BLOCK_WIDTH});Le.createElement(W,{x:195,y:0,srcRest:"button-close-rest.png",srcHover:"button-close-hover.png",srcActive:"button-close-active.png",onClick:function(){e.closeDialog()}},this.dom).show(),Le.popParent()},this.onShowComplete=function(){setTimeout(function(){e.closeDialog()},1.2*We.OnIdle.second)},this.setGoals=function(e){let n,o;for(let e in this.elements)this.elements[e].hide();this.elements=[],o=Pe.getWidth(this.src)/2-e.length*(C.BLOCK_WIDTH+5)/2,n=0;for(let s in e)t[e[s].id].x=o+n,i[e[s].id].x=o+n,i[e[s].id].setText(e[s].count),this.elements.push(t[e[s].id]),this.elements.push(i[e[s].id]),n+=C.BLOCK_WIDTH+5;for(let e in this.elements)this.elements[e].show(),this.elements[e].redraw()}};void 0!==e.DialogGoals&&(e.DialogGoals.__path="../client/components/application/gui_elements/DialogGoals.js");let v=function(){let e=this;this.__proto__=new P;let t,i=null,n=null,o=null,s=null,l=[],r=null,a=null,c=null;this.init=function(){this.__proto__.init.call(this),Le.pushParent(e.dom),(i=Le.createElement(X,{x:135,y:12,width:230,height:40,text:""})).show(),(n=Le.createElement(J,{x:100,y:40,src:"star-off-big.png"})).show(),(o=Le.createElement(J,{x:200,y:40,src:"star-off-big.png"})).show(),(s=Le.createElement(J,{x:300,y:40,src:"star-off-big.png"})).show();for(let e=0;e<3;e++)l[e]={elPhotoScore:Le.createElement(Z,{x:75+75*e+15,y:155})};(r=Le.createElement(Z,{x:355,y:155})).show(),(a=Le.createElement(W,{x:178,y:240,srcRest:"button-red-rest.png",srcHover:"button-red-hover.png",srcActive:"button-red-active.png",onClick:function(){e.closeDialog(),ve.showPage(ge)},title:"НА КАРТУ"})).show(),Le.createElement(W,{x:452,y:3,srcRest:"button-close-rest.png",srcHover:"button-close-hover.png",srcActive:"button-close-active.png",onClick:function(){e.closeDialog(),ve.showPage(ge)}}).show(),Le.popParent()},this.redraw=function(){let e,h,u,d;if(this.__proto__.redraw.call(this),this.dialogShowed){e=oe.getCurrentUser(),h=C.getById(c),i.text="ПРОЙДЕН "+c;for(let e=0;e<3;e++)(u=t[e])&&u.id?(d=C.getScore(h.id,u.id),l[e].elPhotoScore.user=u,l[e].elPhotoScore.score=d,d?(l[e].elPhotoScore.show(),l[e].elPhotoScore.redraw()):l[e].elPhotoScore.hide()):l[e].elPhotoScore.hide();switch(r.user=oe.getCurrentUser(),r.score=C.getScore(h.id),i.redraw(),n.src="star-off-big.png",o.src="star-off-big.png",s.src="star-off-big.png",C.countStars(h.id)){case 3:s.src="star-on-big.png";case 2:o.src="star-on-big.png";case 1:n.src="star-on-big.png"}n.redraw(),o.redraw(),s.redraw(),r.redraw(),0===$.getHealths(e)?a.hide():a.show()}},this.showDialog=function(i){let n;c=i,n=S.getCurent().id,t=oe.getFriendIdsByMapIdAndPointIdWithScore(n,i),this.__proto__.showDialog.call(this),e.redraw()}};void 0!==e.DialogGoalsReached&&(e.DialogGoalsReached.__path="../client/components/application/gui_elements/DialogGoalsReached.js");let B=function(){let e=this;this.__proto__=new P;let t=null;this.init=function(){let i,n,o,s;this.__proto__.init.call(this),n=30,s=80,o=145,Le.pushParent(e.dom),i=Le.createElement(X,{x:135,y:11,width:230,height:40,text:"МАГАЗИН"}),e.elements.push(i),t=Le.createElement(W,{x:175,y:80,srcRest:"shop-health-1.png",srcHover:"shop-health-1.png",srcActive:"shop-health-1.png",onClick:function(){e.buyHealth5()}}),e.elements.push(t),i=Le.createElement(W,{x:320,y:80,srcRest:"shop-health-2.png",srcHover:"shop-health-2.png",srcActive:"shop-health-2.png",onClick:function(){SAPIUser.zeroLife()}}),e.elements.push(i),Le.createElement(W,{x:452,y:3,srcRest:"button-close-rest.png",srcHover:"button-close-hover.png",srcActive:"button-close-active.png",onClick:function(){e.closeDialog()}}).show(),Le.popParent()},this.redraw=function(){let e;e=oe.getCurrentUser(),t.enabled=0===$.getHealths(e),this.__proto__.redraw.call(this)},this.buyHealth5=function(){let t,i;t=ie.getStuff("goldQty"),i=oe.getCurrentUser(),$.getHealths(i)>0||(t<O.healthPrice?(PBZDialogs.dialogMoneyShop.showDialog(this),e.closeDialog()):(SAPIStuff.buyHealth(),ie.giveAHealth($.getMaxHealth()),ie.usedGold(O.healthPrice),e.closeDialog()),ve.redraw())}};void 0!==e.DialogHealthShop&&(e.DialogHealthShop.__path="../client/components/application/gui_elements/DialogHealthShop.js");let R=function(){let e=this;this.__proto__=new P,this.init=function(){let t;this.__proto__.init.call(this),(t=Le.createElement(X,{x:150,y:12,width:200,bold:!0,alignCenter:!0},this.dom)).setText("ВЫЙТИ?"),e.elements.push(t),(t=Le.createElement(X,{x:127,y:114,width:250,bold:!0,alignCenter:!0},this.dom)).setText("Потеряешь одну жизнь."),e.elements.push(t),t=Le.createElement(W,{x:75,y:220,srcRest:"button-red-rest.png",srcHover:"button-red-hover.png",srcActive:"button-red-active.png",onClick:function(){e.closeDialog(),ce.oneHealthHide=!1,ve.showPage(ge),re.setStuffMode(null)},title:"СДАТЬСЯ"},this.dom),e.elements.push(t),t=Le.createElement(W,{x:275,y:220,srcRest:"button-green-rest.png",srcHover:"button-green-hover.png",srcActive:"button-green-active.png",onClick:function(){e.closeDialog()},title:"ИГРАТЬ"},this.dom),e.elements.push(t),t=Le.createElement(W,{x:452,y:3,srcRest:"button-close-rest.png",srcHover:"button-close-hover.png",srcActive:"button-close-active.png",onClick:function(){e.closeDialog()}},this.dom),e.elements.push(t)}};void 0!==e.DialogJustQuit&&(e.DialogJustQuit.__path="../client/components/application/gui_elements/DialogJustQuit.js");let N=function(){let e=this;this.__proto__=new P,this.init=function(){let t,i,n,o;this.__proto__.init.call(this),i=25,o=60,n=150,Le.pushParent(e.dom),t=Le.createElement(X,{x:135,y:11,width:230,height:40,text:"ГОЛОСА"}),e.elements.push(t);for(let i=0;i<3;i++)t=Le.createElement(W,{x:25+150*i,y:60,srcRest:"money_"+(i+1)+".png",srcHover:"money_"+(i+1)+".png",srcActive:"money_"+(i+1)+".png",onClick:function(){Le.isFullScreen()&&Le.fsSwitch(),Re.openOrderDialog(O.gold[i].votes),e.closeDialog()}}),e.elements.push(t),t=Le.createElement(W,{x:25+150*i+45,y:165,srcRest:"button-add-rest.png",srcHover:"button-add-hover.png",srcActive:"button-add-active.png",onClick:function(){Re.openOrderDialog(O.gold[i].votes),e.closeDialog()}});Le.createElement(W,{x:452,y:3,srcRest:"button-close-rest.png",srcHover:"button-close-hover.png",srcActive:"button-close-active.png",onClick:function(){e.closeDialog()}}).show(),Le.popParent()}};void 0!==e.DialogMoneyShop&&(e.DialogMoneyShop.__path="../client/components/application/gui_elements/DialogMoneyShop.js");let k=function(){let e=this;this.__proto__=new P;let t,i=null,n=null,o=null,s=null,l=[],r=null,a=null,c=null;this.init=function(){this.__proto__.init.call(this),Le.pushParent(e.dom),(i=Le.createElement(X,{x:135,y:12,width:230,height:40,text:""})).show(),(n=Le.createElement(J,{x:100,y:40,src:"star-off-big.png"})).show(),(o=Le.createElement(J,{x:200,y:40,src:"star-off-big.png"})).show(),(s=Le.createElement(J,{x:300,y:40,src:"star-off-big.png"})).show(),[0,1,2].forEach(function(e){l[e]={elPhotoScore:Le.createElement(Z,{x:75+75*e+15,y:155})}}),(r=Le.createElement(Z,{x:355,y:155})).show(),(a=Le.createElement(W,{x:178,y:240,srcRest:"button-red-rest.png",srcHover:"button-red-hover.png",srcActive:"button-red-active.png",onClick:function(){e.closeDialog(),0===$.getHealths(oe.getCurrentUser())?(PBZDialogs.dialogHealthShop.showDialog(),e.showDialog(c)):(SAPIUser.onPlayStart(),ce.oneHealthHide=!0,C.setPlayedId(c),ve.showPage(de))},title:"ИГРАТЬ"})).show(),Le.createElement(W,{x:452,y:3,srcRest:"button-close-rest.png",srcHover:"button-close-hover.png",srcActive:"button-close-active.png",onClick:function(){e.closeDialog()}}).show(),Le.popParent()},this.show=function(){this.__proto__.show.call(this)},this.hide=function(){this.__proto__.hide.call(this)},this.redraw=function(){let e,a,h;if(this.__proto__.redraw.call(this),this.dialogShowed){e=C.getById(c),i.text="УРОВЕНЬ  "+c;for(let i=0;i<3;i++)(a=t[i])&&a.id?(h=C.getScore(e.id,a.id),l[i].elPhotoScore.user=a,l[i].elPhotoScore.score=h,h?(l[i].elPhotoScore.show(),l[i].elPhotoScore.redraw()):l[i].elPhotoScore.hide()):l[i].elPhotoScore.hide();switch(r.user=oe.getCurrentUser(),r.score=C.getScore(e.id),i.redraw(),n.src="star-off-big.png",o.src="star-off-big.png",s.src="star-off-big.png",C.countStars(e.id)){case 3:s.src="star-on-big.png";case 2:o.src="star-on-big.png";case 1:n.src="star-on-big.png"}n.redraw(),o.redraw(),s.redraw(),r.redraw()}},this.showDialog=function(i){let n;c=i,n=S.getCurent().id,t=oe.getFriendIdsByMapIdAndPointIdWithScore(n,i,!1),this.__proto__.showDialog.call(this),e.redraw()}};void 0!==e.DialogPointInfo&&(e.DialogPointInfo.__path="../client/components/application/gui_elements/DialogPointInfo.js");let F=function(){let e=this;this.__proto__=new P;let t=null,i=[];this.init=function(){let t,n,o,s;this.__proto__.init.call(this),n=30,s=80,o=145,Le.pushParent(e.dom),t=Le.createElement(X,{x:135,y:11,width:230,height:40,text:"МАГАЗИН"}),e.elements.push(t);for(let n=0;n<3;n++)t=Le.createElement(W,{x:30+145*n,y:80,srcRest:"shop-hummer-2.png",srcHover:"shop-hummer-2.png",srcActive:"shop-hummer-2.png",onClick:function(){e.buyStuff(n)}}),i.push(t),e.elements.push(t),t=Le.createElement(W,{x:30+145*n+45,y:205,srcRest:"button-add-rest.png",srcHover:"button-add-hover.png",srcActive:"button-add-active.png",itemNumber:n,onClick:function(){e.buyStuff(n)}});Le.createElement(W,{x:452,y:3,srcRest:"button-close-rest.png",srcHover:"button-close-hover.png",srcActive:"button-close-active.png",onClick:function(){e.closeDialog()}}).show(),Le.popParent()},this.showDialog=function(i){this.__proto__.showDialog.call(this),t=i,e.redraw()},this.redraw=function(){let e;if(t){switch(t){case ie.STUFF_HUMMER:e=O.hummers;break;case ie.STUFF_LIGHTNING:e=O.lightning;break;case ie.STUFF_SHUFFLE:e=O.shuffle}for(let t=0;t<3;t++)i[t].srcRest=e[t].imageSrc,i[t].srcHover=e[t].imageSrc,i[t].srcActive=e[t].imageSrc,i[t].redraw()}this.__proto__.redraw.call(this)},this.buyStuff=function(i){let n,o,s,l;switch(n=ie.getStuff("goldQty"),t){case ie.STUFF_HUMMER:o=SAPIStuff.buyHummer,s=ie.giveAHummer,l=O.hummers[i];break;case ie.STUFF_SHUFFLE:o=SAPIStuff.buyShuffle,s=ie.giveAShuffle,l=O.shuffle[i];break;case ie.STUFF_LIGHTNING:o=SAPIStuff.buylightning,s=ie.giveALighnting,l=O.lightning[i]}n<l.gold?(PBZDialogs.dialogMoneyShop.showDialog(),e.reset(),e.showDialog(t)):(o(i),s(l.quantity),ie.usedGold(l.gold),e.closeDialog()),ve.redraw()}};void 0!==e.DialogStuffShop&&(e.DialogStuffShop.__path="../client/components/application/gui_elements/DialogStuffShop.js");let M=function(){let e,t=this;this.__proto__=new P,this.init=function(){let i;this.__proto__.init.call(this),Le.pushParent(t.dom),i=Le.createElement(W,{x:452,y:3,srcRest:"button-close-rest.png",srcHover:"button-close-hover.png",srcActive:"button-close-active.png",onClick:function(){t.closeDialog(),ce.oneHealthHide=!1,ve.showPage(ge)}}),t.elements.push(i),(i=Le.createElement(X,{x:50,y:150,fontSize:24,bold:!0,alignCenter:!0,width:400})).setText("Больше ходов нет! Ты потерял жизнь :("),t.elements.push(i),(e=Le.createElement(X,{x:135,y:12,width:230,height:40,text:"ПРОИГРЫШ"})).show(),(i=Le.createElement(W,{x:178,y:240,srcRest:"button-red-rest.png",srcHover:"button-red-hover.png",srcActive:"button-red-active.png",onClick:function(){t.closeDialog(),0===$.getHealths(oe.getCurrentUser())?(PBZDialogs.dialogHealthShop.showDialog(),t.showDialog(pointId)):(SAPIUser.onPlayStart(),ce.oneHealthHide=!0,C.setPlayedId(C.getPlayedId()),ve.showPage(ge),ve.showPage(de))},title:"ИГРАТЬ"})).show(),Le.popParent()}};void 0!==e.DialogTurnLoose&&(e.DialogTurnLoose.__path="../client/components/application/gui_elements/DialogTurnLoose.js");let W=function(){let e=this,t=!1;this.x=0,this.y=0,this.width=0,this.height=0,this.srcHover="/path/to/image/hover.png",this.srcActive="/path/to/image/active.png",this.srcRest="path/to/image/rest2.png",this.onClick=null,this.title,this.enabled=!0;let i,n=null,o=!1,s=!1;this.init=function(){(n=Le.createDom()).width=e.width,n.height=e.height,n.backgroundImage=e.srcRest,n.pointer=Le.POINTER_HAND,Le.bind(n,Le.EVENT_MOUSE_MOUSE_DOWN,r,e),Le.bind(n,Le.EVENT_MOUSE_CLICK,c,e),Le.bind(n,Le.EVENT_MOUSE_OVER,l,e),Le.bind(n,Le.EVENT_MOUSE_OUT,a,e),e.title&&(Le.pushParent(n),(i=Le.createElement(X,{x:0,y:10,height:25,alignCenter:!0,text:e.title,pointer:Le.POINTER_HAND})).show(),Le.popParent())},this.show=function(){!0!==t&&(t=!0,n.show(),e.redraw())},this.hide=function(){!1!==t&&(t=!1,n.hide())},this.redraw=function(){let l;t&&(l=e.srcRest,s&&(l=e.srcHover),s&&o&&(l=e.srcActive),!s&&o&&(l=e.srcRest),n.backgroundImage=l,e.title&&(n.title=e.title,i.width=Pe.getWidth(l),i.redraw()),e.enabled?(n.pointer=Le.POINTER_HAND,n.opacity=1):(n.pointer=Le.POINTER_ARROW,n.opacity=.5),n.x=e.x,n.y=e.y,n.redraw())};let l=function(){e.enabled&&(s=!0,e.redraw())},r=function(){e.enabled&&(o=!0,e.redraw())},a=function(){e.enabled&&(s=!1,e.redraw())},c=function(t,i){if(t.stopPropagation(),e.enabled)return o=!1,s=!1,e.redraw(),e.onClick.call(null,t,i)}};void 0!==e.ElementButton&&(e.ElementButton.__path="../client/components/application/gui_elements/ElementButton.js");let U=function(){let e=this,t=!1;this.x=0,this.y=0,this.width=0,this.goalStars=null,this.height=0,this.srcChestClose="chest-close.png",this.srcChestOpen="chest-open.png",this.onClick=null;let i=null,n=null,o=!1,s=!1;this.stateId=1,this.chestId=null,this.init=function(){n=Le.createElement(X,{width:100,height:40,text:""}),(i=Le.createDom()).width=e.width,i.height=e.height,i.backgroundImage=e.srcChestClose,i.pointer=Le.POINTER_HAND,Le.bind(i,Le.EVENT_MOUSE_MOUSE_DOWN,r,e),Le.bind(i,Le.EVENT_MOUSE_CLICK,c,e),Le.bind(i,Le.EVENT_MOUSE_OVER,l,e),Le.bind(i,Le.EVENT_MOUSE_OUT,a,e)},this.show=function(){t||(t=!0,i.show(),n.show(),e.redraw())},this.hide=function(){t&&(t=!1,n.hide(),i.hide())},this.redraw=function(){if(!t)return;switch(this.stateId){case 1:i.backgroundImage=s?this.srcChestOpen:this.srcChestClose;break;case 2:i.backgroundImage=this.srcChestOpen}e.stateId===U.STATE_OPEN?i.pointer=Le.POINTER_ARROW:i.pointer=Le.POINTER_HAND,i.x=e.x,i.y=e.y,n.x=e.x+10,n.y=e.y+60;let o=b.isItOpened(e.chestId);e.goalStars?e.stars>e.goalStars?n.text=e.goalStars+"/"+e.goalStars:n.text=e.stars+"/"+e.goalStars:n.text="",n.text+=o?"opened":"closed",n.redraw(),i.redraw()};let l=function(){e.enabled&&(s=!0,e.redraw())},r=function(){e.enabled&&(o=!0,e.redraw())},a=function(){e.enabled&&(s=!1,e.redraw())},c=function(t,i){return t.stopPropagation(),o=!1,s=!1,e.redraw(),e.onClick.call(null,t,i,this)}};U.STATE_CLOSE=1,U.STATE_OPEN=2,void 0!==e.ElementChest&&(e.ElementChest.__path="../client/components/application/gui_elements/ElementChest.js");let G=function(){let e=this,t=!0,i=!1,s=!1,l=null,p=null,_=null;this.centerX=0,this.centerY=0,this.x=0,this.y=0;let E=null,I=[],y=[],T=[],b=[],w=[],S=0,L=0,O=0,P=0;this.onDestroyLine=null,this.onDestroyThing=null,this.beforeStuffUse=null,this.onFieldSilent=null;let A=null,D=!1;this.init=function(){let e;E=Le.createDom(void 0,{width:C.FIELD_MAX_WIDTH*C.BLOCK_WIDTH,height:C.FIELD_MAX_HEIGHT*C.BLOCK_HEIGHT,overflow:"visible"}),Le.pushParent(E),E.bind(Le.EVENT_MOUSE_CLICK,B,E),E.bind(Le.EVENT_MOUSE_MOUSE_DOWN,j,E),E.bind(Le.EVENT_MOUSE_MOUSE_UP,z,E),E.bind(Le.EVENT_MOUSE_MOVE,J,E),Field.eachCell(function(e,t){I[e]||(I[e]=[]),I[e][t]=Le.createDom(void 0,{opacity:.4})});for(let t=0;t<100;t++)e=Le.createDom(void 0,{width:C.BLOCK_WIDTH,height:C.BLOCK_HEIGHT}),He.register(e.animate),y.push(e);Field.eachCell(function(t,i){T[t]||(T[t]=[]),e=Le.createDom(void 0,{p:{x:t,y:i},noScale:!0,height:C.BLOCK_HEIGHT,width:C.BLOCK_WIDTH,backgroundImage:"field-none.png"}),T[t][i]=e});for(let t=0;t<100;t++)e=Le.createDom(void 0,{width:C.BLOCK_WIDTH,height:C.BLOCK_HEIGHT}),He.register(e.animate),b.push(e);for(let e=0;e<100;e++)w.push(Le.createDom(void 0,{}));p=Le.createDom(void 0,{backgroundImage:"field-frame.png"}),Le.popParent(),this.redraw()};let H,v=function(t){return{x:Math.floor((t.clientX-e.x)/C.BLOCK_WIDTH),y:Math.floor((t.clientY-e.y)/C.BLOCK_HEIGHT)}},B=function(e){R(v(e))},R=function(e){let i;if(!t&&!n.busy()&&(X&&X(),(i=Field.getCell(e)).isVisible&&i.object.isCanMoved))switch(_){case ie.STUFF_HUMMER:N(e);break;case ie.STUFF_SHUFFLE:k(e);break;case ie.STUFF_LIGHTNING:M(e);break;default:U(e)}},N=function(i){t||n.busy()||Field.isNotGem(i)||(e.beforeStuffUse(),e.cellAttack(i),$(c,i))},k=function(){t||n.busy()||(e.beforeStuffUse(),F())},F=function(){console.log("s"),Field.shuffle(),$(g,(O+S/2)*C.BLOCK_WIDTH,(P+L/2)*C.BLOCK_HEIGHT)},M=function(i,o){t||n.busy()||!Field.isVisible(i)||(o||(o=x.WITH_LIGHTNING_HORIZONTAL),e.beforeStuffUse(),W(i,o))},W=function(t,i){i===x.WITH_LIGHTNING_CROSS?(Field.eachVisibleLine(t,x.WITH_LIGHTNING_VERTICAL,e.cellAttack),Field.eachVisibleLine(t,x.WITH_LIGHTNING_HORIZONTAL,e.cellAttack),e.redraw(),$(a,t,x.WITH_LIGHTNING_VERTICAL),$(a,t,x.WITH_LIGHTNING_HORIZONTAL)):(Field.eachVisibleLine(t,i,e.cellAttack),e.redraw(),$(a,t,i))},U=function(i){let o,s,a=l;if(!t&&!n.busy()&&Field.isFallObject(i)&&((!a||a&&!Field.isNear(a,i))&&(l=i,o=Field.getCell(l),D=o&&o.isVisible&&o.object.isPolyColor&&o,e.redraw()),a&&Field.isNear(a,i))){if(l=null,e.redraw(),D)return s=[],Field.eachCell(function(e,t,n,o){n.isVisible&&o.isGem&&o.objectId===Field.getCell(i).object.objectId&&n.object.isCanMoved&&s.push({x:e,y:t,cell:n})}),s.push({x:D.x,y:D.y,cell:D}),s.forEach(function(t){e.cellAttack(t,t.cell)}),V(),V=!1,D=!1,void(a=i=l=null);Field.isLinePossiblyDestroy(a,i)||($(r,a,i),$(r,i,a)),Field.isLinePossiblyDestroy(a,i)&&(A={a:a,b:i},e.beforeTurnUse(),Field.exchangeObjects(a,i),$(h,a,i),$(h,i,a))}},G=null,j=function(e){Fe.play(Fe.PATH_CHALK),G=v(e)},z=function(){G=null},V=!1,J=function(e){let t;t=v(e),!H||H.x===t.x&&H.y===t.y||(Y(e),K(e)),H=t},K=function(e){let t,i,n;D&&(t=v(e),i=Field.getCell(t),Field.isNear(t,l)&&i.isVisible&&i.object.isGem&&i.object.isCanMoved&&(X&&X(),!1===V&&(n=[],Field.eachCell(function(e,t,o,s){o.isVisible&&s.isGem&&s.objectId===i.object.objectId&&o.object.isCanMoved&&n.push({x:e,y:t})}),V=$(f,n)))),G&&(R(G),R(v(e)),G=null)},Y=function(e){D&&V&&(V(),V=!1)};this.show=function(){!0!==s&&(s=!0,E.show(),Field.eachCell(function(e,t){I[e][t].show(),T[e][t].show()}),e.redraw())},this.hide=function(){!1!==s&&(s=!1,E.hide(),Field.eachCell(function(e,t){I[e][t].hide(),T[e][t].hide()}),p.hide(),X&&X())};let q=function(e,t,i,n){t.x=e.x*C.BLOCK_WIDTH,t.y=e.y*C.BLOCK_HEIGHT;let o="",s=function(e){return!Field.isVisible(e)};o+=s({x:e.x-1,y:e.y})&&s({x:e.x,y:e.y-1})?"8px ":"0px ",o+=s({x:e.x,y:e.y-1})&&s({x:e.x+1,y:e.y})?"8px ":"0px ",o+=s({x:e.x+1,y:e.y})&&s({x:e.x,y:e.y+1})?"8px ":"0px ",o+=s({x:e.x,y:e.y+1})&&s({x:e.x-1,y:e.y})?"8px ":"0px ",t.borderRadius=o,C.objectImages[i]&&(t.backgroundImage=C.objectImages[i]),C.objectAnims[i]?(t.animPlayed=!0,t.animTracks=Le.copyAnimTracks(C.objectAnims[i]),Le.updateAnimTracks(t)):t.animPlayed=!1,void 0!==n&&(t.opacity=n),t.show(),t.redraw()};this.redraw=function(){if(!s)return;if(n.busy())return;E.redraw();let e=0,t=0;Field.eachCell(function(i,n,o,s){let l,r,a;l=I[i][n],(r=T[i][n]).bindedDoms=null,o.isVisible?q({x:i,y:n},l,x.CELL_VISIBLE):l.hide(),o.isVisible&&(s.isGem||s.isSpiderAlpha||s.isBarrel||s.isPolyColor||s.isBlock)?q({x:i,y:n},r,s.objectId,""):r.hide(),o.isVisible&&s.isGem&&s.lightningId&&(a=b[t++],q({x:i,y:n},a,s.lightningId,.5),r.bindedDoms=a),o.isVisible&&s.isSpiderAlpha&&((a=b[t++]).backgroundImage=C.healthImages[s.health],q({x:i,y:n},a,"",""),r.bindedDoms=a),o.isVisible&&o.withGold&&(a=y[e++],q({x:i,y:n},a,x.OBJECT_GOLD,"")),o.isVisible&&o.withTile&&(a=y[e++],q({x:i,y:n},a,x.OBJECT_TILE,"")),o.isVisible&&s.withSpiderBeta&&(a=b[t++],q({x:i,y:n},a,x.OBJECT_SPIDER_BETA,""),r.bindedDoms=a),o.isVisible&&s.withSpiderGamma&&(a=b[t++],q({x:i,y:n},a,x.OBJECT_SPIDER_GAMMA,""),r.bindedDoms=a),o.isVisible&&s.withBox&&(a=b[t++],q({x:i,y:n},a,x.OBJECT_BOX,""),r.hide()),o.isVisible&&s.withChain&&(s.withChainA&&(a=b[t++],q({x:i,y:n},a,x.OBJECT_CHAIN_A,"")),s.withChainB&&(a=b[t++],q({x:i,y:n},a,x.OBJECT_CHAIN_B,"")))});for(let t=e;t<100;t++)y[t].hide();for(let e=t;e<100;e++)b[e].hide();l?q({x:l.x,y:l.y},p):p.hide()},this.setLayers=function(t){let i,n,o=function(e,t){let i;return i=[],e.forEach(function(e,n){i[n]=[],e.forEach(function(e,o){i[n][o]=t?t(e):e})}),i},s=[];t.special.forEach(function(e){s.push(o(e))}),Field.setLayers(o(t.mask),o(t.gems,function(e){return e===x.OBJECT_RANDOM?Field.getRandomGemId():e}),s),i={x:1/0,y:1/0},n={x:-1/0,y:-1/0},Field.eachCell(function(e,t,o){o.isVisible&&(i.x=Math.min(i.x,e),i.y=Math.min(i.y,t),n.x=Math.max(n.x,e),n.y=Math.max(n.y,t))}),S=n.x-i.x+1,L=n.y-i.y+1,O=i.x,P=i.y,e.x=e.centerX-C.BLOCK_WIDTH/2-(S-1)/2*C.BLOCK_WIDTH-O*C.BLOCK_WIDTH,e.y=e.centerY-C.BLOCK_HEIGHT/2-(L-1)/2*C.BLOCK_HEIGHT-P*C.BLOCK_HEIGHT+C.BLOCK_HEIGHT/2,E.x=e.x,E.y=e.y,this.redraw()},this.run=function(){if(!n.busy())return e.hasProcesSpecialLayer()?e.processSpecialLayer():e.hasFall()?e.fall():e.hasDestroyLines()?e.destroyLines():e.hasNoTurns()?F():e.isFieldSilent()?Z():void 0};let X,Z=function(){e.onFieldSilent(),Q()},Q=function(){setTimeout(function(){if(console.log("tryShowHint",e.isFieldSilent(),!t,s,!X,!V,!i),e.isFieldSilent()&&!t&&s&&!X&&!V&&!i){let e=Field.countTurns();if(e.length){let t=$(f,[e[0].a,e[0].b]);X=function(){X=null,t(),Q()}}}},3*We.OnIdle.second)};this.isFieldSilent=function(){return!(n.busy()||e.hasDestroyLines()||e.hasFall()||e.hasProcesSpecialLayer()||e.hasNoTurns())},this.hasProcesSpecialLayer=function(e){return Field.eachCell(function(t,i,n){e|=n.isEmitter&&n.object.isHole,e|=n.isVisible&&n.object.isBarrel&&!Field.isVisible({x:t,y:i+1})}),e},this.processSpecialLayer=function(){Field.eachCell(function(t,i,n){n.isEmitter&&Field.isHole({x:t,y:i})&&(Field.setObject({x:t,y:i},Field.getRandomGemId()),Field.isVisible({x:t,y:i})&&$(u,{x:t,y:i})),n.isVisible&&n.object.isBarrel&&!Field.isVisible({x:t,y:i+1})&&(e.onDestroyThing(x.OBJECT_BARREL,n),Field.setObject({x:t,y:i},x.OBJECT_HOLE,!1),n.object.isBarrel=!1,$(c,{x:t,y:i}))}),e.run()},this.hasFall=function(e=!1){return Field.eachCell(function(t,i){Field.mayFall(t,i)&&(e=!0)}),e},this.fall=function(){let t;if(n.busy())return;let i=[];Field.eachCell(function(e,n){n=C.FIELD_MAX_HEIGHT-n-1,(t=Field.mayFall(e,n))&&(Field.exchangeObjects({x:e,y:n},t),T[e][n].bindedDoms&&(T[t.x][t.y]&&(T[t.x][t.y].bindedDoms=T[e][n].bindedDoms),T[e][n].bindedDoms=null),i.push({from:{x:e,y:n},to:t}))}),i.length?$(d,i):(e.run(),e.redraw()),e.processSpecialLayer()},this.hasDestroyLines=function(){let e;return(e=Field.findLines()).length>0},this.destroyLines=function(){let t,i,n;(t=Field.findLines()).forEach(function(t){i=null,A&&Field.lineCrossing([t],A.a.x,A.a.y)&&(i=A.a),A&&Field.lineCrossing([t],A.b.x,A.b.y)&&(i=A.b),i&&(n=Field.getCell(i).object.objectId),t.coords.forEach(function(t){e.cellAttack(t)}),t.coords.length>3&&(i&&4===t.coords.length&&Field.setObject(i,n,t.orientation),i&&5===t.coords.length&&Field.setObject(i,x.OBJECT_POLY_COLOR,!1)),e.onDestroyLine(t)}),$(m)},this.hasNoTurns=function(){return 0===Field.countTurns().length},this.lock=function(){t=!0},this.unlock=function(){t=!1},this.setStuffMode=function(t){l=null,D=!1,_=t,e.redraw()};this.cellAttack=function(t,i){let n,o;if(n=(o=(i=i||Field.getCell(t)).object).lightningId,i.isVisible&&(o.isGem||o.isPolyColor)&&o.isLineForming&&o.withChain)return o.withChainA&&o.withChainB?o.withChainB=!1:(o.withChainA=!1,o.withChainB=!1,Field.updateSomeFlags(o)),void $(c,t);i.object.isPolyColor&&(e.onDestroyThing(x.OBJECT_POLY_COLOR,i),Field.setObject(t,x.OBJECT_HOLE,!1),$(c,t)),i.isVisible&&o.isGem&&o.isLineForming&&!o.withChain&&(e.onDestroyThing(i.object.objectId,i),Field.setObject(t,x.OBJECT_HOLE,!1),$(c,t),i.withGold&&(e.onDestroyThing(x.OBJECT_GOLD,i),i.withGold=!1,$(c,t)),i.withTile&&(e.onDestroyThing(x.OBJECT_TILE,i),i.withTile=!1,$(c,t)),i.object.withSpiderBeta&&(e.onDestroyThing(x.OBJECT_SPIDER_BETA,i),i.object.withSpiderBeta=!1,$(c,t)),i.object.withSpiderGamma&&(e.onDestroyThing(x.OBJECT_SPIDER_GAMMA,i),i.object.withSpiderGamma=!1,$(c,t)),Field.eachNears(t,function(t,i){var n,o;n=t,(o=i).object.isSpiderAlpha&&(o.object.health--,o.object.health?$(c,n):(e.onDestroyThing(x.OBJECT_SPIDER_ALPHA,o),Field.setObject(n,x.OBJECT_HOLE),$(c,n))),o.object.withBox&&!o.object.withChain&&(o.object.withBox=!1,e.onDestroyThing(x.OBJECT_BOX,o),Field.updateSomeFlags(o.object),$(c,n)),o.object.withBox&&o.object.withChain&&(o.object.withChainA&&o.object.withChainB?o.object.withChainB=!1:(o.object.withChainA=!1,o.object.withChainB=!1),Field.updateSomeFlags(o.object),$(c,n))}),n&&W(t,n))},this.getCoords=function(){return{x:e.x+O*C.BLOCK_WIDTH,y:e.y+(P-1)*C.BLOCK_HEIGHT,cellX:O,cellY:P}},this.lockHint=function(){i=!0,X&&(X(),Q())},this.unlockHint=function(){i=!1,X&&(X(),Q())},this.showHint=function(e){X&&X();let t=$(f,e);return X=function(){X=null,t()}};let $=function(t){let i;return(i=Array.from(arguments)).shift(),i.unshift({gemDoms:T,specDoms2:b,animDoms:w,onFinish:function(){t.name===f.name&&X&&X(),e.redraw(),e.run()}}),i.unshift(t),o.anim.apply(null,i)}};void 0!==e.ElementField&&(e.ElementField.__path="../client/components/application/gui_elements/ElementField.js");let j=function(){let e=this,t=!1;this.x=0,this.y=0,this.cardWidth=50,this.cardHeight=50,this.cardSpace=10,this.cardsCount=6;let i=[],n=[],o=[];this.init=function(){for(let t=0;t<e.cardsCount;t++){let s;s=Le.createDom(void 0,{x:e.x+t*(e.cardWidth+e.cardSpace),y:e.y,width:e.cardWidth,height:e.cardHeight,border:"2px solid #715f4b",borderRadius:"8px",background:"#aaa"}),Le.bind(s,Le.EVENT_MOUSE_CLICK,function(){i[t]||Re.openInviteFriendDialog()}),n.push(s),o.push(Le.createElement(X,{x:e.x+t*(e.cardWidth+e.cardSpace)+3,y:e.y+50-15,width:e.cardWidth,height:30/(100/e.cardWidth),alignCenter:!0,background:"#eee",opacity:.7,fontSize:12}))}},this.show=function(){t||(t=!0,n.forEach(function(e){e.show()}),o.forEach(function(e){e.show()}),e.redraw())},this.hide=function(){t&&(t=!1,n.forEach(function(e){e.hide()}),o.forEach(function(e){e.hide()}))},this.setFriends=function(e){i=e},this.redraw=function(){t&&(n.forEach(function(e,t){i[t]&&i[t].photo50?(e.backgroundImage=i[t].photo50,e.pointer=Le.POINTER_ARROW):(e.backgroundImage="friend-vacancy.png",e.pointer=Le.POINTER_HAND),e.redraw()}),o.forEach(function(e,t){i[t]?(e.text="ур. "+i[t].nextPointId,e.show()):e.hide(),e.redraw()}))}};void 0!==e.ElementFriendsPanel&&(e.ElementFriendsPanel.__path="../client/components/application/gui_elements/ElementFriendsPanel.js");let z=function(){let e,t=this,i=!1;this.x=void 0,this.y=void 0,this.healthIndicator=null,this.init=function(){e=Le.createElement(X,{x:this.x,y:this.y,width:100,height:30,alignCenter:!0,bold:!0}),He.register(t.updateTimer)},this.show=function(){i||(i=!0,e.show(),t.redraw())},this.hide=function(){i&&(e.hide(),i=!1)},this.redraw=function(){i&&(e.setText("00:00:00"),t.updateTimer(),e.redraw())},this.updateTimer=function(){let o;i&&(o=oe.getCurrentUser(),ce.oneHealthHide&&(o.fullRecoveryTime-=$.getHealthRecoveryTime()),$.isMaxHealths(o)?(ce.oneHealthHide&&(o.fullRecoveryTime+=$.getHealthRecoveryTime()),t.healthIndicator.redraw(),e.hide()):(ce.oneHealthHide&&(o.fullRecoveryTime+=$.getHealthRecoveryTime()),e.setText(n($.getTimeLeft(o))),e.show(),e.redraw(),t.healthIndicator.redraw()))};let n=function(e){let t=parseInt(e,10),i=Math.floor(t/3600),n=Math.floor((t-3600*i)/60),o=t-3600*i-60*n;return i<10&&(i="0"+i),n<10&&(n="0"+n),o<10&&(o="0"+o),n+":"+o}};void 0!==e.ElementHealthTimer&&(e.ElementHealthTimer.__path="../client/components/application/gui_elements/ElementHealthTimer.js");let V=function(){let e,t=this,i=!1;this.x=0,this.y=0,this.init=function(){let t;e=[];for(let i=0;i<5;i++)t=Le.createDom(null,{x:this.x+35*i,y:this.y-2,width:50,height:50,backgroundImage:"health-heart.png"}),e.push(t)},this.show=function(){i||(i=!0,e.forEach(function(e){}),t.redraw())},this.hide=function(){i&&(i=!1,e.forEach(function(e){e.hide()}))},this.redraw=function(){let n,o,s,l;i&&(l=oe.getCurrentUser(),ce.oneHealthHide&&(l.fullRecoveryTime-=$.getHealthRecoveryTime()),s=1,n=$.getHealths(l),o=35,n===$.getMaxHealth()-1&&(o-=10),e.forEach(function(e){e.x=t.x+(s-1)*o,s<=n?e.show():e.hide(),e.redraw(),s++}),ce.oneHealthHide&&(l.fullRecoveryTime+=$.getHealthRecoveryTime()))}};void 0!==e.ElementHealthsIndicator&&(e.ElementHealthsIndicator.__path="../client/components/application/gui_elements/ElementHealthsIndicator.js");let J=function(){let e=this,t=!1;this.x=0,this.y=0,this.width=0,this.height=0,this.src="not-found.png",this.opacity=null,this.dom=null,this.pointer=void 0;let i=null;this.title=void 0,this.photoBorder=!1,this.init=function(){(i=Le.createDom()).width=e.width,i.height=e.height,i.backgroundImage=e.src,this.photoBorder&&(i.border="2px solid rgba(68, 62, 0, 0.7)",i.borderRadius="8px"),e.dom=i},this.show=function(){!0!==t&&(t=!0,i.show(),e.redraw())},this.hide=function(){!1!==t&&(t=!1,i.hide())},this.redraw=function(){t&&(i.backgroundImage=e.src,null!=e.opacity&&(i.opacity=e.opacity),i.x=e.x,i.y=e.y,i.title=e.title,i.pointer=e.pointer,i.redraw())}};void 0!==e.ElementImage&&(e.ElementImage.__path="../client/components/application/gui_elements/ElementImage.js");let K=function(){let e,t,i,n=this,o=!1;this.x=0,this.y=0,this.items=[];let s,l={},r={};this.title="",this.init=function(){let o;e=Le.createElement(J,{x:n.x,y:n.y,src:"panel-goals-1.png"}),t=Le.createElement(J,{x:n.x,y:n.y,src:"panel-goals-2.png"}),i=Le.createElement(J,{x:n.x,y:n.y,src:"panel-goals-3.png"}),s=Le.createElement(X,{x:n.x+15,y:n.y+7,width:80,text:n.title,fontSize:n.fontSize});for(let e in C.objectImages)o=Le.createElement(J,{width:50,height:50,src:C.objectImages[e]}),l[e]=o,o=Le.createElement(X,{width:C.BLOCK_WIDTH,alignRight:!0}),r[e]=o},this.show=function(){if(!o){o=!0;for(let e in l)l[e].show();for(let e in r)r[e].show();s.show()}},this.hide=function(){if(o){o=!1;for(let e in l)l[e].hide();for(let e in r)r[e].hide();s.hide(),e.hide(),t.hide(),i.hide()}},this.redraw=function(){if(!o)return;for(let e in l)l[e].hide();for(let e in r)r[e].hide();switch(e.hide(),t.hide(),i.hide(),n.items.length){case 3:i.show();break;case 2:t.show();break;case 1:e.show()}let s;e.redraw(),t.redraw(),i.redraw(),s=0,n.items.forEach(function(e){l[e.id].x=n.x+15,l[e.id].y=n.y+46+s,l[e.id].show(),r[e.id].x=n.x-7+C.BLOCK_WIDTH,r[e.id].y=n.y+46+C.BLOCK_HEIGHT/2-10+s,r[e.id].setText(e.count),r[e.id].show(),s+=C.BLOCK_HEIGHT+5})}};void 0!==e.ElementPanelItems&&(e.ElementPanelItems.__path="../client/components/application/gui_elements/ElementPanelItems.js");let Y=function(){let e=this,t=!1;this.x=0,this.y=0,this.srcGrey="map-way-point-grey.png",this.srcRed="map-way-point-red.png",this.srcYellow="map-way-point-yellow.png",this.srcStarOff="star-off.png",this.srcStarOn="star-on.png",this.onClick=null;let i=null,n=[],o=null,s=null,l=null,r=null,a=null,c=null,h=null,u=!1,d=!1;this.stateId=Y.STATE_CLOSE,this.pointId=null,this.pointWidth=50,this.init=function(){(i=Le.createDom()).backgroundImage=e.srcGrey,i.pointer=Le.POINTER_HAND,Le.bind(i,Le.EVENT_MOUSE_MOUSE_DOWN,m,e),Le.bind(i,Le.EVENT_MOUSE_CLICK,E,e),Le.bind(i,Le.EVENT_MOUSE_OVER,p,e),Le.bind(i,Le.EVENT_MOUSE_OUT,_,e),h=Le.createElement(X,{width:33,height:20,fontSize:15,pointer:Le.POINTER_HAND},i),(o=Le.createDom()).backgroundImage=e.srcStarOff,(s=Le.createDom()).backgroundImage=e.srcStarOff,(l=Le.createDom()).backgroundImage=e.srcStarOff,r=Le.createDom(null,{height:24,width:24,border:"1px solid #715f4b",borderRadius:"2px"}),a=Le.createDom(null,{height:24,width:24,border:"1px solid #715f4b",borderRadius:"2px"}),c=Le.createDom(null,{height:24,width:24,border:"1px solid #715f4b",borderRadius:"2px"})},this.show=function(){t||(t=!0,e.redraw(),i.show(),o.show(),s.show(),l.show(),h.show())},this.hide=function(){t&&(t=!1,i.hide(),o.hide(),s.hide(),l.hide(),h.hide(),r.hide(),a.hide(),c.hide())},this.redraw=function(){if(t){switch(this.stateId){case Y.STATE_CLOSE:i.pointer=Le.POINTER_ARROW,i.backgroundImage=this.srcGrey;break;case Y.STATE_CURRENT:i.pointer=Le.POINTER_HAND,i.backgroundImage=this.srcRed;break;case Y.STATE_FINISHED:i.pointer=Le.POINTER_HAND,i.backgroundImage=this.srcYellow}e.stateId===Y.STATE_CLOSE?i.pointer=Le.POINTER_ARROW:i.pointer=Le.POINTER_HAND,i.x=e.x,i.y=e.y,h.x=9,h.y=16.5,h.text=e.pointId?e.pointId.toString():"",g(),f(),i.redraw(),o.redraw(),s.redraw(),l.redraw(),h.redraw()}};let g=function(){let t,i,n;t=C.countStars(e.pointId),i=e.pointWidth/2-12.5,n=7,o.x=e.x-17+i,o.y=e.y-7,o.backgroundImage=t>=1?e.srcStarOn:e.srcStarOff,s.x=e.x+i,s.y=e.y-7-11,s.backgroundImage=t>=2?e.srcStarOn:e.srcStarOff,l.x=e.x+17+i,l.y=e.y-7,l.backgroundImage=t>=3?e.srcStarOn:e.srcStarOff},f=function(){let t,i,o=e.pointWidth/2-12-2,s=0,l=[r,a,c];e.y>250||1===S.getNumberFromPointId(e.pointId)||18===S.getNumberFromPointId(e.pointId)?(t=-38,i=5):(t=38,i=-5),r.x=e.x-18+o,r.y=e.y+t,a.x=e.x+o,a.y=e.y+t-i,c.x=e.x+19+o,c.y=e.y+t,n.forEach(function(e){e&&e&&e.photo50?(l[s].backgroundImage=e.photo50,l[s].show(),l[s].redraw()):l[s].hide(),s++})},p=function(){e.enabled&&(d=!0,e.redraw())},m=function(){e.enabled&&(u=!0,e.redraw())},_=function(){e.enabled&&(d=!1,e.redraw())},E=function(t,i){if(t.stopPropagation(),e.stateId!==Y.STATE_CLOSE)return u=!1,d=!1,e.redraw(),e.onClick.call(null,t,i,this)};this.setGamers=function(t){for(t=t.filter(function(t){return t.nextPointId===e.pointId}),1===(n=t.slice(0,3)).length&&n.unshift(null);n.length<3;)n.push(null)}};Y.STATE_CLOSE=1,Y.STATE_CURRENT=2,Y.STATE_FINISHED=3,void 0!==e.ElementPoint&&(e.ElementPoint.__path="../client/components/application/gui_elements/ElementPoint.js");void 0!==e.ElementSprite&&(e.ElementSprite.__path="../client/components/application/gui_elements/ElementSprite.js");let q=function(){let e=this,t=!1;this.x=0,this.y=0,this.width=0,this.height=0,this.srcHover="/path/to/image/hover.png",this.srcActive="/path/to/image/active.png",this.srcRest="path/to/image/rest1.png",this.onClick=null,this.title=null,this.enabled=!0;let i=null,n=null,o=!1,s=!1;this.init=function(){(i=Le.createDom()).width=e.width,i.height=e.height,i.backgroundImage=e.srcRest,i.pointer=Le.POINTER_HAND,Le.bind(i,Le.EVENT_MOUSE_MOUSE_DOWN,r,e),Le.bind(i,Le.EVENT_MOUSE_CLICK,c,e),Le.bind(i,Le.EVENT_MOUSE_OVER,l,e),Le.bind(i,Le.EVENT_MOUSE_OUT,a,e),n=Le.createElement(X,{})},this.show=function(){1!=t&&(t=!0,i.show(),n.show(),e.redraw())},this.hide=function(){0!=t&&(t=!1,i.hide(),n.hide())},this.redraw=function(){let l;t&&(l=e.srcRest,s&&(l=e.srcHover),s&&o&&(l=e.srcActive),!s&&o&&(l=e.srcRest),i.backgroundImage=l,e.title&&(i.title=e.title),e.enabled?(i.pointer=Le.POINTER_HAND,i.opacity=1):(i.pointer=Le.POINTER_ARROW,i.opacity=.5),i.x=e.x,i.y=e.y,n.x=e.x+70,n.y=e.y+40,n.setText(ie.getStuff(e.fieldName)),i.redraw(),n.redraw())};let l=function(){e.enabled&&(s=!0,e.redraw())},r=function(){e.enabled&&(o=!0,e.redraw())},a=function(){e.enabled&&(s=!1,e.redraw())},c=function(t,i){if(t.stopPropagation(),e.enabled)return o=!1,s=!1,e.redraw(),e.onClick.call(null,t,i)}};void 0!==e.ElementStuffButton&&(e.ElementStuffButton.__path="../client/components/application/gui_elements/ElementStuffButton.js");let X=function(){let e=this,t=!1;this.x=void 0,this.y=void 0,this.width=void 0,this.height=void 0,this.text="";let i=null;this.pointer=Le.POINTER_ARROW,this.fontSize=18,this.bold=!0,this.alignCenter=!0,this.alignRight=!1,this.opacity=void 0,this.textDecoration=void 0,this.init=function(){(i=Le.createDom(void 0,{height:this.height,color:this.color?this.color:"rgba(103, 77, 56, 1.0)",background:this.background,fontFamily:'arial,sans-serif,"Marvin",Tahoma,"Geneva CY",sans-serif'})).__dom.style.zIndex=this.zIndex,Le.bind(i,Le.EVENT_MOUSE_CLICK,o,e)},this.show=function(){t||(t=!0,i.show(),e.redraw())},this.hide=function(){t&&(t=!1,i.hide())},this.setText=function(t){"string"!=typeof t&&(t=t.toString()),e.text=t},this.redraw=function(){t&&(n(),i.x=e.x,i.y=e.y,i.fontSize=e.fontSize,i.opacity=e.opacity,i.width=e.width,i.textDecoration=e.textDecoration,e.bold?i.fontWeight="bold":i.fontWeight="normal",e.alignCenter&&(i.alignText="center"),e.alignRight&&(i.alignText="right"),i.redraw())};let n=function(){let t,n;t="";for(let i in e.text){let o=e.text[i];10!=(n=e.text.charCodeAt(i))?t+=o:t+="<br>"}i.innerHTML=t,i.pointer=e.pointer},o=function(t,i){if(e.onClick)return t.stopPropagation(),e.onClick.call(this,t,i)}};void 0!==e.ElementText&&(e.ElementText.__path="../client/components/application/gui_elements/ElementText.js");let Z=function(){let e,t,i,n=this,o=!1;this.x=0,this.y=0,this.user=null,this.score=null,this.init=function(){i=Le.createElement(X,{x:n.x-25,y:n.y-22,width:100,height:50,fontSize:12,alignCenter:!0}),e=Le.createElement(J,{x:n.x,y:n.y,width:50,height:50,photoBorder:!0}),t=Le.createElement(X,{x:n.x-25,y:n.y+61,width:100,height:50,fontSize:12,alignCenter:!0})},this.show=function(){!0!==o&&(o=!0,i.show(),e.show(),t.show(),n.redraw())},this.hide=function(){!1!==o&&(o=!1,i.hide(),e.hide(),t.hide())},this.redraw=function(){o&&this.user&&this.user.id&&(i.text=this.user.firstName,e.src=this.user.photo50,t.text=this.score.toString(),i.redraw(),e.redraw(),t.redraw())}};void 0!==e.ElementUserScorePhoto&&(e.ElementUserScorePhoto.__path="../client/components/application/gui_elements/ElementUserScorePhoto.js");let Q=function(){let e=this,t=null,i=[x.OBJECT_RED,x.OBJECT_GREEN,x.OBJECT_BLUE,x.OBJECT_YELLOW,x.OBJECT_PURPLE,x.OBJECT_SAND],n=[x.OBJECT_RED,x.OBJECT_GREEN,x.OBJECT_BLUE,x.OBJECT_YELLOW,x.OBJECT_PURPLE],o=[x.OBJECT_RED,x.OBJECT_GREEN,x.OBJECT_BLUE,x.OBJECT_YELLOW,x.OBJECT_PURPLE,x.OBJECT_SAND,x.OBJECT_POLY_COLOR,x.OBJECT_BARREL,x.OBJECT_SPIDER_ALPHA];this.getCell=function(i){return!e.isOut(i)&&t[i.x][i.y]},this.getObject=function(e){return this.getCell(e).object},this.isGem=function(e){return!(!t[e.x]||!t[e.x][e.y])&&t[e.x][e.y].object.isGem},this.isNotGem=function(t){return!e.isGem(t)},this.isHole=function(e){return!(!t[e.x]||!t[e.x][e.y])&&t[e.x][e.y].object.isHole},this.isFallObject=function(i){return!e.isOut(i)&&-1!==o.indexOf(t[i.x][i.y].object.objectId)},this.mayFall=function(t,i){return!e.isOut({x:t,y:i})&&(!!Q.getCell({x:t,y:i}).object.isCanMoved&&(Q.isFallObject({x:t,y:i})&&s({x:t,y:i})))};let s=function(t){for(let i,n,o=0;o<C.FIELD_MAX_HEIGHT&&(t.y++,n=(i=e.getCell(t))&&i.object,!i||!i.isVisible||n.isHole||n.withBox);o++)if(i&&i.isVisible&&n.isHole)return t;return!1};this.getRandomGemId=function(){return n[Math.floor(Math.random()*n.length)]},this.isVisible=function(e){return!(!t[e.x]||!t[e.x][e.y])&&t[e.x][e.y].isVisible},this.countTurns=function(){let t,i,n,o,s,l=[],r=function(r,a){o=e.getCell(r),s=e.getCell(a),o&&s&&(i=o.object,n=s.object,o.isVisible&&i.isCanMoved&&s.isVisible&&n.isCanMoved&&(e.exchangeObjects(r,a),(t=e.findLines()).length&&l.push({a:r,b:a,lines:t}),e.exchangeObjects(r,a)))};return this.eachCell(function(e,t){r({x:e,y:t},{x:e+1,y:t}),r({x:e,y:t},{x:e,y:t+1})}),l},this.exchangeObjects=function(i,n,o){let s;return!e.isOut(i)&&!e.isOut(n)&&(o?(s=t[n.x][n.y].object.objectId,t[n.x][n.y].object.objectId=t[i.x][i.y].object.objectId,t[i.x][i.y].object.objectId=s):(s=t[n.x][n.y].object,t[n.x][n.y].object=t[i.x][i.y].object,t[i.x][i.y].object=s),!0)},this.isOut=function(e){return e.x<0||e.x>=C.FIELD_MAX_WIDTH||e.y<0||e.y>C.FIELD_MAX_HEIGHT},this.isNear=function(e,t){return 1===Math.abs(e.x-t.x)&&e.y-t.y==0||e.x-t.x==0&&1===Math.abs(e.y-t.y)},this.findLines=function(){let e,t;t=[];for(let i=0;i<C.FIELD_MAX_HEIGHT;i++)for(let n=0;n<C.FIELD_MAX_WIDTH;n++)this.lineCrossing(t,n,i)||((e=this.findLine(n,i,x.WITH_LIGHTNING_VERTICAL))&&t.push(e),(e=this.findLine(n,i,x.WITH_LIGHTNING_HORIZONTAL))&&t.push(e));return t},this.findLine=function(t,i,n){let o,s,l;if(l=e.getCell({x:t,y:i}),o=l.object.objectId,!l.isVisible||!l.object.isLineForming)return!1;s={orientation:n,coords:[],gemId:o};let r=function(t){return!!((l=e.getCell(t))&&l.isVisible&&l.object.isLineForming&&l.object.objectId===o)&&s.coords.push(t)};if(n===x.WITH_LIGHTNING_HORIZONTAL)for(let e=0;e<5&&r({x:t+e,y:i});e++);else for(let e=0;e<5&&r({x:t,y:i+e});e++);return s.coords.length>=3&&s},this.lineCrossing=function(e,t,i){for(let n in e)for(let o in e[n].coords)if(t===e[n].coords[o].x&&i===e[n].coords[o].y)return!0;return!1},this.eachCell=function(e){for(let i=0;i<C.FIELD_MAX_HEIGHT;i++)for(let n=0;n<C.FIELD_MAX_WIDTH;n++)e(n,i,t&&t[n][i],t&&t[n][i].object)},this.setObject=function(n,o,s){let l;(l=t[n.x][n.y].object).objectId=o,l.isHole=o===x.OBJECT_HOLE,l.isGem=-1!==i.indexOf(o),l.lightningId=s,l.isPolyColor=o===x.OBJECT_POLY_COLOR,l.isBarrel=o===x.OBJECT_BARREL,l.isBlock=o===x.OBJECT_BLOCK,l.isSpiderAlpha=o===x.OBJECT_SPIDER_ALPHA,e.updateSomeFlags(l)},this.updateSomeFlags=function(e){e.withChain=e.withChainA||e.withChainB,e.isCanMoved=(e.isGem||e.isBarrel||e.isPolyColor)&&!e.withBox&&!e.withChain,e.isLineForming=e.isGem&&!e.withBox},this.getGemId=function(e){return t[e.x]&&t[e.x][e.y].object.objectId},this.setLayers=function(n,o,s){let r,a,c;t=[],console.log(o);for(let h=0;h<C.FIELD_MAX_WIDTH;h++){t[h]=[];for(let u=0;u<C.FIELD_MAX_HEIGHT;u++){let d,g;a=!1,-1!==(r=l({x:h,y:u},s)).indexOf(x.WITH_LIGHTNING_HORIZONTAL)&&(a=x.WITH_LIGHTNING_HORIZONTAL),-1!==r.indexOf(x.WITH_LIGHTNING_VERTICAL)&&(a=x.WITH_LIGHTNING_VERTICAL),-1!==r.indexOf(x.WITH_LIGHTNING_CROSS)&&(a=x.WITH_LIGHTNING_CROSS),c=o[h]&&o[h][u],-1!==r.indexOf(x.OBJECT_BARREL)&&(c=x.OBJECT_BARREL),-1!==r.indexOf(x.OBJECT_SPIDER_ALPHA)&&(c=x.OBJECT_SPIDER_ALPHA),-1!==r.indexOf(x.OBJECT_SAND)&&(c=x.OBJECT_SAND),-1!==r.indexOf(x.OBJECT_BLOCK)&&(c=x.OBJECT_BLOCK),i.forEach(function(e){-1!==r.indexOf(e)&&(c=e,console.log(e))}),c||(c=Field.getRandomGemId()),d={object:g={},x:h,y:u},t[h][u]=d,d.isVisible=n[h]&&n[h][u]&&n[h][u]===x.CELL_VISIBLE,d.isEmitter=-1!==r.indexOf(x.IS_EMITTER),c===x.OBJECT_SPIDER_ALPHA&&(g.health=3),d.withGold=-1!==r.indexOf(x.OBJECT_GOLD),d.withTile=-1!==r.indexOf(x.OBJECT_TILE),g.withBox=-1!==r.indexOf(x.OBJECT_BOX),g.withChainA=-1!==r.indexOf(x.OBJECT_CHAIN_A),g.withChainB=-1!==r.indexOf(x.OBJECT_CHAIN_B),g.withSpiderBeta=-1!==r.indexOf(x.OBJECT_SPIDER_BETA),g.withSpiderGamma=-1!==r.indexOf(x.OBJECT_SPIDER_GAMMA),e.setObject({x:h,y:u},c,a)}}console.log("find lines",Field.findLines().length),Field.findLines().length&&Field.shuffle(!0)},this.eachNears=function(t,i){[{x:t.x+1,y:t.y},{x:t.x-1,y:t.y},{x:t.x,y:t.y+1},{x:t.x,y:t.y-1}].forEach(function(t){!e.isOut(t)&&e.isVisible(t)&&i(t,e.getCell(t))})};let l=function(e,t){return t[e.x]&&t[e.x][e.y]?t[e.x][e.y]:[]};this.isLinePossiblyDestroy=function(e,t){let i,n;return Q.exchangeObjects(e,t),i=Q.findLines(),n=Q.lineCrossing(i,e.x,e.y)|Q.lineCrossing(i,t.x,t.y),Q.exchangeObjects(e,t),n},this.eachVisibleLine=function(t,i,n){let o=[],s=function(t,i){(i=e.getCell(t)).isVisible&&o.push({p:t,cell:i})};switch(i){case x.WITH_LIGHTNING_HORIZONTAL:for(let e=0;e<C.FIELD_MAX_WIDTH;e++)s({x:e,y:t.y});break;case x.WITH_LIGHTNING_VERTICAL:for(let e=0;e<C.FIELD_MAX_HEIGHT;e++)s({x:t.x,y:e});break;default:De.log("Error :"+arguments.callee.name,De.LEVEL_ERROR)}o.sort(function(e,t){return e.cell.object.isCanMoved&&!t.cell.object.isCanMoved?1:!e.cell.object.isCanMoved&&t.cell.object.isCanMoved?-1:0}),o.forEach(function(e){n(e.p,e.cell)})},this.getVisibleLength=function(e,t){let i=1/0,n=-1/0;switch(t){case x.WITH_LIGHTNING_HORIZONTAL:for(let t=0;t<C.FIELD_MAX_WIDTH;t++)Field.isVisible({x:t,y:e.y})&&(i=Math.min(i,t),n=Math.max(n,t));return{lower:i,higher:n,length:n-i+1};case x.WITH_LIGHTNING_VERTICAL:for(let t=0;t<C.FIELD_MAX_HEIGHT;t++)Field.isVisible({x:e.x,y:t})&&(i=Math.min(i,t),n=Math.max(n,t));return{lower:i,higher:n,length:n-i+1}}};let r=0;this.shuffle=function(t){r++;let i,n=function(){let e,i,n;Field.eachCell(function(o,s,l){let r,a;e={x:o,y:s},i={x:Math.floor(Math.random()*C.FIELD_MAX_WIDTH),y:Math.floor(Math.random()*C.FIELD_MAX_HEIGHT)},n=Field.getCell(i),r=l.object,a=n.object,l.isVisible&&r.isCanMoved&&!r.isBarrel&&r.objectId!==x.OBJECT_SAND&&n.isVisible&&a.isCanMoved&&!a.isBarrel&&a.objectId!==x.OBJECT_SAND&&Field.exchangeObjects(e,i,t)})};for(n(),i=0;i++<50&&0!==Field.findLines().length;)n();if(i=0,Field.findLines().length>0&&t&&r++<1e3){for(;i++<50&&(Field.eachCell(function(t,i,n){n.isVisible&&n.object.isGem&&n.object.objectId!==x.OBJECT_SAND&&(n.object.objectId=e.getRandomGemId())}),0!==Field.findLines().length););e.shuffle(!0)}else r=0}};Q=new Q,Field=Q,void 0!==e.LogicField&&(e.LogicField.__path="../client/components/application/logic/LogicField.js");let $=function(){let e=function(){return void 0!==ne?ne.getTime():LogicTimeServer.getTime()};this.getMaxHealth=function(){return w.user.maxHealth},this.getHealthRecoveryTime=function(){return w.user.healthRecoveryTime},this.getHealths=function(t){let i,n,o,s;return i=t.fullRecoveryTime,n=e(),o=$.getHealthRecoveryTime(),(s=i-n)<=0?this.getMaxHealth():Math.max(0,this.getMaxHealth()-Math.ceil(s/o))},this.isMaxHealths=function(e){return this.getHealths(e)===this.getMaxHealth()},this.setMaxHealth=function(t){t.fullRecoveryTime=e()},this.decrementHealth=function(e,t){t||(t=1),$.isMaxHealths(e)&&$.setMaxHealth(e),0===$.getHealths(e)&&$.zeroLife(e),e.fullRecoveryTime+=this.getHealthRecoveryTime()*t},this.getTimeLeft=function(t){let i;return this.isMaxHealths(t)?0:(i=t.fullRecoveryTime-e())-Math.floor(i/this.getHealthRecoveryTime())*this.getHealthRecoveryTime()},this.zeroLife=function(t){t.fullRecoveryTime=e()+this.getHealthRecoveryTime()*this.getMaxHealth()}};$=new $,CONST_IS_SERVER_SIDE&&(global.LogicHealth=$),void 0!==e.LogicHealth&&(e.LogicHealth.__path="components/application/logic/LogicHealth.js");let ee=function(){this.main=function(){De.init(function(){}),C.init(),Re.init(),webSocketClient=new Me,webSocketClient.init(function(){}),Ce.setMap({CAPIUser:T,CAPITimeServer:y,CAPIMap:E,CAPIStuff:I}),Ce.sendData=webSocketClient.sendData,webSocketClient.onData=Ce.onData,webSocketClient.onConnect=this.onConnect,webSocketClient.onDisconnect=Ce.onDisconnect,webSocketClient.run(),He.init(function(){})},this.onConnect=function(e){Ce.onConnect(e),oe.authorize()},this.onAuthorizeSuccess=function(){S.setCurrentMapId(S.getMapIdFromPointId(oe.getCurrentUser().nextPointId)),SAPITimeServer.sendMeTime(),ie.loadStuff(),ve.showPage(ge),se.onAuthorizeSuccess()}};void 0!==e.LogicMain&&(e.LogicMain.__path="../client/components/application/logic/LogicMain.js");let te=function(){this.onArrowPrevClick=function(){S.setPrevMap(),ve.redraw()},this.onArrowNextClick=function(){S.setNextMap(),ve.redraw()}};te=new te,void 0!==e.LogicMap&&(e.LogicMap.__path="../client/components/application/logic/LogicMap.js");let ie=function(){let e={};this.STUFF_HUMMER=1,this.STUFF_LIGHTNING=2,this.STUFF_SHUFFLE=3,this.loadStuff=function(){SAPIStuff.sendMeStuff()},this.updateStuff=function(t){e=t},this.getStuff=function(t){return t?(void 0===e[t]&&De.log("No Stuff:",De.LEVEL_FATAL_ERROR,[t,e]),e[t]):e},this.usedHummer=function(){e.hummerQty--},this.usedShuffle=function(){e.shuffleQty--},this.usedlightning=function(){e.lightningQty--},this.usedGold=function(t){e.goldQty-=t},this.giveAHummer=function(t){e.hummerQty+=t},this.giveAShuffle=function(t){e.shuffleQty+=t},this.giveALighnting=function(t){e.lightningQty+=t},this.giveAGold=function(t){e.goldQty+=t},this.giveAHealth=function(e){let t;t=oe.getCurrentUser(),$.decrementHealth(t,-e)}};ie=new ie,void 0!==e.LogicStuff&&(e.LogicStuff.__path="../client/components/application/logic/LogicStuff.js");let ne=function(){let e=0,t=0,i=0;this.setServerTime=function(n){e=n,t=(new Date).getTime(),i=e-t,De.log("Time sync:"+n+" gotTime:"+t+" timeDiff:"+i,De.LEVEL_DETAIL)},this.getTime=function(){return Math.floor(this.getMicroTime()/1e3)},this.getMicroTime=function(){return(new Date).getTime()+i},this.convertToClient=function(e){let t;return(t=1e3*e-i)/1e3}};ne=new ne,void 0!==e.LogicTimeClient&&(e.LogicTimeClient.__path="../client/components/application/logic/LogicTimeClient.js");let oe=function(){let e=this,t=null,i=[],n=null;this.authorize=function(){let e,t;switch(e=Re.getSocNetUserId(),t=Re.getAuthParams(),Re.getType()){case Re.TYPE_VK:SAPIUser.authorizeByVK(e,t);break;case Re.TYPE_STANDALONE:SAPIUser.authorizeByStandalone(e,t);break;default:De.log("Wrong soc net type",De.LEVEL_FATAL_ERROR)}},this.authorizeSuccess=function(e){t=e,s={},ee.onAuthorizeSuccess()},this.isAuthorized=function(){return!!t},this.getCurrentUser=function(){return this.getById(t)},this.getById=function(t){return i[t]?i[t]:(e.loadUserInfoById(t),o())},this.getList=function(t){let n,o;return n=[],t&&t.length?(o=[],t.forEach(function(e){i[e]||s[e]||(s[e]=!0,i[e]=!1,o.push(e))}),o.length&&SAPIUser.sendMeUserListInfo(o),t.forEach(function(t){e.getById(t).photo50&&n.push(e.getById(t))}),n):n};let o=function(){return{id:null,online:!1}},s={};this.loadUserInfoById=function(e){null!==t&&(s[e]||(s[e]=!0,SAPIUser.sendMeUserInfo(e)))},this.updateUserInfo=function(e){s[e.id]=!1,i[e.id]||(i[e.id]=o());for(let t in e)i[e.id][t]=e[t];i[e.id].photo50||Re.getUserInfo(e.socNetUserId,function(t){i[e.id].photo50=t[0].photo_50,i[e.id].photo100=t[0].photo_100,i[e.id].firstName=t[0].first_name,i[e.id].lastName=t[0].last_name,ve.redraw()}),ve.redraw()},this.setFriendIds=function(e){n=e,ve.redraw()};let l=!1;this.getFriendIds=function(e){return n||l?n?e?n.slice(0,e):n:null:(l=!0,Re.getFriendIds(function(e){SAPIUser.sendMeUserIdsBySocNet(e)}),null)},this.getMapFriendIds=function(e){let t;return this.getFriendIds()&&(t=C.getPointsByMapId(e),n.forEach(function(e){})),null};let r=[];this.getFriendIdsByMapId=function(e){let t,i,o;return this.getFriendIds()?(i=S.getFirstPointId(),t=S.getLastPointId(),o=this.getList(n).filter(function(e){return e.nextPointId>=i&&e.nextPointId<=t}).map(function(e){return e.id}),function(e){e||(e=currentMapId),oe.getFriendIds()&&(r[e]||(r[e]=!0,SAPIMap.sendMeUsersScore(e,oe.getFriendIds())))}(e),o):[]},this.getFriendIdsByMapIdAndPointIdWithScore=function(e,t,i){let n,o,s,l;return s=[],n=oe.getFriendIdsByMapId(e),l=oe.getCurrentUser().id,i&&n.push(l),n&&(o=oe.getList(n)),o&&(s=o.filter(function(e,n){return!(!i&&l===e.id)&&(o.indexOf(e)===n&&e.nextPointId>=t)}).sort(function(e,t){return t.lastLoginTimestamp-e.lastLoginTimestamp}).map(function(e){return e})),s}};oe=new oe,LU=oe,void 0!==e.LogicUser&&(e.LogicUser.__path="../client/components/application/logic/LogicUser.js");let se=function(){let e=this,t=function(){};this.TAG_FIRST_NUMBER_POINT=1,this.onClick=t,this.onDestroyThing=t,this.onDestroyLine=t,this.onShowDialog=t,this.onHideDialog=t,this.onFieldSilent=t,this.onAuthorizeSuccess=function(){1===oe.getCurrentUser().nextPointId&&e.start(fe)},this.onFieldFirstShow=function(){let t=oe.getCurrentUser().nextPointId,i=C.getPlayedId();2===t&&2===i&&e.start(_e),3===t&&3===i&&e.start(Ie),4===t&&4===i&&e.start(ye),9===t&&9===i&&e.start(Se),12===t&&12===i&&e.start(pe),15===t&&15===i&&e.start(me),23===t&&23===i&&e.start(Ee),41===t&&41===i&&e.start(Te),46===t&&46===i&&e.start(be),51===t&&51===i&&e.start(we)},this.start=function(i){PBWizard.reset(),i.dialogCounter=0,e.onClick=i.onClick?i.onClick:t,e.onDestroyThing=i.onDestroyThing?i.onDestroyThing:t,e.onDestroyLine=i.onDestroyLine?i.onDestroyLine:t,e.onShowDialog=i.onShowDialog?i.onShowDialog:t,e.onHideDialog=i.onHideDialog?i.onHideDialog:t,e.onFieldSilent=i.onFieldSilent?i.onFieldSilent:t,i.init()},this.finish=function(){PBWizard.finish(),e.onClick=t,e.onDestroyThing=t,e.onDestroyLine=t,e.onShowDialog=t,e.onHideDialog=t,e.onFieldSilent=t}};se=new se,void 0!==e.LogicWizard&&(e.LogicWizard.__path="../client/components/application/logic/LogicWizard.js");let le=function(){let e=this,t=!1;this.elements=[],this.init=function(){let t;t=Le.createElement(J,{x:-15,y:-15,src:"fs-frame.png"}),e.elements.push(t),t=Le.createElement(J,{x:0,y:0,src:"old-paper.png"}),e.elements.push(t),i()},this.show=function(){if(!0!==t){t=!0,e.preset();for(let t in e.elements)e.elements[t].show();e.redraw()}},this.hide=function(){if(!1!==t){t=!1;for(let t in e.elements)e.elements[t].hide()}},this.preset=function(){},this.redraw=function(){if(t){e.preset();for(let t in e.elements)e.elements[t].redraw()}};let i=function(){let e,t;e=document.getElementsByTagName("body")[0],t="url('"+Pe.getPath("old-paper.png")+"')",e.style.backgroundImage=t}};le=new le,void 0!==e.PageBlockBackground&&(e.PageBlockBackground.__path="../client/components/application/page_blocks/PageBlockBackground.js");let re=function(){let e,t,i,o,s=this,l=!1,r=null,a=null,c=null,h=null,u=null,d=null,g=null,f=null,p=null,m=null,_=null,I=null,y=null;this.elements=[],this.init=function(){let t,o,l,T;T=37,r=Le.createElement(G,{centerX:388.5,centerY:250,onDestroyLine:s.onDestroyLine,onDestroyThing:s.onDestroyThing,beforeTurnUse:s.beforeTurnUse,beforeStuffUse:s.beforeStuffUse,onFieldSilent:s.onFieldSilent}),s.elements.push(r),t=Le.createElement(W,{x:730,y:10,srcRest:"button-quit-rest.png",srcHover:"button-quit-hover.png",srcActive:"button-quit-active.png",onClick:function(){0===i?PBZDialogs.dialogTurnsLoose.reset():PBZDialogs.dialogJustQuit.showDialog()}}),s.elements.push(t),o=635,l=95,t=Le.createElement(J,{x:o,y:l,src:"panel-turns.png"}),s.elements.push(t),t=Le.createElement(X,{x:o,y:l+6,width:112,text:"УРОВЕНЬ",alignCenter:!0}),s.elements.push(t),g=Le.createElement(X,{x:o,y:l+37,width:112,alignCenter:!0}),s.elements.push(g),o=15,l=160,t=Le.createElement(J,{x:o,y:l,src:"panel-score.png"}),s.elements.push(t),t=Le.createElement(X,{x:o,y:l+6,width:112,text:"ОЧКИ",alignCenter:!0}),s.elements.push(t),a=Le.createElement(X,{x:o,y:l+37,width:112,alignCenter:!0}),s.elements.push(a),c=Le.createDom(void 0,{x:o+15,y:l+62}),s.elements.push(c),h=Le.createDom(void 0,{x:o+15+27,y:l+62}),s.elements.push(h),u=Le.createDom(void 0,{x:o+15+54,y:l+62}),s.elements.push(u),o=15,l=75,t=Le.createElement(J,{x:o,y:l,src:"panel-turns.png"}),s.elements.push(t),t=Le.createElement(X,{x:o,y:l+6,width:112,text:"ХОДЫ",alignCenter:!0,fontSize5:18}),s.elements.push(t),d=Le.createElement(X,{x:o,y:l+37,width:112,alignCenter:!0}),s.elements.push(d),o=15,l=260,e=Le.createElement(K,{x:o,y:l,title:"ЦЕЛИ",fontSize:18}),s.elements.push(e),l=200,t=Le.createElement(q,{x:650,y:l,fieldName:"hummerQty",srcRest:"button-hummer-rest.png",srcHover:"button-hummer-hover.png",srcActive:"button-hummer-active.png",onClick:function(){s.setStuffMode(ie.STUFF_HUMMER)}}),s.elements.push(t),t=Le.createElement(q,{x:650,y:l+80,fieldName:"lightningQty",srcRest:"button-lightning-rest.png",srcHover:"button-lightning-hover.png",srcActive:"button-lightning-active.png",onClick:function(){s.setStuffMode(ie.STUFF_LIGHTNING)}}),s.elements.push(t),t=Le.createElement(q,{x:650,y:l+160,fieldName:"shuffleQty",srcRest:"button-shuffle-rest.png",srcHover:"button-shuffle-hover.png",srcActive:"button-shuffle-active.png",onClick:function(){s.setStuffMode(ie.STUFF_SHUFFLE)}}),s.elements.push(t),I=Le.createElement(W,{x:312,y:5,width:25,height:25,srcRest:"button-reload-field-rest.png",srcHover:"button-reload-field-hover.png",srcActive:"button-reload-field-active.png",onClick:function(){n.lock(),E.setCallbackOnMapsInfo(function(){ve.showPage(ge),ve.showPage(de),n.release(),ve.redraw()}),SAPIMap.reloadLevels(),SAPIMap.sendMeMapInfo(S.getCurent().id)}}),y=Le.createElement(W,{x:342,y:5,width:25,height:25,srcRest:"field-red.png",srcHover:"field-red.png",srcActive:"field-red.png",onClick:function(){switch(We.OnIdle.animStep){case 5:y.srcRest="field-yellow.png",We.OnIdle.animStep=1;break;case 1:y.srcRest="field-red.png",We.OnIdle.animStep=.2;break;case.2:y.srcRest="field-green.png",We.OnIdle.animStep=5;break;default:We.OnIdle.animStep=1}y.redraw()}}),(_=Le.createDom(null,{x:190,y:10})).__dom.style.zIndex=1e4,p=Le.createDom(void 0,{x:0,y:0,width:w.app.width,height:w.app.height,background:"black",opacity:.3,zIndex:999}),f=Le.createElement(X,{x:w.app.width/2-w.app.width/1.5/2,y:w.app.height/2-40,width:w.app.width/1.5,height:40,fontSize:36,color:"#fdfff5",alignCenter:!0,zIndex:1e3}),Le.bind(_,Le.EVENT_MOUSE_CLICK,function(e,t){let i;_.hide(),(i=document.elementFromPoint(e.clientX,e.clientY)).dispatchEvent(new MouseEvent(e.type,e)),m&&_.show()}),Le.onMouseMove(function(e,t){_.x=e-25,_.y=t-25,_.redraw()})},this.show=function(){if(!0!==l){l=!0,b();for(let e in s.elements)s.elements[e].show();s.firstShow(),Re.getType()!==Re.TYPE_STANDALONE&&1!==oe.getCurrentUser().id&&1!==oe.getCurrentUser().socNetUserId||(I.show(),y.show())}},this.isShowed=function(){return l},this.hide=function(){if(!1!==l){l=!1;for(let e in s.elements)s.elements[e].hide();_.hide(),e.hide(),I.hide(),y.hide()}};let T,b=function(){let e;e=C.getById(C.getPlayedId()),t=0,i=e.turns,o=C.copyGoals(e.goals),r.setLayers(e.layers),s.redraw()};this.firstShow=function(){let e;r.unlock(),r.run(),e=C.getById(C.getPlayedId()),PBZDialogs.dialogGoals.setGoals(e.goals),PBZDialogs.dialogGoals.showDialog(),T=!1,se.onFieldFirstShow()},this.redraw=function(){if(!l)return;let n=C.countStars(null,null,t);c.backgroundImage="star-off-middle.png",h.backgroundImage="star-off-middle.png",u.backgroundImage="star-off-middle.png",n>=1&&(c.backgroundImage="star-on-middle.png"),n>=2&&(h.backgroundImage="star-on-middle.png"),n>=3&&(u.backgroundImage="star-on-middle.png"),a.setText(t.toString()),d.setText(i.toString()),g.setText(C.getPlayedId().toString());for(let e in s.elements)s.elements[e].redraw();e.items=o,e.redraw(),m?(_.show(),_.redraw()):_.hide(),I.redraw(),y.redraw()};let L={};L[x.OBJECT_RED]=10,L[x.OBJECT_GREEN]=10,L[x.OBJECT_BLUE]=10,L[x.OBJECT_YELLOW]=10,L[x.OBJECT_PURPLE]=10,L[x.OBJECT_SAND]=30,L[x.OBJECT_SPIDER_ALPHA]=100,L[x.OBJECT_SPIDER_BETA]=100,L[x.OBJECT_SPIDER_GAMMA]=100,L[x.OBJECT_POLY_COLOR]=300,L[x.OBJECT_GOLD]=300,L[x.OBJECT_TILE]=300,L[x.OBJECT_BOX]=5,L[x.OBJECT_BARREL]=100,L[x.OBJECT_BOX]=100,this.onDestroyThing=function(e,i){O(e,1),L[e]&&(t+=L[e]),s.redraw(),se.onDestroyThing(i)},this.onDestroyLine=function(e){se.onDestroyLine(e)};let O=function(e,t){T=!0,o.forEach(function(i){i.id===e&&(i.count-=t),i.count>0&&(T=!1),i.count<0&&(i.count=0)}),s.redraw()};this.onFieldSilent=function(){se.onFieldSilent(),T?(r.lock(),T=!1,setTimeout(s.finishLevel,15*We.OnIdle.animateInterval)):0===i&&PBZDialogs.dialogTurnsLoose.showDialog()},this.finishLevel=function(){let e,i,n;m=null,De.log("finishLevel()",De.LEVEL_DETAIL),i=oe.getCurrentUser(),e=C.getPlayedId(),n=C.getScore(e),i.nextPointId<e+1&&(i.nextPointId=e+1,oe.updateUserInfo(i)),t>n&&(SAPIMap.finishLevel(e,t),C.setPointUserScore(i.id,e,t)),SAPIUser.onPlayFinish(),PBZDialogs.dialogGoalsReached.showDialog(e),ve.redraw()},this.beforeTurnUse=function(){0!==--i||T||r.lock(),5===i&&P("Осталось 5 ходов!"),s.redraw()},this.beforeStuffUse=function(){switch(m){case ie.STUFF_HUMMER:SAPIStuff.usedHummer(),ie.usedHummer();break;case ie.STUFF_LIGHTNING:SAPIStuff.usedlightning(),ie.usedlightning();break;case ie.STUFF_SHUFFLE:SAPIStuff.usedShuffle(),ie.usedShuffle()}m=null,r.setStuffMode(m),s.redraw()},this.setStuffMode=function(e){switch(e){case ie.STUFF_HUMMER:if(ie.getStuff("hummerQty")<1)return void PBZDialogs.dialogStuffShop.showDialog(e);_.backgroundImage="button-hummer-active.png";break;case ie.STUFF_LIGHTNING:if(ie.getStuff("lightningQty")<1)return void PBZDialogs.dialogStuffShop.showDialog(e);_.backgroundImage="button-lightning-active.png";break;case ie.STUFF_SHUFFLE:if(ie.getStuff("shuffleQty")<1)return void PBZDialogs.dialogStuffShop.showDialog(e);_.backgroundImage="button-shuffle-active.png"}m=e,r.setStuffMode(e),s.redraw()},this.getElementField=function(){return r},this.onWizardFinish=function(){P("Теперь сами!")};let P=function(e){p.show(),f.setText(e),f.show(),f.redraw(),setTimeout(function(){p.hide(),f.hide()},1.1*We.OnIdle.second)}};re=new re,void 0!==e.PageBlockField&&(e.PageBlockField.__path="../client/components/application/page_blocks/PageBlockField.js");let ae=function(){let t,i=this,n=!1,s=!1,l={x:714,y:225},r=!1,a=!1,c=!1,h=!1,u=!1,d={},g=1,f=null,m=[],_=[],E=null;this.elements=[],this.init=function(){let e;s=Le.createElement(J,{x:0,y:0,width:777,height:500,src:"not-found.png"}),u=Le.createElement(J,{x:0,y:0,width:777,height:500,src:"old-paper.png"}),i.elements.push(u),h=Le.createElement(J,{x:0,y:0,width:777,height:500,src:"way-line.png"}),i.elements.push(h),c=Le.createElement(J,{x:0,y:0,width:777,height:500,src:"map-001.png"}),i.elements.push(c),E=Le.createElement(J,{x:0,y:0,width:50,height:50,p:{},src:"hint-arrow.png"}),i.elements.push(E),o.anim(p,{},E),r=Le.createElement(W,{x:0,y:l.y,srcRest:"map-arrow-left-rest.png",srcHover:"map-arrow-left-hover.png",srcActive:"map-arrow-left-active.png",onClick:te.onArrowPrevClick}),i.elements.push(r),a=Le.createElement(W,{x:l.x,y:l.y,srcRest:"map-arrow-right-rest.png",srcHover:"map-arrow-right-hover.png",srcActive:"map-arrow-right-active.png",onClick:te.onArrowNextClick}),i.elements.push(a),C.getPointsCoords().forEach(function(t){1===t.number&&Le.setTagId(se.TAG_FIRST_NUMBER_POINT),e=Le.createElement(Y,{x:t.x,y:t.y,friends:[],stateId:Y.STATE_CLOSE,number:null,pointId:null,onClick:function(e,t,i){PBZDialogs.dialogPointInfo.showDialog(i.pointId)}}),i.elements.push(e),m[t.number]=e,1===t.number&&Le.setTagId(null)}),b.getCoords().forEach(function(t){e=Le.createElement(U,{x:t.x,y:t.y,width:71,height:62,number:t.number,enabled:!0,onClick:function(e,t,i){let n,o,s,l,r;n=i.chestId,o=b.isItOpened(n),l=(s=b.getById(n)).goalStars,r=S.countStarsByMapId(),o||(r<l?(PBZDialogs.dialogChestNeedStars.mapStars=r,PBZDialogs.dialogChestNeedStars.goalStars=l,PBZDialogs.dialogChestNeedStars.showDialog()):(SAPIChest.openChest(n),b.setOpened(n),L.giveOutPrizes(s.prizes),PBZDialogs.dialogChestYouWin.chestId=n,PBZDialogs.dialogChestYouWin.showDialog(),ve.redraw()))}}),_[t.number]=e}),t=Le.createElement(j,{x:213,y:435}),i.elements.push(t),e=Le.createElement(W,{x:165,y:438,srcRest:"button-add-rest.png",srcHover:"button-add-hover.png",srcActive:"button-add-active.png",onClick:function(){Re.openInviteFriendDialog()}}),i.elements.push(e),e=Le.createElement(J,{x:650,y:370,opacity:.7,src:"wind-rose.png"}),i.elements.push(e),f=Le.createDom(void 0,{x:0,y:0,backgroundImage:"not-found.png"})},this.show=function(){!0!==n&&(n=!0,i.elements.forEach(function(e){e.show()}),this.mapElsCreateIfNotExits(),this.mapElsShow(),i.preset(),i.redraw())},this.hide=function(){if(!1!==n){n=!1;for(let e in i.elements)i.elements[e].hide();this.mapElsHide(),r.hide()}},this.preset=function(){let e,t,i;if(this.presetPoints(),this.presetChests(),e=oe.getCurrentUser().nextPointId,t=S.getFirstPointId(),i=S.getLastPointId(),e>=t&&e<=i){let t=C.getPointsCoords()[S.getNumberFromPointId(e)-1];E.src="hint-arrow.png",E.p=t,E.show()}else e>i?(E.show(),E.p=l,E.src="map-arrow-right-rest.png"):E.hide()},this.redraw=function(){n&&(I()||(i.preset(),t.setFriends(oe.getList(oe.getFriendIds(6))),t.redraw(),i.elements.forEach(function(e){e.redraw()}),this.mapElsRedraw(),r.redraw()))},this.mapElsCreateIfNotExits=function(){let t,i;if((t=S.getCurent())&&!d[t.id]){d[t.id]=[];for(let n in t.elements)i=Le.createElement(e[t.elements[n].name],t.elements[n].params),t.elements[n].animPlay&&i.animPlay(),d[t.id].push(i)}},this.mapElsShow=function(){let e;if(e=S.getCurent()){for(let t in d[e.id])d[e.id][t].show();if(g!==e.id){for(let e in d[g])d[g][e].hide();g=e.id}}},this.mapElsHide=function(){for(let e in d)for(let t in d[e])d[e][t].hide();f.hide()},this.mapElsRedraw=function(){let e;if(e=S.getCurent()){c.src=e.src,g!==e.id&&this.mapElsShow();for(let t in d[e.id]);}},this.presetPoints=function(){let e,t,i,n,o,s;if(e=oe.getCurrentUser(),s=S.getCurent()){o=C.getPointUserScore(s.id,[e.id]);for(let s=1;s<=S.POINTS_PER_MAP;s++)t=S.getPointIdFromPointNumber(s),(n=m[s]).pointId=t,(i=C.getById(t))&&(n=m[s],i.id===e.nextPointId&&(n.stateId=Y.STATE_CURRENT),i.id<e.nextPointId&&(n.stateId=Y.STATE_FINISHED),i.id>e.nextPointId&&(n.stateId=Y.STATE_CLOSE),o[t]?n.userScore=o[t][e.id]?o[t][e.id].score:0:n.userScore=0,n.setGamers(oe.getFriendIdsByMapIdAndPointIdWithScore(S.getCurent().id,t,!0)))}},this.presetChests=function(){let e,t,i,n;if(n=S.getCurent())for(let n=1;n<=S.CHESTS_PER_MAP;n++)e=S.getChestIdFromChestNumber(n),(t=b.getById(e))&&((i=_[n]).chestId=e,i.goalStars=t.goalStars,i.stars=S.countStarsByMapId())};let I=function(){let e,t,i,n,o,s;return e=!1,t=S.getCurent(),i=oe.getFriendIds(6),t&&(n=oe.getFriendIdsByMapId(t.id)),i&&(o=oe.getList(i)),n&&(s=oe.getList(n)),t||(e=!0),i&&i.length!==o.length&&(e=!0),n&&n.length!==s.length&&(e=!0),e?f.show():f.hide(),e}};ae=new ae,void 0!==e.PageBlockMaps&&(e.PageBlockMaps.__path="../client/components/application/page_blocks/PageBlockMaps.js");let ce=function(){let e=this,t=!1;this.elements=[];let i,n=null,o=null;this.init=function(){let t,l,r;l=110,t=Le.createElement(J,{x:110,y:0,src:"panel-money.png"}),e.elements.push(t),t=Le.createElement(W,{x:115,y:-3,srcRest:"button-money-rest.png",srcHover:"button-money-hover.png",srcActive:"button-money-active.png",onClick:function(){PBZDialogs.dialogMoneyShop.showDialog()}}),e.elements.push(t),i=Le.createElement(X,{x:168,y:11,width:70,alignCenter:!0}),e.elements.push(i),t=Le.createElement(W,{x:232,y:-3,srcRest:"button-add-rest.png",srcHover:"button-add-hover.png",srcActive:"button-add-active.png",onClick:function(){PBZDialogs.dialogMoneyShop.showDialog()}}),e.elements.push(t),r=398,t=Le.createElement(J,{x:398,y:0,src:"panel-hearth.png"}),e.elements.push(t),t=Le.createElement(V,{x:407,y:-1}),e.elements.push(t),t=Le.createElement(z,{x:509,y:10,healthIndicator:t}),e.elements.push(t),t=Le.createElement(W,{x:588,y:-4,srcRest:"button-add-rest.png",srcHover:"button-add-hover.png",srcActive:"button-add-active.png",onClick:function(){PBZDialogs.dialogHealthShop.showDialog()}}),e.elements.push(t),n=Le.createElement(W,{x:650,y:10,srcRest:"button-sound-off.png",srcHover:"button-sound-active.png",srcActive:"button-sound-active.png",onClick:function(){Fe.toggle(),Fe.play(Fe.PATH_CHALK),ve.redraw()}}),e.elements.push(n),o=Le.createElement(W,{x:690,y:10,srcRest:"button-fs-on-rest.png",srcHover:"button-fs-on-hover.png",srcActive:"button-fs-on-active.png",onClick:s}),e.elements.push(o)},this.show=function(){if(!t){t=!0,e.preset();for(let t in e.elements)e.elements[t].show();e.redraw()}},this.hide=function(){if(t){t=!1;for(let t in e.elements)e.elements[t].hide()}},this.preset=function(){Fe.isEnabled()?n.srcRest="button-sound-on.png":n.srcRest="button-sound-off.png",void 0!==ie.getStuff().goldQty&&i.setText(ie.getStuff("goldQty"))},this.redraw=function(){t&&(e.preset(),e.elements.forEach(function(e){e.redraw()}))};let s=function(){Le.fsSwitch(),Le.isFullScreen()?(o.srcRest="button-fs-on-rest.png",o.srcHover="button-fs-on-rest.png",o.srcActive="button-fs-on-rest.png"):(o.srcRest="button-fs-off-rest.png",o.srcHover="button-fs-off-rest.png",o.srcActive="button-fs-off-rest.png")};this.oneHealthHide=!1};ce=new ce,void 0!==e.PageBlockPanel&&(e.PageBlockPanel.__path="../client/components/application/page_blocks/PageBlockPanel.js");let he=function(){let t=this,i=!1,n={};this.elements=[];let s=null,l=null,r=null,a=null;this.init=function(){s=document.getElementById("wizardArea"),console.log(s),s.width=w.app.width,s.height=w.app.height,s.style.display="none",(l=s.getContext("2d")).showByImg=u,l.unlockByImg=h,l.highlightCells=d;let e=function(e,t){let i,n,o,r;o=e.offsetX,r=e.offsetY,0===(i=l.getImageData(o,r,1,1).data)[3]?(s.style.display="none",(n=document.elementFromPoint(e.offsetX,e.offsetY))&&n.dispatchEvent(new MouseEvent(e.type,e)),s.isActive&&(s.style.display=""),t&&t(n)):t&&t(!1)};s.onclick=function(t){e(t,se.onClick)},s.onmousemove=function(t){e(t,function(e){s.style.cursor=e?e.style.cursor:""})},(r=Le.createElement(J,{x:400,y:360,src:"wizard-dialog.png"})).dom.__dom.style.zIndex=2e4,r.hide(),(a=Le.createElement(X,{x:416,y:376,width:Pe.getWidth("wizard-dialog.png")-32,height:Pe.getHeight("wizard-dialog.png"),alignCenter:!0,zIndex:20001,text:"text"})).hide()};this.show=function(){if(!i){i=!0,t.preset();for(let e in t.elements)t.elements[e].show();t.redraw()}},this.hide=function(){if(i){i=!1;for(let e in t.elements)t.elements[e].hide()}},this.preset=function(){},this.redraw=function(){i&&(t.preset(),t.elements.forEach(function(e){e.redraw()}),r.redraw(),a.redraw())},this.begin=function(){re.getElementField().lockHint(),s.style.display="",s.isActive=!0,l.clearRect(0,0,w.app.width*e.devicePixelRatio,w.app.height*e.devicePixelRatio),l.globalCompositeOperation="source-out",l.globalAlpha=.55,l.fillStyle="black",l.fillRect(0,0,w.app.width*e.devicePixelRatio,w.app.height*e.devicePixelRatio)},this.finish=function(){t.reset(),re.onWizardFinish()},this.reset=function(){s.isActive=!1,s.style.display="none",r.hide(),a.hide(),re.getElementField().unlockHint(),clearInterval(c)};let c=null;this.showHint=function(e){let t=re.getElementField().getCoords();e.forEach(function(e){e.x+=t.cellX,e.y+=t.cellY}),c&&clearInterval(c),c=setInterval(function(){o.hintActive||re.getElementField().showHint(e)},1.5*We.OnIdle.second)},this.updateText=function(e){a.text=e,t.redraw()},this.showDialog=function(e,i,n,o){let s;switch(e||(e=400),i||(i=360),n){default:case 1:s=30;break;case 2:s=15;break;case 3:s=2}n||(s=15*n),o||(o=""),r.x=e,r.y=i,a.x=e+16,a.y=i+16+s,r.show(),a.show(),t.redraw()},this.hideDialog=function(){r.hide(),a.hide()},this.draw=function(e){e(l)};let h=function(e,t,i){if(l.globalAlpha=1,l.globalCompositeOperation="destination-out",!n[e])return n[e]=new Image,n[e].onload=function(){h(e,t,i)},void(n[e].src=e);l.drawImage(n[e],t,i,Pe.getWidth(e),Pe.getHeight(e))},u=function(e,t,i){if(l.globalAlpha=.99,l.globalCompositeOperation="destination-out",!n[e])return n[e]=new Image,n[e].onload=function(){u(e,t,i)},void(n[e].src=e);l.drawImage(n[e],t,i,Pe.getWidth(e),Pe.getHeight(e))},d=function(e){let t=re.getElementField().getCoords();e.forEach(function(e){e.unlock?h("wizard-diamond-cell.png",t.x+C.BLOCK_WIDTH*e.x,t.y+C.BLOCK_HEIGHT*(e.y+1)):u("wizard-diamond-cell.png",t.x+C.BLOCK_WIDTH*e.x,t.y+C.BLOCK_HEIGHT*(e.y+1))})};this.showByImg=u,this.unlockByImg=h,this.highlightCells=d};he=new he,PBWizard=he,void 0!==e.PageBlockWizard&&(e.PageBlockWizard.__path="../client/components/application/page_blocks/PageBlockWizard.js");let ue=function(){let e=this,t=!1;this.elements=[],this.dialogMoneyShop=null,this.dialogHealthShop=null,this.dialogGoals=null,this.dialogStuffShop=null,this.dialogGoalsReached=null,this.dialogTurnsLoose=null,this.dialogJustQuit=null,this.dialogPointInfo=null,this.dialogChestNeedStars=null,this.dialogChestYouWin=null,this.init=function(){this.dialogMoneyShop=Le.createElement(N,{}),e.elements.push(this.dialogMoneyShop),this.dialogHealthShop=Le.createElement(B,{}),e.elements.push(this.dialogHealthShop),this.dialogGoals=Le.createElement(H),e.elements.push(this.dialogGoals),this.dialogGoalsReached=Le.createElement(v),e.elements.push(this.dialogGoalsReached),this.dialogTurnsLoose=Le.createElement(M),e.elements.push(this.dialogTurnsLoose),this.dialogJustQuit=Le.createElement(R),e.elements.push(this.dialogJustQuit),this.dialogStuffShop=Le.createElement(F),e.elements.push(this.dialogStuffShop),this.dialogPointInfo=Le.createElement(k),e.elements.push(this.dialogPointInfo),this.dialogChestNeedStars=Le.createElement(A),e.elements.push(this.dialogChestNeedStars),this.dialogChestYouWin=Le.createElement(D),e.elements.push(this.dialogChestYouWin)},this.show=function(){if(!t){t=!0,e.preset();for(let t in e.elements)e.elements[t].show();e.redraw()}},this.hide=function(){if(t){t=!1;for(let t in e.elements)e.elements[t].hide()}},this.preset=function(){},this.redraw=function(){t&&(e.preset(),e.elements.forEach(function(e){e.redraw()}))}};ue=new ue,PBZDialogs=ue,void 0!==e.PageBlockZDialogs&&(e.PageBlockZDialogs.__path="../client/components/application/page_blocks/PageBlockZDialogs.js");let de=function(){let e=this;this.blocks=[],this.init=function(){e.blocks.push(le),e.blocks.push(re),e.blocks.push(ce),e.blocks.push(PBZDialogs),e.blocks.push(he)}};de=new de,void 0!==e.PageField&&(e.PageField.__path="../client/components/application/pages/PageField.js");let ge=function(){let e=this;this.blocks=[],this.init=function(){e.blocks.push(le),e.blocks.push(ce),e.blocks.push(ae),e.blocks.push(PBZDialogs),e.blocks.push(he)}};ge=new ge,void 0!==e.PageMain&&(e.PageMain.__path="../client/components/application/pages/PageMain.js");let fe={init:function(){PBWizard.begin(),PBWizard.updateText("Нажми на красный кружок, что бы начать играть."),PBWizard.showDialog(400,360,2);let e=C.getPointsCoords()[0];PBWizard.unlockByImg("wizard-point-circle.png",e.x-Pe.getWidth("wizard-point-circle.png")/2+Pe.getWidth("map-way-point-red.png")/2,e.y-Pe.getHeight("wizard-point-circle.png")/2+Pe.getHeight("map-way-point-red.png")/2)},onClick:function(e){e.tagId===se.TAG_FIRST_NUMBER_POINT&&"1"===e.innerText&&se.start(WizardFirstStart_2)}};WizardFirstStart_2={init:function(){PBWizard.begin()},onShowDialog:function(){WizardFirstStart_2.dialogCounter++,WizardFirstStart_2.dialogCounter>1||(PBWizard.updateText("Нажми кнопку играть."),PBWizard.showDialog(400,380,1),PBWizard.unlockByImg("wizard-button.png",390-Pe.getWidth("wizard-button.png")/2,328))},onHideDialog:function(){WizardFirstStart_2.dialogCounter++,2===WizardFirstStart_2.dialogCounter&&PBWizard.hideDialog(),2===WizardFirstStart_2.dialogCounter&&PBWizard.begin(),5===WizardFirstStart_2.dialogCounter&&se.start(WizardFirstStart_3)}},WizardFirstStart_3={init:function(){PBWizard.begin()},onHideDialog:function(e){this.dialogCounter++<3||(PBWizard.updateText("Поменяй соседние камни местами, чтобы собрать камни красного цвета."),PBWizard.showDialog(210,380,3),PBWizard.showHint([{x:1,y:0},{x:2,y:0}]),PBWizard.highlightCells([{x:1,y:0,unlock:!0},{x:2,y:0,unlock:!0},{x:3,y:0,unlock:!1},{x:4,y:0,unlock:!1}]))},onDestroyLine:function(e){se.start(WizardFirstStart_4)}},WizardFirstStart_4={init:function(){PBWizard.begin(),setTimeout(function(){PBWizard.updateText("У тебя получилось. Давай ещё!"),PBWizard.showDialog(210,380,2,21),PBWizard.showHint([{x:3,y:2},{x:3,y:3}]),PBWizard.highlightCells([{x:2,y:2,unlock:!1},{x:3,y:2,unlock:!0},{x:3,y:3,unlock:!0},{x:4,y:2,unlock:!1}])},1.5*We.OnIdle.second)},onDestroyLine:function(e){se.finish()}},void 0!==e.WizardFirst&&(e.WizardFirst.__path="../client/components/application/wizards/WizardFirst.js");let pe={init:function(){PBWizard.begin(),PBWizard.updateText("Собирай пауков, взрывая камни на которых они сидят")},onHideDialog:function(){pe.dialogCounter++<2||(PBWizard.showHint([{x:2,y:1},{x:3,y:1}]),PBWizard.showDialog(210,400,2,20),PBWizard.highlightCells([{x:0,y:1,unlock:!1},{x:1,y:1,unlock:!1},{x:2,y:1,unlock:!0},{x:3,y:1,unlock:!0}]))},onDestroyLine:function(){se.finish()}};void 0!==e.WizardLevel_12&&(e.WizardLevel_12.__path="../client/components/application/wizards/WizardLevel_12.js");let me={init:function(){PBWizard.begin(),PBWizard.updateText("Взорви камни, что бы снять цепь.")},onHideDialog:function(){me.dialogCounter++<2||(PBWizard.showHint([{x:2,y:1},{x:2,y:0}]),PBWizard.showDialog(210,400,2,20),PBWizard.highlightCells([{x:2,y:0,unlock:!0},{x:1,y:1,unlock:!1},{x:2,y:1,unlock:!0},{x:3,y:1,unlock:!1}]))},onDestroyLine:function(){se.finish()}};void 0!==e.WizardLevel_14&&(e.WizardLevel_14.__path="../client/components/application/wizards/WizardLevel_14.js");let _e={init:function(){PBWizard.begin(),PBWizard.updateText("Собрав ряд из 4-ех камней, получишь камень с молнией.")},onHideDialog:function(e){_e.dialogCounter++<2||(PBWizard.showDialog(210,400,3,20),PBWizard.showHint([{x:1,y:3},{x:2,y:3}]),PBWizard.draw(function(e){e.highlightCells([{x:2,y:1,unlock:!1},{x:2,y:2,unlock:!1},{x:1,y:3,unlock:!0},{x:2,y:3,unlock:!0},{x:2,y:4,unlock:!1}])}))},onDestroyLine:function(){se.start(WizardLevel2_2)}};WizardLevel2_2={init:function(){PBWizard.begin(),PBWizard.updateText("Взорви камень с молнией, что бы использовать её."),setTimeout(function(){PBWizard.showHint([{x:2,y:4},{x:3,y:4}]),PBWizard.showDialog(230,150,2,20),PBWizard.draw(function(e){e.highlightCells([{x:2,y:4,unlock:!0},{x:3,y:4,unlock:!0},{x:4,y:4,unlock:!1},{x:5,y:4,unlock:!1}])})},1.1*We.OnIdle.second)},onDestroyLine:function(){se.finish()}},void 0!==e.WizardLevel_2&&(e.WizardLevel_2.__path="../client/components/application/wizards/WizardLevel_2.js");let Ee={init:function(){PBWizard.begin(),PBWizard.updateText("Взрывай камни рядом с красным пауком, что бы он убежал с поля.")},onHideDialog:function(){Ee.dialogCounter++<2||(PBWizard.showHint([{x:2,y:1},{x:2,y:0}]),PBWizard.showDialog(210,400,3,20),PBWizard.highlightCells([{x:2,y:2,unlock:!1},{x:1,y:1,unlock:!1},{x:2,y:1,unlock:!1},{x:3,y:1,unlock:!0},{x:4,y:1,unlock:!0}]))},onDestroyLine:function(){se.finish()}};void 0!==e.WizardLevel_23&&(e.WizardLevel_23.__path="../client/components/application/wizards/WizardLevel_23.js");let Ie={init:function(){PBWizard.begin(),PBWizard.updateText("Собрав ряд из 5-ти камней, получаешь звезду.")},onHideDialog:function(){Ie.dialogCounter++<2||(PBWizard.showHint([{x:4,y:2},{x:4,y:3}]),PBWizard.showDialog(210,400,2,20),PBWizard.highlightCells([{x:2,y:2,unlock:!1},{x:3,y:2,unlock:!1},{x:4,y:2,unlock:!0},{x:5,y:2,unlock:!1},{x:6,y:2,unlock:!1},{x:4,y:3,unlock:!0}]))},onDestroyLine:function(){se.start(WizardLevel3_2)}};WizardLevel3_2={init:function(){PBWizard.begin()},onFieldSilent:function(){PBWizard.updateText("Выбери цвет, что бы убрать все камни этого цвета."),PBWizard.showDialog(230,50,2,20),PBWizard.showHint([{x:4,y:2},{x:5,y:2}]),PBWizard.highlightCells([{x:4,y:2,unlock:!0},{x:5,y:2,unlock:!0}])},onDestroyThing:function(e){e.object.objectId===x.OBJECT_POLY_COLOR&&se.finish()}},void 0!==e.WizardLevel_3&&(e.WizardLevel_3.__path="../client/components/application/wizards/WizardLevel_3.js");let ye={init:function(){PBWizard.begin(),PBWizard.updateText("Взорви камень, под которым есть золото.")},onHideDialog:function(){ye.dialogCounter++<2||(PBWizard.showHint([{x:2,y:1},{x:3,y:1}]),PBWizard.showDialog(210,400,2,20),PBWizard.highlightCells([{x:0,y:1,unlock:!1},{x:1,y:1,unlock:!1},{x:2,y:1,unlock:!0},{x:3,y:1,unlock:!0}]))},onDestroyLine:function(){se.start(WizardLevel4_2)}};WizardLevel4_2={init:function(){PBWizard.begin()},onFieldSilent:function(){PBWizard.updateText("Собери еще золота!"),PBWizard.showDialog(450,250,1,20),PBWizard.showHint([{x:0,y:2},{x:1,y:2}]),PBWizard.highlightCells([{x:1,y:0,unlock:!1},{x:1,y:1,unlock:!1},{x:1,y:2,unlock:!0},{x:1,y:3,unlock:!1},{x:0,y:2,unlock:!0}])},onDestroyLine:function(e){se.finish()}},void 0!==e.WizardLevel_4&&(e.WizardLevel_4.__path="../client/components/application/wizards/WizardLevel_4.js");let Te={init:function(){PBWizard.begin(),PBWizard.updateText("Взорви камни и бочка упадет на блок.")},onHideDialog:function(){Te.dialogCounter++<2||(PBWizard.showHint([{x:1,y:4},{x:2,y:4}]),PBWizard.showDialog(340,390,2),PBWizard.highlightCells([{x:2,y:2,unlock:!1},{x:2,y:3,unlock:!1},{x:2,y:4,unlock:!0},{x:2,y:5,unlock:!1},{x:2,y:6,unlock:!1},{x:1,y:4,unlock:!0}]))},onDestroyLine:function(){console.log(1),se.start(WizardLevel41_2)}};WizardLevel41_2={init:function(){PBWizard.begin(),console.log(2),PBWizard.updateText("Бочка ещё не улетела, взорви ряд камней что бы переместить бочку."),console.log(2),PBWizard.showDialog(360,390,3),PBWizard.showHint([{x:2,y:5},{x:3,y:5}]),PBWizard.highlightCells([{x:3,y:3,unlock:!1},{x:3,y:4,unlock:!1},{x:3,y:5,unlock:!0},{x:3,y:6,unlock:!1},{x:2,y:5,unlock:!0}])},onDestroyLine:function(){se.finish()}},void 0!==e.WizardLevel_41&&(e.WizardLevel_41.__path="../client/components/application/wizards/WizardLevel_41.js");let be={init:function(){PBWizard.begin(),PBWizard.updateText("Соедини песочные камни в ряд.")},onHideDialog:function(){be.dialogCounter++<2||(PBWizard.showHint([{x:2,y:1},{x:3,y:1}]),PBWizard.showDialog(340,390,2),PBWizard.highlightCells([{x:3,y:0,unlock:!1},{x:3,y:1,unlock:!0},{x:3,y:2,unlock:!1},{x:2,y:1,unlock:!0}]))},onDestroyLine:function(){se.finish()}};void 0!==e.WizardLevel_46&&(e.WizardLevel_46.__path="../client/components/application/wizards/WizardLevel_46.js");let we={init:function(){PBWizard.begin(),PBWizard.updateText("Соедини ряд чтобы взорвать желтого паука.")},onHideDialog:function(){we.dialogCounter++<2||(PBWizard.showHint([{x:5,y:2},{x:5,y:2}]),PBWizard.showDialog(340,390,2),PBWizard.highlightCells([{x:2,y:2,unlock:!1},{x:3,y:2,unlock:!1},{x:4,y:2,unlock:!0},{x:5,y:2,unlock:!0}]))},onDestroyLine:function(){se.finish()}};void 0!==e.WizardLevel_51&&(e.WizardLevel_51.__path="../client/components/application/wizards/WizardLevel_51.js");let Se={init:function(){PBWizard.begin(),PBWizard.updateText("Взорви камни рядом с ящиком.")},onHideDialog:function(){Se.dialogCounter++<2||(PBWizard.showHint([{x:2,y:1},{x:3,y:1}]),PBWizard.showDialog(210,400,2,20),PBWizard.highlightCells([{x:0,y:1,unlock:!1},{x:1,y:1,unlock:!1},{x:2,y:1,unlock:!0},{x:3,y:1,unlock:!0}]))},onDestroyLine:function(){se.finish()}};var xe;void 0!==e.WizardLevel_9&&(e.WizardLevel_9.__path="../client/components/application/wizards/WizardLevel_9.js"),CONST_IS_SERVER_SIDE&&(Ae=require("fs"),xe=require("path"));let Ce=new function(){let e,i=this,n={},o=[],s=[];this.setMap=function(t){e=t},this.onData=function(o,s){let l,r,a;try{o=JSON.parse(o)}catch(e){return void t("Wrong data:parse error",De.LEVEL_WARNING,o)}"object"==typeof o?void 0!==o.group?"string"==typeof o.group?void 0!==o.method?"string"==typeof o.method?void 0!==o.args?"object"==typeof o.args?(l=o.group,r=o.method,a=o.args,void 0!==e[l]?void 0!==e[l][r]?(CONST_IS_SERVER_SIDE?De.log(s+" >> "+l+"."+r,De.LEVEL_DETAIL,a):De.log(l+"."+r,De.LEVEL_DETAIL,a),a.unshift(n[s]),e[l][r].apply(i,a)):De.log("Wrong data: method not found "+r,De.LEVEL_WARNING,o):De.log("Wrong data: group not found "+l,De.LEVEL_WARNING,o)):De.log("Wrong data: packet.args must have type 'object'",De.LEVEL_WARNING,o):De.log("Wrong data: packet must have .args",De.LEVEL_WARNING,o):De.log("Wrong data: packet.method must have type 'string'",De.LEVEL_WARNING,o):De.log("Wrong data: packet must have .method",De.LEVEL_WARNING,o):De.log("Wrong data: packet.group must have type 'string'",De.LEVEL_WARNING,o):De.log("Wrong data: packet must have .group",De.LEVEL_WARNING,o):De.log("Wrong data: packet must be 'object'",De.LEVEL_WARNING,o)},this.onConnect=function(e){De.log("ApiRouter.onConnect: id="+e,De.LEVEL_DETAIL),n[e]={connectionId:e}},this.onDisconnect=function(e){De.log("connection close: id="+e,De.LEVEL_WARNING);for(let t in o)o[t].call(i,n[e]);delete n[e]},this.executeRequest=function(e,t,n,o){let l,r;for(r in n=Array.prototype.slice.call(n),o||(o=[{connectionId:null}]),l="",o)l+=o[r].connectionId;CONST_IS_SERVER_SIDE?De.log(l+" << "+e+"."+t+":"+n.join(","),De.LEVEL_DETAIL):De.log(e+"."+t,De.LEVEL_DETAIL,n);let a={group:e,method:t,args:n};a=JSON.stringify(a);let c=0;for(r in o){if(!this.sendData(a,o[r].connectionId)){De.log("ApiRouter.failedToSend",De.LEVEL_WARNING,{packet:a,cntx:o[r]});for(let e in s)s[e].call(i,o[e])}c++}0===c&&De.log("ApiRouter. Try send to empty contextlist.",De.LEVEL_WARNING,{packet:a,cntxList:o})},this.addOnDisconnectCallback=function(e){o.push(e)},this.addOnFailedSendCallback=function(e){s.push(e)},this.getSAPIJSCode=function(){let t,i,n,o;for(i in t="",o={},e||(e=r()),e)for(n in global[i])"function"==typeof global[i][n]&&(o[i]||(o[i]={}),o[i][n]=!0);for(i in o){for(n in t+=i+" = function(){\r\n",o[i])t+="\tthis."+n+" = function(){\r\n",t+="\t\tApiRouter.executeRequest('"+i+"' ,'"+n+"', arguments);\r\n",t+="\t};\r\n";t+="};\r\n",t+=i+" = new "+i+"();\r\n"}for(i in t+="ApiRouter.map2 = {\r\n",o)t+="\t"+i+" : "+i+",\r\n";return t=t.substr(0,t.length-1),t+="};\r\n"},this.generate=function(){return h(l()),c(r())},this.generateClient=function(){let e,t;t=l();let i="";for(e in i+="ApiRouter.map = {\r\n",t)i+="\t"+e+" : "+e+",\r\n";i=i.substr(0,i.length-1),i='document.addEventListener("DOMContentLoaded", function() {'+(i+="};\r\n")+"})"};let l=function(){let e,t,i,n,o,s;e=CONST_DIR_CLIENT+"components/application/capi/",t=Ae.readdirSync(e),o={};for(let l in t)if(".gitkeep"!==t[l]&&".gitignore"!==t[l]){for(n in i=a(e+t[l]),s=null,global[i]&&(s=global[i]),require(e+t[l]),o[i]=[],global[i])"function"==typeof global[i][n]&&(o[i][n]=!0);s&&(global[i]=s)}return o},r=function(){let e,t,i,n,o;e=CONST_DIR_COMPONENTS+"/application/sapi/",t=Ae.readdirSync(e),o={};for(let s in t)if(".gitkeep"!==t[s]&&".gitignore"!==t[s])for(n in i=a(e+t[s]),require(e+t[s]),o[i]=[],global[i])"function"==typeof global[i][n]&&(o[i][n]=!0);return o},a=function(e){return xe.basename(e).replace(".js","")},c=function(e){let t,i;for(t in i="",i+=" ApiRouter.setMap({\r\n",e)i+="\t"+t+":"+t+",\r\n";return i+="});\r\n"},h=function(e){let t,i,n="";for(t in e)if(".gitkeep"!==t&&".gitignore"!==t){for(i in n="",n+=t+" = function(){\r\n\r\n",e[t])n+="\tthis."+i+" = function(){\r\n\r\n",n+="\t\tlet args, toUserId;\r\n",n+="\t\targs = Array.prototype.slice.call(arguments);\r\n",n+="\t\ttoUserId = args.shift();\r\n",n+='\t\tLogicUser.sendToUser(toUserId, "'+t+'", "'+i+'", args);\r\n',n+="\t};\r\n\r\n";n+="};\r\n",n+=t+" = new "+t+"();\r\n",Ae.writeFileSync(CONST_DIR_COMPONENTS+"generated/"+t+".js",n)}}};CONST_IS_SERVER_SIDE&&(global.ApiRouter=Ce),void 0!==e.ApiRouter&&(e.ApiRouter.__path="components/base/ApiRouter.js");let Le=function(){let t=this,i=!1,n=!1;this.EVENT_MOUSE_MOUSE_DOWN=1,this.EVENT_MOUSE_MOUSE_TOUCH_START=100,this.EVENT_MOUSE_MOUSE_TOUCH_END=101,this.EVENT_MOUSE_MOUSE_UP=2,this.EVENT_MOUSE_CLICK=3,this.EVENT_MOUSE_MOVE=4,this.EVENT_MOUSE_OVER=5,this.EVENT_MOUSE_OUT=6,this.EVENT_KEY_DOWN=100,this.EVENT_KEY_UP=101,this.POINTER_HAND="pointer",this.POINTER_ARROW="default",this.eventNames=[],this.eventNames[this.EVENT_MOUSE_MOUSE_DOWN]="mousedown",this.eventNames[this.EVENT_MOUSE_MOUSE_UP]="mouseup",this.eventNames[this.EVENT_MOUSE_CLICK]="click",this.eventNames[this.EVENT_MOUSE_OVER]="mouseover",this.eventNames[this.EVENT_MOUSE_MOVE]="mousemove",this.eventNames[this.EVENT_MOUSE_OUT]="mouseout",this.eventNames[this.EVENT_KEY_DOWN]="keydown",this.eventNames[this.EVENT_KEY_UP]="keyup",this.eventNames[this.EVENT_MOUSE_MOUSE_TOUCH_START]="touchstart",this.eventNames[this.EVENT_MOUSE_MOUSE_TOUCH_END]="touchend";let o=[],s=[];this.lockEventsExcept=null;let l=null;this.init=function(){n=document.getElementById("appArea"),s.push(n);let t=document.createElement("style");t.type="text/css",t.innerHTML=".sepia { filter: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg'><filter id='old-timey'><feColorMatrix type='matrix' values='0.14 0.45 0.05 0 0 0.12 0.39 0.04 0 0 0.08 0.28 0.03 0 0 0 0 0 1 0'/></filter></svg>#old-timey\");-webkit-filter: sepia(0.5);-webkit-filter: sepia(85%) grayscale(50%);-moz-filter: sepia(70%);-ms-filter: sepia(70%);-o-filter: sepia(70%);filter: sepia(70%);}",t.innerHTML+=".gui-dom {  position: absolute; overflow: hidden}",t.innerHTML+="* {-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;}",document.getElementsByTagName("head")[0].appendChild(t),document.addEventListener("mousemove",function(e){o.forEach(function(t){t.call(null,e.clientX-n.offsetLeft,e.clientY-n.offsetTop)})}),r(function(){i=!i,l()}),this.fsSwitch=function(){l(!0),Le.isFullScreen()?c():a()};let l=function(e){let t;t=document.getElementById("vk_comments"),e&&!Le.isFullScreen()||!e&&Le.isFullScreen()?(t&&(t.style.display="none"),n.style.left=screen.availWidth/2-parseInt(n.style.width)/2+"px",n.style.top=screen.availHeight/2-parseInt(n.style.height)/2+"px"):(t&&(t.style.display=""),n.style.left="",n.style.top="")},a=function(){let t=e.document.body;t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen&&t.webkitRequestFullScreen()},c=function(){e.document.exitFullscreen?e.document.exitFullscreen():e.document.mozCancelFullScreen?e.document.mozCancelFullScreen():e.document.webkitCancelFullScreen&&e.document.webkitCancelFullScreen()}},this.createElement=function(e,t,i){let n;t||(t={}),e||De.log("GUI.createElement: не определен элемент:"+e,De.LEVEL_FATAL_ERROR),(n=new e).init&&"function"==typeof n.init||De.log("GUI.craeteElement: элемент должен иметь функцию init().",De.LEVEL_FATAL_ERROR,arguments),n.show&&"function"==typeof n.show||De.log("GUI.createElement: элемент должен иметь функцию show().",De.LEVEL_FATAL_ERROR,arguments),n.hide&&"function"==typeof n.hide||De.log("GUI.createElement: элемент должен иметь функцию hide().",De.LEVEL_FATAL_ERROR,arguments),n.redraw&&"function"==typeof n.redraw||De.log("GUI.createElement: элемент должен иметь функцию redraw().",De.LEVEL_FATAL_ERROR,arguments);for(let e in t)n[e]=t[e];return i?(Le.pushParent(i),n.init(),Le.popParent()):n.init(),n},this.pushParent=function(e){return s.push(e.__dom)},this.popParent=function(){return s.pop()},this.getCurrentParent=function(){return s[s.length-1]},this.createDom=function(e,i){let n;if((n=new Oe).init(void 0,e),l&&(n.__dom.tagId=l),i){for(let e in i)n[e]=i[e];i.animTracks&&(n.animTracks=i.animTracks,t.updateAnimTracks(n),He.register(n.animate))}return n},this.updateAnimTracks=function(e){if(e.animTracks)for(let t in e.animTracks){e.animData[t]={frameN:0,counter:0};for(let i in e.animTracks[t]){let n=e.animTracks[t][i];switch(n.type){case Le.ANIM_TYPE_ROTATE:n.currentAngle||(n.currentAngle=0);break;case Le.ANIM_TYPE_MOVIE:n.imageN||(n.imageN=0,e.src=n.images[n.imageN])}}}},this.createInput=function(e,t){let i;if((i=new Oe).init("input",e),t)for(let e in t)i[e]=t[e];return i},this.createCanvas=function(e,t){let i;if((i=new Oe).init("canvas",e),t)for(let e in t)i[e]=t[e];return i},this.bind=function(e,t,i,n){e.bind(t,i,n)},this.lockEvents=function(e){t.lockEventsExcept=e},this.unlockEvents=function(){t.lockEventsExcept=null},this.onMouseMove=function(e){o.push(e)};let r=function(e){document.addEventListener("fullscreenchange",e),document.addEventListener("mozfullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("msfullscreenchange",e)};this.isFullScreen=function(){return i},this.setTagId=function(e){l=e},this.copyAnimTracks=function(e){let t,i;return t=[],e.forEach(function(e,n){t[n]=[],e.forEach(function(e,o){i={};for(let t in e)i[t]=e[t];t[n][o]=i})}),t}};(Le=new Le).ANIM_TYPE_ROTATE=10,Le.ANIM_TYPE_MOVE=20,Le.ANIM_TYPE_MOVE_2=21,Le.ANIM_TYPE_GOTO=30,Le.ANIM_TYPE_MOVIE=40,Le.ANIM_TYPE_PAUSE=50,Le.ANIM_TYPE_STOP=60,void 0!==e.GUI&&(e.GUI.__path="../client/components/base/GUI.js");let Oe=function(){let e=this;this.__id=++Oe.lastId;let t={},i=!1,n=null;this.animTracks=[],this.animData=[],this.animPlayed=!1,this.init=function(e,i){for(let e in u)t[e]=void 0;e||(e="span"),(n=document.createElement(e)).className="gui-dom","input"===e&&(n.style.border="none"),n.ondragstart=function(){return!1},this.__dom=n,n.__dom=this,(i=i?i.__dom:Le.getCurrentParent()).appendChild(n)},this.show=function(){i||(i=!0,n.style.display="",e.redraw())},this.hide=function(){i&&(i=!1,n.style.display="none")},this.redraw=function(){if(i)for(let i in u)t[i]!==e[i]&&(u[i].call(),t[i]=e[i])};let o=null,s=[],l=null;this.animateStop=function(){o=null},this.animateOpacity=function(t,i,n){void 0!==i&&(e.opacity=i),e.opacity||(e.opacity=0),i=e.opacity,o=i<t?1:2,(s=[]).push(t),s.push(i),s.push(Math.abs((t-i)/24)),l=n,r()};let r=function(){switch(o){case 1:a.apply(this,s);break;case 2:c.apply(this,s);break;default:return}setTimeout(function(){r(),e.redraw()},l)},a=function(t,i,n){e.opacity<t?e.opacity+=n:(e.opacity=t,o=null)},c=function(t,i,n){e.opacity>t?e.opacity-=n:(e.opacity=t,o=null)};this.bind=function(t,i,o){let s;(s=Le.eventNames[t])||De.log("undefined gui eventId:"+t,De.LEVEL_FATAL_ERROR),n.addEventListener(s,function(t){if(Le.lockEventsExcept){let t,i;for(t=e.__dom,i=!0;t;)Le.lockEventsExcept.__dom===t&&(i=!1),t=t.parentElement;if(i)return}i.call(o,t,n)},!1)},this.setFocus=function(){n.focus()};let h=function(){let t;t=Pe.getPath(e.backgroundImage),e.width||e.height||!Pe.getPath(e.backgroundImage)||(e.width=Pe.getWidth(e.backgroundImage),e.height=Pe.getHeight(e.backgroundImage),u.height.call(),u.width.call()),n.style.backgroundImage="url("+t+")",e.backgroundPositionY=e.backgroundPositionY?e.backgroundPositionY:0,n.style.backgroundPositionX="-"+Pe.getX(e.backgroundImage)+"px",n.style.backgroundPositionY="-"+(Pe.getY(e.backgroundImage)+e.backgroundPositionY)+"px",n.style.backgroundRepeat="no-repeat",e.noScale?n.style.backgroundSize=Pe.getWidth(e.backgroundImage)+"px "+Pe.getHeight(e.backgroundImage)+"px":n.style.backgroundSize=e.width+"px "+e.height+"px"},u={x:function(){n.style.left=e.x+"px"},y:function(){n.style.top=e.y+"px"},width:function(){n.style.width=e.width+"px",e.backgroundImage&&h()},height:function(){n.style.height=e.height+"px",e.backgroundImage&&h()},backgroundPositionY:h,backgroundImage:h,backgroundSize:function(){n.style.backgroundSize=e.backgroundSize+"px"},innerHTML:function(){n.innerHTML=e.innerHTML},pointer:function(){n.style.cursor=e.pointer},opacity:function(){n.style.opacity=e.opacity},fontWeight:function(){n.style.fontWeight=e.fontWeight},fontSize:function(){n.style.fontSize=e.fontSize+"px"},fontFamily:function(){n.style.fontFamily=e.fontFamily},color:function(){n.style.color=e.color},textShadow:function(){n.style.textShadow=e.textShadow},borderRadius:function(){n.style.borderRadius=e.borderRadius},border:function(){n.style.border=e.border},borderTop:function(){n.style.borderTop=e.borderTop},borderRight:function(){n.style.borderRight=e.borderRight},borderBottom:function(){n.style.borderBottom=e.borderBottom},borderLeft:function(){n.style.borderLeft=e.borderLeft},padding:function(){n.style.padding=e.padding},boxShadow:function(){n.style.boxShadow=e.boxShadow},lineHeight:function(){n.style.lineHeight=e.lineHeight},background:function(){n.style.background=e.background},transform:function(){n.style.transform=e.transform},title:function(){n.setAttribute("title",e.title)},isItsepia:function(){n.className+="sepia"},alignText:function(){n.style.textAlign=e.alignText},zIndex:function(){n.style.zIndex=e.zIndex},overflow:function(){n.style.overflow=e.overflow},textDecoration:function(){n.style.textDecoration=e.textDecoration},rotate:function(){n.style.transform="rotate("+e.rotate+"deg)"}};this.animate=function(){if(e.animPlayed&&i)for(let t in e.animTracks)e.proccessTrack(t)},this.proccessTrack=function(t){let i;switch((i=e.animTracks[t][e.animData[t].frameN]).type){case Le.ANIM_TYPE_ROTATE:i.currentAngle>=360&&(i.currentAngle=0),e.transform="rotate("+(i.currentAngle+=i.angle)+"deg)",e.redraw();break;case Le.ANIM_TYPE_GOTO:e.animData[t].frameN=i.pos;break;case Le.ANIM_TYPE_MOVIE:i.imageN++,i.imageN===i.images.length&&(i.imageN=0),e.backgroundImage=i.images[i.imageN],e.redraw();break;case Le.ANIM_TYPE_MOVE:e.x+=i.vX,e.y+=i.vY,e.redraw();break;case Le.ANIM_TYPE_PAUSE:break;case Le.ANIM_TYPE_STOP:e.animPlayed=!1,i.callback&&i.callback()}e.animData[t].counter++,i.duration&&e.animData[t].counter>i.duration&&(e.animData[t].frameN++,e.animData[t].counter=0,void 0===e.animTracks[t][e.animData[t].frameN]&&(e.animPlayed=!1,e.animData[t].frameN=0,i.callback&&i.callback()))}};Oe.lastId=0,void 0!==e.GUIDom&&(e.GUIDom.__path="../client/components/base/GUIDom.js");let Pe=function(){this.getPath=function(e){return this.getMeta(e).path},this.getHeight=function(e){return this.getMeta(e).h},this.getWidth=function(e){return this.getMeta(e).w},this.getX=function(e){return this.getMeta(e).x},this.getY=function(e){return this.getMeta(e).y};let t={path:"",w:void 0,h:void 0,x:0,y:0},i=[];this.getMeta=function(n){return n&&0===n.indexOf("https://")||0===n.indexOf("http://")?(t.path=n,t):n&&e.imagesData[n]?e.imagesData[n]:-1!==i.indexOf(n)?t:(i.push(n),De.log("Image url not found for: "+n,De.LEVEL_ERROR),t.path="",t)}};var Ae;Pe=new Pe,void 0!==e.Images&&(e.Images.__path="../client/components/base/Images.js"),CONST_IS_SERVER_SIDE&&(Ae=require("fs"));let De=function(){let e=this,t=null,i=[];this.init=function(e){t=We.Logs.triggerLevel;for(let e=0;e<100;e++)i.push("--dummy--");e()},this.showCache=function(){for(let e in i)i[e]},this.log=function(s,l,r,a){let c,h,u,d,g,f,p,m,_,E;if(l||(l=De.LEVEL_DETAIL),!(l<t)){switch(p=(c=new Date).getFullYear(),g=n(c.getDate()),f=n(c.getMonth()+1),m=n(c.getHours()),_=n(c.getMinutes()),E=n(c.getSeconds()),u=(h=CONST_IS_CLIENT_SIDE?_+":"+E:g+"-"+f+"-"+p+" "+m+":"+_+":"+E)+" ["+(d=o[l])+"] "+s,r||(r=""),CONST_IS_SERVER_SIDE&&r&&(r=JSON.stringify(r)),i.push(u),i.shift(),a){default:switch(l){case De.LEVEL_ERROR:console.error(" > "+u,r);break;case De.LEVEL_WARNING:console.warn(" > "+u,r);break;default:console.log(" > "+u,r)}break;case De.CHANNEL_VK_PAYMENTS:Ae.writeFile(CONST_DIR_SERVER+"/logs/vk_payments.log",u+r+"\r\n",{flag:"a"},function(){});break;case De.CHANNEL_VK_STUFF:Ae.writeFile(CONST_DIR_SERVER+"/logs/vk_stuff.log",u+r+"\r\n",{flag:"a"},function(){});break;case De.CHANNEL_VK_HEALTH:Ae.writeFile(CONST_DIR_SERVER+"/logs/vk_health.log",u+r+"\r\n",{flag:"a"},function(){})}if(l!==De.LEVEL_ERROR&&De.LEVEL_FATAL_ERROR,l===De.LEVEL_FATAL_ERROR)throw e.showCache(),new Error("Vse polamalos'!")}};let n=function(e){return"00000".substr(0,2-e.toString().length)+e};this.setLevel=function(e){t=e},this.LEVEL_DETAIL=1,this.LEVEL_NOTIFY=2,this.LEVEL_WARNING=3,this.LEVEL_ERROR=4,this.LEVEL_FATAL_ERROR=5,this.alert=function(e,i){e<t||alert(i)};let o={};o[this.LEVEL_DETAIL]="d",o[this.LEVEL_NOTIFY]="N",o[this.LEVEL_WARNING]="w",o[this.LEVEL_ERROR]="E",o[this.LEVEL_FATAL_ERROR]="FE"};(De=new De).CHANNEL_VK_PAYMENTS=1,De.CHANNEL_VK_STUFF=2,De.CHANNEL_VK_HEALTH=3,De.depends=[],CONST_IS_SERVER_SIDE&&(global.Logs=De),void 0!==e.Logs&&(e.Logs.__path="components/base/Logs.js");let He=function(){let e=this;this.stack=[],this.init=function(e){setTimeout(He.iterate,15*We.OnIdle.animateInterval),e()},this.register=function(t){e.stack.push(t)},this.iterate=function(){for(let t in e.stack)e.stack[t]();setTimeout(He.iterate,We.OnIdle.animateInterval)}};He=new He,void 0!==e.OnIdle&&(e.OnIdle.__path="../client/components/base/OnIdle.js");let ve=function(){let e,t=this,i=[];this.addBlocks=function(e){e.forEach(function(e){i.push({block:e,showed:!1}),e.init||De.log("PageController.addPage. block must have method init(). ",De.LEVEL_FATAL_ERROR,e),e.show||De.log("PageController.addPage. block must have method show().",De.LEVEL_FATAL_ERROR,e),e.hide||De.log("PageController.addPage. block must have method hide()",De.LEVEL_FATAL_ERROR,e),e.redraw||De.log("PageController.addPage. block must have method redraw()",De.LEVEL_FATAL_ERROR,e),e.init()})},this.showBlocks=function(e){let n;for(let t in i){n=!1;for(let o in e)i[t].block===e[o]&&(n=!0);n?!1===i[t].showed&&(i[t].block.show(),i[t].showed=!0):!0===i[t].showed&&(i[t].block.hide(),i[t].showed=!1)}t.redraw()};let n=!1;this.redrawCount=0,this.pendingData=function(e){n=e};let o=null;this.redraw=function(){if(n)o||(o=setTimeout(ve.redraw,1e3));else{o=null,ve.redrawCount++;for(let e in i)i[e].block.redraw()}},this.showPage=function(i){e=i,t.showBlocks(i.blocks)},this.isShowedNow=function(t){return t===e},this.getCurrentPage=function(){return e}};ve=new ve,void 0!==e.PageController&&(e.PageController.__path="../client/components/base/PageController.js");let Be=function(){this.start=function(e){},this.stop=function(e){},this.getNewId=function(e){},this.printReport=function(){},this.saveToDB=function(){},this.getTextReport=function(){},this.init=function(e){}};Be=new Be,void 0!==e.Profiler&&(e.Profiler.__path="../client/components/base/Profiler.js");let Re=function(){let e=this,t=null;this.init=function(t){switch(De.log("SocNet.Init()",De.LEVEL_NOTIFY),e.getType()){case Re.TYPE_VK:e.__proto__=ke;break;case Re.TYPE_STANDALONE:e.__proto__=Ne;break;default:De.log("Wrong soc net type",De.LEVEL_FATAL_ERROR)}e.__proto__.init(t)},this.getType=function(){return t||(ke.detectIsItThat()&&(t=Re.TYPE_VK),Ne.detectIsItThat()&&(t=Re.TYPE_STANDALONE),t||De.log("Не удалось определить тип социальной сети(платформы)",De.LEVEL_FATAL_ERROR)),t}};(Re=new Re).TYPE_VK=1,Re.TYPE_STANDALONE=2,Re.SEX_UNKNOWN=1,Re.SEX_WOMAN=2,Re.SEX_MAN=3,void 0!==e.SocNet&&(e.SocNet.__path="../client/components/base/SocNet.js");let Ne=function(){this.init=function(){},this.getAuthParams=function(){return{}},this.getUserProfileUrl=function(){return De.log("TODO Me, SocNetStandalone.getUserProfileUrl",De.LEVEL_WARNING),"/notFound/todo/me/please/:)"},this.openInviteFriendDialog=function(){De.log("todo me SocNetStandalone.openIvniteFirendDialog",De.LEVEL_WARNING),alert("Sorry, but functional is not realized!")},this.getSocNetUserId=function(){let e;return(e=parseInt(i("soc-net-user-id")))||(De.log("TODO Me. SocNetStandlaone.getSocNetUesrId and ... guset mode :)",De.LEVEL_WARNING),e=111),e};let t=[];for(let e=0;e<1e4;e++)t.push(e);this.getFriendIds=function(e){e(t)},this.getUserInfo=function(e,t){let i=["Кириллов Юрий Валериевич field-barrel.png","Пахомов Александр Григорьевич field-box.png","Негода Устин Леонидович field-red.png","Грабчак Роман Андреевич field-green.png","Наумов Людвиг Артёмович field-blue.png","Симонов Игнатий Васильевич field-purple.png","Харитонов Яромир Александрович field-yellow.png","Носков Людвиг Романович field-sand.png","Крюков Марк Романович field-poly-color.png","Киранов Марат Романович field-gold.png","Чубайк Николай Викторович field-poly-color.png","Пушкин Александр Сергеевич field-alpha.png","Билл Гейтс Ибнабабн field-beta.png","Стив Джоб Jobs field-gamma.png"],n={};this.getSocNetUserId(),n.first_name=i[e%i.length].split(" ")[0],n.last_name=i[e%i.length].split(" ")[1],n.photo_50=i[e%i.length].split(" ")[3],n.photo_100=i[e%i.length].split(" ")[3],n.id=e,n.sex=Re.SEX_UNKNOWN,t([n])},this.openOrderDialog=function(e){let t=O.getGoldProductByPrice(e);confirm("Купить "+t.quantity+"монет за "+e+" стенделонов?")},this.detectIsItThat=function(){return"STANDALONE"===e.PLATFORM_ID}};Ne=new Ne,void 0!==e.SocNetStandalone&&(e.SocNetStandalone.__path="../client/components/base/SocNetStandalone.js");let ke=function(){let t={};this.getAuthParams=function(){return{authKey:t.auth_key,appId:t.api_id}},this.getUserProfileUrl=function(e,t){return"http://vk.com/id"+t},this.openInviteFriendDialog=function(){VK.callMethod("showInviteBox")},this.openOrderDialog=function(e){VK.callMethod("showOrderBox",{type:"votes",votes:e})},this.getFriendIds=function(e){VK.api("friends.getAppUsers",{},function(t){e(t.response)})},this.getUserInfo=function(e,t){VK.api("users.get",{user_ids:e,fields:"photo_50,photo_100"},function(e){t(e.response)})},this.init=function(){let e,n;e=function(){De.log("VK client API inited.",De.LEVEL_NOTIFY)},n=function(){alert("Произошла ошибка доступа к вКонтакте, обратитесь к автору приложения."),De.log("SocNetVK Fail",De.LEVEL_FATAL_ERROR)},VK.init(e,n,"5.95"),t={viewer_id:i("viewer_id"),api_id:i("api_id"),auth_key:i("auth_key"),secret:i("secret"),access_token:i("access_token")}},this.getSocNetUserId=function(){return t.viewer_id},this.detectIsItThat=function(){return"VK"==e.PLATFORM_ID}};ke=new ke,void 0!==e.SocNetVK&&(e.SocNetVK.__path="../client/components/base/SocNetVK.js");let Fe=function(){let e=this,t={};this.enabled=!0,this.PATH_CHALK="/sounds/chalk.mp3",this.toggle=function(){e.enabled?e.off():e.on()},this.isEnabled=function(){return e.enabled},this.on=function(){e.enabled=!0,document.cookie="settings_sound=on"},this.off=function(){e.enabled=!1,document.cookie="settings_sound=off"},this.play=function(i,n){e.enabled&&(t[i]||(t[i]=new Audio(i+"?t=1123")),n||(n=1),t[i].volume=n,t[i].play())},-1!==document.cookie.search("settings_sound=off")&&e.off()};Fe=new Fe,void 0!==e.Sounds&&(e.Sounds.__path="../client/components/base/Sounds.js");let Me=function(){let t,i=this,n=null,o=null,s=null,l=null;this.init=function(i){s="https:"==e.document.location.protocol?"wss":"ws",n=We.WebSocketClient.host,o=We.WebSocketClient.port,t=We.WebSocketClient.url,i()},this.onData=null,this.onConnect=null,this.onDisconnect=null,this.sendData=function(e){return c.push(e),I(),!0},this.run=function(){r(),d()};let r=function(){"function"!=typeof i.onConnect&&De.log("onConnect must be function",De.LEVEL_FATAL_ERROR,i.onConnect),"function"!=typeof i.onDisconnect&&De.log("onConnect must be function",De.LEVEL_FATAL_ERROR,i.onDisconnect),"function"!=typeof i.onData&&De.log("onConnect must be function",De.LEVEL_FATAL_ERROR,i.onData)},a=!1,c=[],h=null,u=0,d=function(){g()},g=function(){let e;u++,e=s+"://"+n+":"+o+t,De.log("WebSocket, connectCount:"+u,De.LEVEL_NOTIFY,{uri:e}),(h=new WebSocket(e)).onopen=f,h.onclose=p,h.onmessage=_,h.onerror=E},f=function(){a=!0,I(),l=++Me.connectionId,i.onConnect(l)},p=function(e){a=!1,u--,e.wasClean?De.log("WebSocket: Соединение закрыто успешно."):De.log("WebSocket: Соединение закрыто, отсутствует соединение."),De.log("WebSocket: Код: "+e.code+" причина: "+e.reason),i.onDisconnect(l),setTimeout(m,3e3)},m=function(){!1===a&&(De.log("Try reconnect",De.LEVEL_NOTIFY),u<3&&g())},_=function(e){i.onData(e.data,l)},E=function(e){De.log("WebSocket: Ошибка ",De.LEVEL_NOTIFY,e.timeStamp)},I=function(){let e;c.length&&a&&(e=c.shift(),h.send(e),c.length&&setTimeout(I,1500))}};Me.connectionId=0,void 0!==e.WebSocketClient&&(e.WebSocketClient.__path="../client/components/base/WebSocketClient.js");let We={Logs:{triggerLevel:De.LEVEL_DETAIL},WebSocketClient:{host:"local.host",port:443,url:"/service"},SocNet:{appId:6221265},OnIdle:{animateInterval:1e3/33.3,second:-1,animStep:1}};We.OnIdle.second=33.3*We.OnIdle.animateInterval/We.OnIdle.animStep,void 0!==e["config.local.host.tri-base"]&&(e["config.local.host.tri-base"].__path="../client/config.local.host.tri-base.js"),e.onload=function(){(ee=new ee).main()},void 0!==e.run&&(e.run.__path="../client//run.js"),SAPIChest=function(){this.openChest=function(){Ce.executeRequest("SAPIChest","openChest",arguments)}},SAPIChest=new SAPIChest,SAPIMap=function(){this.reloadLevels=function(){Ce.executeRequest("SAPIMap","reloadLevels",arguments)},this.sendMeMapInfo=function(){Ce.executeRequest("SAPIMap","sendMeMapInfo",arguments)},this.sendMeUsersScore=function(){Ce.executeRequest("SAPIMap","sendMeUsersScore",arguments)},this.finishLevel=function(){Ce.executeRequest("SAPIMap","finishLevel",arguments)}},SAPIMap=new SAPIMap,SAPIStuff=function(){this.sendMeStuff=function(){Ce.executeRequest("SAPIStuff","sendMeStuff",arguments)},this.usedHummer=function(){Ce.executeRequest("SAPIStuff","usedHummer",arguments)},this.usedShuffle=function(){Ce.executeRequest("SAPIStuff","usedShuffle",arguments)},this.usedlightning=function(){Ce.executeRequest("SAPIStuff","usedlightning",arguments)},this.buyHummer=function(){Ce.executeRequest("SAPIStuff","buyHummer",arguments)},this.buyShuffle=function(){Ce.executeRequest("SAPIStuff","buyShuffle",arguments)},this.buylightning=function(){Ce.executeRequest("SAPIStuff","buylightning",arguments)},this.buyHealth=function(){Ce.executeRequest("SAPIStuff","buyHealth",arguments)}},SAPIStuff=new SAPIStuff,SAPITimeServer=function(){this.sendMeTime=function(){Ce.executeRequest("SAPITimeServer","sendMeTime",arguments)}},SAPITimeServer=new SAPITimeServer,SAPIUser=function(){this.authorizeByVK=function(){Ce.executeRequest("SAPIUser","authorizeByVK",arguments)},this.authorizeByStandalone=function(){Ce.executeRequest("SAPIUser","authorizeByStandalone",arguments)},this.sendMeUserInfo=function(){Ce.executeRequest("SAPIUser","sendMeUserInfo",arguments)},this.sendMeUserListInfo=function(){Ce.executeRequest("SAPIUser","sendMeUserListInfo",arguments)},this.sendMeUserIdsBySocNet=function(){Ce.executeRequest("SAPIUser","sendMeUserIdsBySocNet",arguments)},this.onPlayFinish=function(){Ce.executeRequest("SAPIUser","onPlayFinish",arguments)},this.onPlayStart=function(){Ce.executeRequest("SAPIUser","onPlayStart",arguments)},this.zeroLife=function(){Ce.executeRequest("SAPIUser","zeroLife",arguments)}},SAPIUser=new SAPIUser,Ce.map2={SAPIChest:SAPIChest,SAPIMap:SAPIMap,SAPIStuff:SAPIStuff,SAPITimeServer:SAPITimeServer,SAPIUser:SAPIUser},document.addEventListener("DOMContentLoaded",function(){Le.init(),ve.addBlocks([le,re,ae,ce,he,ue]),de.init(),ge.init()})}_(window);